<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>数据库学习笔记 - 数据库保护</title>
    <meta name="description" content="  什么是事务（Transaction）什么是事务（Transaction）事务是用户定义的数据操作系列，这些操作可作为一个完整的工作单元（数据库的逻辑工作单位）。">

    <link rel="shortcut icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="stylesheet" href="/blog/css/main.css">
    <link rel="stylesheet" href="/blog/css/fontawesome/css/font-awesome.min.css ">
    <link rel="canonical" href="https://wr4javaee.github.io/blog/2016/05/25/db_trans/">
    <link rel="alternate" type="application/rss+xml" title="wr4javaee" href="https://wr4javaee.github.io/blog/feed.xml ">


    <script>
    // 百度统计代码
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?b2565d31550c78e030ced325d605abaa";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
    </script>


    <script>
    // google analytics
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-80991226-1', 'auto');
      ga('send', 'pageview');

    </script>

</head>


  <body>

    <header id="top">
    <div class="wrapper">
        <a href="/blog/" class="brand">wr4javaee</a>
        <small>搬砖者</small>
        <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button>
        <nav id="headerNav">
            <ul>
                <li>
                    
                    <a href="/blog/">
                    
                        <i class="fa fa-home"></i>主頁
                    </a>
                </li>

                
                    
                    <li>
                        
                        <a href="/blog/archive/">
                        
                            <i class="fa fa-archive"></i>章節列表
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/blog/category/">
                        
                            <i class="fa fa-th-list"></i>分類
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/blog/tag/">
                        
                            <i class="fa fa-tags"></i>標籤
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/blog/collection/">
                        
                            <i class="fa fa-bookmark"></i>收藏
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/blog/about/">
                        
                            <i class="fa fa-glyphicon-heart"></i>關於我
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/blog/Links/">
                        
                            <i class="fa fa-play"></i>Links
                        </a>
                    </li>
                    
                
                    
                
                    
                
                    
                
            </ul>
        </nav>
    </div>
</header>


        <div class="page clearfix" post>
    <div class="left">
        <h1>数据库学习笔记 - 数据库保护</h1>
        <div class="label">

            <div class="label-card">
                <i class="fa fa-calendar"></i>2016-05-25
            </div>

            <div class="label-card">
                
            </div>

            <div class="label-card">
                
            </div>

            <div class="label-card">
            


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#Database" title="Category: Database" rel="category">Database</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


            </div>

            <div class="label-card">
            
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <!--a href="/tag/#%E6%95%B0%E6%8D%AE%E5%BA%93" title="Tag: 数据库" rel="tag">数据库</a-->
        <a href="/tag/#数据库" title="Tag: 数据库" rel="tag">数据库</a>&nbsp;
    
        <!--a href="/tag/#%E4%BA%8B%E5%8A%A1" title="Tag: 事务" rel="tag">事务</a-->
        <a href="/tag/#事务" title="Tag: 事务" rel="tag">事务</a>&nbsp;
    
        <!--a href="/tag/#transaction" title="Tag: transaction" rel="tag">transaction</a-->
        <a href="/tag/#transaction" title="Tag: transaction" rel="tag">transaction</a>&nbsp;
    
        <!--a href="/tag/#acid" title="Tag: acid" rel="tag">acid</a-->
        <a href="/tag/#acid" title="Tag: acid" rel="tag">acid</a>&nbsp;
    
        <!--a href="/tag/#lock" title="Tag: lock" rel="tag">lock</a-->
        <a href="/tag/#lock" title="Tag: lock" rel="tag">lock</a>
    
  

</span>

            </div>

        </div>
        <hr>
            <article itemscope itemtype="http://schema.org/BlogPosting">
            <ul id="markdown-toc">
  <li><a href="#transaction" id="markdown-toc-transaction">什么是事务（Transaction）</a></li>
  <li><a href="#acid" id="markdown-toc-acid">事务的特性（ACID）</a></li>
  <li><a href="#section" id="markdown-toc-section">并发控制</a>    <ul>
      <li><a href="#lost-update" id="markdown-toc-lost-update">丢失更新（Lost Update）</a></li>
      <li><a href="#dirty-reads" id="markdown-toc-dirty-reads">脏读（Dirty Reads）</a></li>
      <li><a href="#non-repeatable-reads" id="markdown-toc-non-repeatable-reads">不可重复读（Non-repeatable Reads）</a></li>
      <li><a href="#phantom-reads" id="markdown-toc-phantom-reads">幻读（Phantom Reads）</a></li>
    </ul>
  </li>
  <li><a href="#section-1" id="markdown-toc-section-1">事务的隔离级别</a>    <ul>
      <li><a href="#read-uncommitted" id="markdown-toc-read-uncommitted">未授权读取（Read Uncommitted）</a></li>
      <li><a href="#read-committed" id="markdown-toc-read-committed">授权读取（Read Committed）</a></li>
      <li><a href="#repeatable-read" id="markdown-toc-repeatable-read">可重复读（Repeatable Read）</a></li>
      <li><a href="#serializable" id="markdown-toc-serializable">串行化（Serializable）</a></li>
    </ul>
  </li>
  <li><a href="#section-2" id="markdown-toc-section-2">分布式事务</a>    <ul>
      <li><a href="#cap" id="markdown-toc-cap">CAP定理</a></li>
      <li><a href="#base" id="markdown-toc-base">BASE理论</a></li>
    </ul>
  </li>
  <li><a href="#section-3" id="markdown-toc-section-3">一致性协议</a>    <ul>
      <li><a href="#pctwo-phase-commit" id="markdown-toc-pctwo-phase-commit">2PC二阶段提交协议（Two-Phase Commit）</a></li>
      <li><a href="#pc" id="markdown-toc-pc">3PC</a></li>
    </ul>
  </li>
  <li><a href="#section-4" id="markdown-toc-section-4">锁</a>    <ul>
      <li><a href="#pessimistic-concurrency-control-pcc" id="markdown-toc-pessimistic-concurrency-control-pcc">悲观锁（Pessimistic Concurrency Control， PCC）</a></li>
      <li><a href="#optimistic-concurrency-control-occ" id="markdown-toc-optimistic-concurrency-control-occ">乐观锁 （Optimistic Concurrency Control， OCC）</a></li>
    </ul>
  </li>
</ul>

<h2 id="transaction">什么是事务（Transaction）</h2>

<p>事务是用户定义的数据操作系列，这些操作可作为一个完整的工作单元（数据库的逻辑工作单位）。</p>

<hr />

<h2 id="acid">事务的特性（ACID）</h2>

<ul>
  <li>原子性（Atomicity）事务中的操作要么都做，要么都不做。</li>
  <li>一致性（Consistency）只有合法的数据可以被写入数据库，否则事务应该将其回滚到最初状态。</li>
  <li>隔离性（Isolation）数据库中一个事务的执行不能被其他事务干扰。</li>
  <li>持久性（Durability）事务一旦提交，其对数据库中数据的改变就是永久的。</li>
</ul>

<hr />

<h2 id="section">并发控制</h2>

<p>并发问题导致的异常情况归类如下：</p>

<h4 id="lost-update">丢失更新（Lost Update）</h4>

<p>两个事务都同时更新一行数据，第一个事务的提交结果被第二个事务的提交结果破坏。</p>

<p><img src="https://wr4javaee.github.io/blog/images/db/transaction/2016_05_26_lost_update.png" alt="lost_update" /></p>

<h4 id="dirty-reads">脏读（Dirty Reads）</h4>

<p>一个事务读了某个失败事务运行过程中的数据。</p>

<p><img src="https://wr4javaee.github.io/blog/images/db/transaction/2016_05_26_dirty_reads.png" alt="ldirty_reads" /></p>

<h4 id="non-repeatable-reads">不可重复读（Non-repeatable Reads）</h4>

<p>一个事务对同一行数据重复读取两次，但是却得到了不同的结果。</p>

<p><img src="https://wr4javaee.github.io/blog/images/db/transaction/2016_05_26_non_repeatable_reads.png" alt="non_repeatable_reads" /></p>

<h4 id="phantom-reads">幻读（Phantom Reads）</h4>

<p>幻读实际属于不可重复读的范畴。它指当事务T1按照一定条件读取某些数据，事务T2对其中部分记录做了删除或更新操作，当事务T1再次以相同条件读取数据时，发现少或多了某些记录。</p>

<hr />

<h2 id="section-1">事务的隔离级别</h2>

<h4 id="read-uncommitted">未授权读取（Read Uncommitted）</h4>
<p>也称读未提交，隔离级别最低，允许脏读。</p>

<h4 id="read-committed">授权读取（Read Committed）</h4>
<p>也称读已提交，允许不可重复读。</p>

<h4 id="repeatable-read">可重复读（Repeatable Read）</h4>
<p>允许出现幻读。</p>

<h4 id="serializable">串行化（Serializable）</h4>
<p>最严格的事务隔离级别，要求所有事务都被串行执行。</p>

<p><img src="https://wr4javaee.github.io/blog/images/db/transaction/2016_05_26_transaction_isolation_level.png" alt="transaction_isolation_level" /></p>

<table>
  <thead>
    <tr>
      <th>隔离级别</th>
      <th>脏读</th>
      <th>可重复读</th>
      <th>幻读</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>未授权读取</td>
      <td>存在</td>
      <td>不可以</td>
      <td>存在</td>
    </tr>
    <tr>
      <td>授权读取</td>
      <td>不存在</td>
      <td>不可以</td>
      <td>存在</td>
    </tr>
    <tr>
      <td>可重复读取</td>
      <td>不存在</td>
      <td>可以</td>
      <td>存在</td>
    </tr>
    <tr>
      <td>串行化</td>
      <td>不存在</td>
      <td>可以</td>
      <td>不存在</td>
    </tr>
  </tbody>
</table>

<h1 id="section-2">分布式事务</h1>

<h2 id="cap">CAP定理</h2>
<p>一个分布式系统不可能同时满足一致性（Consistency）、可用性（Availability）、分区容错性（Partition tolerance），最多只能同时满足其中两项。</p>

<h2 id="base">BASE理论</h2>

<h1 id="section-3">一致性协议</h1>

<p>协调者：统一调度所有分布式节点执行逻辑组件。
参与者：被协调者调度的分布式节点。</p>

<h2 id="pctwo-phase-commit">2PC二阶段提交协议（Two-Phase Commit）</h2>

<h2 id="pc">3PC</h2>

<h1 id="section-4">锁</h1>

<h2 id="pessimistic-concurrency-control-pcc">悲观锁（Pessimistic Concurrency Control， PCC）</h2>
<p>又称排他锁，若事务T1使用悲观锁对数据进行处理，则处理完成前，其他事务均不能对数据进行更新操作。</p>

<h2 id="optimistic-concurrency-control-occ">乐观锁 （Optimistic Concurrency Control， OCC）</h2>
<p>乐观锁事务控制分为三阶段，分别是：数据读取、写入校验、数据写入。</p>


            </article>
        <hr>
        
        
            
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
                    
                
            
        
        

        <div class="post-recent">
    <div class="pre">
        
        <p><strong>上一篇</strong> <a href="/blog/2016/05/22/blog_start/">使用Jekyll在github上搭建博客</a></p>
        
    </div>
    <div class="nex">

        
        <p><strong>下一篇</strong> <a href="/blog/2016/06/17/zookeeper-01/">Zookeeper学习笔记一之Paxos算法</a></p>
        
    </div>
</div>


        <h2 id="comments">Comments</h2>
        
<!-- 多说评论框 start -->
<div class="ds-thread" data-thread-key="https://wr4javaee.github.io/2016/05/25/db_trans/" data-title="数据库学习笔记 - 数据库保护" data-url="https://wr4javaee.github.io/2016/05/25/db_trans/"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
    var duoshuoQuery = {
        short_name: "wr4javaee"
    };
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';
        ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
</script>
<!-- 多说公共JS代码 end -->






    </div>
    <button class="anchor"><i class="fa fa-anchor"></i></button>
    <div class="right">
        <div class="wrap">

            <!-- Content -->
            <div class="side content">
                <div>
                    Content
                </div>
                <ul id="content-side" class="content-ul">
                    <li><a href="#similar_posts">Similar Posts</a></li>
                    <li><a href="#comments">Comments</a></li>
                </ul>
            </div>
            <!-- 其他div框放到这里 -->
            <!-- <div class="side">bbbb</div> -->
        </div>
    </div>
</div>
<script>
/**
 * target _blank
 */
(function() {
    var aTags = document.querySelectorAll('article a:not([id])')
    for (var i = 0; i < aTags.length; i++) {
        aTags[i].setAttribute('target', '_blank')
    }
}());
</script>
<script src="/blog/js/pageContent.js " charset="utf-8"></script>


    <footer class="site-footer">


    <div class="wrapper">

        <p class="description">
            
        </p>
        <p class="contact">
            聯繫方式: 
            <a href="https://github.com/wr4javaee" title="GitHub"><i class="fa fa-github" aria-hidden="true"></i></a>  
            <a href="mailto:wr4javaee@126.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a>  
            <a href="http://weibo.com/wr4javaee" title="Weibo"><i class="fa fa-weibo" aria-hidden="true"></i></a>  
            <a href="https://www.zhihu.com/people/wr4javaee" title="Zhihu"><i class="iconfont">&#xe829;</i></a>  
            <a href="https://twitter.com/wr4javaee" title="Twitter"><i class="fa fa-twitter" aria-hidden="true"></i></a>  
            <a href="https://www.facebook.com/wr4javaee" title="Facebook"><i class="fa fa-facebook-official" aria-hidden="true"></i></a>   
            <a href="https://www.linkedin.com/in/wr4javaee" title="LinkedIn"><i class="fa fa-linkedin" aria-hidden="true"></i></a>  
        </p>
        <p>
            本站总访问量<span id="busuanzi_value_site_pv"></span>次，本站访客数<span id="busuanzi_value_site_uv"></span>人次，本文总阅读量<span id="busuanzi_value_page_pv"></span>次
        </p>
        <!--<p class="power">
            <span>
                Site powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://pages.github.com/">Github Pages</a>.
            </span>
            <span>
                Theme designed by <a href="https://github.com/Gaohaoyang">HyG</a>.
            </span>
        </p> -->
    </div>
</footer>
<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <div class="back-to-top">
    <a href="#top" class="scroll">
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

    <script src="/blog/js/main.js " charset="utf-8"></script>
    <script src="/blog/js/scroll.min.js " charset="utf-8"></script>
  </body>

</html>
