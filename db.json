{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"source/CNAME","path":"CNAME","modified":1,"renderable":0},{"_id":"source/images/blog_create/create_repository.png","path":"images/blog_create/create_repository.png","modified":1,"renderable":0},{"_id":"source/images/blog_create/git_branch.png","path":"images/blog_create/git_branch.png","modified":1,"renderable":0},{"_id":"source/images/blog_create/hexo_clean.png","path":"images/blog_create/hexo_clean.png","modified":1,"renderable":0},{"_id":"source/images/blog_create/hexo_files.png","path":"images/blog_create/hexo_files.png","modified":1,"renderable":0},{"_id":"source/images/blog_create/hexo_files_after_generate_1.png","path":"images/blog_create/hexo_files_after_generate_1.png","modified":1,"renderable":0},{"_id":"source/images/blog_create/hexo_files_after_generate_2.png","path":"images/blog_create/hexo_files_after_generate_2.png","modified":1,"renderable":0},{"_id":"source/images/blog_create/jekyll_default_page.png","path":"images/blog_create/jekyll_default_page.png","modified":1,"renderable":0},{"_id":"source/images/blog_create/jekyll_files.png","path":"images/blog_create/jekyll_files.png","modified":1,"renderable":0},{"_id":"source/images/blog_create/settings_lunch.png","path":"images/blog_create/settings_lunch.png","modified":1,"renderable":0},{"_id":"source/images/curator/retrypolicy_extends.png","path":"images/curator/retrypolicy_extends.png","modified":1,"renderable":0},{"_id":"themes/hiero/source/css/comment.css","path":"css/comment.css","modified":1,"renderable":1},{"_id":"themes/hiero/source/css/glyphs.css","path":"css/glyphs.css","modified":1,"renderable":1},{"_id":"themes/hiero/source/css/hiero.css","path":"css/hiero.css","modified":1,"renderable":1},{"_id":"themes/hiero/source/css/style.styl","path":"css/style.styl","modified":1,"renderable":1},{"_id":"themes/hiero/source/fancybox/blank.gif","path":"fancybox/blank.gif","modified":1,"renderable":1},{"_id":"themes/hiero/source/fancybox/fancybox_loading.gif","path":"fancybox/fancybox_loading.gif","modified":1,"renderable":1},{"_id":"themes/hiero/source/fancybox/fancybox_loading@2x.gif","path":"fancybox/fancybox_loading@2x.gif","modified":1,"renderable":1},{"_id":"themes/hiero/source/fancybox/fancybox_overlay.png","path":"fancybox/fancybox_overlay.png","modified":1,"renderable":1},{"_id":"themes/hiero/source/fancybox/fancybox_sprite.png","path":"fancybox/fancybox_sprite.png","modified":1,"renderable":1},{"_id":"themes/hiero/source/fancybox/fancybox_sprite@2x.png","path":"fancybox/fancybox_sprite@2x.png","modified":1,"renderable":1},{"_id":"themes/hiero/source/fancybox/jquery.fancybox.css","path":"fancybox/jquery.fancybox.css","modified":1,"renderable":1},{"_id":"themes/hiero/source/fancybox/jquery.fancybox.js","path":"fancybox/jquery.fancybox.js","modified":1,"renderable":1},{"_id":"themes/hiero/source/fancybox/jquery.fancybox.pack.js","path":"fancybox/jquery.fancybox.pack.js","modified":1,"renderable":1},{"_id":"themes/hiero/source/js/insight.js","path":"js/insight.js","modified":1,"renderable":1},{"_id":"themes/hiero/source/js/main.js","path":"js/main.js","modified":1,"renderable":1},{"_id":"themes/hiero/source/js/script.js","path":"js/script.js","modified":1,"renderable":1},{"_id":"themes/hiero/source/js/totop.js","path":"js/totop.js","modified":1,"renderable":1},{"_id":"themes/hiero/source/preview/browser-support.png","path":"preview/browser-support.png","modified":1,"renderable":1},{"_id":"source/images/blog_create/hexo_github.png","path":"images/blog_create/hexo_github.png","modified":1,"renderable":0},{"_id":"source/images/blog_create/lunch_page1.png","path":"images/blog_create/lunch_page1.png","modified":1,"renderable":0},{"_id":"themes/hiero/source/css/bootstrap.css","path":"css/bootstrap.css","modified":1,"renderable":1},{"_id":"themes/hiero/source/js/bootstrap.js","path":"js/bootstrap.js","modified":1,"renderable":1},{"_id":"themes/hiero/source/js/jquery-3.1.1.min.js","path":"js/jquery-3.1.1.min.js","modified":1,"renderable":1},{"_id":"source/images/blog_create/settings_theme.png","path":"images/blog_create/settings_theme.png","modified":1,"renderable":0},{"_id":"source/images/db/transaction/2016_05_26_dirty_reads.png","path":"images/db/transaction/2016_05_26_dirty_reads.png","modified":1,"renderable":0},{"_id":"source/images/db/transaction/2016_05_26_lost_update.png","path":"images/db/transaction/2016_05_26_lost_update.png","modified":1,"renderable":0},{"_id":"source/images/db/transaction/2016_05_26_non_repeatable_reads.png","path":"images/db/transaction/2016_05_26_non_repeatable_reads.png","modified":1,"renderable":0},{"_id":"source/images/networking_protocol/tcp/2016_07_03_01.jpg","path":"images/networking_protocol/tcp/2016_07_03_01.jpg","modified":1,"renderable":0},{"_id":"source/images/networking_protocol/tcp/2016_07_03_02.jpg","path":"images/networking_protocol/tcp/2016_07_03_02.jpg","modified":1,"renderable":0},{"_id":"source/images/zookeeper/zab/2016_07_18_zab_message_broadcast.png","path":"images/zookeeper/zab/2016_07_18_zab_message_broadcast.png","modified":1,"renderable":0},{"_id":"themes/hiero/source/css/fonts/FontAwesome.otf","path":"css/fonts/FontAwesome.otf","modified":1,"renderable":1},{"_id":"themes/hiero/source/css/fonts/athemes-glyphs.woff","path":"css/fonts/athemes-glyphs.woff","modified":1,"renderable":1},{"_id":"themes/hiero/source/css/fonts/fontawesome-webfont.eot","path":"css/fonts/fontawesome-webfont.eot","modified":1,"renderable":1},{"_id":"themes/hiero/source/css/fonts/fontawesome-webfont.woff","path":"css/fonts/fontawesome-webfont.woff","modified":1,"renderable":1},{"_id":"themes/hiero/source/css/images/avatar.png","path":"css/images/avatar.png","modified":1,"renderable":1},{"_id":"themes/hiero/source/css/images/favicon.ico","path":"css/images/favicon.ico","modified":1,"renderable":1},{"_id":"themes/hiero/source/css/images/rocket.png","path":"css/images/rocket.png","modified":1,"renderable":1},{"_id":"themes/hiero/source/fancybox/helpers/fancybox_buttons.png","path":"fancybox/helpers/fancybox_buttons.png","modified":1,"renderable":1},{"_id":"themes/hiero/source/fancybox/helpers/jquery.fancybox-buttons.css","path":"fancybox/helpers/jquery.fancybox-buttons.css","modified":1,"renderable":1},{"_id":"themes/hiero/source/fancybox/helpers/jquery.fancybox-buttons.js","path":"fancybox/helpers/jquery.fancybox-buttons.js","modified":1,"renderable":1},{"_id":"themes/hiero/source/fancybox/helpers/jquery.fancybox-media.js","path":"fancybox/helpers/jquery.fancybox-media.js","modified":1,"renderable":1},{"_id":"themes/hiero/source/fancybox/helpers/jquery.fancybox-thumbs.css","path":"fancybox/helpers/jquery.fancybox-thumbs.css","modified":1,"renderable":1},{"_id":"themes/hiero/source/fancybox/helpers/jquery.fancybox-thumbs.js","path":"fancybox/helpers/jquery.fancybox-thumbs.js","modified":1,"renderable":1},{"_id":"themes/hiero/source/preview/Hiero_home.png","path":"preview/Hiero_home.png","modified":1,"renderable":1},{"_id":"themes/hiero/source/preview/logo-preview.jpg","path":"preview/logo-preview.jpg","modified":1,"renderable":1},{"_id":"themes/hiero/source/css/fonts/fontawesome-webfont.ttf","path":"css/fonts/fontawesome-webfont.ttf","modified":1,"renderable":1},{"_id":"themes/hiero/source/preview/mobile-preview.png","path":"preview/mobile-preview.png","modified":1,"renderable":1},{"_id":"source/images/db/transaction/2016_05_26_transaction_isolation_level.png","path":"images/db/transaction/2016_05_26_transaction_isolation_level.png","modified":1,"renderable":0},{"_id":"source/images/blog_create/hexo_server_page.png","path":"images/blog_create/hexo_server_page.png","modified":1,"renderable":0},{"_id":"themes/hiero/source/css/fonts/fontawesome-webfont.svg","path":"css/fonts/fontawesome-webfont.svg","modified":1,"renderable":1},{"_id":"themes/hiero/source/css/images/pose.jpg","path":"css/images/pose.jpg","modified":1,"renderable":1},{"_id":"themes/hiero/source/preview/code-default-preview.png","path":"preview/code-default-preview.png","modified":1,"renderable":1},{"_id":"themes/hiero/source/preview/code-theme.jpg","path":"preview/code-theme.jpg","modified":1,"renderable":1}],"Cache":[{"_id":"source/CNAME","hash":"a4a2a3821004a971b91d6f18e70770a2b7bb75c7","modified":1469281796599},{"_id":"themes/hiero/.gitignore","hash":"58d26d4b5f2f94c2d02a4e4a448088e4a2527c77","modified":1492152210280},{"_id":"themes/hiero/.travis.yml","hash":"24851843a40973daaee47b2697e8b0dc4e6556b3","modified":1492152210280},{"_id":"themes/hiero/Gruntfile.js","hash":"71adaeaac1f3cc56e36c49d549b8d8a72235c9b9","modified":1492152210280},{"_id":"themes/hiero/LICENSE","hash":"e84291eaaeb4a02004d4aa6a504cbf9475f5c562","modified":1492152210280},{"_id":"themes/hiero/README.cn.md","hash":"fda2364991567a03c9517001221adfd8c4045fcb","modified":1492152210280},{"_id":"themes/hiero/README.md","hash":"11dfd3d56571c6356da77d624e2c3969f93d2204","modified":1492152210280},{"_id":"themes/hiero/_config.yml","hash":"ed056e1fd86dd8c8793a19332221244d013e05ec","modified":1492159706960},{"_id":"themes/hiero/package.json","hash":"2f2998f0db3e376d767dc9cddad9a6203952d6aa","modified":1492152210280},{"_id":"source/404/index.md","hash":"c41e79322880e63ca29836224985aef1e1027828","modified":1469235416156},{"_id":"source/_posts/blog_start.md","hash":"cb4b9ce656565f8973a4db25df9758e8c45f4fce","modified":1478422482767},{"_id":"source/_posts/db_trans.md","hash":"7cd969af49904dfea0b70725b7cb408947132157","modified":1469236458772},{"_id":"source/_posts/github_pages_init.md","hash":"f72bd9dad165fb61c55dfc6f9cf1928e43f62c15","modified":1478426356719},{"_id":"source/_posts/tcp-connection.md","hash":"e2f70b52e7ac78b48d6f5585d44c375d84aadca6","modified":1469236456225},{"_id":"source/_posts/zookeeper-01.md","hash":"513222ee177980d32dcabf61b3340be2bbfcf65c","modified":1469236452865},{"_id":"source/_posts/zookeeper-02.md","hash":"455191902368c191f367fb3a69beacb622d48b0b","modified":1469236445512},{"_id":"source/_posts/zookeeper_curator.md","hash":"3a0944ccace2e0b1a514bd842d61842539a3bc70","modified":1469794079187},{"_id":"source/_posts/zookeeper_deploy_and_client_using.md","hash":"267eb8df2497702ec21513817a4f45bbf27d0b15","modified":1469587363396},{"_id":"source/_posts/zookeeper_java_api.md","hash":"ff1087accfe27a884d539e07086a61e4170e27b3","modified":1469608133527},{"_id":"source/about/index.md","hash":"0cf4b9c89b79f8172160175a4236cad8363eeafc","modified":1469238072781},{"_id":"source/tags/index.md","hash":"64c8229e7c4d1d3b544c3d4130af9a0180f77765","modified":1469207864424},{"_id":"themes/hiero/.git/FETCH_HEAD","hash":"4c468e89c11211c99d2fb10a4499f2ef639f87df","modified":1492159166032},{"_id":"themes/hiero/.git/HEAD","hash":"acbaef275e46a7f14c1ef456fff2c8bbe8c84724","modified":1492152210256},{"_id":"themes/hiero/.git/ORIG_HEAD","hash":"c9e9c9de6c0668719266a4faa193573e6d642eaa","modified":1492159166056},{"_id":"themes/hiero/.git/config","hash":"af26f361dc88b949dea7d6315d3d55c99ee7f1d5","modified":1492152210260},{"_id":"themes/hiero/.git/description","hash":"9635f1b7e12c045212819dd934d809ef07efa2f4","modified":1492151030108},{"_id":"themes/hiero/.git/index","hash":"7ca480f014fdd79f7b24e2ab3c8a314500c5756a","modified":1492159149272},{"_id":"themes/hiero/.git/packed-refs","hash":"da981f684540ec398ff70219fdeebb247d8ddb78","modified":1492152210256},{"_id":"themes/hiero/languages/de.yml","hash":"3ebf0775abbee928c8d7bda943c191d166ded0d3","modified":1492152210280},{"_id":"themes/hiero/languages/default.yml","hash":"a7640a0c0c341fef694ed7367654cb5c2bde1af3","modified":1492152210280},{"_id":"themes/hiero/languages/en.yml","hash":"a7640a0c0c341fef694ed7367654cb5c2bde1af3","modified":1492152210280},{"_id":"themes/hiero/languages/es.yml","hash":"76edb1171b86532ef12cfd15f5f2c1ac3949f061","modified":1492152210280},{"_id":"themes/hiero/languages/fr.yml","hash":"84ab164b37c6abf625473e9a0c18f6f815dd5fd9","modified":1492152210280},{"_id":"themes/hiero/languages/nl.yml","hash":"12ed59faba1fc4e8cdd1d42ab55ef518dde8039c","modified":1492152210280},{"_id":"themes/hiero/languages/no.yml","hash":"965a171e70347215ec726952e63f5b47930931ef","modified":1492152210280},{"_id":"themes/hiero/languages/pt.yml","hash":"46bd5f121f4704e2cd6c0950ec18b549f03bfe5c","modified":1492152210280},{"_id":"themes/hiero/languages/ru.yml","hash":"4fda301bbd8b39f2c714e2c934eccc4b27c0a2b0","modified":1492152210280},{"_id":"themes/hiero/languages/zh-CN.yml","hash":"73c4a3d4ac3c5b89b096ed2cbea0dfce8586d2ad","modified":1492152210280},{"_id":"themes/hiero/languages/zh-TW.yml","hash":"ea111659185c7d0d9d1add6da9f19fdce6a1cb9e","modified":1492152210280},{"_id":"themes/hiero/layout/archive.ejs","hash":"8f56d91c8057fd045064379599a12460fdb16e1a","modified":1492152210280},{"_id":"themes/hiero/layout/categories.ejs","hash":"0788a872a9d407af8f0fad87f50416c11b512fc9","modified":1492152210280},{"_id":"themes/hiero/layout/category.ejs","hash":"765426a9c8236828dc34759e604cc2c52292835a","modified":1492152210280},{"_id":"themes/hiero/layout/index.ejs","hash":"aa1b4456907bdb43e629be3931547e2d29ac58c8","modified":1492152210280},{"_id":"themes/hiero/layout/layout.ejs","hash":"e96105f14a0ca9c53f0bf143c790c069a81fc2a2","modified":1492152210280},{"_id":"themes/hiero/layout/page.ejs","hash":"7d80e4e36b14d30a7cd2ac1f61376d9ebf264e8b","modified":1492152210280},{"_id":"themes/hiero/layout/post.ejs","hash":"7d80e4e36b14d30a7cd2ac1f61376d9ebf264e8b","modified":1492152210280},{"_id":"themes/hiero/layout/tag.ejs","hash":"eaa7b4ccb2ca7befb90142e4e68995fb1ea68b2e","modified":1492152210280},{"_id":"themes/hiero/layout/tags.ejs","hash":"d98cb3bbc72dab15b1b518e30cfda58ef35c842e","modified":1492152210280},{"_id":"themes/hiero/scripts/fancybox.js","hash":"aa411cd072399df1ddc8e2181a3204678a5177d9","modified":1492152210280},{"_id":"themes/hiero/scripts/hierarchical-categories.js","hash":"6f761c8bf1c44e8bd4f8cb3c77cb585480d7a6ca","modified":1492152210280},{"_id":"source/images/blog_create/create_repository.png","hash":"9cf2dff102ac975b7bd6d568941a889090dd3c59","modified":1476975467563},{"_id":"source/images/blog_create/git_branch.png","hash":"9c77d880ce6e0f0c35791ac17083115ca3b107ca","modified":1476977389623},{"_id":"source/images/blog_create/hexo_clean.png","hash":"2656b89b1834272c55bc945ed0ddb675966e8294","modified":1477028354056},{"_id":"source/images/blog_create/hexo_files.png","hash":"94171547d5c7529603c491cb22d218b7557adbb8","modified":1477026706035},{"_id":"source/images/blog_create/hexo_files_after_generate_1.png","hash":"b3b5d340cd6478f508468a7e2633a297c4d0fc20","modified":1477027779740},{"_id":"source/images/blog_create/hexo_files_after_generate_2.png","hash":"be3e2028b75a17c934e5cf53a251fb5d899ea67c","modified":1477027841128},{"_id":"source/images/blog_create/jekyll_default_page.png","hash":"6f34123cb958843bac5dd5c1b452fae69823d5ec","modified":1477041843915},{"_id":"source/images/blog_create/jekyll_files.png","hash":"4dadd12045ea80dd27f99e3aab694f231a510cb1","modified":1478400368237},{"_id":"source/images/blog_create/settings_lunch.png","hash":"10dc80584286fe3017864b205f0a4038932ba167","modified":1476976176990},{"_id":"source/images/curator/retrypolicy_extends.png","hash":"d4ae905fef78cf55251df81987acfcd37404c6d4","modified":1469776694819},{"_id":"themes/hiero/.git/hooks/applypatch-msg.sample","hash":"4de88eb95a5e93fd27e78b5fb3b5231a8d8917dd","modified":1492151030100},{"_id":"themes/hiero/.git/hooks/commit-msg.sample","hash":"ee1ed5aad98a435f2020b6de35c173b75d9affac","modified":1492151030108},{"_id":"themes/hiero/.git/hooks/post-update.sample","hash":"b614c2f63da7dca9f1db2e7ade61ef30448fc96c","modified":1492151030100},{"_id":"themes/hiero/.git/hooks/pre-applypatch.sample","hash":"f208287c1a92525de9f5462e905a9d31de1e2d75","modified":1492151030108},{"_id":"themes/hiero/.git/hooks/pre-commit.sample","hash":"36aed8976dcc08b5076844f0ec645b18bc37758f","modified":1492151030100},{"_id":"themes/hiero/.git/hooks/pre-push.sample","hash":"5c8518bfd1d1d3d2c1a7194994c0a16d8a313a41","modified":1492151030100},{"_id":"themes/hiero/.git/hooks/pre-rebase.sample","hash":"18be3eb275c1decd3614e139f5a311b75f1b0ab8","modified":1492151030108},{"_id":"themes/hiero/.git/hooks/prepare-commit-msg.sample","hash":"2b6275eda365cad50d167fe3a387c9bc9fedd54f","modified":1492151030108},{"_id":"themes/hiero/.git/hooks/update.sample","hash":"e729cd61b27c128951d139de8e7c63d1a3758dde","modified":1492151030108},{"_id":"themes/hiero/.git/info/exclude","hash":"c879df015d97615050afa7b9641e3352a1e701ac","modified":1492151030100},{"_id":"themes/hiero/.git/logs/HEAD","hash":"904b8e7e1912a6f5dc5c3ecbad990539d6d138a8","modified":1492152210260},{"_id":"themes/hiero/layout/_partial/after-footer.ejs","hash":"dbd54bc695dbb71e3475af74b824c3cdb2eb2336","modified":1492152210280},{"_id":"themes/hiero/layout/_partial/archive-post.ejs","hash":"29a9f178815ff7f9f1393d11afe016d7230a6b51","modified":1492152210280},{"_id":"themes/hiero/layout/_partial/archive.ejs","hash":"ba641e2e4801bcc9df994d0596823af1982b5a00","modified":1492152210280},{"_id":"themes/hiero/layout/_partial/article.ejs","hash":"547eba57e5d3f505279364959b94f5780f7ee6a4","modified":1492152210280},{"_id":"themes/hiero/layout/_partial/baidu-analytics.ejs","hash":"990da0a787e78a8e44973536cc2dd547ee5aeaaf","modified":1492152210280},{"_id":"themes/hiero/layout/_partial/busuanzi-analytics.ejs","hash":"fd1eaae085c84733016737b11efe8e6b5b86ae63","modified":1492152210280},{"_id":"themes/hiero/layout/_partial/cnzz-analytics.ejs","hash":"b0df992adf3c3c37189a66a98e6ef5ed06517ac4","modified":1492152210280},{"_id":"themes/hiero/layout/_partial/comment.ejs","hash":"30e1fe864841ac0e7244ae2593487eaa16583ffc","modified":1492152210280},{"_id":"themes/hiero/layout/_partial/facebook-sdk.ejs","hash":"06038db50d2e1febdefa3f8e1512b332c7da5a17","modified":1492152210280},{"_id":"themes/hiero/layout/_partial/footer.ejs","hash":"d57c3db1ebb4c8059263f3aa89cae053fa8aa38a","modified":1492152210280},{"_id":"themes/hiero/layout/_partial/gauges-analytics.ejs","hash":"aad6312ac197d6c5aaf2104ac863d7eba46b772a","modified":1492152210280},{"_id":"themes/hiero/layout/_partial/google-analytics.ejs","hash":"f921e7f9223d7c95165e0f835f353b2938e40c45","modified":1492152210280},{"_id":"themes/hiero/layout/_partial/head.ejs","hash":"7218c9a4526d4e3b260de621687ce56e997c6fd0","modified":1492152210280},{"_id":"themes/hiero/layout/_partial/header-post.ejs","hash":"8aeab1d7dd2443d461f59ae61ef4e47e3715748a","modified":1492152210280},{"_id":"themes/hiero/layout/_partial/jsHelper.ejs","hash":"39d8783c5381098bd79a065e3b2a5cff68486513","modified":1492152210280},{"_id":"themes/hiero/layout/_partial/mobile-nav.ejs","hash":"e952a532dfc583930a666b9d4479c32d4a84b44e","modified":1492152210280},{"_id":"themes/hiero/layout/_partial/sidebar.ejs","hash":"930da35cc2d447a92e5ee8f835735e6fd2232469","modified":1492152210280},{"_id":"themes/hiero/layout/_partial/tencent-analytics.ejs","hash":"93120ad06c5d73ca777470faf570e993a805e049","modified":1492152210280},{"_id":"themes/hiero/layout/_widget/archive.ejs","hash":"9fffde4e794b35f07c96eaec6d9373a40014da8f","modified":1492152210280},{"_id":"themes/hiero/layout/_widget/category.ejs","hash":"dd1e5af3c6af3f5d6c85dfd5ca1766faed6a0b05","modified":1492152210280},{"_id":"themes/hiero/layout/_widget/recent_posts.ejs","hash":"4ce0632c42a1aed974026c88ed945421e775695e","modified":1492152210280},{"_id":"themes/hiero/layout/_widget/search.ejs","hash":"9cd1f4d511e0cf5ffd95abb078bb683f2046000e","modified":1492152210280},{"_id":"themes/hiero/layout/_widget/social.ejs","hash":"013beb5d78dfe34507b766f551b4a43ff628a5fe","modified":1492152210280},{"_id":"themes/hiero/layout/_widget/tag.ejs","hash":"2de380865df9ab5f577f7d3bcadf44261eb5faae","modified":1492152210280},{"_id":"themes/hiero/layout/_widget/tagcloud.ejs","hash":"b4a2079101643f63993dcdb32925c9b071763b46","modified":1492152210280},{"_id":"themes/hiero/layout/search/baidu.ejs","hash":"5ab1e59191c95d58a9935f011c7e1a2129643b36","modified":1492152210280},{"_id":"themes/hiero/layout/search/index-mobile.ejs","hash":"50a727ac1dfe3073eb6fa6699ba01e66f4ac41c0","modified":1492152210280},{"_id":"themes/hiero/layout/search/index.ejs","hash":"6ac6b28dc2085613dd380f5b3419e3040f2313df","modified":1492152210280},{"_id":"themes/hiero/layout/search/insight.ejs","hash":"7d2a6d9639c08852345239d131784328ddf0493b","modified":1492152210280},{"_id":"themes/hiero/layout/search/swiftype.ejs","hash":"379e66d2c13526e72e4120c443f95fccf4edef71","modified":1492152210280},{"_id":"themes/hiero/source/css/_extend.styl","hash":"b099bbeb871790dbc9e1e48533a1f9a52c767506","modified":1492152210280},{"_id":"themes/hiero/source/css/_variables.styl","hash":"8d93f862667b31bfb7b62977322321ad3482e1aa","modified":1492152210284},{"_id":"themes/hiero/source/css/comment.css","hash":"7d6033b53a2ebf80b3c0a9f407de2a44e1315dd1","modified":1492152210284},{"_id":"themes/hiero/source/css/glyphs.css","hash":"c4088f9a347e42a31d9aabc8aa17ead3d1ed8b8e","modified":1492152210292},{"_id":"themes/hiero/source/css/hiero.css","hash":"4bda85324170af690d74790c7100d4eed4877057","modified":1492152210292},{"_id":"themes/hiero/source/css/style.styl","hash":"68118d98ad5fa1b2e1b0dc83a96782711735ffe9","modified":1492152210296},{"_id":"themes/hiero/source/fancybox/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1492152210296},{"_id":"themes/hiero/source/fancybox/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1492152210296},{"_id":"themes/hiero/source/fancybox/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1492152210296},{"_id":"themes/hiero/source/fancybox/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1492152210296},{"_id":"themes/hiero/source/fancybox/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1492152210296},{"_id":"themes/hiero/source/fancybox/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1492152210296},{"_id":"themes/hiero/source/fancybox/jquery.fancybox.css","hash":"aaa582fb9eb4b7092dc69fcb2d5b1c20cca58ab6","modified":1492152210296},{"_id":"themes/hiero/source/fancybox/jquery.fancybox.js","hash":"d08b03a42d5c4ba456ef8ba33116fdbb7a9cabed","modified":1492152210296},{"_id":"themes/hiero/source/fancybox/jquery.fancybox.pack.js","hash":"9e0d51ca1dbe66f6c0c7aefd552dc8122e694a6e","modified":1492152210296},{"_id":"themes/hiero/source/js/insight.js","hash":"2995f3f94d0a9887b08e38a6f5053b6ca2997c19","modified":1492152210296},{"_id":"themes/hiero/source/js/main.js","hash":"2381eccd9a1ac3d70988f9ea5a36d34f63153bcf","modified":1492152210296},{"_id":"themes/hiero/source/js/script.js","hash":"4964e125255a3f1afbf05728b331ad1fb1646e4d","modified":1492152210296},{"_id":"themes/hiero/source/js/totop.js","hash":"560baaa7bbf70ce67261b39aef61293646d9e539","modified":1492152210296},{"_id":"themes/hiero/source/preview/browser-support.png","hash":"a6d8498553550c6b18a8f22bcd2f53c993c7d677","modified":1492152210296},{"_id":"source/images/blog_create/hexo_github.png","hash":"e4a98cbf795c9ee8bc0300f29c0471c049bc79ec","modified":1477030252789},{"_id":"source/images/blog_create/lunch_page1.png","hash":"aae51818c3a82241b5d5536e2791a163f90c6470","modified":1476976341789},{"_id":"themes/hiero/source/css/_partial/footer.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1492152210280},{"_id":"themes/hiero/source/css/_partial/header-post.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1492152210280},{"_id":"themes/hiero/source/css/_partial/header.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1492152210280},{"_id":"themes/hiero/source/css/bootstrap.css","hash":"64fdc2e7c3f8a164d21c5632b5adbbb9990ea802","modified":1492152210284},{"_id":"themes/hiero/source/js/bootstrap.js","hash":"3b965a36a6b08854ad6eddedf85c5319fd392b4a","modified":1492152210296},{"_id":"themes/hiero/source/js/jquery-3.1.1.min.js","hash":"f647a6d37dc4ca055ced3cf64bbc1f490070acba","modified":1492152210296},{"_id":"source/images/blog_create/settings_theme.png","hash":"ab547f02878bb10d62ecec10a966c6baa0fcc0c3","modified":1476976472333},{"_id":"source/images/db/transaction/2016_05_26_dirty_reads.png","hash":"ef89b15685612b877aa4c7278ff30e6adbf84d55","modified":1464252633831},{"_id":"source/images/db/transaction/2016_05_26_lost_update.png","hash":"481d4c6f46e22ae6533fb15912e516e83f22705c","modified":1464252633831},{"_id":"source/images/db/transaction/2016_05_26_non_repeatable_reads.png","hash":"52086e3df5a1a0a71f6d0878f32d693b40490225","modified":1464252633831},{"_id":"source/images/networking_protocol/tcp/2016_07_03_01.jpg","hash":"6fbddcb68da45b4aa17561bdecd20b013e006c63","modified":1467625980818},{"_id":"source/images/networking_protocol/tcp/2016_07_03_02.jpg","hash":"ccb8d1b6516ae3c7c1d64b1552ad53132399469e","modified":1467626029142},{"_id":"source/images/zookeeper/zab/2016_07_18_zab_message_broadcast.png","hash":"0ab1ba5a166197ad7708488be8fbee1c9afa4c47","modified":1468910774957},{"_id":"themes/hiero/.git/objects/8a/d87040792bdc315d1282035602a954f993c032","hash":"39ec17a8ad8052f2bfe2020db79a4d2577b939ce","modified":1492159149272},{"_id":"themes/hiero/.git/refs/heads/master","hash":"c9e9c9de6c0668719266a4faa193573e6d642eaa","modified":1492152210260},{"_id":"themes/hiero/layout/_partial/post/busuanzi-analytics.ejs","hash":"125fcedc8baf7dc67587c2ded05bfa8df868989a","modified":1492152210280},{"_id":"themes/hiero/layout/_partial/post/category.ejs","hash":"7d167be432a0f41034f7e34ea33eb8748202358d","modified":1492152210280},{"_id":"themes/hiero/layout/_partial/post/date.ejs","hash":"3f9a9568dac4fc8d5122b8e4ac3052b4d2587b82","modified":1492152210280},{"_id":"themes/hiero/layout/_partial/post/gallery.ejs","hash":"30028f10a4f03561e53da323d06b292e1ae7990c","modified":1492152210280},{"_id":"themes/hiero/layout/_partial/post/mathjax.ejs","hash":"571c19f57c2b38ac5cd9b8f811cfad53b38616cf","modified":1492152210280},{"_id":"themes/hiero/layout/_partial/post/nav.ejs","hash":"16a904de7bceccbb36b4267565f2215704db2880","modified":1492152210280},{"_id":"themes/hiero/layout/_partial/post/tag.ejs","hash":"e6ab2d49029ed4b15204f84928b14b036a0c9c84","modified":1492152210280},{"_id":"themes/hiero/layout/_partial/post/title.ejs","hash":"a61267f27f2148321e549344be91dbc4e22e1a48","modified":1492152210280},{"_id":"themes/hiero/source/css/_partial/archive.styl","hash":"8415b0a3b8cf696be0470f01db071ee327e5cc0a","modified":1492152210280},{"_id":"themes/hiero/source/css/_partial/article.styl","hash":"01680989cf6a11d830e20cb09f0f3a9879325c06","modified":1492152210280},{"_id":"themes/hiero/source/css/_partial/comment.styl","hash":"f23dbf9c1224559314f7d10b7fee030a9ffab58a","modified":1492152210280},{"_id":"themes/hiero/source/css/_partial/highlight.styl","hash":"da12f49dcb4ea8484e2e46056ed5b148693693c8","modified":1492152210280},{"_id":"themes/hiero/source/css/_partial/insight.styl","hash":"f1a152ef3b6998e313b7771ce57cb675cd95b269","modified":1492152210280},{"_id":"themes/hiero/source/css/_partial/mobile.styl","hash":"fcfbaf24634519063af46953e0eb733a8ada5556","modified":1492152210280},{"_id":"themes/hiero/source/css/_partial/sidebar-aside.styl","hash":"67e8073e88bf48761e590dbd0f66eb376b748ba9","modified":1492152210280},{"_id":"themes/hiero/source/css/_partial/sidebar-bottom.styl","hash":"8fd4f30d319542babfd31f087ddbac550f000a8a","modified":1492152210280},{"_id":"themes/hiero/source/css/_partial/sidebar.styl","hash":"404ec059dc674a48b9ab89cd83f258dec4dcb24d","modified":1492152210280},{"_id":"themes/hiero/source/css/_util/grid.styl","hash":"0bf55ee5d09f193e249083602ac5fcdb1e571aed","modified":1492152210284},{"_id":"themes/hiero/source/css/_util/mixin.styl","hash":"44f32767d9fd3c1c08a60d91f181ee53c8f0dbb3","modified":1492152210284},{"_id":"themes/hiero/source/css/fonts/FontAwesome.otf","hash":"b5b4f9be85f91f10799e87a083da1d050f842734","modified":1492152210284},{"_id":"themes/hiero/source/css/fonts/athemes-glyphs.woff","hash":"f1ac9ffcc97571ceff48b68792c34de97bc289c0","modified":1492152210284},{"_id":"themes/hiero/source/css/fonts/fontawesome-webfont.eot","hash":"7619748fe34c64fb157a57f6d4ef3678f63a8f5e","modified":1492152210284},{"_id":"themes/hiero/source/css/fonts/fontawesome-webfont.woff","hash":"04c3bf56d87a0828935bd6b4aee859995f321693","modified":1492152210292},{"_id":"themes/hiero/source/css/images/avatar.png","hash":"84f20e6d6c4a984722c930b214d8fe2cab839b9f","modified":1469205699116},{"_id":"themes/hiero/source/css/images/favicon.ico","hash":"277372f07132304ea7933196b9cfa07fd23fa603","modified":1492152210292},{"_id":"themes/hiero/source/css/images/rocket.png","hash":"6dee0406955aa9b7a261161d30f2538a671e806b","modified":1492152210296},{"_id":"themes/hiero/source/fancybox/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1492152210296},{"_id":"themes/hiero/source/fancybox/helpers/jquery.fancybox-buttons.css","hash":"1a9d8e5c22b371fcc69d4dbbb823d9c39f04c0c8","modified":1492152210296},{"_id":"themes/hiero/source/fancybox/helpers/jquery.fancybox-buttons.js","hash":"dc3645529a4bf72983a39fa34c1eb9146e082019","modified":1492152210296},{"_id":"themes/hiero/source/fancybox/helpers/jquery.fancybox-media.js","hash":"294420f9ff20f4e3584d212b0c262a00a96ecdb3","modified":1492152210296},{"_id":"themes/hiero/source/fancybox/helpers/jquery.fancybox-thumbs.css","hash":"4ac329c16a5277592fc12a37cca3d72ca4ec292f","modified":1492152210296},{"_id":"themes/hiero/source/fancybox/helpers/jquery.fancybox-thumbs.js","hash":"47da1ae5401c24b5c17cc18e2730780f5c1a7a0c","modified":1492152210296},{"_id":"themes/hiero/source/preview/Hiero_home.png","hash":"7b430bf82a3f8f4194bac272822ed697e976117f","modified":1492152210296},{"_id":"themes/hiero/source/preview/logo-preview.jpg","hash":"18ec270e302e6870953bb59bf57052cd663659ec","modified":1492152210308},{"_id":"themes/hiero/source/css/fonts/fontawesome-webfont.ttf","hash":"7f09c97f333917034ad08fa7295e916c9f72fd3f","modified":1492152210292},{"_id":"themes/hiero/source/preview/mobile-preview.png","hash":"daa8cec3fdae123d97dd9893502e138a3779535e","modified":1492152210308},{"_id":"source/images/db/transaction/2016_05_26_transaction_isolation_level.png","hash":"4be9f35f444793aae1505124919a93babc853dc9","modified":1467098344894},{"_id":"themes/hiero/.git/logs/refs/heads/master","hash":"904b8e7e1912a6f5dc5c3ecbad990539d6d138a8","modified":1492152210260},{"_id":"themes/hiero/.git/refs/remotes/origin/HEAD","hash":"d9427cda09aba1cdde5c69c2b13c905bddb0bc51","modified":1492152210256},{"_id":"source/images/blog_create/hexo_server_page.png","hash":"c892ff0546af11bbc2d3a5554554816825abf88a","modified":1477028180212},{"_id":"themes/hiero/source/css/fonts/fontawesome-webfont.svg","hash":"46fcc0194d75a0ddac0a038aee41b23456784814","modified":1492152210292},{"_id":"themes/hiero/.git/logs/refs/remotes/origin/HEAD","hash":"904b8e7e1912a6f5dc5c3ecbad990539d6d138a8","modified":1492152210256},{"_id":"themes/hiero/source/css/images/pose.jpg","hash":"4d394a662e7d6d2de6a4598688c7cd3dba5c2fa3","modified":1492152210296},{"_id":"themes/hiero/source/preview/code-default-preview.png","hash":"0862313cb73a498155d72aa2fa309470b12bf0cd","modified":1492152210304},{"_id":"themes/hiero/.git/objects/pack/pack-58361e1d3e9f7be6457c8d31a64dbd68f8081c09.idx","hash":"e4ccd300248ff19d78b4f468107c5fbe648b11b2","modified":1492152210236},{"_id":"themes/hiero/source/preview/code-theme.jpg","hash":"8c8512fd04e6106033656d10e92d51de76cca6d8","modified":1492152210308},{"_id":"themes/hiero/.git/objects/pack/pack-58361e1d3e9f7be6457c8d31a64dbd68f8081c09.pack","hash":"b692f0a35312aa07f4a271cbb40267fba183e4b5","modified":1492152210228}],"Category":[{"name":"Jekyll","_id":"cj1hliwfo0005o65lo9b5joag"},{"name":"Database","_id":"cj1hliwg3000bo65lv3xtgwnu"},{"name":"Github Jekyll Hexo","_id":"cj1hliwgg000ho65l7t5hcwbo"},{"name":"TCP","_id":"cj1hliwgl000no65l5e48nzo2"},{"name":"Zookeeper","_id":"cj1hliwgm000ro65lnt0hvpyy"}],"Data":[],"Page":[{"title":"404","date":"2016-07-23T00:56:56.000Z","_content":"","source":"404/index.md","raw":"---\ntitle: 404\ndate: 2016-07-22 17:56:56\n---\n","updated":"2016-07-23T00:56:56.156Z","path":"404/index.html","comments":1,"layout":"page","_id":"cj1hliwek0000o65lwajdi3fw","content":"","excerpt":"","more":""},{"title":"about","date":"2016-07-22T17:18:45.000Z","_content":"\n### 关于我\n\n>\n>初级java码农一枚\n\n---\n\n### 联系我\n> * email：[wr4javaee@126.com](mailto:{{ site.email }})\n> * QQ：332863826\n\n---\n\n### 模板来源\n>\n>模板作者：[MOxFIVE](http://moxfive.xyz/)\n\n---","source":"about/index.md","raw":"---\ntitle: about\ndate: 2016-07-22 10:18:45\n---\n\n### 关于我\n\n>\n>初级java码农一枚\n\n---\n\n### 联系我\n> * email：[wr4javaee@126.com](mailto:{{ site.email }})\n> * QQ：332863826\n\n---\n\n### 模板来源\n>\n>模板作者：[MOxFIVE](http://moxfive.xyz/)\n\n---","updated":"2016-07-23T01:41:12.781Z","path":"about/index.html","comments":1,"layout":"page","_id":"cj1hliwf90002o65l9hrzsvu8","content":"<h3 id=\"关于我\"><a href=\"#关于我\" class=\"headerlink\" title=\"关于我\"></a>关于我</h3><p>&gt;</p>\n<blockquote>\n<p>初级java码农一枚</p>\n</blockquote>\n<hr>\n<h3 id=\"联系我\"><a href=\"#联系我\" class=\"headerlink\" title=\"联系我\"></a>联系我</h3><blockquote>\n<ul>\n<li>email：<a href=\"mailto:&lt;!--￼0--\" target=\"_blank\" rel=\"external\">wr4javaee@126.com</a></li>\n<li>QQ：332863826</li>\n</ul>\n</blockquote>\n<hr>\n<h3 id=\"模板来源\"><a href=\"#模板来源\" class=\"headerlink\" title=\"模板来源\"></a>模板来源</h3><p>&gt;</p>\n<blockquote>\n<p>模板作者：<a href=\"http://moxfive.xyz/\" target=\"_blank\" rel=\"external\">MOxFIVE</a></p>\n</blockquote>\n<hr>\n","excerpt":"","more":"<h3 id=\"关于我\"><a href=\"#关于我\" class=\"headerlink\" title=\"关于我\"></a>关于我</h3><p>&gt;</p>\n<blockquote>\n<p>初级java码农一枚</p>\n</blockquote>\n<hr>\n<h3 id=\"联系我\"><a href=\"#联系我\" class=\"headerlink\" title=\"联系我\"></a>联系我</h3><blockquote>\n<ul>\n<li>email：<a href=\"mailto:&lt;!--￼0--\">wr4javaee@126.com</a></li>\n<li>QQ：332863826</li>\n</ul>\n</blockquote>\n<hr>\n<h3 id=\"模板来源\"><a href=\"#模板来源\" class=\"headerlink\" title=\"模板来源\"></a>模板来源</h3><p>&gt;</p>\n<blockquote>\n<p>模板作者：<a href=\"http://moxfive.xyz/\">MOxFIVE</a></p>\n</blockquote>\n<hr>\n"},{"title":"tags","date":"2016-07-22T17:17:44.000Z","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2016-07-22 10:17:44\n---\n","updated":"2016-07-22T17:17:44.424Z","path":"tags/index.html","comments":1,"layout":"page","_id":"cj1hliwfp0006o65lqljxjglj","content":"","excerpt":"","more":""}],"Post":[{"title":"使用Jekyll在github上搭建博客","date":"2016-05-03T07:00:00.000Z","toc":{"on":true,"max_depth":3,"nowrap":false,"list_number":true},"toc_list_number":true,"_content":"\n\n## 写在前面\n>\n>[Jekyll官方网站](http://jekyll.bootcss.com/)，内容很详细\n>\n>[作者阮一峰关于Jekyll与Github Blog的入门教程](http://www.ruanyifeng.com/blog/2012/08/blogging_with_jekyll.html)，推荐大家阅读\n<!-- more -->\n\n---\n\n\n\n## 关于博客模板\n网络上免费的Jekyll主题非常多，推荐2个主题网站\n\n>\n>[Jekyll主题网站一](http://jekyllthemes.org/)\n>\n>[Jekyll主题网站二](http://jekyllthemes.io/)\n\n另外，本网站使用的主题来源\n\n> [Gaohaoyang](http://gaohaoyang.github.io)\n\n---\n\n## 搭建过程中遇到的问题\n由于Jekyll依赖于Ruby，在安装Ruby环境过程中由于众所周知的原因，总是遇到网络连接错误。\n好在淘宝提供了RubyGems镜像服务，它与官方服务同步频率为15分钟。\n\n> [淘宝网RubyGems镜像说明](https://ruby.taobao.org/)\n\n以下为说明中提到的大致流程\n\n> ```\n> $ gem sources --add https://ruby.taobao.org/ --remove https://rubygems.org/\n> $ gem sources -l\n> *** CURRENT SOURCES ***\n>\n> https://ruby.taobao.org\n> # 请确保只有 ruby.taobao.org\n> $ gem install rails\n> ```\n","source":"_posts/blog_start.md","raw":"---\ntitle:  \"使用Jekyll在github上搭建博客\"\ndate: 2016-05-03 00:00:00\ncategories: Jekyll\ntags: Jekyll Github 搭建静态博客 blog\ntoc:\n  on: true\n  max_depth: 3\n  nowrap: false\n  list_number: true\ntoc_list_number: true\n---\n\n\n## 写在前面\n>\n>[Jekyll官方网站](http://jekyll.bootcss.com/)，内容很详细\n>\n>[作者阮一峰关于Jekyll与Github Blog的入门教程](http://www.ruanyifeng.com/blog/2012/08/blogging_with_jekyll.html)，推荐大家阅读\n<!-- more -->\n\n---\n\n\n\n## 关于博客模板\n网络上免费的Jekyll主题非常多，推荐2个主题网站\n\n>\n>[Jekyll主题网站一](http://jekyllthemes.org/)\n>\n>[Jekyll主题网站二](http://jekyllthemes.io/)\n\n另外，本网站使用的主题来源\n\n> [Gaohaoyang](http://gaohaoyang.github.io)\n\n---\n\n## 搭建过程中遇到的问题\n由于Jekyll依赖于Ruby，在安装Ruby环境过程中由于众所周知的原因，总是遇到网络连接错误。\n好在淘宝提供了RubyGems镜像服务，它与官方服务同步频率为15分钟。\n\n> [淘宝网RubyGems镜像说明](https://ruby.taobao.org/)\n\n以下为说明中提到的大致流程\n\n> ```\n> $ gem sources --add https://ruby.taobao.org/ --remove https://rubygems.org/\n> $ gem sources -l\n> *** CURRENT SOURCES ***\n>\n> https://ruby.taobao.org\n> # 请确保只有 ruby.taobao.org\n> $ gem install rails\n> ```\n","slug":"blog_start","published":1,"updated":"2016-11-06T08:54:42.767Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1hliweo0001o65l47lgwh86","content":"<h2 id=\"写在前面\"><a href=\"#写在前面\" class=\"headerlink\" title=\"写在前面\"></a>写在前面</h2><p>&gt;</p>\n<blockquote>\n<p><a href=\"http://jekyll.bootcss.com/\" target=\"_blank\" rel=\"external\">Jekyll官方网站</a>，内容很详细</p>\n<p><a href=\"http://www.ruanyifeng.com/blog/2012/08/blogging_with_jekyll.html\" target=\"_blank\" rel=\"external\">作者阮一峰关于Jekyll与Github Blog的入门教程</a>，推荐大家阅读<br><a id=\"more\"></a></p>\n</blockquote>\n<hr>\n<h2 id=\"关于博客模板\"><a href=\"#关于博客模板\" class=\"headerlink\" title=\"关于博客模板\"></a>关于博客模板</h2><p>网络上免费的Jekyll主题非常多，推荐2个主题网站</p>\n<p>&gt;</p>\n<blockquote>\n<p><a href=\"http://jekyllthemes.org/\" target=\"_blank\" rel=\"external\">Jekyll主题网站一</a></p>\n<p><a href=\"http://jekyllthemes.io/\" target=\"_blank\" rel=\"external\">Jekyll主题网站二</a></p>\n</blockquote>\n<p>另外，本网站使用的主题来源</p>\n<blockquote>\n<p><a href=\"http://gaohaoyang.github.io\" target=\"_blank\" rel=\"external\">Gaohaoyang</a></p>\n</blockquote>\n<hr>\n<h2 id=\"搭建过程中遇到的问题\"><a href=\"#搭建过程中遇到的问题\" class=\"headerlink\" title=\"搭建过程中遇到的问题\"></a>搭建过程中遇到的问题</h2><p>由于Jekyll依赖于Ruby，在安装Ruby环境过程中由于众所周知的原因，总是遇到网络连接错误。<br>好在淘宝提供了RubyGems镜像服务，它与官方服务同步频率为15分钟。</p>\n<blockquote>\n<p><a href=\"https://ruby.taobao.org/\" target=\"_blank\" rel=\"external\">淘宝网RubyGems镜像说明</a></p>\n</blockquote>\n<p>以下为说明中提到的大致流程</p>\n<blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\">&gt; $ gem sources --add https://ruby.taobao.org/ --remove https://rubygems.org/</div><div class=\"line\">&gt; $ gem sources -l</div><div class=\"line\">&gt; *** CURRENT SOURCES ***</div><div class=\"line\">&gt;</div><div class=\"line\">&gt; https://ruby.taobao.org</div><div class=\"line\">&gt; # 请确保只有 ruby.taobao.org</div><div class=\"line\">&gt; $ gem install rails</div><div class=\"line\">&gt;</div></pre></td></tr></table></figure>\n</blockquote>\n","excerpt":"<h2 id=\"写在前面\"><a href=\"#写在前面\" class=\"headerlink\" title=\"写在前面\"></a>写在前面</h2><p>&gt;</p>\n<blockquote>\n<p><a href=\"http://jekyll.bootcss.com/\">Jekyll官方网站</a>，内容很详细</p>\n<p><a href=\"http://www.ruanyifeng.com/blog/2012/08/blogging_with_jekyll.html\">作者阮一峰关于Jekyll与Github Blog的入门教程</a>，推荐大家阅读<br>","more":"</p>\n</blockquote>\n<hr>\n<h2 id=\"关于博客模板\"><a href=\"#关于博客模板\" class=\"headerlink\" title=\"关于博客模板\"></a>关于博客模板</h2><p>网络上免费的Jekyll主题非常多，推荐2个主题网站</p>\n<p>&gt;</p>\n<blockquote>\n<p><a href=\"http://jekyllthemes.org/\">Jekyll主题网站一</a></p>\n<p><a href=\"http://jekyllthemes.io/\">Jekyll主题网站二</a></p>\n</blockquote>\n<p>另外，本网站使用的主题来源</p>\n<blockquote>\n<p><a href=\"http://gaohaoyang.github.io\">Gaohaoyang</a></p>\n</blockquote>\n<hr>\n<h2 id=\"搭建过程中遇到的问题\"><a href=\"#搭建过程中遇到的问题\" class=\"headerlink\" title=\"搭建过程中遇到的问题\"></a>搭建过程中遇到的问题</h2><p>由于Jekyll依赖于Ruby，在安装Ruby环境过程中由于众所周知的原因，总是遇到网络连接错误。<br>好在淘宝提供了RubyGems镜像服务，它与官方服务同步频率为15分钟。</p>\n<blockquote>\n<p><a href=\"https://ruby.taobao.org/\">淘宝网RubyGems镜像说明</a></p>\n</blockquote>\n<p>以下为说明中提到的大致流程</p>\n<blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\">&gt; $ gem sources --add https://ruby.taobao.org/ --remove https://rubygems.org/</div><div class=\"line\">&gt; $ gem sources -l</div><div class=\"line\">&gt; *** CURRENT SOURCES ***</div><div class=\"line\">&gt;</div><div class=\"line\">&gt; https://ruby.taobao.org</div><div class=\"line\">&gt; # 请确保只有 ruby.taobao.org</div><div class=\"line\">&gt; $ gem install rails</div><div class=\"line\">&gt;</div></pre></td></tr></table></figure>\n</blockquote>"},{"title":"数据库学习笔记 - 数据库保护","date":"2016-05-22T07:00:00.000Z","toc":{"on":true,"max_depth":3,"nowrap":false,"list_number":true},"toc_list_number":true,"_content":"\n## 什么是事务（Transaction）\n\n事务是用户定义的数据操作系列，这些操作可作为一个完整的工作单元（数据库的逻辑工作单位）。\n<!-- more -->\n\n---\n\n\n\n## 事务的特性（ACID）\n\n* 原子性（Atomicity）事务中的操作要么都做，要么都不做。\n* 一致性（Consistency）只有合法的数据可以被写入数据库，否则事务应该将其回滚到最初状态。\n* 隔离性（Isolation）数据库中一个事务的执行不能被其他事务干扰。\n* 持久性（Durability）事务一旦提交，其对数据库中数据的改变就是永久的。\n\n---\n\n\n\n## 并发控制\n\n并发问题导致的异常情况归类如下：\n\n#### 丢失更新（Lost Update）\n\n两个事务都同时更新一行数据，第一个事务的提交结果被第二个事务的提交结果破坏。\n\n\n\n![lost_update](/images/db/transaction/2016_05_26_lost_update.png)\n\n\n\n#### 脏读（Dirty Reads）\n\n一个事务读了某个失败事务运行过程中的数据。\n\n![ldirty_reads](/images/db/transaction/2016_05_26_dirty_reads.png)\n\n\n\n#### 不可重复读（Non-repeatable Reads）\n\n一个事务对同一行数据重复读取两次，但是却得到了不同的结果。\n\n![non_repeatable_reads](/images/db/transaction/2016_05_26_non_repeatable_reads.png)\n\n\n\n#### 幻读（Phantom Reads）\n\n幻读实际属于不可重复读的范畴。它指当事务T1按照一定条件读取某些数据，事务T2对其中部分记录做了删除或更新操作，当事务T1再次以相同条件读取数据时，发现少或多了某些记录。\n\n---\n\n## 事务的隔离级别\n\n#### 未授权读取（Read Uncommitted）\n也称读未提交，隔离级别最低，允许脏读。\n\n#### 授权读取（Read Committed）\n也称读已提交，允许不可重复读。\n\n#### 可重复读（Repeatable Read）\n允许出现幻读。\n\n#### 串行化（Serializable）\n最严格的事务隔离级别，要求所有事务都被串行执行。\n\n![transaction_isolation_level](/images/db/transaction/2016_05_26_transaction_isolation_level.png)\n\n| 隔离级别  | 脏读   | 可重复读 | 幻读   |\n| ----- | ---- | ---- | ---- |\n| 未授权读取 | 存在   | 不可以  | 存在   |\n| 授权读取  | 不存在  | 不可以  | 存在   |\n| 可重复读取 | 不存在  | 可以   | 存在   |\n| 串行化   | 不存在  | 可以   | 不存在  |\n\n# 分布式事务\n\n## CAP定理\n一个分布式系统不可能同时满足一致性（Consistency）、可用性（Availability）、分区容错性（Partition tolerance），最多只能同时满足其中两项。\n\n## BASE理论\n\n# 一致性协议\n\n协调者：统一调度所有分布式节点执行逻辑组件。\n参与者：被协调者调度的分布式节点。\n\n## 2PC二阶段提交协议（Two-Phase Commit）\n\n## 3PC\n\n# 锁\n\n## 悲观锁（Pessimistic Concurrency Control， PCC）\n又称排他锁，若事务T1使用悲观锁对数据进行处理，则处理完成前，其他事务均不能对数据进行更新操作。\n\n## 乐观锁 （Optimistic Concurrency Control， OCC）\n乐观锁事务控制分为三阶段，分别是：数据读取、写入校验、数据写入。\n\n","source":"_posts/db_trans.md","raw":"---\ntitle:  \"数据库学习笔记 - 数据库保护\"\ndate: 2016-05-22 00:00:00\ncategories: Database\ntags: 数据库 事务 transaction acid lock\ntoc:\n  on: true\n  max_depth: 3\n  nowrap: false\n  list_number: true\ntoc_list_number: true\n---\n\n## 什么是事务（Transaction）\n\n事务是用户定义的数据操作系列，这些操作可作为一个完整的工作单元（数据库的逻辑工作单位）。\n<!-- more -->\n\n---\n\n\n\n## 事务的特性（ACID）\n\n* 原子性（Atomicity）事务中的操作要么都做，要么都不做。\n* 一致性（Consistency）只有合法的数据可以被写入数据库，否则事务应该将其回滚到最初状态。\n* 隔离性（Isolation）数据库中一个事务的执行不能被其他事务干扰。\n* 持久性（Durability）事务一旦提交，其对数据库中数据的改变就是永久的。\n\n---\n\n\n\n## 并发控制\n\n并发问题导致的异常情况归类如下：\n\n#### 丢失更新（Lost Update）\n\n两个事务都同时更新一行数据，第一个事务的提交结果被第二个事务的提交结果破坏。\n\n\n\n![lost_update](/images/db/transaction/2016_05_26_lost_update.png)\n\n\n\n#### 脏读（Dirty Reads）\n\n一个事务读了某个失败事务运行过程中的数据。\n\n![ldirty_reads](/images/db/transaction/2016_05_26_dirty_reads.png)\n\n\n\n#### 不可重复读（Non-repeatable Reads）\n\n一个事务对同一行数据重复读取两次，但是却得到了不同的结果。\n\n![non_repeatable_reads](/images/db/transaction/2016_05_26_non_repeatable_reads.png)\n\n\n\n#### 幻读（Phantom Reads）\n\n幻读实际属于不可重复读的范畴。它指当事务T1按照一定条件读取某些数据，事务T2对其中部分记录做了删除或更新操作，当事务T1再次以相同条件读取数据时，发现少或多了某些记录。\n\n---\n\n## 事务的隔离级别\n\n#### 未授权读取（Read Uncommitted）\n也称读未提交，隔离级别最低，允许脏读。\n\n#### 授权读取（Read Committed）\n也称读已提交，允许不可重复读。\n\n#### 可重复读（Repeatable Read）\n允许出现幻读。\n\n#### 串行化（Serializable）\n最严格的事务隔离级别，要求所有事务都被串行执行。\n\n![transaction_isolation_level](/images/db/transaction/2016_05_26_transaction_isolation_level.png)\n\n| 隔离级别  | 脏读   | 可重复读 | 幻读   |\n| ----- | ---- | ---- | ---- |\n| 未授权读取 | 存在   | 不可以  | 存在   |\n| 授权读取  | 不存在  | 不可以  | 存在   |\n| 可重复读取 | 不存在  | 可以   | 存在   |\n| 串行化   | 不存在  | 可以   | 不存在  |\n\n# 分布式事务\n\n## CAP定理\n一个分布式系统不可能同时满足一致性（Consistency）、可用性（Availability）、分区容错性（Partition tolerance），最多只能同时满足其中两项。\n\n## BASE理论\n\n# 一致性协议\n\n协调者：统一调度所有分布式节点执行逻辑组件。\n参与者：被协调者调度的分布式节点。\n\n## 2PC二阶段提交协议（Two-Phase Commit）\n\n## 3PC\n\n# 锁\n\n## 悲观锁（Pessimistic Concurrency Control， PCC）\n又称排他锁，若事务T1使用悲观锁对数据进行处理，则处理完成前，其他事务均不能对数据进行更新操作。\n\n## 乐观锁 （Optimistic Concurrency Control， OCC）\n乐观锁事务控制分为三阶段，分别是：数据读取、写入校验、数据写入。\n\n","slug":"db_trans","published":1,"updated":"2016-07-23T01:14:18.772Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1hliwfa0003o65l7xivcf7r","content":"<h2 id=\"什么是事务（Transaction）\"><a href=\"#什么是事务（Transaction）\" class=\"headerlink\" title=\"什么是事务（Transaction）\"></a>什么是事务（Transaction）</h2><p>事务是用户定义的数据操作系列，这些操作可作为一个完整的工作单元（数据库的逻辑工作单位）。<br><a id=\"more\"></a></p>\n<hr>\n<h2 id=\"事务的特性（ACID）\"><a href=\"#事务的特性（ACID）\" class=\"headerlink\" title=\"事务的特性（ACID）\"></a>事务的特性（ACID）</h2><ul>\n<li>原子性（Atomicity）事务中的操作要么都做，要么都不做。</li>\n<li>一致性（Consistency）只有合法的数据可以被写入数据库，否则事务应该将其回滚到最初状态。</li>\n<li>隔离性（Isolation）数据库中一个事务的执行不能被其他事务干扰。</li>\n<li>持久性（Durability）事务一旦提交，其对数据库中数据的改变就是永久的。</li>\n</ul>\n<hr>\n<h2 id=\"并发控制\"><a href=\"#并发控制\" class=\"headerlink\" title=\"并发控制\"></a>并发控制</h2><p>并发问题导致的异常情况归类如下：</p>\n<h4 id=\"丢失更新（Lost-Update）\"><a href=\"#丢失更新（Lost-Update）\" class=\"headerlink\" title=\"丢失更新（Lost Update）\"></a>丢失更新（Lost Update）</h4><p>两个事务都同时更新一行数据，第一个事务的提交结果被第二个事务的提交结果破坏。</p>\n<p><img src=\"/images/db/transaction/2016_05_26_lost_update.png\" alt=\"lost_update\"></p>\n<h4 id=\"脏读（Dirty-Reads）\"><a href=\"#脏读（Dirty-Reads）\" class=\"headerlink\" title=\"脏读（Dirty Reads）\"></a>脏读（Dirty Reads）</h4><p>一个事务读了某个失败事务运行过程中的数据。</p>\n<p><img src=\"/images/db/transaction/2016_05_26_dirty_reads.png\" alt=\"ldirty_reads\"></p>\n<h4 id=\"不可重复读（Non-repeatable-Reads）\"><a href=\"#不可重复读（Non-repeatable-Reads）\" class=\"headerlink\" title=\"不可重复读（Non-repeatable Reads）\"></a>不可重复读（Non-repeatable Reads）</h4><p>一个事务对同一行数据重复读取两次，但是却得到了不同的结果。</p>\n<p><img src=\"/images/db/transaction/2016_05_26_non_repeatable_reads.png\" alt=\"non_repeatable_reads\"></p>\n<h4 id=\"幻读（Phantom-Reads）\"><a href=\"#幻读（Phantom-Reads）\" class=\"headerlink\" title=\"幻读（Phantom Reads）\"></a>幻读（Phantom Reads）</h4><p>幻读实际属于不可重复读的范畴。它指当事务T1按照一定条件读取某些数据，事务T2对其中部分记录做了删除或更新操作，当事务T1再次以相同条件读取数据时，发现少或多了某些记录。</p>\n<hr>\n<h2 id=\"事务的隔离级别\"><a href=\"#事务的隔离级别\" class=\"headerlink\" title=\"事务的隔离级别\"></a>事务的隔离级别</h2><h4 id=\"未授权读取（Read-Uncommitted）\"><a href=\"#未授权读取（Read-Uncommitted）\" class=\"headerlink\" title=\"未授权读取（Read Uncommitted）\"></a>未授权读取（Read Uncommitted）</h4><p>也称读未提交，隔离级别最低，允许脏读。</p>\n<h4 id=\"授权读取（Read-Committed）\"><a href=\"#授权读取（Read-Committed）\" class=\"headerlink\" title=\"授权读取（Read Committed）\"></a>授权读取（Read Committed）</h4><p>也称读已提交，允许不可重复读。</p>\n<h4 id=\"可重复读（Repeatable-Read）\"><a href=\"#可重复读（Repeatable-Read）\" class=\"headerlink\" title=\"可重复读（Repeatable Read）\"></a>可重复读（Repeatable Read）</h4><p>允许出现幻读。</p>\n<h4 id=\"串行化（Serializable）\"><a href=\"#串行化（Serializable）\" class=\"headerlink\" title=\"串行化（Serializable）\"></a>串行化（Serializable）</h4><p>最严格的事务隔离级别，要求所有事务都被串行执行。</p>\n<p><img src=\"/images/db/transaction/2016_05_26_transaction_isolation_level.png\" alt=\"transaction_isolation_level\"></p>\n<table>\n<thead>\n<tr>\n<th>隔离级别</th>\n<th>脏读</th>\n<th>可重复读</th>\n<th>幻读</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>未授权读取</td>\n<td>存在</td>\n<td>不可以</td>\n<td>存在</td>\n</tr>\n<tr>\n<td>授权读取</td>\n<td>不存在</td>\n<td>不可以</td>\n<td>存在</td>\n</tr>\n<tr>\n<td>可重复读取</td>\n<td>不存在</td>\n<td>可以</td>\n<td>存在</td>\n</tr>\n<tr>\n<td>串行化</td>\n<td>不存在</td>\n<td>可以</td>\n<td>不存在</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"分布式事务\"><a href=\"#分布式事务\" class=\"headerlink\" title=\"分布式事务\"></a>分布式事务</h1><h2 id=\"CAP定理\"><a href=\"#CAP定理\" class=\"headerlink\" title=\"CAP定理\"></a>CAP定理</h2><p>一个分布式系统不可能同时满足一致性（Consistency）、可用性（Availability）、分区容错性（Partition tolerance），最多只能同时满足其中两项。</p>\n<h2 id=\"BASE理论\"><a href=\"#BASE理论\" class=\"headerlink\" title=\"BASE理论\"></a>BASE理论</h2><h1 id=\"一致性协议\"><a href=\"#一致性协议\" class=\"headerlink\" title=\"一致性协议\"></a>一致性协议</h1><p>协调者：统一调度所有分布式节点执行逻辑组件。<br>参与者：被协调者调度的分布式节点。</p>\n<h2 id=\"2PC二阶段提交协议（Two-Phase-Commit）\"><a href=\"#2PC二阶段提交协议（Two-Phase-Commit）\" class=\"headerlink\" title=\"2PC二阶段提交协议（Two-Phase Commit）\"></a>2PC二阶段提交协议（Two-Phase Commit）</h2><h2 id=\"3PC\"><a href=\"#3PC\" class=\"headerlink\" title=\"3PC\"></a>3PC</h2><h1 id=\"锁\"><a href=\"#锁\" class=\"headerlink\" title=\"锁\"></a>锁</h1><h2 id=\"悲观锁（Pessimistic-Concurrency-Control，-PCC）\"><a href=\"#悲观锁（Pessimistic-Concurrency-Control，-PCC）\" class=\"headerlink\" title=\"悲观锁（Pessimistic Concurrency Control， PCC）\"></a>悲观锁（Pessimistic Concurrency Control， PCC）</h2><p>又称排他锁，若事务T1使用悲观锁对数据进行处理，则处理完成前，其他事务均不能对数据进行更新操作。</p>\n<h2 id=\"乐观锁-（Optimistic-Concurrency-Control，-OCC）\"><a href=\"#乐观锁-（Optimistic-Concurrency-Control，-OCC）\" class=\"headerlink\" title=\"乐观锁 （Optimistic Concurrency Control， OCC）\"></a>乐观锁 （Optimistic Concurrency Control， OCC）</h2><p>乐观锁事务控制分为三阶段，分别是：数据读取、写入校验、数据写入。</p>\n","excerpt":"<h2 id=\"什么是事务（Transaction）\"><a href=\"#什么是事务（Transaction）\" class=\"headerlink\" title=\"什么是事务（Transaction）\"></a>什么是事务（Transaction）</h2><p>事务是用户定义的数据操作系列，这些操作可作为一个完整的工作单元（数据库的逻辑工作单位）。<br>","more":"</p>\n<hr>\n<h2 id=\"事务的特性（ACID）\"><a href=\"#事务的特性（ACID）\" class=\"headerlink\" title=\"事务的特性（ACID）\"></a>事务的特性（ACID）</h2><ul>\n<li>原子性（Atomicity）事务中的操作要么都做，要么都不做。</li>\n<li>一致性（Consistency）只有合法的数据可以被写入数据库，否则事务应该将其回滚到最初状态。</li>\n<li>隔离性（Isolation）数据库中一个事务的执行不能被其他事务干扰。</li>\n<li>持久性（Durability）事务一旦提交，其对数据库中数据的改变就是永久的。</li>\n</ul>\n<hr>\n<h2 id=\"并发控制\"><a href=\"#并发控制\" class=\"headerlink\" title=\"并发控制\"></a>并发控制</h2><p>并发问题导致的异常情况归类如下：</p>\n<h4 id=\"丢失更新（Lost-Update）\"><a href=\"#丢失更新（Lost-Update）\" class=\"headerlink\" title=\"丢失更新（Lost Update）\"></a>丢失更新（Lost Update）</h4><p>两个事务都同时更新一行数据，第一个事务的提交结果被第二个事务的提交结果破坏。</p>\n<p><img src=\"/images/db/transaction/2016_05_26_lost_update.png\" alt=\"lost_update\"></p>\n<h4 id=\"脏读（Dirty-Reads）\"><a href=\"#脏读（Dirty-Reads）\" class=\"headerlink\" title=\"脏读（Dirty Reads）\"></a>脏读（Dirty Reads）</h4><p>一个事务读了某个失败事务运行过程中的数据。</p>\n<p><img src=\"/images/db/transaction/2016_05_26_dirty_reads.png\" alt=\"ldirty_reads\"></p>\n<h4 id=\"不可重复读（Non-repeatable-Reads）\"><a href=\"#不可重复读（Non-repeatable-Reads）\" class=\"headerlink\" title=\"不可重复读（Non-repeatable Reads）\"></a>不可重复读（Non-repeatable Reads）</h4><p>一个事务对同一行数据重复读取两次，但是却得到了不同的结果。</p>\n<p><img src=\"/images/db/transaction/2016_05_26_non_repeatable_reads.png\" alt=\"non_repeatable_reads\"></p>\n<h4 id=\"幻读（Phantom-Reads）\"><a href=\"#幻读（Phantom-Reads）\" class=\"headerlink\" title=\"幻读（Phantom Reads）\"></a>幻读（Phantom Reads）</h4><p>幻读实际属于不可重复读的范畴。它指当事务T1按照一定条件读取某些数据，事务T2对其中部分记录做了删除或更新操作，当事务T1再次以相同条件读取数据时，发现少或多了某些记录。</p>\n<hr>\n<h2 id=\"事务的隔离级别\"><a href=\"#事务的隔离级别\" class=\"headerlink\" title=\"事务的隔离级别\"></a>事务的隔离级别</h2><h4 id=\"未授权读取（Read-Uncommitted）\"><a href=\"#未授权读取（Read-Uncommitted）\" class=\"headerlink\" title=\"未授权读取（Read Uncommitted）\"></a>未授权读取（Read Uncommitted）</h4><p>也称读未提交，隔离级别最低，允许脏读。</p>\n<h4 id=\"授权读取（Read-Committed）\"><a href=\"#授权读取（Read-Committed）\" class=\"headerlink\" title=\"授权读取（Read Committed）\"></a>授权读取（Read Committed）</h4><p>也称读已提交，允许不可重复读。</p>\n<h4 id=\"可重复读（Repeatable-Read）\"><a href=\"#可重复读（Repeatable-Read）\" class=\"headerlink\" title=\"可重复读（Repeatable Read）\"></a>可重复读（Repeatable Read）</h4><p>允许出现幻读。</p>\n<h4 id=\"串行化（Serializable）\"><a href=\"#串行化（Serializable）\" class=\"headerlink\" title=\"串行化（Serializable）\"></a>串行化（Serializable）</h4><p>最严格的事务隔离级别，要求所有事务都被串行执行。</p>\n<p><img src=\"/images/db/transaction/2016_05_26_transaction_isolation_level.png\" alt=\"transaction_isolation_level\"></p>\n<table>\n<thead>\n<tr>\n<th>隔离级别</th>\n<th>脏读</th>\n<th>可重复读</th>\n<th>幻读</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>未授权读取</td>\n<td>存在</td>\n<td>不可以</td>\n<td>存在</td>\n</tr>\n<tr>\n<td>授权读取</td>\n<td>不存在</td>\n<td>不可以</td>\n<td>存在</td>\n</tr>\n<tr>\n<td>可重复读取</td>\n<td>不存在</td>\n<td>可以</td>\n<td>存在</td>\n</tr>\n<tr>\n<td>串行化</td>\n<td>不存在</td>\n<td>可以</td>\n<td>不存在</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"分布式事务\"><a href=\"#分布式事务\" class=\"headerlink\" title=\"分布式事务\"></a>分布式事务</h1><h2 id=\"CAP定理\"><a href=\"#CAP定理\" class=\"headerlink\" title=\"CAP定理\"></a>CAP定理</h2><p>一个分布式系统不可能同时满足一致性（Consistency）、可用性（Availability）、分区容错性（Partition tolerance），最多只能同时满足其中两项。</p>\n<h2 id=\"BASE理论\"><a href=\"#BASE理论\" class=\"headerlink\" title=\"BASE理论\"></a>BASE理论</h2><h1 id=\"一致性协议\"><a href=\"#一致性协议\" class=\"headerlink\" title=\"一致性协议\"></a>一致性协议</h1><p>协调者：统一调度所有分布式节点执行逻辑组件。<br>参与者：被协调者调度的分布式节点。</p>\n<h2 id=\"2PC二阶段提交协议（Two-Phase-Commit）\"><a href=\"#2PC二阶段提交协议（Two-Phase-Commit）\" class=\"headerlink\" title=\"2PC二阶段提交协议（Two-Phase Commit）\"></a>2PC二阶段提交协议（Two-Phase Commit）</h2><h2 id=\"3PC\"><a href=\"#3PC\" class=\"headerlink\" title=\"3PC\"></a>3PC</h2><h1 id=\"锁\"><a href=\"#锁\" class=\"headerlink\" title=\"锁\"></a>锁</h1><h2 id=\"悲观锁（Pessimistic-Concurrency-Control，-PCC）\"><a href=\"#悲观锁（Pessimistic-Concurrency-Control，-PCC）\" class=\"headerlink\" title=\"悲观锁（Pessimistic Concurrency Control， PCC）\"></a>悲观锁（Pessimistic Concurrency Control， PCC）</h2><p>又称排他锁，若事务T1使用悲观锁对数据进行处理，则处理完成前，其他事务均不能对数据进行更新操作。</p>\n<h2 id=\"乐观锁-（Optimistic-Concurrency-Control，-OCC）\"><a href=\"#乐观锁-（Optimistic-Concurrency-Control，-OCC）\" class=\"headerlink\" title=\"乐观锁 （Optimistic Concurrency Control， OCC）\"></a>乐观锁 （Optimistic Concurrency Control， OCC）</h2><p>乐观锁事务控制分为三阶段，分别是：数据读取、写入校验、数据写入。</p>"},{"title":"基于Github搭建个人博客","date":"2016-10-20T07:00:00.000Z","toc":{"on":true,"max_depth":3,"nowrap":false,"list_number":true},"toc_list_number":true,"_content":"\n# 基于Github搭建个人博客\n\n## Github Pages\n\n### 什么是github pages？\n\nGitHub Pages is a static site hosting service.\n\nGitHub Pages is designed to host your personal, organization, or project pages directly from a GitHub repository. To learn more about the different types of GitHub Pages sites, see \"[User, organization, and project pages](https://help.github.com/articles/user-organization-and-project-pages/).\"\n\nYou can create and publish GitHub Pages online using the [Automatic Page Generator](https://help.github.com/articles/creating-pages-with-the-automatic-generator). If you prefer to work locally, you can use [GitHub Desktop](http://desktop.github.com) or the [command line](https://help.github.com/articles/adding-an-existing-project-to-github-using-the-command-line).\n\n\n\n 由用户编写的、免费的、托管在github上的静态网页\n\n---\n\n<!-- more -->\n\n### 如何搭建Github Pages \n\n官方教程\n\n https://pages.github.com/\n\nhttps://help.github.com/articles/user-organization-and-project-pages/\n\n搭建github博客基本分为如下几步：\n\n* 第一步，create a repository\n* 第二步， clone the repository\n* 第三步，create your website pages\n* 第四步，commit and push your files\n\n\n\ngithub pages为我们搭建的个人博客地址是有规则的：\n例如，我的github地址为https://github.com/wr4javaee\n那么，我的博客主页地址为https://wr4javaee.github.io\n\n若我的项目名称叫blog，那么对应的pages地址就是https://wr4javaee.github.io/blog\n\n\n\n* 注册github账号\n\nhttps://github.com/join\n\nonepieceworld@qq.com&3377128016，protosssoul@qq.com&2027194199\n\n![](/images/blog_create/create_repository.png)\n\ngithub为我们准备了两种搭建博客方式，一种是github提供模板，我们只需写md文档即可。另一种是从头搭建。\n\n我们先介绍第一种方式。\n\n\n\n#### 方法一，利用github pages模板搭建博客\n\n进入项目->settings->github pages->launch\n\n![](/images/blog_create/settings_lunch.png)\n\n\n\n点击launch后，进入\n\n![](/images/blog_create/lunch_page1.png)\n\n\n\n\n\n填写好项目名称、项目描述后，进入下一步，选择项目模板\n\n![](/images/blog_create/settings_theme.png)\n\n选择好模板后，点击 publish page即可提交。\n\n稍等片刻后，github即可为我们搭建好项目对应的网站。\n\n通过访问https://onepieceworld.github.io/test/\n\n\n\n\n#### 方法二，从头搭建博客\n\n若我们查看github模板为我们创建的博客，会发现github为我们自动创建了一个分支gh-pages作为默认分支，博客的文件都提交在这个特定的分支中。\n\n![](/images/blog_create/git_branch.png)\n\n那么，若我们从头搭建博客，就得模仿这一步骤。github规定，只有该分支中的页面，才会生成静态网页文件。\n\n我们新创建一个reponsitory，名为test1\n\nhttps://github.com/onepieceworld/test1.git\n\n\n\n接下来，我们创建一个全新的gh-pages分支，并将其作为默认分支\n\n```\nyumao@ubuntu:~/github/test1$ git checkout --orphan gh-pages\n```\n\n\n\n为新的空白分支创建默认页面并提交\n\n```\nyumao@ubuntu:~/github/test1$ git checkout --orphan gh-pages\nSwitched to a new branch 'gh-pages'\nyumao@ubuntu:~/github/test1$ git branch \nyumao@ubuntu:~/github/test1$ echo \"Hello World!\" > index.html\nyumao@ubuntu:~/github/test1$ git add index.html \nyumao@ubuntu:~/github/test1$ git commit -a -m \"commit index pages\"\n[gh-pages (root-commit) 0fab7c5] commit index pages\n 1 file changed, 1 insertion(+)\n create mode 100644 index.html\nyumao@ubuntu:~/github/test1$ git push origin gh-pages \n```\n\n\n\n提交成功后，访问https://onepieceworld.github.io/test1/，\n\n可以看到，github已经自动为我们将静态文件部署。\n\n---\n\n\n\n## 利用Jekyll搭建个人博客\n\n[Jekyll官方网站](http://jekyll.com.cn)\n[Jekyll github](https://github.com/jekyll/jekyll)\n\n\n### 什么是Jekyll？\n\nJekyll is a simple, blog-aware, static site generator perfect for \npersonal, project, or organization sites. Think of it like a file-based \nCMS, without all the complexity. Jekyll takes your content, renders \nMarkdown and Liquid templates, and spits out a complete, static website \nready to be served by Apache, Nginx or another web server. Jekyll is the\n engine behind [GitHub Pages](https://pages.github.com), which you can use to host sites right from your GitHub repositories.\n\n一个可以将纯文本转化为静态网站文件的生成器。\n\n基于Jekyll，我们可以只关注编写纯文本，如markdown，而无需将精力放在HTML本身。\n\n\n\n### Jekyll的简易用法\n\n> [Jekyll官方使用简介](http://jekyll.bootcss.com/)，内容很详细\n> [作者阮一峰关于Jekyll与Github Blog的入门教程](http://www.ruanyifeng.com/blog/2012/08/blogging_with_jekyll.html)，推荐大家阅读\n\n\n\n首先，Jekyll依赖Ruby\n\n安装Ruby环境过程中会遇到GWF，需要用到淘宝提供的RubyGems镜像服务，它与官方服务同步频率为15分钟。\n\n[淘宝RubyGems镜像]: https://ruby.taobao.org/\n\n\n\nRuby环境搭建好后，我们通过以下命令安装Jekyll\n\n```\n~ $ gem install jekyll\n```\n\n\n\n接下来，利用jekyll命令jekyll new my-awesome-site自动创建jekyll项目\n\n```\nyumao@ubuntu:~/github$ jekyll new jekyll_test\nNew jekyll site installed in /home/yumao/github/jekyll_test. \nRunning bundle install in /home/yumao/github/jekyll_test... \nFetching gem metadata from https://rubygems.org/................\nFetching version metadata from https://rubygems.org/...\nFetching dependency metadata from https://rubygems.org/..\nResolving dependencies...\nUsing addressable 2.4.0\nUsing colorator 1.1.0\nUsing ffi 1.9.14\nUsing forwardable-extended 2.6.0\nUsing sass 3.4.22\nUsing rb-fsevent 0.9.7\nUsing kramdown 1.12.0\nUsing liquid 3.0.6\nUsing mercenary 0.3.6\nUsing rouge 1.11.1\nUsing safe_yaml 1.0.4\nUsing minima 2.0.0\nUsing bundler 1.13.5\nUsing rb-inotify 0.9.7\nUsing pathutil 0.14.0\nUsing jekyll-sass-converter 1.4.0\nUsing listen 3.0.8\nUsing jekyll-watch 1.5.0\nUsing jekyll 3.3.0\nUsing jekyll-feed 0.8.0\nBundle complete! 3 Gemfile dependencies, 20 gems now installed.\nUse `bundle show [gemname]` to see where a bundled gem is installed.\nyumao@ubuntu:~/github$ \n```\n\n\n\n进入项目目录下，执行Jekyll命令 jekyll serve，启动项目\n\n```\nyumao@ubuntu:~/github$ cd jekyll_test/\nyumao@ubuntu:~/github/jekyll_test$ jekyll serve\nWARN: Unresolved specs during Gem::Specification.reset:\n      rouge (~> 1.7)\n      jekyll-watch (~> 1.1)\nWARN: Clearing out unresolved specs.\nPlease report a bug if this causes problems.\nConfiguration file: /home/yumao/github/jekyll_test/_config.yml\nConfiguration file: /home/yumao/github/jekyll_test/_config.yml\n            Source: /home/yumao/github/jekyll_test\n       Destination: /home/yumao/github/jekyll_test/_site\n Incremental build: disabled. Enable with --incremental\n      Generating... \n                    done in 0.286 seconds.\n Auto-regeneration: enabled for '/home/yumao/github/jekyll_test'\nConfiguration file: /home/yumao/github/jekyll_test/_config.yml\n    Server address: http://127.0.0.1:4000/\n  Server running... press ctrl-c to stop.\n\n```\n\n![](/images/blog_create/jekyll_default_page.png)\n\n\n\n至此，一个简易的jekyll项目就搭建好了，我们将它部署到github中，每次只要新增md文档，提交到github后，其会自动编译jekyll项目，自动解析成静态网页文件。\n\n\n\n### Jekyll的目录结构\n\n\n\n\n![](/images/blog_create/jekyll_files.png)\n\n```\n.\n├── _config.yml\n├── _drafts\n|   ├── begin-with-the-crazy-ideas.textile\n|   └── on-simplicity-in-technology.markdown\n├── _includes\n|   ├── footer.html\n|   └── header.html\n├── _layouts\n|   ├── default.html\n|   └── post.html\n├── _posts\n|   ├── 2007-10-29-why-every-programmer-should-play-nethack.textile\n|   └── 2009-04-26-barcamp-boston-4-roundup.textile\n├── _data\n|   └── members.yml\n├── _site\n└── index.html\n```\n\n\n\n| 文件 / 目录                                  | 描述                                       |\n| ---------------------------------------- | ---------------------------------------- |\n| `_config.yml`                            | 保存[配置](http://jekyll.com.cn/docs/configuration/)数据。很多配置选项都会直接从命令行中进行设置，但是如果你把那些配置写在这儿，你就不用非要去记住那些命令了。 |\n| `_drafts`                                | drafts 是未发布的文章。这些文件的格式中都没有 `title.MARKUP` 数据。学习如何使用 [drafts](http://jekyll.com.cn/docs/drafts/). |\n| `_includes`                              | 你可以加载这些包含部分到你的布局或者文章中以方便重用。可以用这个标签          `{nclude file.ext`          来把文件 `_includes/file.ext` 包含进来。 |\n| `_layouts`                               | layouts 是包裹在文章外部的模板。布局可以在 [YAML 头信息](http://jekyll.com.cn/docs/frontmatter/)中根据不同文章进行选择。          这将在下一个部分进行介绍。标签          `content`          可以将content插入页面中。 |\n| `_posts`                                 | 这里放的就是你的文章了。文件格式很重要，必须要符合:          `YEAR-MONTH-DAY-title.MARKUP`。          The [permalinks](http://jekyll.com.cn/docs/permalinks/) 可以在文章中自己定制，但是数据和标记语言都是根据文件名来确定的。 |\n| `_data`                                  | Well-formatted site data should be placed here. The jekyll engine will           autoload all yaml files (ends with `.yml` or `.yaml`)           in this directory. If there's a file `members.yml` under the directory,           then you can access contents of the file through `site.data.members`. |\n| `_site`                                  | 一旦 Jekyll 完成转换，就会将生成的页面放在这里（默认）。最好将这个目录放进你的 `.gitignore` 文件中。 |\n| `index.html` and other HTML, Markdown, Textile files | 如果这些文件中包含 [YAML 头信息](http://jekyll.com.cn/docs/frontmatter/) 部分，Jekyll 就会自动将它们进行转换。当然，其他的如 `.html`， `.markdown`，          `.md`，或者 `.textile` 等在你的站点根目录下或者不是以上提到的目录中的文件也会被转换。 |\n| Other Files/Folders                      | 其他一些未被提及的目录和文件如          `css` 还有 `images` 文件夹，          `favicon.ico` 等文件都将被完全拷贝到生成的 site 中。 这里有一些[使用 Jekyll 的站点](http://jekyll.com.cn/docs/sites/)，如果你感兴趣就来看看吧。 |\n\n\n\n#### _config.yml配置文件\n\n[官方配置文件说明](http://jekyll.com.cn/docs/configuration/)\n\n\n\n### 使用Jekyll的开源模板\n\n网络上免费的Jekyll主题非常多，推荐2个主题网站\n\n>\n>[Jekyll主题网站一](http://jekyllthemes.org/)\n>\n>[Jekyll主题网站二](http://jekyllthemes.io/)\n\n\n\n这里为大家推荐一个我喜欢的主题来源\n\n> [Gaohaoyang](http://gaohaoyang.github.io)\n\ngithub地址\n\nhttps://github.com/Gaohaoyang/gaohaoyang.github.io.git\n\n\n\n### Jekyll的优缺点\n\nJekyll是比较流行的博客系统，其主题、插件数量上比较丰富，且上手简单。\n缺点为文章量多的时候，生成速度慢。\n\n---\n\n\n\n## 利用Hexo搭建个人博客\n\n### Hexo与Jekyll的区别\nHexo是基于Node.js编写的静态博客系统，使用Jekyl我们可以将原生的markdown文档上传到github，由github自动解析成静态html文件。但hexo为本地将markdown文档解析后，将生成的静态html文件直接上传到github中。\n\n由于hexo基于nodejs，因此其生成html速度较Jekyll快，相对更灵活。主题数量然有Jade/Stylus/Less等各种方言支持。\n\n|        | 语言     | 活跃度  | 开箱即用 | 主题数量 | 主题系统 | 生成速度 | 博客适应性 | 非博客适应性 |\n| ------ | ------ | ---- | ---- | ---- | ---- | ---- | ----- | ------ |\n| Jekyll | Ruby   | S    | B    | A    | A    | C    | A     | C      |\n| Hexo   | NodeJS | B    | A    | A    | B    | A    | A     | B      |\n\n\n\n### Hexo官方文档\n\n[Hexo官方文档](https://hexo.io/zh-cn/docs/)\n\n\n\n### 安装Hexo\n\nHexo基于Node.js，因此首先应安装Node.js环境。\n\ncURL：\n\n```\n$ curl https://raw.github.com/creationix/nvm/master/install.sh | sh\n```\n\nWget\n```\n$ wget -qO- https://raw.github.com/creationix/nvm/master/install.sh | sh\n```\n安装完成后，重启终端执行下列命令完成安装Node.js\n```\n$ nvm install stable\n```\n\n若环境准备就绪，使用以下命令安装Hexo\n\n```\n$ npm install -g hexo-cli\n```\n\n\n\n### 使用Hexo建立网站\n\n使用以下命令初始化网站\n\n```\n$ hexo init <folder>\n$ cd <folder>\n$ npm install\n```\n\n\n\n建站后的文件目录如下：\n\n![](/images/blog_create/hexo_files.png)\n\n\n\n```\n.\n├── _config.yml\n├── package.json\n├── scaffolds\n├── source\n|   ├── _drafts\n|   └── _posts\n└── themes\n```\n\n* scaffolds模板文件夹\n\n建站的模板，hexo依赖于此模板来生成静态文件。\n\n*  _config.yml配置文件\n\n[hexo官方配置文件说明](https://hexo.io/zh-cn/docs/configuration.html)\n\n以下为hexo的默认配置\n\n```\n# Hexo Configuration\n## Docs: https://hexo.io/docs/configuration.html\n## Source: https://github.com/hexojs/hexo/\n\n# Site\n# 网站标题\ntitle: Hexo \n# 网站副标题\nsubtitle: \n# 网站描述\ndescription: \nauthor: John Doe\n# 网站使用的语言\nlanguage: \n# 网站时区。Hexo 默认使用您电脑的时区。时区列表。比如说：America/New_York, Japan, 和 UTC 。\ntimezone: \n\n# URL\n## If your site is put in a subdirectory, set url as 'http://yoursite.com/child' and root as '/child/'\n# 如果您的网站存放在子目录中，例如 http://yoursite.com/blog，则请将您的 url 设为 #http://yoursite.com/blog 并把 root 设为 /blog/。\nurl: http://yoursite.com\n# 网站根目录\nroot: /\n# 文章的 永久链接 格式 \t:year/:month/:day/:title/\npermalink: :year/:month/:day/:title/\n# 永久链接中各部分的默认值 \t\npermalink_defaults:\n\n# Directory\n# 资源文件夹，这个文件夹用来存放内容。\nsource_dir: source\n# 公共文件夹，这个文件夹用于存放生成的站点文件\npublic_dir: public\n# 标签文件夹\ntag_dir: tags\n# 归档文件夹\narchive_dir: archives\n# 分类文件夹\ncategory_dir: categories\n# Include code 文件夹\ncode_dir: downloads/code\n# 国际化（i18n）文件夹\ni18n_dir: :lang\n# 跳过指定文件的渲染，您可使用 glob 表达式来匹配路径。 \t\nskip_render:\n\n# Writing\nnew_post_name: :title.md # File name of new posts\ndefault_layout: post\ntitlecase: false # Transform title into titlecase\nexternal_link: true # Open external links in new tab\nfilename_case: 0\nrender_drafts: false\npost_asset_folder: false\nrelative_link: false\nfuture: true\nhighlight:\n  enable: true\n  line_number: true\n  auto_detect: false\n  tab_replace:\n\n# Category & Tag\n# 默认分类 \tuncategorized\ndefault_category: uncategorized\n# 分类别名 \t\ncategory_map:\n# 标签别名 \t\ntag_map:\n\n# Date / Time format\n## Hexo uses Moment.js to parse and display date\n## You can customize the date format as defined in\n## http://momentjs.com/docs/#/displaying/format/\n# 日期格式 \tYYYY-MM-DD\ndate_format: YYYY-MM-DD\n# 时间格式 \tH:mm:ss\ntime_format: HH:mm:ss\n\n# Pagination\n## Set per_page to 0 to disable pagination\n# 每页显示的文章量 (0 = 关闭分页功能) \t10\nper_page: 10\n# 分页目录 \tpage\npagination_dir: page\n\n# Extensions\n## Plugins: https://hexo.io/plugins/\n## Themes: https://hexo.io/themes/\n# 当前主题名称。值为false时禁用主题\ntheme: landscape\n\n# Deployment\n## Docs: https://hexo.io/docs/deployment.html\ndeploy:\n  type:\n```\n\n\n\n* source资源文件夹\n\n用来存放用户资源，其中_post文件夹下的markdown文档，会被hexo自动解析成html，并放置到public文件夹中\n\n其他以_开头的文件夹会被自动忽略\n\n* themes主题文件夹\n\nhexo在解析时，会根据主题来生成静态页面。\n\n\n\n#### 新建一篇文章\n\n```\n$ hexo new [layout] <title>\n```\n\nlayout若不指定，默认从_config.yml文件中的default_layout代替\n\n\n\n#### 生成静态文件\n\n```\n$ hexo generate\n```\n\n| 选项               | 描述          |\n| ---------------- | ----------- |\n| `-d`, `--deploy` | 文件生成后立即部署网站 |\n| `-w`, `--watch`  | 监视文件变动      |\n\n\n\n使用generate命令后，hexo的文件夹会自动生成静态文件，放置到配置文件中规定的public目录中\n\n![](/images/blog_create/hexo_files_after_generate_1.png)\n\n\n\npublic文件夹中的内容如下\n\n![](/images/blog_create/hexo_files_after_generate_2.png)\n\n\n\n#### 启动服务器\n\n```\n$ hexo server\n```\n\n\n\n#### 部署网站\n\n```\n$ hexo deploy\n```\n\n| 参数                 | 描述           |\n| ------------------ | ------------ |\n| `-g`, `--generate` | 部署之前预先生成静态文件 |\n\n\n\n部署后的界面如下\n![](/images/blog_create/hexo_server_page.png)\n\n\n\n#### 清除缓存文件\n\n```\n$ hexo clean\n```\n\n清除缓存文件 (`db.json`) 和已生成的静态文件 (`public`)。\n\n![](/images/blog_create/hexo_clean.png)\n\n\n\n#### 其他hexo命令\n\n[其他hexo命令](https://hexo.io/zh-cn/docs/commands.html)\n\n\n\n### hexo部署到github中\n\n通过_config.yml文件建立关联，\n\n```\ndeploy:\n  type: git\n  repository: https://github.com/onepieceworld/hexo_test.git\n  branch: gh-pages\n```\n\n执行命令\n\n```\n~ $ npm install hexo-deployer-git --save\n~ $ hexo deploy\n```\n\n\n\n至此，hexo已成功将解析后的html文件上传到github中\n\n![](/images/blog_create/hexo_github.png)\n\n","source":"_posts/github_pages_init.md","raw":"---\ntitle:  \"基于Github搭建个人博客\"\ndate: 2016-10-20 00:00:00\ncategories: Github Jekyll Hexo\ntags: Jekyll Hexo blog Github\ntoc:\n  on: true\n  max_depth: 3\n  nowrap: false\n  list_number: true\ntoc_list_number: true\n---\n\n# 基于Github搭建个人博客\n\n## Github Pages\n\n### 什么是github pages？\n\nGitHub Pages is a static site hosting service.\n\nGitHub Pages is designed to host your personal, organization, or project pages directly from a GitHub repository. To learn more about the different types of GitHub Pages sites, see \"[User, organization, and project pages](https://help.github.com/articles/user-organization-and-project-pages/).\"\n\nYou can create and publish GitHub Pages online using the [Automatic Page Generator](https://help.github.com/articles/creating-pages-with-the-automatic-generator). If you prefer to work locally, you can use [GitHub Desktop](http://desktop.github.com) or the [command line](https://help.github.com/articles/adding-an-existing-project-to-github-using-the-command-line).\n\n\n\n 由用户编写的、免费的、托管在github上的静态网页\n\n---\n\n<!-- more -->\n\n### 如何搭建Github Pages \n\n官方教程\n\n https://pages.github.com/\n\nhttps://help.github.com/articles/user-organization-and-project-pages/\n\n搭建github博客基本分为如下几步：\n\n* 第一步，create a repository\n* 第二步， clone the repository\n* 第三步，create your website pages\n* 第四步，commit and push your files\n\n\n\ngithub pages为我们搭建的个人博客地址是有规则的：\n例如，我的github地址为https://github.com/wr4javaee\n那么，我的博客主页地址为https://wr4javaee.github.io\n\n若我的项目名称叫blog，那么对应的pages地址就是https://wr4javaee.github.io/blog\n\n\n\n* 注册github账号\n\nhttps://github.com/join\n\nonepieceworld@qq.com&3377128016，protosssoul@qq.com&2027194199\n\n![](/images/blog_create/create_repository.png)\n\ngithub为我们准备了两种搭建博客方式，一种是github提供模板，我们只需写md文档即可。另一种是从头搭建。\n\n我们先介绍第一种方式。\n\n\n\n#### 方法一，利用github pages模板搭建博客\n\n进入项目->settings->github pages->launch\n\n![](/images/blog_create/settings_lunch.png)\n\n\n\n点击launch后，进入\n\n![](/images/blog_create/lunch_page1.png)\n\n\n\n\n\n填写好项目名称、项目描述后，进入下一步，选择项目模板\n\n![](/images/blog_create/settings_theme.png)\n\n选择好模板后，点击 publish page即可提交。\n\n稍等片刻后，github即可为我们搭建好项目对应的网站。\n\n通过访问https://onepieceworld.github.io/test/\n\n\n\n\n#### 方法二，从头搭建博客\n\n若我们查看github模板为我们创建的博客，会发现github为我们自动创建了一个分支gh-pages作为默认分支，博客的文件都提交在这个特定的分支中。\n\n![](/images/blog_create/git_branch.png)\n\n那么，若我们从头搭建博客，就得模仿这一步骤。github规定，只有该分支中的页面，才会生成静态网页文件。\n\n我们新创建一个reponsitory，名为test1\n\nhttps://github.com/onepieceworld/test1.git\n\n\n\n接下来，我们创建一个全新的gh-pages分支，并将其作为默认分支\n\n```\nyumao@ubuntu:~/github/test1$ git checkout --orphan gh-pages\n```\n\n\n\n为新的空白分支创建默认页面并提交\n\n```\nyumao@ubuntu:~/github/test1$ git checkout --orphan gh-pages\nSwitched to a new branch 'gh-pages'\nyumao@ubuntu:~/github/test1$ git branch \nyumao@ubuntu:~/github/test1$ echo \"Hello World!\" > index.html\nyumao@ubuntu:~/github/test1$ git add index.html \nyumao@ubuntu:~/github/test1$ git commit -a -m \"commit index pages\"\n[gh-pages (root-commit) 0fab7c5] commit index pages\n 1 file changed, 1 insertion(+)\n create mode 100644 index.html\nyumao@ubuntu:~/github/test1$ git push origin gh-pages \n```\n\n\n\n提交成功后，访问https://onepieceworld.github.io/test1/，\n\n可以看到，github已经自动为我们将静态文件部署。\n\n---\n\n\n\n## 利用Jekyll搭建个人博客\n\n[Jekyll官方网站](http://jekyll.com.cn)\n[Jekyll github](https://github.com/jekyll/jekyll)\n\n\n### 什么是Jekyll？\n\nJekyll is a simple, blog-aware, static site generator perfect for \npersonal, project, or organization sites. Think of it like a file-based \nCMS, without all the complexity. Jekyll takes your content, renders \nMarkdown and Liquid templates, and spits out a complete, static website \nready to be served by Apache, Nginx or another web server. Jekyll is the\n engine behind [GitHub Pages](https://pages.github.com), which you can use to host sites right from your GitHub repositories.\n\n一个可以将纯文本转化为静态网站文件的生成器。\n\n基于Jekyll，我们可以只关注编写纯文本，如markdown，而无需将精力放在HTML本身。\n\n\n\n### Jekyll的简易用法\n\n> [Jekyll官方使用简介](http://jekyll.bootcss.com/)，内容很详细\n> [作者阮一峰关于Jekyll与Github Blog的入门教程](http://www.ruanyifeng.com/blog/2012/08/blogging_with_jekyll.html)，推荐大家阅读\n\n\n\n首先，Jekyll依赖Ruby\n\n安装Ruby环境过程中会遇到GWF，需要用到淘宝提供的RubyGems镜像服务，它与官方服务同步频率为15分钟。\n\n[淘宝RubyGems镜像]: https://ruby.taobao.org/\n\n\n\nRuby环境搭建好后，我们通过以下命令安装Jekyll\n\n```\n~ $ gem install jekyll\n```\n\n\n\n接下来，利用jekyll命令jekyll new my-awesome-site自动创建jekyll项目\n\n```\nyumao@ubuntu:~/github$ jekyll new jekyll_test\nNew jekyll site installed in /home/yumao/github/jekyll_test. \nRunning bundle install in /home/yumao/github/jekyll_test... \nFetching gem metadata from https://rubygems.org/................\nFetching version metadata from https://rubygems.org/...\nFetching dependency metadata from https://rubygems.org/..\nResolving dependencies...\nUsing addressable 2.4.0\nUsing colorator 1.1.0\nUsing ffi 1.9.14\nUsing forwardable-extended 2.6.0\nUsing sass 3.4.22\nUsing rb-fsevent 0.9.7\nUsing kramdown 1.12.0\nUsing liquid 3.0.6\nUsing mercenary 0.3.6\nUsing rouge 1.11.1\nUsing safe_yaml 1.0.4\nUsing minima 2.0.0\nUsing bundler 1.13.5\nUsing rb-inotify 0.9.7\nUsing pathutil 0.14.0\nUsing jekyll-sass-converter 1.4.0\nUsing listen 3.0.8\nUsing jekyll-watch 1.5.0\nUsing jekyll 3.3.0\nUsing jekyll-feed 0.8.0\nBundle complete! 3 Gemfile dependencies, 20 gems now installed.\nUse `bundle show [gemname]` to see where a bundled gem is installed.\nyumao@ubuntu:~/github$ \n```\n\n\n\n进入项目目录下，执行Jekyll命令 jekyll serve，启动项目\n\n```\nyumao@ubuntu:~/github$ cd jekyll_test/\nyumao@ubuntu:~/github/jekyll_test$ jekyll serve\nWARN: Unresolved specs during Gem::Specification.reset:\n      rouge (~> 1.7)\n      jekyll-watch (~> 1.1)\nWARN: Clearing out unresolved specs.\nPlease report a bug if this causes problems.\nConfiguration file: /home/yumao/github/jekyll_test/_config.yml\nConfiguration file: /home/yumao/github/jekyll_test/_config.yml\n            Source: /home/yumao/github/jekyll_test\n       Destination: /home/yumao/github/jekyll_test/_site\n Incremental build: disabled. Enable with --incremental\n      Generating... \n                    done in 0.286 seconds.\n Auto-regeneration: enabled for '/home/yumao/github/jekyll_test'\nConfiguration file: /home/yumao/github/jekyll_test/_config.yml\n    Server address: http://127.0.0.1:4000/\n  Server running... press ctrl-c to stop.\n\n```\n\n![](/images/blog_create/jekyll_default_page.png)\n\n\n\n至此，一个简易的jekyll项目就搭建好了，我们将它部署到github中，每次只要新增md文档，提交到github后，其会自动编译jekyll项目，自动解析成静态网页文件。\n\n\n\n### Jekyll的目录结构\n\n\n\n\n![](/images/blog_create/jekyll_files.png)\n\n```\n.\n├── _config.yml\n├── _drafts\n|   ├── begin-with-the-crazy-ideas.textile\n|   └── on-simplicity-in-technology.markdown\n├── _includes\n|   ├── footer.html\n|   └── header.html\n├── _layouts\n|   ├── default.html\n|   └── post.html\n├── _posts\n|   ├── 2007-10-29-why-every-programmer-should-play-nethack.textile\n|   └── 2009-04-26-barcamp-boston-4-roundup.textile\n├── _data\n|   └── members.yml\n├── _site\n└── index.html\n```\n\n\n\n| 文件 / 目录                                  | 描述                                       |\n| ---------------------------------------- | ---------------------------------------- |\n| `_config.yml`                            | 保存[配置](http://jekyll.com.cn/docs/configuration/)数据。很多配置选项都会直接从命令行中进行设置，但是如果你把那些配置写在这儿，你就不用非要去记住那些命令了。 |\n| `_drafts`                                | drafts 是未发布的文章。这些文件的格式中都没有 `title.MARKUP` 数据。学习如何使用 [drafts](http://jekyll.com.cn/docs/drafts/). |\n| `_includes`                              | 你可以加载这些包含部分到你的布局或者文章中以方便重用。可以用这个标签          `{nclude file.ext`          来把文件 `_includes/file.ext` 包含进来。 |\n| `_layouts`                               | layouts 是包裹在文章外部的模板。布局可以在 [YAML 头信息](http://jekyll.com.cn/docs/frontmatter/)中根据不同文章进行选择。          这将在下一个部分进行介绍。标签          `content`          可以将content插入页面中。 |\n| `_posts`                                 | 这里放的就是你的文章了。文件格式很重要，必须要符合:          `YEAR-MONTH-DAY-title.MARKUP`。          The [permalinks](http://jekyll.com.cn/docs/permalinks/) 可以在文章中自己定制，但是数据和标记语言都是根据文件名来确定的。 |\n| `_data`                                  | Well-formatted site data should be placed here. The jekyll engine will           autoload all yaml files (ends with `.yml` or `.yaml`)           in this directory. If there's a file `members.yml` under the directory,           then you can access contents of the file through `site.data.members`. |\n| `_site`                                  | 一旦 Jekyll 完成转换，就会将生成的页面放在这里（默认）。最好将这个目录放进你的 `.gitignore` 文件中。 |\n| `index.html` and other HTML, Markdown, Textile files | 如果这些文件中包含 [YAML 头信息](http://jekyll.com.cn/docs/frontmatter/) 部分，Jekyll 就会自动将它们进行转换。当然，其他的如 `.html`， `.markdown`，          `.md`，或者 `.textile` 等在你的站点根目录下或者不是以上提到的目录中的文件也会被转换。 |\n| Other Files/Folders                      | 其他一些未被提及的目录和文件如          `css` 还有 `images` 文件夹，          `favicon.ico` 等文件都将被完全拷贝到生成的 site 中。 这里有一些[使用 Jekyll 的站点](http://jekyll.com.cn/docs/sites/)，如果你感兴趣就来看看吧。 |\n\n\n\n#### _config.yml配置文件\n\n[官方配置文件说明](http://jekyll.com.cn/docs/configuration/)\n\n\n\n### 使用Jekyll的开源模板\n\n网络上免费的Jekyll主题非常多，推荐2个主题网站\n\n>\n>[Jekyll主题网站一](http://jekyllthemes.org/)\n>\n>[Jekyll主题网站二](http://jekyllthemes.io/)\n\n\n\n这里为大家推荐一个我喜欢的主题来源\n\n> [Gaohaoyang](http://gaohaoyang.github.io)\n\ngithub地址\n\nhttps://github.com/Gaohaoyang/gaohaoyang.github.io.git\n\n\n\n### Jekyll的优缺点\n\nJekyll是比较流行的博客系统，其主题、插件数量上比较丰富，且上手简单。\n缺点为文章量多的时候，生成速度慢。\n\n---\n\n\n\n## 利用Hexo搭建个人博客\n\n### Hexo与Jekyll的区别\nHexo是基于Node.js编写的静态博客系统，使用Jekyl我们可以将原生的markdown文档上传到github，由github自动解析成静态html文件。但hexo为本地将markdown文档解析后，将生成的静态html文件直接上传到github中。\n\n由于hexo基于nodejs，因此其生成html速度较Jekyll快，相对更灵活。主题数量然有Jade/Stylus/Less等各种方言支持。\n\n|        | 语言     | 活跃度  | 开箱即用 | 主题数量 | 主题系统 | 生成速度 | 博客适应性 | 非博客适应性 |\n| ------ | ------ | ---- | ---- | ---- | ---- | ---- | ----- | ------ |\n| Jekyll | Ruby   | S    | B    | A    | A    | C    | A     | C      |\n| Hexo   | NodeJS | B    | A    | A    | B    | A    | A     | B      |\n\n\n\n### Hexo官方文档\n\n[Hexo官方文档](https://hexo.io/zh-cn/docs/)\n\n\n\n### 安装Hexo\n\nHexo基于Node.js，因此首先应安装Node.js环境。\n\ncURL：\n\n```\n$ curl https://raw.github.com/creationix/nvm/master/install.sh | sh\n```\n\nWget\n```\n$ wget -qO- https://raw.github.com/creationix/nvm/master/install.sh | sh\n```\n安装完成后，重启终端执行下列命令完成安装Node.js\n```\n$ nvm install stable\n```\n\n若环境准备就绪，使用以下命令安装Hexo\n\n```\n$ npm install -g hexo-cli\n```\n\n\n\n### 使用Hexo建立网站\n\n使用以下命令初始化网站\n\n```\n$ hexo init <folder>\n$ cd <folder>\n$ npm install\n```\n\n\n\n建站后的文件目录如下：\n\n![](/images/blog_create/hexo_files.png)\n\n\n\n```\n.\n├── _config.yml\n├── package.json\n├── scaffolds\n├── source\n|   ├── _drafts\n|   └── _posts\n└── themes\n```\n\n* scaffolds模板文件夹\n\n建站的模板，hexo依赖于此模板来生成静态文件。\n\n*  _config.yml配置文件\n\n[hexo官方配置文件说明](https://hexo.io/zh-cn/docs/configuration.html)\n\n以下为hexo的默认配置\n\n```\n# Hexo Configuration\n## Docs: https://hexo.io/docs/configuration.html\n## Source: https://github.com/hexojs/hexo/\n\n# Site\n# 网站标题\ntitle: Hexo \n# 网站副标题\nsubtitle: \n# 网站描述\ndescription: \nauthor: John Doe\n# 网站使用的语言\nlanguage: \n# 网站时区。Hexo 默认使用您电脑的时区。时区列表。比如说：America/New_York, Japan, 和 UTC 。\ntimezone: \n\n# URL\n## If your site is put in a subdirectory, set url as 'http://yoursite.com/child' and root as '/child/'\n# 如果您的网站存放在子目录中，例如 http://yoursite.com/blog，则请将您的 url 设为 #http://yoursite.com/blog 并把 root 设为 /blog/。\nurl: http://yoursite.com\n# 网站根目录\nroot: /\n# 文章的 永久链接 格式 \t:year/:month/:day/:title/\npermalink: :year/:month/:day/:title/\n# 永久链接中各部分的默认值 \t\npermalink_defaults:\n\n# Directory\n# 资源文件夹，这个文件夹用来存放内容。\nsource_dir: source\n# 公共文件夹，这个文件夹用于存放生成的站点文件\npublic_dir: public\n# 标签文件夹\ntag_dir: tags\n# 归档文件夹\narchive_dir: archives\n# 分类文件夹\ncategory_dir: categories\n# Include code 文件夹\ncode_dir: downloads/code\n# 国际化（i18n）文件夹\ni18n_dir: :lang\n# 跳过指定文件的渲染，您可使用 glob 表达式来匹配路径。 \t\nskip_render:\n\n# Writing\nnew_post_name: :title.md # File name of new posts\ndefault_layout: post\ntitlecase: false # Transform title into titlecase\nexternal_link: true # Open external links in new tab\nfilename_case: 0\nrender_drafts: false\npost_asset_folder: false\nrelative_link: false\nfuture: true\nhighlight:\n  enable: true\n  line_number: true\n  auto_detect: false\n  tab_replace:\n\n# Category & Tag\n# 默认分类 \tuncategorized\ndefault_category: uncategorized\n# 分类别名 \t\ncategory_map:\n# 标签别名 \t\ntag_map:\n\n# Date / Time format\n## Hexo uses Moment.js to parse and display date\n## You can customize the date format as defined in\n## http://momentjs.com/docs/#/displaying/format/\n# 日期格式 \tYYYY-MM-DD\ndate_format: YYYY-MM-DD\n# 时间格式 \tH:mm:ss\ntime_format: HH:mm:ss\n\n# Pagination\n## Set per_page to 0 to disable pagination\n# 每页显示的文章量 (0 = 关闭分页功能) \t10\nper_page: 10\n# 分页目录 \tpage\npagination_dir: page\n\n# Extensions\n## Plugins: https://hexo.io/plugins/\n## Themes: https://hexo.io/themes/\n# 当前主题名称。值为false时禁用主题\ntheme: landscape\n\n# Deployment\n## Docs: https://hexo.io/docs/deployment.html\ndeploy:\n  type:\n```\n\n\n\n* source资源文件夹\n\n用来存放用户资源，其中_post文件夹下的markdown文档，会被hexo自动解析成html，并放置到public文件夹中\n\n其他以_开头的文件夹会被自动忽略\n\n* themes主题文件夹\n\nhexo在解析时，会根据主题来生成静态页面。\n\n\n\n#### 新建一篇文章\n\n```\n$ hexo new [layout] <title>\n```\n\nlayout若不指定，默认从_config.yml文件中的default_layout代替\n\n\n\n#### 生成静态文件\n\n```\n$ hexo generate\n```\n\n| 选项               | 描述          |\n| ---------------- | ----------- |\n| `-d`, `--deploy` | 文件生成后立即部署网站 |\n| `-w`, `--watch`  | 监视文件变动      |\n\n\n\n使用generate命令后，hexo的文件夹会自动生成静态文件，放置到配置文件中规定的public目录中\n\n![](/images/blog_create/hexo_files_after_generate_1.png)\n\n\n\npublic文件夹中的内容如下\n\n![](/images/blog_create/hexo_files_after_generate_2.png)\n\n\n\n#### 启动服务器\n\n```\n$ hexo server\n```\n\n\n\n#### 部署网站\n\n```\n$ hexo deploy\n```\n\n| 参数                 | 描述           |\n| ------------------ | ------------ |\n| `-g`, `--generate` | 部署之前预先生成静态文件 |\n\n\n\n部署后的界面如下\n![](/images/blog_create/hexo_server_page.png)\n\n\n\n#### 清除缓存文件\n\n```\n$ hexo clean\n```\n\n清除缓存文件 (`db.json`) 和已生成的静态文件 (`public`)。\n\n![](/images/blog_create/hexo_clean.png)\n\n\n\n#### 其他hexo命令\n\n[其他hexo命令](https://hexo.io/zh-cn/docs/commands.html)\n\n\n\n### hexo部署到github中\n\n通过_config.yml文件建立关联，\n\n```\ndeploy:\n  type: git\n  repository: https://github.com/onepieceworld/hexo_test.git\n  branch: gh-pages\n```\n\n执行命令\n\n```\n~ $ npm install hexo-deployer-git --save\n~ $ hexo deploy\n```\n\n\n\n至此，hexo已成功将解析后的html文件上传到github中\n\n![](/images/blog_create/hexo_github.png)\n\n","slug":"github_pages_init","published":1,"updated":"2016-11-06T09:59:16.719Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1hliwfr0007o65lqinnde4t","content":"<h1 id=\"基于Github搭建个人博客\"><a href=\"#基于Github搭建个人博客\" class=\"headerlink\" title=\"基于Github搭建个人博客\"></a>基于Github搭建个人博客</h1><h2 id=\"Github-Pages\"><a href=\"#Github-Pages\" class=\"headerlink\" title=\"Github Pages\"></a>Github Pages</h2><h3 id=\"什么是github-pages？\"><a href=\"#什么是github-pages？\" class=\"headerlink\" title=\"什么是github pages？\"></a>什么是github pages？</h3><p>GitHub Pages is a static site hosting service.</p>\n<p>GitHub Pages is designed to host your personal, organization, or project pages directly from a GitHub repository. To learn more about the different types of GitHub Pages sites, see “<a href=\"https://help.github.com/articles/user-organization-and-project-pages/\" target=\"_blank\" rel=\"external\">User, organization, and project pages</a>.”</p>\n<p>You can create and publish GitHub Pages online using the <a href=\"https://help.github.com/articles/creating-pages-with-the-automatic-generator\" target=\"_blank\" rel=\"external\">Automatic Page Generator</a>. If you prefer to work locally, you can use <a href=\"http://desktop.github.com\" target=\"_blank\" rel=\"external\">GitHub Desktop</a> or the <a href=\"https://help.github.com/articles/adding-an-existing-project-to-github-using-the-command-line\" target=\"_blank\" rel=\"external\">command line</a>.</p>\n<p> 由用户编写的、免费的、托管在github上的静态网页</p>\n<hr>\n<a id=\"more\"></a>\n<h3 id=\"如何搭建Github-Pages\"><a href=\"#如何搭建Github-Pages\" class=\"headerlink\" title=\"如何搭建Github Pages\"></a>如何搭建Github Pages</h3><p>官方教程</p>\n<p> <a href=\"https://pages.github.com/\" target=\"_blank\" rel=\"external\">https://pages.github.com/</a></p>\n<p><a href=\"https://help.github.com/articles/user-organization-and-project-pages/\" target=\"_blank\" rel=\"external\">https://help.github.com/articles/user-organization-and-project-pages/</a></p>\n<p>搭建github博客基本分为如下几步：</p>\n<ul>\n<li>第一步，create a repository</li>\n<li>第二步， clone the repository</li>\n<li>第三步，create your website pages</li>\n<li>第四步，commit and push your files</li>\n</ul>\n<p>github pages为我们搭建的个人博客地址是有规则的：<br>例如，我的github地址为<a href=\"https://github.com/wr4javaee\" target=\"_blank\" rel=\"external\">https://github.com/wr4javaee</a><br>那么，我的博客主页地址为<a href=\"https://wr4javaee.github.io\" target=\"_blank\" rel=\"external\">https://wr4javaee.github.io</a></p>\n<p>若我的项目名称叫blog，那么对应的pages地址就是<a href=\"https://wr4javaee.github.io/blog\" target=\"_blank\" rel=\"external\">https://wr4javaee.github.io/blog</a></p>\n<ul>\n<li>注册github账号</li>\n</ul>\n<p><a href=\"https://github.com/join\" target=\"_blank\" rel=\"external\">https://github.com/join</a></p>\n<p>onepieceworld@qq.com&amp;3377128016，protosssoul@qq.com&amp;2027194199</p>\n<p><img src=\"/images/blog_create/create_repository.png\" alt=\"\"></p>\n<p>github为我们准备了两种搭建博客方式，一种是github提供模板，我们只需写md文档即可。另一种是从头搭建。</p>\n<p>我们先介绍第一种方式。</p>\n<h4 id=\"方法一，利用github-pages模板搭建博客\"><a href=\"#方法一，利用github-pages模板搭建博客\" class=\"headerlink\" title=\"方法一，利用github pages模板搭建博客\"></a>方法一，利用github pages模板搭建博客</h4><p>进入项目-&gt;settings-&gt;github pages-&gt;launch</p>\n<p><img src=\"/images/blog_create/settings_lunch.png\" alt=\"\"></p>\n<p>点击launch后，进入</p>\n<p><img src=\"/images/blog_create/lunch_page1.png\" alt=\"\"></p>\n<p>填写好项目名称、项目描述后，进入下一步，选择项目模板</p>\n<p><img src=\"/images/blog_create/settings_theme.png\" alt=\"\"></p>\n<p>选择好模板后，点击 publish page即可提交。</p>\n<p>稍等片刻后，github即可为我们搭建好项目对应的网站。</p>\n<p>通过访问<a href=\"https://onepieceworld.github.io/test/\" target=\"_blank\" rel=\"external\">https://onepieceworld.github.io/test/</a></p>\n<h4 id=\"方法二，从头搭建博客\"><a href=\"#方法二，从头搭建博客\" class=\"headerlink\" title=\"方法二，从头搭建博客\"></a>方法二，从头搭建博客</h4><p>若我们查看github模板为我们创建的博客，会发现github为我们自动创建了一个分支gh-pages作为默认分支，博客的文件都提交在这个特定的分支中。</p>\n<p><img src=\"/images/blog_create/git_branch.png\" alt=\"\"></p>\n<p>那么，若我们从头搭建博客，就得模仿这一步骤。github规定，只有该分支中的页面，才会生成静态网页文件。</p>\n<p>我们新创建一个reponsitory，名为test1</p>\n<p><a href=\"https://github.com/onepieceworld/test1.git\" target=\"_blank\" rel=\"external\">https://github.com/onepieceworld/test1.git</a></p>\n<p>接下来，我们创建一个全新的gh-pages分支，并将其作为默认分支</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">yumao@ubuntu:~/github/test1$ git checkout --orphan gh-pages</div></pre></td></tr></table></figure>\n<p>为新的空白分支创建默认页面并提交</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\">yumao@ubuntu:~/github/test1$ git checkout --orphan gh-pages</div><div class=\"line\">Switched to a new branch &apos;gh-pages&apos;</div><div class=\"line\">yumao@ubuntu:~/github/test1$ git branch </div><div class=\"line\">yumao@ubuntu:~/github/test1$ echo &quot;Hello World!&quot; &gt; index.html</div><div class=\"line\">yumao@ubuntu:~/github/test1$ git add index.html </div><div class=\"line\">yumao@ubuntu:~/github/test1$ git commit -a -m &quot;commit index pages&quot;</div><div class=\"line\">[gh-pages (root-commit) 0fab7c5] commit index pages</div><div class=\"line\"> 1 file changed, 1 insertion(+)</div><div class=\"line\"> create mode 100644 index.html</div><div class=\"line\">yumao@ubuntu:~/github/test1$ git push origin gh-pages</div></pre></td></tr></table></figure>\n<p>提交成功后，访问<a href=\"https://onepieceworld.github.io/test1/，\" target=\"_blank\" rel=\"external\">https://onepieceworld.github.io/test1/，</a></p>\n<p>可以看到，github已经自动为我们将静态文件部署。</p>\n<hr>\n<h2 id=\"利用Jekyll搭建个人博客\"><a href=\"#利用Jekyll搭建个人博客\" class=\"headerlink\" title=\"利用Jekyll搭建个人博客\"></a>利用Jekyll搭建个人博客</h2><p><a href=\"http://jekyll.com.cn\" target=\"_blank\" rel=\"external\">Jekyll官方网站</a><br><a href=\"https://github.com/jekyll/jekyll\" target=\"_blank\" rel=\"external\">Jekyll github</a></p>\n<h3 id=\"什么是Jekyll？\"><a href=\"#什么是Jekyll？\" class=\"headerlink\" title=\"什么是Jekyll？\"></a>什么是Jekyll？</h3><p>Jekyll is a simple, blog-aware, static site generator perfect for<br>personal, project, or organization sites. Think of it like a file-based<br>CMS, without all the complexity. Jekyll takes your content, renders<br>Markdown and Liquid templates, and spits out a complete, static website<br>ready to be served by Apache, Nginx or another web server. Jekyll is the<br> engine behind <a href=\"https://pages.github.com\" target=\"_blank\" rel=\"external\">GitHub Pages</a>, which you can use to host sites right from your GitHub repositories.</p>\n<p>一个可以将纯文本转化为静态网站文件的生成器。</p>\n<p>基于Jekyll，我们可以只关注编写纯文本，如markdown，而无需将精力放在HTML本身。</p>\n<h3 id=\"Jekyll的简易用法\"><a href=\"#Jekyll的简易用法\" class=\"headerlink\" title=\"Jekyll的简易用法\"></a>Jekyll的简易用法</h3><blockquote>\n<p><a href=\"http://jekyll.bootcss.com/\" target=\"_blank\" rel=\"external\">Jekyll官方使用简介</a>，内容很详细<br><a href=\"http://www.ruanyifeng.com/blog/2012/08/blogging_with_jekyll.html\" target=\"_blank\" rel=\"external\">作者阮一峰关于Jekyll与Github Blog的入门教程</a>，推荐大家阅读</p>\n</blockquote>\n<p>首先，Jekyll依赖Ruby</p>\n<p>安装Ruby环境过程中会遇到GWF，需要用到淘宝提供的RubyGems镜像服务，它与官方服务同步频率为15分钟。</p>\n<p>Ruby环境搭建好后，我们通过以下命令安装Jekyll</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">~ $ gem install jekyll</div></pre></td></tr></table></figure>\n<p>接下来，利用jekyll命令jekyll new my-awesome-site自动创建jekyll项目</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div></pre></td><td class=\"code\"><pre><div class=\"line\">yumao@ubuntu:~/github$ jekyll new jekyll_test</div><div class=\"line\">New jekyll site installed in /home/yumao/github/jekyll_test. </div><div class=\"line\">Running bundle install in /home/yumao/github/jekyll_test... </div><div class=\"line\">Fetching gem metadata from https://rubygems.org/................</div><div class=\"line\">Fetching version metadata from https://rubygems.org/...</div><div class=\"line\">Fetching dependency metadata from https://rubygems.org/..</div><div class=\"line\">Resolving dependencies...</div><div class=\"line\">Using addressable 2.4.0</div><div class=\"line\">Using colorator 1.1.0</div><div class=\"line\">Using ffi 1.9.14</div><div class=\"line\">Using forwardable-extended 2.6.0</div><div class=\"line\">Using sass 3.4.22</div><div class=\"line\">Using rb-fsevent 0.9.7</div><div class=\"line\">Using kramdown 1.12.0</div><div class=\"line\">Using liquid 3.0.6</div><div class=\"line\">Using mercenary 0.3.6</div><div class=\"line\">Using rouge 1.11.1</div><div class=\"line\">Using safe_yaml 1.0.4</div><div class=\"line\">Using minima 2.0.0</div><div class=\"line\">Using bundler 1.13.5</div><div class=\"line\">Using rb-inotify 0.9.7</div><div class=\"line\">Using pathutil 0.14.0</div><div class=\"line\">Using jekyll-sass-converter 1.4.0</div><div class=\"line\">Using listen 3.0.8</div><div class=\"line\">Using jekyll-watch 1.5.0</div><div class=\"line\">Using jekyll 3.3.0</div><div class=\"line\">Using jekyll-feed 0.8.0</div><div class=\"line\">Bundle complete! 3 Gemfile dependencies, 20 gems now installed.</div><div class=\"line\">Use `bundle show [gemname]` to see where a bundled gem is installed.</div><div class=\"line\">yumao@ubuntu:~/github$</div></pre></td></tr></table></figure>\n<p>进入项目目录下，执行Jekyll命令 jekyll serve，启动项目</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\">yumao@ubuntu:~/github$ cd jekyll_test/</div><div class=\"line\">yumao@ubuntu:~/github/jekyll_test$ jekyll serve</div><div class=\"line\">WARN: Unresolved specs during Gem::Specification.reset:</div><div class=\"line\">      rouge (~&gt; 1.7)</div><div class=\"line\">      jekyll-watch (~&gt; 1.1)</div><div class=\"line\">WARN: Clearing out unresolved specs.</div><div class=\"line\">Please report a bug if this causes problems.</div><div class=\"line\">Configuration file: /home/yumao/github/jekyll_test/_config.yml</div><div class=\"line\">Configuration file: /home/yumao/github/jekyll_test/_config.yml</div><div class=\"line\">            Source: /home/yumao/github/jekyll_test</div><div class=\"line\">       Destination: /home/yumao/github/jekyll_test/_site</div><div class=\"line\"> Incremental build: disabled. Enable with --incremental</div><div class=\"line\">      Generating... </div><div class=\"line\">                    done in 0.286 seconds.</div><div class=\"line\"> Auto-regeneration: enabled for &apos;/home/yumao/github/jekyll_test&apos;</div><div class=\"line\">Configuration file: /home/yumao/github/jekyll_test/_config.yml</div><div class=\"line\">    Server address: http://127.0.0.1:4000/</div><div class=\"line\">  Server running... press ctrl-c to stop.</div></pre></td></tr></table></figure>\n<p><img src=\"/images/blog_create/jekyll_default_page.png\" alt=\"\"></p>\n<p>至此，一个简易的jekyll项目就搭建好了，我们将它部署到github中，每次只要新增md文档，提交到github后，其会自动编译jekyll项目，自动解析成静态网页文件。</p>\n<h3 id=\"Jekyll的目录结构\"><a href=\"#Jekyll的目录结构\" class=\"headerlink\" title=\"Jekyll的目录结构\"></a>Jekyll的目录结构</h3><p><img src=\"/images/blog_create/jekyll_files.png\" alt=\"\"></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\">.</div><div class=\"line\">├── _config.yml</div><div class=\"line\">├── _drafts</div><div class=\"line\">|   ├── begin-with-the-crazy-ideas.textile</div><div class=\"line\">|   └── on-simplicity-in-technology.markdown</div><div class=\"line\">├── _includes</div><div class=\"line\">|   ├── footer.html</div><div class=\"line\">|   └── header.html</div><div class=\"line\">├── _layouts</div><div class=\"line\">|   ├── default.html</div><div class=\"line\">|   └── post.html</div><div class=\"line\">├── _posts</div><div class=\"line\">|   ├── 2007-10-29-why-every-programmer-should-play-nethack.textile</div><div class=\"line\">|   └── 2009-04-26-barcamp-boston-4-roundup.textile</div><div class=\"line\">├── _data</div><div class=\"line\">|   └── members.yml</div><div class=\"line\">├── _site</div><div class=\"line\">└── index.html</div></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>文件 / 目录</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>_config.yml</code></td>\n<td>保存<a href=\"http://jekyll.com.cn/docs/configuration/\" target=\"_blank\" rel=\"external\">配置</a>数据。很多配置选项都会直接从命令行中进行设置，但是如果你把那些配置写在这儿，你就不用非要去记住那些命令了。</td>\n</tr>\n<tr>\n<td><code>_drafts</code></td>\n<td>drafts 是未发布的文章。这些文件的格式中都没有 <code>title.MARKUP</code> 数据。学习如何使用 <a href=\"http://jekyll.com.cn/docs/drafts/\" target=\"_blank\" rel=\"external\">drafts</a>.</td>\n</tr>\n<tr>\n<td><code>_includes</code></td>\n<td>你可以加载这些包含部分到你的布局或者文章中以方便重用。可以用这个标签          <code>{nclude file.ext</code>          来把文件 <code>_includes/file.ext</code> 包含进来。</td>\n</tr>\n<tr>\n<td><code>_layouts</code></td>\n<td>layouts 是包裹在文章外部的模板。布局可以在 <a href=\"http://jekyll.com.cn/docs/frontmatter/\" target=\"_blank\" rel=\"external\">YAML 头信息</a>中根据不同文章进行选择。          这将在下一个部分进行介绍。标签          <code>content</code>          可以将content插入页面中。</td>\n</tr>\n<tr>\n<td><code>_posts</code></td>\n<td>这里放的就是你的文章了。文件格式很重要，必须要符合:          <code>YEAR-MONTH-DAY-title.MARKUP</code>。          The <a href=\"http://jekyll.com.cn/docs/permalinks/\" target=\"_blank\" rel=\"external\">permalinks</a> 可以在文章中自己定制，但是数据和标记语言都是根据文件名来确定的。</td>\n</tr>\n<tr>\n<td><code>_data</code></td>\n<td>Well-formatted site data should be placed here. The jekyll engine will           autoload all yaml files (ends with <code>.yml</code> or <code>.yaml</code>)           in this directory. If there’s a file <code>members.yml</code> under the directory,           then you can access contents of the file through <code>site.data.members</code>.</td>\n</tr>\n<tr>\n<td><code>_site</code></td>\n<td>一旦 Jekyll 完成转换，就会将生成的页面放在这里（默认）。最好将这个目录放进你的 <code>.gitignore</code> 文件中。</td>\n</tr>\n<tr>\n<td><code>index.html</code> and other HTML, Markdown, Textile files</td>\n<td>如果这些文件中包含 <a href=\"http://jekyll.com.cn/docs/frontmatter/\" target=\"_blank\" rel=\"external\">YAML 头信息</a> 部分，Jekyll 就会自动将它们进行转换。当然，其他的如 <code>.html</code>， <code>.markdown</code>，          <code>.md</code>，或者 <code>.textile</code> 等在你的站点根目录下或者不是以上提到的目录中的文件也会被转换。</td>\n</tr>\n<tr>\n<td>Other Files/Folders</td>\n<td>其他一些未被提及的目录和文件如          <code>css</code> 还有 <code>images</code> 文件夹，          <code>favicon.ico</code> 等文件都将被完全拷贝到生成的 site 中。 这里有一些<a href=\"http://jekyll.com.cn/docs/sites/\" target=\"_blank\" rel=\"external\">使用 Jekyll 的站点</a>，如果你感兴趣就来看看吧。</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"config-yml配置文件\"><a href=\"#config-yml配置文件\" class=\"headerlink\" title=\"_config.yml配置文件\"></a>_config.yml配置文件</h4><p><a href=\"http://jekyll.com.cn/docs/configuration/\" target=\"_blank\" rel=\"external\">官方配置文件说明</a></p>\n<h3 id=\"使用Jekyll的开源模板\"><a href=\"#使用Jekyll的开源模板\" class=\"headerlink\" title=\"使用Jekyll的开源模板\"></a>使用Jekyll的开源模板</h3><p>网络上免费的Jekyll主题非常多，推荐2个主题网站</p>\n<p>&gt;</p>\n<blockquote>\n<p><a href=\"http://jekyllthemes.org/\" target=\"_blank\" rel=\"external\">Jekyll主题网站一</a></p>\n<p><a href=\"http://jekyllthemes.io/\" target=\"_blank\" rel=\"external\">Jekyll主题网站二</a></p>\n</blockquote>\n<p>这里为大家推荐一个我喜欢的主题来源</p>\n<blockquote>\n<p><a href=\"http://gaohaoyang.github.io\" target=\"_blank\" rel=\"external\">Gaohaoyang</a></p>\n</blockquote>\n<p>github地址</p>\n<p><a href=\"https://github.com/Gaohaoyang/gaohaoyang.github.io.git\" target=\"_blank\" rel=\"external\">https://github.com/Gaohaoyang/gaohaoyang.github.io.git</a></p>\n<h3 id=\"Jekyll的优缺点\"><a href=\"#Jekyll的优缺点\" class=\"headerlink\" title=\"Jekyll的优缺点\"></a>Jekyll的优缺点</h3><p>Jekyll是比较流行的博客系统，其主题、插件数量上比较丰富，且上手简单。<br>缺点为文章量多的时候，生成速度慢。</p>\n<hr>\n<h2 id=\"利用Hexo搭建个人博客\"><a href=\"#利用Hexo搭建个人博客\" class=\"headerlink\" title=\"利用Hexo搭建个人博客\"></a>利用Hexo搭建个人博客</h2><h3 id=\"Hexo与Jekyll的区别\"><a href=\"#Hexo与Jekyll的区别\" class=\"headerlink\" title=\"Hexo与Jekyll的区别\"></a>Hexo与Jekyll的区别</h3><p>Hexo是基于Node.js编写的静态博客系统，使用Jekyl我们可以将原生的markdown文档上传到github，由github自动解析成静态html文件。但hexo为本地将markdown文档解析后，将生成的静态html文件直接上传到github中。</p>\n<p>由于hexo基于nodejs，因此其生成html速度较Jekyll快，相对更灵活。主题数量然有Jade/Stylus/Less等各种方言支持。</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>语言</th>\n<th>活跃度</th>\n<th>开箱即用</th>\n<th>主题数量</th>\n<th>主题系统</th>\n<th>生成速度</th>\n<th>博客适应性</th>\n<th>非博客适应性</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Jekyll</td>\n<td>Ruby</td>\n<td>S</td>\n<td>B</td>\n<td>A</td>\n<td>A</td>\n<td>C</td>\n<td>A</td>\n<td>C</td>\n</tr>\n<tr>\n<td>Hexo</td>\n<td>NodeJS</td>\n<td>B</td>\n<td>A</td>\n<td>A</td>\n<td>B</td>\n<td>A</td>\n<td>A</td>\n<td>B</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"Hexo官方文档\"><a href=\"#Hexo官方文档\" class=\"headerlink\" title=\"Hexo官方文档\"></a>Hexo官方文档</h3><p><a href=\"https://hexo.io/zh-cn/docs/\" target=\"_blank\" rel=\"external\">Hexo官方文档</a></p>\n<h3 id=\"安装Hexo\"><a href=\"#安装Hexo\" class=\"headerlink\" title=\"安装Hexo\"></a>安装Hexo</h3><p>Hexo基于Node.js，因此首先应安装Node.js环境。</p>\n<p>cURL：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ curl https://raw.github.com/creationix/nvm/master/install.sh | sh</div></pre></td></tr></table></figure>\n<p>Wget<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ wget -qO- https://raw.github.com/creationix/nvm/master/install.sh | sh</div></pre></td></tr></table></figure></p>\n<p>安装完成后，重启终端执行下列命令完成安装Node.js<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ nvm install stable</div></pre></td></tr></table></figure></p>\n<p>若环境准备就绪，使用以下命令安装Hexo</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ npm install -g hexo-cli</div></pre></td></tr></table></figure>\n<h3 id=\"使用Hexo建立网站\"><a href=\"#使用Hexo建立网站\" class=\"headerlink\" title=\"使用Hexo建立网站\"></a>使用Hexo建立网站</h3><p>使用以下命令初始化网站</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ hexo init &lt;folder&gt;</div><div class=\"line\">$ cd &lt;folder&gt;</div><div class=\"line\">$ npm install</div></pre></td></tr></table></figure>\n<p>建站后的文件目录如下：</p>\n<p><img src=\"/images/blog_create/hexo_files.png\" alt=\"\"></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\">.</div><div class=\"line\">├── _config.yml</div><div class=\"line\">├── package.json</div><div class=\"line\">├── scaffolds</div><div class=\"line\">├── source</div><div class=\"line\">|   ├── _drafts</div><div class=\"line\">|   └── _posts</div><div class=\"line\">└── themes</div></pre></td></tr></table></figure>\n<ul>\n<li>scaffolds模板文件夹</li>\n</ul>\n<p>建站的模板，hexo依赖于此模板来生成静态文件。</p>\n<ul>\n<li>_config.yml配置文件</li>\n</ul>\n<p><a href=\"https://hexo.io/zh-cn/docs/configuration.html\" target=\"_blank\" rel=\"external\">hexo官方配置文件说明</a></p>\n<p>以下为hexo的默认配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div></pre></td><td class=\"code\"><pre><div class=\"line\"># Hexo Configuration</div><div class=\"line\">## Docs: https://hexo.io/docs/configuration.html</div><div class=\"line\">## Source: https://github.com/hexojs/hexo/</div><div class=\"line\"></div><div class=\"line\"># Site</div><div class=\"line\"># 网站标题</div><div class=\"line\">title: Hexo </div><div class=\"line\"># 网站副标题</div><div class=\"line\">subtitle: </div><div class=\"line\"># 网站描述</div><div class=\"line\">description: </div><div class=\"line\">author: John Doe</div><div class=\"line\"># 网站使用的语言</div><div class=\"line\">language: </div><div class=\"line\"># 网站时区。Hexo 默认使用您电脑的时区。时区列表。比如说：America/New_York, Japan, 和 UTC 。</div><div class=\"line\">timezone: </div><div class=\"line\"></div><div class=\"line\"># URL</div><div class=\"line\">## If your site is put in a subdirectory, set url as &apos;http://yoursite.com/child&apos; and root as &apos;/child/&apos;</div><div class=\"line\"># 如果您的网站存放在子目录中，例如 http://yoursite.com/blog，则请将您的 url 设为 #http://yoursite.com/blog 并把 root 设为 /blog/。</div><div class=\"line\">url: http://yoursite.com</div><div class=\"line\"># 网站根目录</div><div class=\"line\">root: /</div><div class=\"line\"># 文章的 永久链接 格式 \t:year/:month/:day/:title/</div><div class=\"line\">permalink: :year/:month/:day/:title/</div><div class=\"line\"># 永久链接中各部分的默认值 \t</div><div class=\"line\">permalink_defaults:</div><div class=\"line\"></div><div class=\"line\"># Directory</div><div class=\"line\"># 资源文件夹，这个文件夹用来存放内容。</div><div class=\"line\">source_dir: source</div><div class=\"line\"># 公共文件夹，这个文件夹用于存放生成的站点文件</div><div class=\"line\">public_dir: public</div><div class=\"line\"># 标签文件夹</div><div class=\"line\">tag_dir: tags</div><div class=\"line\"># 归档文件夹</div><div class=\"line\">archive_dir: archives</div><div class=\"line\"># 分类文件夹</div><div class=\"line\">category_dir: categories</div><div class=\"line\"># Include code 文件夹</div><div class=\"line\">code_dir: downloads/code</div><div class=\"line\"># 国际化（i18n）文件夹</div><div class=\"line\">i18n_dir: :lang</div><div class=\"line\"># 跳过指定文件的渲染，您可使用 glob 表达式来匹配路径。 \t</div><div class=\"line\">skip_render:</div><div class=\"line\"></div><div class=\"line\"># Writing</div><div class=\"line\">new_post_name: :title.md # File name of new posts</div><div class=\"line\">default_layout: post</div><div class=\"line\">titlecase: false # Transform title into titlecase</div><div class=\"line\">external_link: true # Open external links in new tab</div><div class=\"line\">filename_case: 0</div><div class=\"line\">render_drafts: false</div><div class=\"line\">post_asset_folder: false</div><div class=\"line\">relative_link: false</div><div class=\"line\">future: true</div><div class=\"line\">highlight:</div><div class=\"line\">  enable: true</div><div class=\"line\">  line_number: true</div><div class=\"line\">  auto_detect: false</div><div class=\"line\">  tab_replace:</div><div class=\"line\"></div><div class=\"line\"># Category &amp; Tag</div><div class=\"line\"># 默认分类 \tuncategorized</div><div class=\"line\">default_category: uncategorized</div><div class=\"line\"># 分类别名 \t</div><div class=\"line\">category_map:</div><div class=\"line\"># 标签别名 \t</div><div class=\"line\">tag_map:</div><div class=\"line\"></div><div class=\"line\"># Date / Time format</div><div class=\"line\">## Hexo uses Moment.js to parse and display date</div><div class=\"line\">## You can customize the date format as defined in</div><div class=\"line\">## http://momentjs.com/docs/#/displaying/format/</div><div class=\"line\"># 日期格式 \tYYYY-MM-DD</div><div class=\"line\">date_format: YYYY-MM-DD</div><div class=\"line\"># 时间格式 \tH:mm:ss</div><div class=\"line\">time_format: HH:mm:ss</div><div class=\"line\"></div><div class=\"line\"># Pagination</div><div class=\"line\">## Set per_page to 0 to disable pagination</div><div class=\"line\"># 每页显示的文章量 (0 = 关闭分页功能) \t10</div><div class=\"line\">per_page: 10</div><div class=\"line\"># 分页目录 \tpage</div><div class=\"line\">pagination_dir: page</div><div class=\"line\"></div><div class=\"line\"># Extensions</div><div class=\"line\">## Plugins: https://hexo.io/plugins/</div><div class=\"line\">## Themes: https://hexo.io/themes/</div><div class=\"line\"># 当前主题名称。值为false时禁用主题</div><div class=\"line\">theme: landscape</div><div class=\"line\"></div><div class=\"line\"># Deployment</div><div class=\"line\">## Docs: https://hexo.io/docs/deployment.html</div><div class=\"line\">deploy:</div><div class=\"line\">  type:</div></pre></td></tr></table></figure>\n<ul>\n<li>source资源文件夹</li>\n</ul>\n<p>用来存放用户资源，其中_post文件夹下的markdown文档，会被hexo自动解析成html，并放置到public文件夹中</p>\n<p>其他以_开头的文件夹会被自动忽略</p>\n<ul>\n<li>themes主题文件夹</li>\n</ul>\n<p>hexo在解析时，会根据主题来生成静态页面。</p>\n<h4 id=\"新建一篇文章\"><a href=\"#新建一篇文章\" class=\"headerlink\" title=\"新建一篇文章\"></a>新建一篇文章</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ hexo new [layout] &lt;title&gt;</div></pre></td></tr></table></figure>\n<p>layout若不指定，默认从_config.yml文件中的default_layout代替</p>\n<h4 id=\"生成静态文件\"><a href=\"#生成静态文件\" class=\"headerlink\" title=\"生成静态文件\"></a>生成静态文件</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ hexo generate</div></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>选项</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>-d</code>, <code>--deploy</code></td>\n<td>文件生成后立即部署网站</td>\n</tr>\n<tr>\n<td><code>-w</code>, <code>--watch</code></td>\n<td>监视文件变动</td>\n</tr>\n</tbody>\n</table>\n<p>使用generate命令后，hexo的文件夹会自动生成静态文件，放置到配置文件中规定的public目录中</p>\n<p><img src=\"/images/blog_create/hexo_files_after_generate_1.png\" alt=\"\"></p>\n<p>public文件夹中的内容如下</p>\n<p><img src=\"/images/blog_create/hexo_files_after_generate_2.png\" alt=\"\"></p>\n<h4 id=\"启动服务器\"><a href=\"#启动服务器\" class=\"headerlink\" title=\"启动服务器\"></a>启动服务器</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ hexo server</div></pre></td></tr></table></figure>\n<h4 id=\"部署网站\"><a href=\"#部署网站\" class=\"headerlink\" title=\"部署网站\"></a>部署网站</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ hexo deploy</div></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>-g</code>, <code>--generate</code></td>\n<td>部署之前预先生成静态文件</td>\n</tr>\n</tbody>\n</table>\n<p>部署后的界面如下<br><img src=\"/images/blog_create/hexo_server_page.png\" alt=\"\"></p>\n<h4 id=\"清除缓存文件\"><a href=\"#清除缓存文件\" class=\"headerlink\" title=\"清除缓存文件\"></a>清除缓存文件</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ hexo clean</div></pre></td></tr></table></figure>\n<p>清除缓存文件 (<code>db.json</code>) 和已生成的静态文件 (<code>public</code>)。</p>\n<p><img src=\"/images/blog_create/hexo_clean.png\" alt=\"\"></p>\n<h4 id=\"其他hexo命令\"><a href=\"#其他hexo命令\" class=\"headerlink\" title=\"其他hexo命令\"></a>其他hexo命令</h4><p><a href=\"https://hexo.io/zh-cn/docs/commands.html\" target=\"_blank\" rel=\"external\">其他hexo命令</a></p>\n<h3 id=\"hexo部署到github中\"><a href=\"#hexo部署到github中\" class=\"headerlink\" title=\"hexo部署到github中\"></a>hexo部署到github中</h3><p>通过_config.yml文件建立关联，</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">deploy:</div><div class=\"line\">  type: git</div><div class=\"line\">  repository: https://github.com/onepieceworld/hexo_test.git</div><div class=\"line\">  branch: gh-pages</div></pre></td></tr></table></figure>\n<p>执行命令</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">~ $ npm install hexo-deployer-git --save</div><div class=\"line\">~ $ hexo deploy</div></pre></td></tr></table></figure>\n<p>至此，hexo已成功将解析后的html文件上传到github中</p>\n<p><img src=\"/images/blog_create/hexo_github.png\" alt=\"\"></p>\n","excerpt":"<h1 id=\"基于Github搭建个人博客\"><a href=\"#基于Github搭建个人博客\" class=\"headerlink\" title=\"基于Github搭建个人博客\"></a>基于Github搭建个人博客</h1><h2 id=\"Github-Pages\"><a href=\"#Github-Pages\" class=\"headerlink\" title=\"Github Pages\"></a>Github Pages</h2><h3 id=\"什么是github-pages？\"><a href=\"#什么是github-pages？\" class=\"headerlink\" title=\"什么是github pages？\"></a>什么是github pages？</h3><p>GitHub Pages is a static site hosting service.</p>\n<p>GitHub Pages is designed to host your personal, organization, or project pages directly from a GitHub repository. To learn more about the different types of GitHub Pages sites, see “<a href=\"https://help.github.com/articles/user-organization-and-project-pages/\">User, organization, and project pages</a>.”</p>\n<p>You can create and publish GitHub Pages online using the <a href=\"https://help.github.com/articles/creating-pages-with-the-automatic-generator\">Automatic Page Generator</a>. If you prefer to work locally, you can use <a href=\"http://desktop.github.com\">GitHub Desktop</a> or the <a href=\"https://help.github.com/articles/adding-an-existing-project-to-github-using-the-command-line\">command line</a>.</p>\n<p> 由用户编写的、免费的、托管在github上的静态网页</p>\n<hr>","more":"<h3 id=\"如何搭建Github-Pages\"><a href=\"#如何搭建Github-Pages\" class=\"headerlink\" title=\"如何搭建Github Pages\"></a>如何搭建Github Pages</h3><p>官方教程</p>\n<p> <a href=\"https://pages.github.com/\">https://pages.github.com/</a></p>\n<p><a href=\"https://help.github.com/articles/user-organization-and-project-pages/\">https://help.github.com/articles/user-organization-and-project-pages/</a></p>\n<p>搭建github博客基本分为如下几步：</p>\n<ul>\n<li>第一步，create a repository</li>\n<li>第二步， clone the repository</li>\n<li>第三步，create your website pages</li>\n<li>第四步，commit and push your files</li>\n</ul>\n<p>github pages为我们搭建的个人博客地址是有规则的：<br>例如，我的github地址为<a href=\"https://github.com/wr4javaee\">https://github.com/wr4javaee</a><br>那么，我的博客主页地址为<a href=\"https://wr4javaee.github.io\">https://wr4javaee.github.io</a></p>\n<p>若我的项目名称叫blog，那么对应的pages地址就是<a href=\"https://wr4javaee.github.io/blog\">https://wr4javaee.github.io/blog</a></p>\n<ul>\n<li>注册github账号</li>\n</ul>\n<p><a href=\"https://github.com/join\">https://github.com/join</a></p>\n<p>onepieceworld@qq.com&amp;3377128016，protosssoul@qq.com&amp;2027194199</p>\n<p><img src=\"/images/blog_create/create_repository.png\" alt=\"\"></p>\n<p>github为我们准备了两种搭建博客方式，一种是github提供模板，我们只需写md文档即可。另一种是从头搭建。</p>\n<p>我们先介绍第一种方式。</p>\n<h4 id=\"方法一，利用github-pages模板搭建博客\"><a href=\"#方法一，利用github-pages模板搭建博客\" class=\"headerlink\" title=\"方法一，利用github pages模板搭建博客\"></a>方法一，利用github pages模板搭建博客</h4><p>进入项目-&gt;settings-&gt;github pages-&gt;launch</p>\n<p><img src=\"/images/blog_create/settings_lunch.png\" alt=\"\"></p>\n<p>点击launch后，进入</p>\n<p><img src=\"/images/blog_create/lunch_page1.png\" alt=\"\"></p>\n<p>填写好项目名称、项目描述后，进入下一步，选择项目模板</p>\n<p><img src=\"/images/blog_create/settings_theme.png\" alt=\"\"></p>\n<p>选择好模板后，点击 publish page即可提交。</p>\n<p>稍等片刻后，github即可为我们搭建好项目对应的网站。</p>\n<p>通过访问<a href=\"https://onepieceworld.github.io/test/\">https://onepieceworld.github.io/test/</a></p>\n<h4 id=\"方法二，从头搭建博客\"><a href=\"#方法二，从头搭建博客\" class=\"headerlink\" title=\"方法二，从头搭建博客\"></a>方法二，从头搭建博客</h4><p>若我们查看github模板为我们创建的博客，会发现github为我们自动创建了一个分支gh-pages作为默认分支，博客的文件都提交在这个特定的分支中。</p>\n<p><img src=\"/images/blog_create/git_branch.png\" alt=\"\"></p>\n<p>那么，若我们从头搭建博客，就得模仿这一步骤。github规定，只有该分支中的页面，才会生成静态网页文件。</p>\n<p>我们新创建一个reponsitory，名为test1</p>\n<p><a href=\"https://github.com/onepieceworld/test1.git\">https://github.com/onepieceworld/test1.git</a></p>\n<p>接下来，我们创建一个全新的gh-pages分支，并将其作为默认分支</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">yumao@ubuntu:~/github/test1$ git checkout --orphan gh-pages</div></pre></td></tr></table></figure>\n<p>为新的空白分支创建默认页面并提交</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\">yumao@ubuntu:~/github/test1$ git checkout --orphan gh-pages</div><div class=\"line\">Switched to a new branch &apos;gh-pages&apos;</div><div class=\"line\">yumao@ubuntu:~/github/test1$ git branch </div><div class=\"line\">yumao@ubuntu:~/github/test1$ echo &quot;Hello World!&quot; &gt; index.html</div><div class=\"line\">yumao@ubuntu:~/github/test1$ git add index.html </div><div class=\"line\">yumao@ubuntu:~/github/test1$ git commit -a -m &quot;commit index pages&quot;</div><div class=\"line\">[gh-pages (root-commit) 0fab7c5] commit index pages</div><div class=\"line\"> 1 file changed, 1 insertion(+)</div><div class=\"line\"> create mode 100644 index.html</div><div class=\"line\">yumao@ubuntu:~/github/test1$ git push origin gh-pages</div></pre></td></tr></table></figure>\n<p>提交成功后，访问<a href=\"https://onepieceworld.github.io/test1/，\">https://onepieceworld.github.io/test1/，</a></p>\n<p>可以看到，github已经自动为我们将静态文件部署。</p>\n<hr>\n<h2 id=\"利用Jekyll搭建个人博客\"><a href=\"#利用Jekyll搭建个人博客\" class=\"headerlink\" title=\"利用Jekyll搭建个人博客\"></a>利用Jekyll搭建个人博客</h2><p><a href=\"http://jekyll.com.cn\">Jekyll官方网站</a><br><a href=\"https://github.com/jekyll/jekyll\">Jekyll github</a></p>\n<h3 id=\"什么是Jekyll？\"><a href=\"#什么是Jekyll？\" class=\"headerlink\" title=\"什么是Jekyll？\"></a>什么是Jekyll？</h3><p>Jekyll is a simple, blog-aware, static site generator perfect for<br>personal, project, or organization sites. Think of it like a file-based<br>CMS, without all the complexity. Jekyll takes your content, renders<br>Markdown and Liquid templates, and spits out a complete, static website<br>ready to be served by Apache, Nginx or another web server. Jekyll is the<br> engine behind <a href=\"https://pages.github.com\">GitHub Pages</a>, which you can use to host sites right from your GitHub repositories.</p>\n<p>一个可以将纯文本转化为静态网站文件的生成器。</p>\n<p>基于Jekyll，我们可以只关注编写纯文本，如markdown，而无需将精力放在HTML本身。</p>\n<h3 id=\"Jekyll的简易用法\"><a href=\"#Jekyll的简易用法\" class=\"headerlink\" title=\"Jekyll的简易用法\"></a>Jekyll的简易用法</h3><blockquote>\n<p><a href=\"http://jekyll.bootcss.com/\">Jekyll官方使用简介</a>，内容很详细<br><a href=\"http://www.ruanyifeng.com/blog/2012/08/blogging_with_jekyll.html\">作者阮一峰关于Jekyll与Github Blog的入门教程</a>，推荐大家阅读</p>\n</blockquote>\n<p>首先，Jekyll依赖Ruby</p>\n<p>安装Ruby环境过程中会遇到GWF，需要用到淘宝提供的RubyGems镜像服务，它与官方服务同步频率为15分钟。</p>\n<p>Ruby环境搭建好后，我们通过以下命令安装Jekyll</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">~ $ gem install jekyll</div></pre></td></tr></table></figure>\n<p>接下来，利用jekyll命令jekyll new my-awesome-site自动创建jekyll项目</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div></pre></td><td class=\"code\"><pre><div class=\"line\">yumao@ubuntu:~/github$ jekyll new jekyll_test</div><div class=\"line\">New jekyll site installed in /home/yumao/github/jekyll_test. </div><div class=\"line\">Running bundle install in /home/yumao/github/jekyll_test... </div><div class=\"line\">Fetching gem metadata from https://rubygems.org/................</div><div class=\"line\">Fetching version metadata from https://rubygems.org/...</div><div class=\"line\">Fetching dependency metadata from https://rubygems.org/..</div><div class=\"line\">Resolving dependencies...</div><div class=\"line\">Using addressable 2.4.0</div><div class=\"line\">Using colorator 1.1.0</div><div class=\"line\">Using ffi 1.9.14</div><div class=\"line\">Using forwardable-extended 2.6.0</div><div class=\"line\">Using sass 3.4.22</div><div class=\"line\">Using rb-fsevent 0.9.7</div><div class=\"line\">Using kramdown 1.12.0</div><div class=\"line\">Using liquid 3.0.6</div><div class=\"line\">Using mercenary 0.3.6</div><div class=\"line\">Using rouge 1.11.1</div><div class=\"line\">Using safe_yaml 1.0.4</div><div class=\"line\">Using minima 2.0.0</div><div class=\"line\">Using bundler 1.13.5</div><div class=\"line\">Using rb-inotify 0.9.7</div><div class=\"line\">Using pathutil 0.14.0</div><div class=\"line\">Using jekyll-sass-converter 1.4.0</div><div class=\"line\">Using listen 3.0.8</div><div class=\"line\">Using jekyll-watch 1.5.0</div><div class=\"line\">Using jekyll 3.3.0</div><div class=\"line\">Using jekyll-feed 0.8.0</div><div class=\"line\">Bundle complete! 3 Gemfile dependencies, 20 gems now installed.</div><div class=\"line\">Use `bundle show [gemname]` to see where a bundled gem is installed.</div><div class=\"line\">yumao@ubuntu:~/github$</div></pre></td></tr></table></figure>\n<p>进入项目目录下，执行Jekyll命令 jekyll serve，启动项目</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\">yumao@ubuntu:~/github$ cd jekyll_test/</div><div class=\"line\">yumao@ubuntu:~/github/jekyll_test$ jekyll serve</div><div class=\"line\">WARN: Unresolved specs during Gem::Specification.reset:</div><div class=\"line\">      rouge (~&gt; 1.7)</div><div class=\"line\">      jekyll-watch (~&gt; 1.1)</div><div class=\"line\">WARN: Clearing out unresolved specs.</div><div class=\"line\">Please report a bug if this causes problems.</div><div class=\"line\">Configuration file: /home/yumao/github/jekyll_test/_config.yml</div><div class=\"line\">Configuration file: /home/yumao/github/jekyll_test/_config.yml</div><div class=\"line\">            Source: /home/yumao/github/jekyll_test</div><div class=\"line\">       Destination: /home/yumao/github/jekyll_test/_site</div><div class=\"line\"> Incremental build: disabled. Enable with --incremental</div><div class=\"line\">      Generating... </div><div class=\"line\">                    done in 0.286 seconds.</div><div class=\"line\"> Auto-regeneration: enabled for &apos;/home/yumao/github/jekyll_test&apos;</div><div class=\"line\">Configuration file: /home/yumao/github/jekyll_test/_config.yml</div><div class=\"line\">    Server address: http://127.0.0.1:4000/</div><div class=\"line\">  Server running... press ctrl-c to stop.</div></pre></td></tr></table></figure>\n<p><img src=\"/images/blog_create/jekyll_default_page.png\" alt=\"\"></p>\n<p>至此，一个简易的jekyll项目就搭建好了，我们将它部署到github中，每次只要新增md文档，提交到github后，其会自动编译jekyll项目，自动解析成静态网页文件。</p>\n<h3 id=\"Jekyll的目录结构\"><a href=\"#Jekyll的目录结构\" class=\"headerlink\" title=\"Jekyll的目录结构\"></a>Jekyll的目录结构</h3><p><img src=\"/images/blog_create/jekyll_files.png\" alt=\"\"></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\">.</div><div class=\"line\">├── _config.yml</div><div class=\"line\">├── _drafts</div><div class=\"line\">|   ├── begin-with-the-crazy-ideas.textile</div><div class=\"line\">|   └── on-simplicity-in-technology.markdown</div><div class=\"line\">├── _includes</div><div class=\"line\">|   ├── footer.html</div><div class=\"line\">|   └── header.html</div><div class=\"line\">├── _layouts</div><div class=\"line\">|   ├── default.html</div><div class=\"line\">|   └── post.html</div><div class=\"line\">├── _posts</div><div class=\"line\">|   ├── 2007-10-29-why-every-programmer-should-play-nethack.textile</div><div class=\"line\">|   └── 2009-04-26-barcamp-boston-4-roundup.textile</div><div class=\"line\">├── _data</div><div class=\"line\">|   └── members.yml</div><div class=\"line\">├── _site</div><div class=\"line\">└── index.html</div></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>文件 / 目录</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>_config.yml</code></td>\n<td>保存<a href=\"http://jekyll.com.cn/docs/configuration/\">配置</a>数据。很多配置选项都会直接从命令行中进行设置，但是如果你把那些配置写在这儿，你就不用非要去记住那些命令了。</td>\n</tr>\n<tr>\n<td><code>_drafts</code></td>\n<td>drafts 是未发布的文章。这些文件的格式中都没有 <code>title.MARKUP</code> 数据。学习如何使用 <a href=\"http://jekyll.com.cn/docs/drafts/\">drafts</a>.</td>\n</tr>\n<tr>\n<td><code>_includes</code></td>\n<td>你可以加载这些包含部分到你的布局或者文章中以方便重用。可以用这个标签          <code>{nclude file.ext</code>          来把文件 <code>_includes/file.ext</code> 包含进来。</td>\n</tr>\n<tr>\n<td><code>_layouts</code></td>\n<td>layouts 是包裹在文章外部的模板。布局可以在 <a href=\"http://jekyll.com.cn/docs/frontmatter/\">YAML 头信息</a>中根据不同文章进行选择。          这将在下一个部分进行介绍。标签          <code>content</code>          可以将content插入页面中。</td>\n</tr>\n<tr>\n<td><code>_posts</code></td>\n<td>这里放的就是你的文章了。文件格式很重要，必须要符合:          <code>YEAR-MONTH-DAY-title.MARKUP</code>。          The <a href=\"http://jekyll.com.cn/docs/permalinks/\">permalinks</a> 可以在文章中自己定制，但是数据和标记语言都是根据文件名来确定的。</td>\n</tr>\n<tr>\n<td><code>_data</code></td>\n<td>Well-formatted site data should be placed here. The jekyll engine will           autoload all yaml files (ends with <code>.yml</code> or <code>.yaml</code>)           in this directory. If there’s a file <code>members.yml</code> under the directory,           then you can access contents of the file through <code>site.data.members</code>.</td>\n</tr>\n<tr>\n<td><code>_site</code></td>\n<td>一旦 Jekyll 完成转换，就会将生成的页面放在这里（默认）。最好将这个目录放进你的 <code>.gitignore</code> 文件中。</td>\n</tr>\n<tr>\n<td><code>index.html</code> and other HTML, Markdown, Textile files</td>\n<td>如果这些文件中包含 <a href=\"http://jekyll.com.cn/docs/frontmatter/\">YAML 头信息</a> 部分，Jekyll 就会自动将它们进行转换。当然，其他的如 <code>.html</code>， <code>.markdown</code>，          <code>.md</code>，或者 <code>.textile</code> 等在你的站点根目录下或者不是以上提到的目录中的文件也会被转换。</td>\n</tr>\n<tr>\n<td>Other Files/Folders</td>\n<td>其他一些未被提及的目录和文件如          <code>css</code> 还有 <code>images</code> 文件夹，          <code>favicon.ico</code> 等文件都将被完全拷贝到生成的 site 中。 这里有一些<a href=\"http://jekyll.com.cn/docs/sites/\">使用 Jekyll 的站点</a>，如果你感兴趣就来看看吧。</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"config-yml配置文件\"><a href=\"#config-yml配置文件\" class=\"headerlink\" title=\"_config.yml配置文件\"></a>_config.yml配置文件</h4><p><a href=\"http://jekyll.com.cn/docs/configuration/\">官方配置文件说明</a></p>\n<h3 id=\"使用Jekyll的开源模板\"><a href=\"#使用Jekyll的开源模板\" class=\"headerlink\" title=\"使用Jekyll的开源模板\"></a>使用Jekyll的开源模板</h3><p>网络上免费的Jekyll主题非常多，推荐2个主题网站</p>\n<p>&gt;</p>\n<blockquote>\n<p><a href=\"http://jekyllthemes.org/\">Jekyll主题网站一</a></p>\n<p><a href=\"http://jekyllthemes.io/\">Jekyll主题网站二</a></p>\n</blockquote>\n<p>这里为大家推荐一个我喜欢的主题来源</p>\n<blockquote>\n<p><a href=\"http://gaohaoyang.github.io\">Gaohaoyang</a></p>\n</blockquote>\n<p>github地址</p>\n<p><a href=\"https://github.com/Gaohaoyang/gaohaoyang.github.io.git\">https://github.com/Gaohaoyang/gaohaoyang.github.io.git</a></p>\n<h3 id=\"Jekyll的优缺点\"><a href=\"#Jekyll的优缺点\" class=\"headerlink\" title=\"Jekyll的优缺点\"></a>Jekyll的优缺点</h3><p>Jekyll是比较流行的博客系统，其主题、插件数量上比较丰富，且上手简单。<br>缺点为文章量多的时候，生成速度慢。</p>\n<hr>\n<h2 id=\"利用Hexo搭建个人博客\"><a href=\"#利用Hexo搭建个人博客\" class=\"headerlink\" title=\"利用Hexo搭建个人博客\"></a>利用Hexo搭建个人博客</h2><h3 id=\"Hexo与Jekyll的区别\"><a href=\"#Hexo与Jekyll的区别\" class=\"headerlink\" title=\"Hexo与Jekyll的区别\"></a>Hexo与Jekyll的区别</h3><p>Hexo是基于Node.js编写的静态博客系统，使用Jekyl我们可以将原生的markdown文档上传到github，由github自动解析成静态html文件。但hexo为本地将markdown文档解析后，将生成的静态html文件直接上传到github中。</p>\n<p>由于hexo基于nodejs，因此其生成html速度较Jekyll快，相对更灵活。主题数量然有Jade/Stylus/Less等各种方言支持。</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>语言</th>\n<th>活跃度</th>\n<th>开箱即用</th>\n<th>主题数量</th>\n<th>主题系统</th>\n<th>生成速度</th>\n<th>博客适应性</th>\n<th>非博客适应性</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Jekyll</td>\n<td>Ruby</td>\n<td>S</td>\n<td>B</td>\n<td>A</td>\n<td>A</td>\n<td>C</td>\n<td>A</td>\n<td>C</td>\n</tr>\n<tr>\n<td>Hexo</td>\n<td>NodeJS</td>\n<td>B</td>\n<td>A</td>\n<td>A</td>\n<td>B</td>\n<td>A</td>\n<td>A</td>\n<td>B</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"Hexo官方文档\"><a href=\"#Hexo官方文档\" class=\"headerlink\" title=\"Hexo官方文档\"></a>Hexo官方文档</h3><p><a href=\"https://hexo.io/zh-cn/docs/\">Hexo官方文档</a></p>\n<h3 id=\"安装Hexo\"><a href=\"#安装Hexo\" class=\"headerlink\" title=\"安装Hexo\"></a>安装Hexo</h3><p>Hexo基于Node.js，因此首先应安装Node.js环境。</p>\n<p>cURL：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ curl https://raw.github.com/creationix/nvm/master/install.sh | sh</div></pre></td></tr></table></figure>\n<p>Wget<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ wget -qO- https://raw.github.com/creationix/nvm/master/install.sh | sh</div></pre></td></tr></table></figure></p>\n<p>安装完成后，重启终端执行下列命令完成安装Node.js<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ nvm install stable</div></pre></td></tr></table></figure></p>\n<p>若环境准备就绪，使用以下命令安装Hexo</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ npm install -g hexo-cli</div></pre></td></tr></table></figure>\n<h3 id=\"使用Hexo建立网站\"><a href=\"#使用Hexo建立网站\" class=\"headerlink\" title=\"使用Hexo建立网站\"></a>使用Hexo建立网站</h3><p>使用以下命令初始化网站</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ hexo init &lt;folder&gt;</div><div class=\"line\">$ cd &lt;folder&gt;</div><div class=\"line\">$ npm install</div></pre></td></tr></table></figure>\n<p>建站后的文件目录如下：</p>\n<p><img src=\"/images/blog_create/hexo_files.png\" alt=\"\"></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\">.</div><div class=\"line\">├── _config.yml</div><div class=\"line\">├── package.json</div><div class=\"line\">├── scaffolds</div><div class=\"line\">├── source</div><div class=\"line\">|   ├── _drafts</div><div class=\"line\">|   └── _posts</div><div class=\"line\">└── themes</div></pre></td></tr></table></figure>\n<ul>\n<li>scaffolds模板文件夹</li>\n</ul>\n<p>建站的模板，hexo依赖于此模板来生成静态文件。</p>\n<ul>\n<li>_config.yml配置文件</li>\n</ul>\n<p><a href=\"https://hexo.io/zh-cn/docs/configuration.html\">hexo官方配置文件说明</a></p>\n<p>以下为hexo的默认配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div></pre></td><td class=\"code\"><pre><div class=\"line\"># Hexo Configuration</div><div class=\"line\">## Docs: https://hexo.io/docs/configuration.html</div><div class=\"line\">## Source: https://github.com/hexojs/hexo/</div><div class=\"line\"></div><div class=\"line\"># Site</div><div class=\"line\"># 网站标题</div><div class=\"line\">title: Hexo </div><div class=\"line\"># 网站副标题</div><div class=\"line\">subtitle: </div><div class=\"line\"># 网站描述</div><div class=\"line\">description: </div><div class=\"line\">author: John Doe</div><div class=\"line\"># 网站使用的语言</div><div class=\"line\">language: </div><div class=\"line\"># 网站时区。Hexo 默认使用您电脑的时区。时区列表。比如说：America/New_York, Japan, 和 UTC 。</div><div class=\"line\">timezone: </div><div class=\"line\"></div><div class=\"line\"># URL</div><div class=\"line\">## If your site is put in a subdirectory, set url as &apos;http://yoursite.com/child&apos; and root as &apos;/child/&apos;</div><div class=\"line\"># 如果您的网站存放在子目录中，例如 http://yoursite.com/blog，则请将您的 url 设为 #http://yoursite.com/blog 并把 root 设为 /blog/。</div><div class=\"line\">url: http://yoursite.com</div><div class=\"line\"># 网站根目录</div><div class=\"line\">root: /</div><div class=\"line\"># 文章的 永久链接 格式 \t:year/:month/:day/:title/</div><div class=\"line\">permalink: :year/:month/:day/:title/</div><div class=\"line\"># 永久链接中各部分的默认值 \t</div><div class=\"line\">permalink_defaults:</div><div class=\"line\"></div><div class=\"line\"># Directory</div><div class=\"line\"># 资源文件夹，这个文件夹用来存放内容。</div><div class=\"line\">source_dir: source</div><div class=\"line\"># 公共文件夹，这个文件夹用于存放生成的站点文件</div><div class=\"line\">public_dir: public</div><div class=\"line\"># 标签文件夹</div><div class=\"line\">tag_dir: tags</div><div class=\"line\"># 归档文件夹</div><div class=\"line\">archive_dir: archives</div><div class=\"line\"># 分类文件夹</div><div class=\"line\">category_dir: categories</div><div class=\"line\"># Include code 文件夹</div><div class=\"line\">code_dir: downloads/code</div><div class=\"line\"># 国际化（i18n）文件夹</div><div class=\"line\">i18n_dir: :lang</div><div class=\"line\"># 跳过指定文件的渲染，您可使用 glob 表达式来匹配路径。 \t</div><div class=\"line\">skip_render:</div><div class=\"line\"></div><div class=\"line\"># Writing</div><div class=\"line\">new_post_name: :title.md # File name of new posts</div><div class=\"line\">default_layout: post</div><div class=\"line\">titlecase: false # Transform title into titlecase</div><div class=\"line\">external_link: true # Open external links in new tab</div><div class=\"line\">filename_case: 0</div><div class=\"line\">render_drafts: false</div><div class=\"line\">post_asset_folder: false</div><div class=\"line\">relative_link: false</div><div class=\"line\">future: true</div><div class=\"line\">highlight:</div><div class=\"line\">  enable: true</div><div class=\"line\">  line_number: true</div><div class=\"line\">  auto_detect: false</div><div class=\"line\">  tab_replace:</div><div class=\"line\"></div><div class=\"line\"># Category &amp; Tag</div><div class=\"line\"># 默认分类 \tuncategorized</div><div class=\"line\">default_category: uncategorized</div><div class=\"line\"># 分类别名 \t</div><div class=\"line\">category_map:</div><div class=\"line\"># 标签别名 \t</div><div class=\"line\">tag_map:</div><div class=\"line\"></div><div class=\"line\"># Date / Time format</div><div class=\"line\">## Hexo uses Moment.js to parse and display date</div><div class=\"line\">## You can customize the date format as defined in</div><div class=\"line\">## http://momentjs.com/docs/#/displaying/format/</div><div class=\"line\"># 日期格式 \tYYYY-MM-DD</div><div class=\"line\">date_format: YYYY-MM-DD</div><div class=\"line\"># 时间格式 \tH:mm:ss</div><div class=\"line\">time_format: HH:mm:ss</div><div class=\"line\"></div><div class=\"line\"># Pagination</div><div class=\"line\">## Set per_page to 0 to disable pagination</div><div class=\"line\"># 每页显示的文章量 (0 = 关闭分页功能) \t10</div><div class=\"line\">per_page: 10</div><div class=\"line\"># 分页目录 \tpage</div><div class=\"line\">pagination_dir: page</div><div class=\"line\"></div><div class=\"line\"># Extensions</div><div class=\"line\">## Plugins: https://hexo.io/plugins/</div><div class=\"line\">## Themes: https://hexo.io/themes/</div><div class=\"line\"># 当前主题名称。值为false时禁用主题</div><div class=\"line\">theme: landscape</div><div class=\"line\"></div><div class=\"line\"># Deployment</div><div class=\"line\">## Docs: https://hexo.io/docs/deployment.html</div><div class=\"line\">deploy:</div><div class=\"line\">  type:</div></pre></td></tr></table></figure>\n<ul>\n<li>source资源文件夹</li>\n</ul>\n<p>用来存放用户资源，其中_post文件夹下的markdown文档，会被hexo自动解析成html，并放置到public文件夹中</p>\n<p>其他以_开头的文件夹会被自动忽略</p>\n<ul>\n<li>themes主题文件夹</li>\n</ul>\n<p>hexo在解析时，会根据主题来生成静态页面。</p>\n<h4 id=\"新建一篇文章\"><a href=\"#新建一篇文章\" class=\"headerlink\" title=\"新建一篇文章\"></a>新建一篇文章</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ hexo new [layout] &lt;title&gt;</div></pre></td></tr></table></figure>\n<p>layout若不指定，默认从_config.yml文件中的default_layout代替</p>\n<h4 id=\"生成静态文件\"><a href=\"#生成静态文件\" class=\"headerlink\" title=\"生成静态文件\"></a>生成静态文件</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ hexo generate</div></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>选项</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>-d</code>, <code>--deploy</code></td>\n<td>文件生成后立即部署网站</td>\n</tr>\n<tr>\n<td><code>-w</code>, <code>--watch</code></td>\n<td>监视文件变动</td>\n</tr>\n</tbody>\n</table>\n<p>使用generate命令后，hexo的文件夹会自动生成静态文件，放置到配置文件中规定的public目录中</p>\n<p><img src=\"/images/blog_create/hexo_files_after_generate_1.png\" alt=\"\"></p>\n<p>public文件夹中的内容如下</p>\n<p><img src=\"/images/blog_create/hexo_files_after_generate_2.png\" alt=\"\"></p>\n<h4 id=\"启动服务器\"><a href=\"#启动服务器\" class=\"headerlink\" title=\"启动服务器\"></a>启动服务器</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ hexo server</div></pre></td></tr></table></figure>\n<h4 id=\"部署网站\"><a href=\"#部署网站\" class=\"headerlink\" title=\"部署网站\"></a>部署网站</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ hexo deploy</div></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>-g</code>, <code>--generate</code></td>\n<td>部署之前预先生成静态文件</td>\n</tr>\n</tbody>\n</table>\n<p>部署后的界面如下<br><img src=\"/images/blog_create/hexo_server_page.png\" alt=\"\"></p>\n<h4 id=\"清除缓存文件\"><a href=\"#清除缓存文件\" class=\"headerlink\" title=\"清除缓存文件\"></a>清除缓存文件</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ hexo clean</div></pre></td></tr></table></figure>\n<p>清除缓存文件 (<code>db.json</code>) 和已生成的静态文件 (<code>public</code>)。</p>\n<p><img src=\"/images/blog_create/hexo_clean.png\" alt=\"\"></p>\n<h4 id=\"其他hexo命令\"><a href=\"#其他hexo命令\" class=\"headerlink\" title=\"其他hexo命令\"></a>其他hexo命令</h4><p><a href=\"https://hexo.io/zh-cn/docs/commands.html\">其他hexo命令</a></p>\n<h3 id=\"hexo部署到github中\"><a href=\"#hexo部署到github中\" class=\"headerlink\" title=\"hexo部署到github中\"></a>hexo部署到github中</h3><p>通过_config.yml文件建立关联，</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">deploy:</div><div class=\"line\">  type: git</div><div class=\"line\">  repository: https://github.com/onepieceworld/hexo_test.git</div><div class=\"line\">  branch: gh-pages</div></pre></td></tr></table></figure>\n<p>执行命令</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">~ $ npm install hexo-deployer-git --save</div><div class=\"line\">~ $ hexo deploy</div></pre></td></tr></table></figure>\n<p>至此，hexo已成功将解析后的html文件上传到github中</p>\n<p><img src=\"/images/blog_create/hexo_github.png\" alt=\"\"></p>"},{"title":"TCP长连接与短连接的区别","date":"2016-07-03T07:00:00.000Z","toc":{"on":true,"max_depth":3,"nowrap":false,"list_number":true},"toc_list_number":true,"_content":"\n## TCP连接\n\n当网络通信时采用TCP协议时，在真正的读写操作之前，server与client之间必须建立一个连接，当读写操作完成后，双方不再需要这个连接时它们可以释放这个连接，连接的建立是需要三次握手的，而释放则需要4次握手，所以说每个连接的建立都是需要资源消耗和时间消耗的。\n\n<!-- more -->\n\n经典的三次握手示意图：\n\n![tcp_connection](/images/networking_protocol/tcp/2016_07_03_01.jpg)\n\n经典的四次握手关闭图：\n![tcp_connection](/images/networking_protocol/tcp/2016_07_03_02.jpg)\n\n---\n\n\n\n\n## TCP短连接\n我们模拟一下TCP短连接的情况，client向server发起连接请求，server接到请求，然后双方建立连接。client向server发送消息，server回应client，然后一次读写就完成了，这时候双方任何一个都可以发起close操作，不过一般都是client先发起close操作。为什么呢，一般的server不会回复完client后立即关闭连接的，当然不排除有特殊的情况。从上面的描述看，短连接一般只会在client/server间传递一次读写操作\n\n短连接的优点是：管理起来比较简单，存在的连接都是有用的连接，不需要额外的控制手段\n\n---\n\n## TCP长连接\n\n接下来我们再模拟一下长连接的情况，client向server发起连接，server接受client连接，双方建立连接。Client与server完成一次读写之后，它们之间的连接并不会主动关闭，后续的读写操作会继续使用这个连接。\n\n首先说一下TCP/IP详解上讲到的TCP保活功能，保活功能主要为服务器应用提供，服务器应用希望知道客户主机是否崩溃，从而可以代表客户使用资源。如果客户已经消失，使得服务器上保留一个半开放的连接，而服务器又在等待来自客户端的数据，则服务器将应远等待客户端的数据，保活功能就是试图在服务器端检测到这种半开放的连接。\n\n如果一个给定的连接在两小时内没有任何的动作，则服务器就向客户发一个探测报文段，客户主机必须处于以下4个状态之一：\n* 客户主机依然正常运行，并从服务器可达。客户的TCP响应正常，而服务器也知道对方是正常的，服务器在两小时后将保活定时器复位。\n* 客户主机已经崩溃，并且关闭或者正在重新启动。在任何一种情况下，客户的TCP都没有响应。服务端将不能收到对探测的响应，并在75秒后超时。服务器总共发送10个这样的探测 ，每个间隔75秒。如果服务器没有收到一个响应，它就认为客户主机已经关闭并终止连接。\n* 客户主机崩溃并已经重新启动。服务器将收到一个对其保活探测的响应，这个响应是一个复位，使得服务器终止这个连接。\n* 客户机正常运行，但是服务器不可达，这种情况与2类似，TCP能发现的就是没有收到探查的响应。\n* \n  从上面可以看出，TCP保活功能主要为探测长连接的存活状况，不过这里存在一个问题，存活功能的探测周期太长，还有就是它只是探测TCP连接的存活，属于比较斯文的做法，遇到恶意的连接时，保活功能就不够使了。\n\n在长连接的应用场景下，client端一般不会主动关闭它们之间的连接，Client与server之间的连接如果一直不关闭的话，会存在一个问题，随着客户端连接越来越多，server早晚有扛不住的时候，这时候server端需要采取一些策略，如关闭一些长时间没有读写事件发生的连接，这样可以避免一些恶意连接导致server端服务受损；如果条件再允许就可以以客户端机器为颗粒度，限制每个客户端的最大长连接数，这样可以完全避免某个蛋疼的客户端连累后端服务。\n\n长连接和短连接的产生在于client和server采取的关闭策略，具体的应用场景采用具体的策略，没有十全十美的选择，只有合适的选择。\n\n---\n\n本文转自http://www.cnblogs.com/beifei/archive/2011/06/26/2090611.html\n\n---\n","source":"_posts/tcp-connection.md","raw":"---\ntitle:  \"TCP长连接与短连接的区别\"\ndate: 2016-07-03 00:00:00\ncategories: TCP\ntags: TCP Connection TCP连接\ntoc:\n  on: true\n  max_depth: 3\n  nowrap: false\n  list_number: true\ntoc_list_number: true\n---\n\n## TCP连接\n\n当网络通信时采用TCP协议时，在真正的读写操作之前，server与client之间必须建立一个连接，当读写操作完成后，双方不再需要这个连接时它们可以释放这个连接，连接的建立是需要三次握手的，而释放则需要4次握手，所以说每个连接的建立都是需要资源消耗和时间消耗的。\n\n<!-- more -->\n\n经典的三次握手示意图：\n\n![tcp_connection](/images/networking_protocol/tcp/2016_07_03_01.jpg)\n\n经典的四次握手关闭图：\n![tcp_connection](/images/networking_protocol/tcp/2016_07_03_02.jpg)\n\n---\n\n\n\n\n## TCP短连接\n我们模拟一下TCP短连接的情况，client向server发起连接请求，server接到请求，然后双方建立连接。client向server发送消息，server回应client，然后一次读写就完成了，这时候双方任何一个都可以发起close操作，不过一般都是client先发起close操作。为什么呢，一般的server不会回复完client后立即关闭连接的，当然不排除有特殊的情况。从上面的描述看，短连接一般只会在client/server间传递一次读写操作\n\n短连接的优点是：管理起来比较简单，存在的连接都是有用的连接，不需要额外的控制手段\n\n---\n\n## TCP长连接\n\n接下来我们再模拟一下长连接的情况，client向server发起连接，server接受client连接，双方建立连接。Client与server完成一次读写之后，它们之间的连接并不会主动关闭，后续的读写操作会继续使用这个连接。\n\n首先说一下TCP/IP详解上讲到的TCP保活功能，保活功能主要为服务器应用提供，服务器应用希望知道客户主机是否崩溃，从而可以代表客户使用资源。如果客户已经消失，使得服务器上保留一个半开放的连接，而服务器又在等待来自客户端的数据，则服务器将应远等待客户端的数据，保活功能就是试图在服务器端检测到这种半开放的连接。\n\n如果一个给定的连接在两小时内没有任何的动作，则服务器就向客户发一个探测报文段，客户主机必须处于以下4个状态之一：\n* 客户主机依然正常运行，并从服务器可达。客户的TCP响应正常，而服务器也知道对方是正常的，服务器在两小时后将保活定时器复位。\n* 客户主机已经崩溃，并且关闭或者正在重新启动。在任何一种情况下，客户的TCP都没有响应。服务端将不能收到对探测的响应，并在75秒后超时。服务器总共发送10个这样的探测 ，每个间隔75秒。如果服务器没有收到一个响应，它就认为客户主机已经关闭并终止连接。\n* 客户主机崩溃并已经重新启动。服务器将收到一个对其保活探测的响应，这个响应是一个复位，使得服务器终止这个连接。\n* 客户机正常运行，但是服务器不可达，这种情况与2类似，TCP能发现的就是没有收到探查的响应。\n* \n  从上面可以看出，TCP保活功能主要为探测长连接的存活状况，不过这里存在一个问题，存活功能的探测周期太长，还有就是它只是探测TCP连接的存活，属于比较斯文的做法，遇到恶意的连接时，保活功能就不够使了。\n\n在长连接的应用场景下，client端一般不会主动关闭它们之间的连接，Client与server之间的连接如果一直不关闭的话，会存在一个问题，随着客户端连接越来越多，server早晚有扛不住的时候，这时候server端需要采取一些策略，如关闭一些长时间没有读写事件发生的连接，这样可以避免一些恶意连接导致server端服务受损；如果条件再允许就可以以客户端机器为颗粒度，限制每个客户端的最大长连接数，这样可以完全避免某个蛋疼的客户端连累后端服务。\n\n长连接和短连接的产生在于client和server采取的关闭策略，具体的应用场景采用具体的策略，没有十全十美的选择，只有合适的选择。\n\n---\n\n本文转自http://www.cnblogs.com/beifei/archive/2011/06/26/2090611.html\n\n---\n","slug":"tcp-connection","published":1,"updated":"2016-07-23T01:14:16.225Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1hliwft0008o65lj2srlrrn","content":"<h2 id=\"TCP连接\"><a href=\"#TCP连接\" class=\"headerlink\" title=\"TCP连接\"></a>TCP连接</h2><p>当网络通信时采用TCP协议时，在真正的读写操作之前，server与client之间必须建立一个连接，当读写操作完成后，双方不再需要这个连接时它们可以释放这个连接，连接的建立是需要三次握手的，而释放则需要4次握手，所以说每个连接的建立都是需要资源消耗和时间消耗的。</p>\n<a id=\"more\"></a>\n<p>经典的三次握手示意图：</p>\n<p><img src=\"/images/networking_protocol/tcp/2016_07_03_01.jpg\" alt=\"tcp_connection\"></p>\n<p>经典的四次握手关闭图：<br><img src=\"/images/networking_protocol/tcp/2016_07_03_02.jpg\" alt=\"tcp_connection\"></p>\n<hr>\n<h2 id=\"TCP短连接\"><a href=\"#TCP短连接\" class=\"headerlink\" title=\"TCP短连接\"></a>TCP短连接</h2><p>我们模拟一下TCP短连接的情况，client向server发起连接请求，server接到请求，然后双方建立连接。client向server发送消息，server回应client，然后一次读写就完成了，这时候双方任何一个都可以发起close操作，不过一般都是client先发起close操作。为什么呢，一般的server不会回复完client后立即关闭连接的，当然不排除有特殊的情况。从上面的描述看，短连接一般只会在client/server间传递一次读写操作</p>\n<p>短连接的优点是：管理起来比较简单，存在的连接都是有用的连接，不需要额外的控制手段</p>\n<hr>\n<h2 id=\"TCP长连接\"><a href=\"#TCP长连接\" class=\"headerlink\" title=\"TCP长连接\"></a>TCP长连接</h2><p>接下来我们再模拟一下长连接的情况，client向server发起连接，server接受client连接，双方建立连接。Client与server完成一次读写之后，它们之间的连接并不会主动关闭，后续的读写操作会继续使用这个连接。</p>\n<p>首先说一下TCP/IP详解上讲到的TCP保活功能，保活功能主要为服务器应用提供，服务器应用希望知道客户主机是否崩溃，从而可以代表客户使用资源。如果客户已经消失，使得服务器上保留一个半开放的连接，而服务器又在等待来自客户端的数据，则服务器将应远等待客户端的数据，保活功能就是试图在服务器端检测到这种半开放的连接。</p>\n<p>如果一个给定的连接在两小时内没有任何的动作，则服务器就向客户发一个探测报文段，客户主机必须处于以下4个状态之一：</p>\n<ul>\n<li>客户主机依然正常运行，并从服务器可达。客户的TCP响应正常，而服务器也知道对方是正常的，服务器在两小时后将保活定时器复位。</li>\n<li>客户主机已经崩溃，并且关闭或者正在重新启动。在任何一种情况下，客户的TCP都没有响应。服务端将不能收到对探测的响应，并在75秒后超时。服务器总共发送10个这样的探测 ，每个间隔75秒。如果服务器没有收到一个响应，它就认为客户主机已经关闭并终止连接。</li>\n<li>客户主机崩溃并已经重新启动。服务器将收到一个对其保活探测的响应，这个响应是一个复位，使得服务器终止这个连接。</li>\n<li>客户机正常运行，但是服务器不可达，这种情况与2类似，TCP能发现的就是没有收到探查的响应。</li>\n<li>从上面可以看出，TCP保活功能主要为探测长连接的存活状况，不过这里存在一个问题，存活功能的探测周期太长，还有就是它只是探测TCP连接的存活，属于比较斯文的做法，遇到恶意的连接时，保活功能就不够使了。</li>\n</ul>\n<p>在长连接的应用场景下，client端一般不会主动关闭它们之间的连接，Client与server之间的连接如果一直不关闭的话，会存在一个问题，随着客户端连接越来越多，server早晚有扛不住的时候，这时候server端需要采取一些策略，如关闭一些长时间没有读写事件发生的连接，这样可以避免一些恶意连接导致server端服务受损；如果条件再允许就可以以客户端机器为颗粒度，限制每个客户端的最大长连接数，这样可以完全避免某个蛋疼的客户端连累后端服务。</p>\n<p>长连接和短连接的产生在于client和server采取的关闭策略，具体的应用场景采用具体的策略，没有十全十美的选择，只有合适的选择。</p>\n<hr>\n<p>本文转自<a href=\"http://www.cnblogs.com/beifei/archive/2011/06/26/2090611.html\" target=\"_blank\" rel=\"external\">http://www.cnblogs.com/beifei/archive/2011/06/26/2090611.html</a></p>\n<hr>\n","excerpt":"<h2 id=\"TCP连接\"><a href=\"#TCP连接\" class=\"headerlink\" title=\"TCP连接\"></a>TCP连接</h2><p>当网络通信时采用TCP协议时，在真正的读写操作之前，server与client之间必须建立一个连接，当读写操作完成后，双方不再需要这个连接时它们可以释放这个连接，连接的建立是需要三次握手的，而释放则需要4次握手，所以说每个连接的建立都是需要资源消耗和时间消耗的。</p>","more":"<p>经典的三次握手示意图：</p>\n<p><img src=\"/images/networking_protocol/tcp/2016_07_03_01.jpg\" alt=\"tcp_connection\"></p>\n<p>经典的四次握手关闭图：<br><img src=\"/images/networking_protocol/tcp/2016_07_03_02.jpg\" alt=\"tcp_connection\"></p>\n<hr>\n<h2 id=\"TCP短连接\"><a href=\"#TCP短连接\" class=\"headerlink\" title=\"TCP短连接\"></a>TCP短连接</h2><p>我们模拟一下TCP短连接的情况，client向server发起连接请求，server接到请求，然后双方建立连接。client向server发送消息，server回应client，然后一次读写就完成了，这时候双方任何一个都可以发起close操作，不过一般都是client先发起close操作。为什么呢，一般的server不会回复完client后立即关闭连接的，当然不排除有特殊的情况。从上面的描述看，短连接一般只会在client/server间传递一次读写操作</p>\n<p>短连接的优点是：管理起来比较简单，存在的连接都是有用的连接，不需要额外的控制手段</p>\n<hr>\n<h2 id=\"TCP长连接\"><a href=\"#TCP长连接\" class=\"headerlink\" title=\"TCP长连接\"></a>TCP长连接</h2><p>接下来我们再模拟一下长连接的情况，client向server发起连接，server接受client连接，双方建立连接。Client与server完成一次读写之后，它们之间的连接并不会主动关闭，后续的读写操作会继续使用这个连接。</p>\n<p>首先说一下TCP/IP详解上讲到的TCP保活功能，保活功能主要为服务器应用提供，服务器应用希望知道客户主机是否崩溃，从而可以代表客户使用资源。如果客户已经消失，使得服务器上保留一个半开放的连接，而服务器又在等待来自客户端的数据，则服务器将应远等待客户端的数据，保活功能就是试图在服务器端检测到这种半开放的连接。</p>\n<p>如果一个给定的连接在两小时内没有任何的动作，则服务器就向客户发一个探测报文段，客户主机必须处于以下4个状态之一：</p>\n<ul>\n<li>客户主机依然正常运行，并从服务器可达。客户的TCP响应正常，而服务器也知道对方是正常的，服务器在两小时后将保活定时器复位。</li>\n<li>客户主机已经崩溃，并且关闭或者正在重新启动。在任何一种情况下，客户的TCP都没有响应。服务端将不能收到对探测的响应，并在75秒后超时。服务器总共发送10个这样的探测 ，每个间隔75秒。如果服务器没有收到一个响应，它就认为客户主机已经关闭并终止连接。</li>\n<li>客户主机崩溃并已经重新启动。服务器将收到一个对其保活探测的响应，这个响应是一个复位，使得服务器终止这个连接。</li>\n<li>客户机正常运行，但是服务器不可达，这种情况与2类似，TCP能发现的就是没有收到探查的响应。</li>\n<li>从上面可以看出，TCP保活功能主要为探测长连接的存活状况，不过这里存在一个问题，存活功能的探测周期太长，还有就是它只是探测TCP连接的存活，属于比较斯文的做法，遇到恶意的连接时，保活功能就不够使了。</li>\n</ul>\n<p>在长连接的应用场景下，client端一般不会主动关闭它们之间的连接，Client与server之间的连接如果一直不关闭的话，会存在一个问题，随着客户端连接越来越多，server早晚有扛不住的时候，这时候server端需要采取一些策略，如关闭一些长时间没有读写事件发生的连接，这样可以避免一些恶意连接导致server端服务受损；如果条件再允许就可以以客户端机器为颗粒度，限制每个客户端的最大长连接数，这样可以完全避免某个蛋疼的客户端连累后端服务。</p>\n<p>长连接和短连接的产生在于client和server采取的关闭策略，具体的应用场景采用具体的策略，没有十全十美的选择，只有合适的选择。</p>\n<hr>\n<p>本文转自<a href=\"http://www.cnblogs.com/beifei/archive/2011/06/26/2090611.html\">http://www.cnblogs.com/beifei/archive/2011/06/26/2090611.html</a></p>\n<hr>"},{"title":"Zookeeper学习笔记一之Paxos算法","date":"2016-07-10T07:00:00.000Z","toc":{"on":true,"max_depth":3,"nowrap":false,"list_number":true},"toc_list_number":true,"_content":"\n## 背景\n\n1990年提出的一种基于消息传递且具有高度容错性的一致性算法。\n<!-- more -->\n\n\n\n## 算法描述\n\n假设有一组可以提出提案的进程集合，对于一个一致性算法来说需保证：\n\n* 提案只有一个会被选定\n* 若没有提案提出，则没有被选定的提案\n* 提案若被选定，进程可以获取提案信息\n\n\n\n分布式系统的【三态】：成功、失败、超时。\n","source":"_posts/zookeeper-01.md","raw":"---\ntitle:  \"Zookeeper学习笔记一之Paxos算法\"\ndate: 2016-07-10 00:00:00\ncategories: Zookeeper\ntags: Zookeeper Paxos\ntoc:\n  on: true\n  max_depth: 3\n  nowrap: false\n  list_number: true\ntoc_list_number: true\n---\n\n## 背景\n\n1990年提出的一种基于消息传递且具有高度容错性的一致性算法。\n<!-- more -->\n\n\n\n## 算法描述\n\n假设有一组可以提出提案的进程集合，对于一个一致性算法来说需保证：\n\n* 提案只有一个会被选定\n* 若没有提案提出，则没有被选定的提案\n* 提案若被选定，进程可以获取提案信息\n\n\n\n分布式系统的【三态】：成功、失败、超时。\n","slug":"zookeeper-01","published":1,"updated":"2016-07-23T01:14:12.865Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1hliwg1000ao65l8ke7ddin","content":"<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p>1990年提出的一种基于消息传递且具有高度容错性的一致性算法。<br><a id=\"more\"></a></p>\n<h2 id=\"算法描述\"><a href=\"#算法描述\" class=\"headerlink\" title=\"算法描述\"></a>算法描述</h2><p>假设有一组可以提出提案的进程集合，对于一个一致性算法来说需保证：</p>\n<ul>\n<li>提案只有一个会被选定</li>\n<li>若没有提案提出，则没有被选定的提案</li>\n<li>提案若被选定，进程可以获取提案信息</li>\n</ul>\n<p>分布式系统的【三态】：成功、失败、超时。</p>\n","excerpt":"<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p>1990年提出的一种基于消息传递且具有高度容错性的一致性算法。<br>","more":"</p>\n<h2 id=\"算法描述\"><a href=\"#算法描述\" class=\"headerlink\" title=\"算法描述\"></a>算法描述</h2><p>假设有一组可以提出提案的进程集合，对于一个一致性算法来说需保证：</p>\n<ul>\n<li>提案只有一个会被选定</li>\n<li>若没有提案提出，则没有被选定的提案</li>\n<li>提案若被选定，进程可以获取提案信息</li>\n</ul>\n<p>分布式系统的【三态】：成功、失败、超时。</p>"},{"title":"Zookeeper学习笔记二","date":"2016-07-18T07:00:00.000Z","toc":{"on":true,"max_depth":3,"nowrap":false,"list_number":true},"toc_list_number":true,"_content":"\n# 基本概念\n\n### 集群角色\n\nZooKeeper没有沿用传统集群模式（主备模式，Master/Slave），而是采用了Leader、Follower、Observer三种角色。\n\n* Leader 选举而来，为client提供读/写服务。\n* Follower 为client提供读服务，可参与选举。\n* Observer 为client提供读服务，不参与Leader选举，不参与写操作的“过半写成功”策略，通常用于提升集群读性能。\n<!-- more -->\n---\n\n\n\n\n### 会话（Session）\n\n---\n\n### 数据节点（Znode）\n\n指数据模型（Znode Tree）中的数据单元\n\n---\n\n### 版本\n\n---\n\n### 事件监听器（Watcher）\n\n---\n\n### ACL（Access Control Lists）\n\nZooKeeper定义了5种权限：\n\n* CREATE 创建子节点的权限\n* READ 获取节点数据和节点列表的权限\n* WRITE 更新节点数据的权限\n* DELETE 删除子节点的权限\n* ADMIN 设置节点ACL的权限\n\n---\n\n## ZAB协议\n\nZooKeeper原子消息广播协议（Zookeeper Atomic Broadcast）。\nZooKeeper并未采用Paxos，而是采用ZAB作为数据一致性的核心算法。\n\n### ZAB协议两种基本模式\n#### 崩溃恢复\n  服务器启动、Leader服务器挂掉时进入该模式，选举产生新Leader服务器。\n  当集群中有过半服务器（包含Leader）与Leader服务器完成状态同步（即数据同步）后，退出该模式。\n\n##### 基本特性\n* ZAB协议需要确保已在Leader提交的事务最终被所有服务器提交。\n* ZAB协议需要确保丢弃那些只在Leader服务器上被提出的事务。\n\n##### Leader选举\n算法思路：确保已被Leader提交的事务Proposal，同时丢弃已被掉过的事务Proposal。\n即保证选举出的Leader服务器拥有集群中ZXID最大的事务Proposal。\n\n##### 数据同步\nLeader服务器通过确认事务日志中所有Proposal是否已被集群中过半的服务器提交，来判断是否完成数据同步。\n\n\n\n\n\n#### 消息广播\n\n##### ZAB协议核心\n定义了可能改变ZooKeeper服务器数据状态的数据请求处理方式：\n![zab_message_broadcast](/images/zookeeper/zab/2016_07_18_zab_message_broadcast.png)\n\n* Leader服务器收到事务请求后，生成事务Proposal，并为其分配事务ID（全局单调递增的ID，ZXID），放入队列中。\n* Follower服务器接收到Proposal后，以事务日志形式写入到本地磁盘，写入成功后Respone Leader服务器“Ack”。\n* 当Leader服务器接收超过半数Follower服务器Ack响应，广播Commit消息发送给所有Follower服务器，Leader自身与收到Commit消息的Follower服务器会完成事务提交。\n\n基于TCP协议（FIFO）保证消息接收与发送的顺序性。\n\n\n\n","source":"_posts/zookeeper-02.md","raw":"---\ntitle:  \"Zookeeper学习笔记二\"\ndate: 2016-07-18 00:00:00\ncategories: Zookeeper\ntags: Zookeeper ZAB\ntoc:\n  on: true\n  max_depth: 3\n  nowrap: false\n  list_number: true\ntoc_list_number: true\n---\n\n# 基本概念\n\n### 集群角色\n\nZooKeeper没有沿用传统集群模式（主备模式，Master/Slave），而是采用了Leader、Follower、Observer三种角色。\n\n* Leader 选举而来，为client提供读/写服务。\n* Follower 为client提供读服务，可参与选举。\n* Observer 为client提供读服务，不参与Leader选举，不参与写操作的“过半写成功”策略，通常用于提升集群读性能。\n<!-- more -->\n---\n\n\n\n\n### 会话（Session）\n\n---\n\n### 数据节点（Znode）\n\n指数据模型（Znode Tree）中的数据单元\n\n---\n\n### 版本\n\n---\n\n### 事件监听器（Watcher）\n\n---\n\n### ACL（Access Control Lists）\n\nZooKeeper定义了5种权限：\n\n* CREATE 创建子节点的权限\n* READ 获取节点数据和节点列表的权限\n* WRITE 更新节点数据的权限\n* DELETE 删除子节点的权限\n* ADMIN 设置节点ACL的权限\n\n---\n\n## ZAB协议\n\nZooKeeper原子消息广播协议（Zookeeper Atomic Broadcast）。\nZooKeeper并未采用Paxos，而是采用ZAB作为数据一致性的核心算法。\n\n### ZAB协议两种基本模式\n#### 崩溃恢复\n  服务器启动、Leader服务器挂掉时进入该模式，选举产生新Leader服务器。\n  当集群中有过半服务器（包含Leader）与Leader服务器完成状态同步（即数据同步）后，退出该模式。\n\n##### 基本特性\n* ZAB协议需要确保已在Leader提交的事务最终被所有服务器提交。\n* ZAB协议需要确保丢弃那些只在Leader服务器上被提出的事务。\n\n##### Leader选举\n算法思路：确保已被Leader提交的事务Proposal，同时丢弃已被掉过的事务Proposal。\n即保证选举出的Leader服务器拥有集群中ZXID最大的事务Proposal。\n\n##### 数据同步\nLeader服务器通过确认事务日志中所有Proposal是否已被集群中过半的服务器提交，来判断是否完成数据同步。\n\n\n\n\n\n#### 消息广播\n\n##### ZAB协议核心\n定义了可能改变ZooKeeper服务器数据状态的数据请求处理方式：\n![zab_message_broadcast](/images/zookeeper/zab/2016_07_18_zab_message_broadcast.png)\n\n* Leader服务器收到事务请求后，生成事务Proposal，并为其分配事务ID（全局单调递增的ID，ZXID），放入队列中。\n* Follower服务器接收到Proposal后，以事务日志形式写入到本地磁盘，写入成功后Respone Leader服务器“Ack”。\n* 当Leader服务器接收超过半数Follower服务器Ack响应，广播Commit消息发送给所有Follower服务器，Leader自身与收到Commit消息的Follower服务器会完成事务提交。\n\n基于TCP协议（FIFO）保证消息接收与发送的顺序性。\n\n\n\n","slug":"zookeeper-02","published":1,"updated":"2016-07-23T01:14:05.512Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1hliwg7000do65l21xrema0","content":"<h1 id=\"基本概念\"><a href=\"#基本概念\" class=\"headerlink\" title=\"基本概念\"></a>基本概念</h1><h3 id=\"集群角色\"><a href=\"#集群角色\" class=\"headerlink\" title=\"集群角色\"></a>集群角色</h3><p>ZooKeeper没有沿用传统集群模式（主备模式，Master/Slave），而是采用了Leader、Follower、Observer三种角色。</p>\n<ul>\n<li>Leader 选举而来，为client提供读/写服务。</li>\n<li>Follower 为client提供读服务，可参与选举。</li>\n<li>Observer 为client提供读服务，不参与Leader选举，不参与写操作的“过半写成功”策略，通常用于提升集群读性能。<a id=\"more\"></a>\n</li>\n</ul>\n<hr>\n<h3 id=\"会话（Session）\"><a href=\"#会话（Session）\" class=\"headerlink\" title=\"会话（Session）\"></a>会话（Session）</h3><hr>\n<h3 id=\"数据节点（Znode）\"><a href=\"#数据节点（Znode）\" class=\"headerlink\" title=\"数据节点（Znode）\"></a>数据节点（Znode）</h3><p>指数据模型（Znode Tree）中的数据单元</p>\n<hr>\n<h3 id=\"版本\"><a href=\"#版本\" class=\"headerlink\" title=\"版本\"></a>版本</h3><hr>\n<h3 id=\"事件监听器（Watcher）\"><a href=\"#事件监听器（Watcher）\" class=\"headerlink\" title=\"事件监听器（Watcher）\"></a>事件监听器（Watcher）</h3><hr>\n<h3 id=\"ACL（Access-Control-Lists）\"><a href=\"#ACL（Access-Control-Lists）\" class=\"headerlink\" title=\"ACL（Access Control Lists）\"></a>ACL（Access Control Lists）</h3><p>ZooKeeper定义了5种权限：</p>\n<ul>\n<li>CREATE 创建子节点的权限</li>\n<li>READ 获取节点数据和节点列表的权限</li>\n<li>WRITE 更新节点数据的权限</li>\n<li>DELETE 删除子节点的权限</li>\n<li>ADMIN 设置节点ACL的权限</li>\n</ul>\n<hr>\n<h2 id=\"ZAB协议\"><a href=\"#ZAB协议\" class=\"headerlink\" title=\"ZAB协议\"></a>ZAB协议</h2><p>ZooKeeper原子消息广播协议（Zookeeper Atomic Broadcast）。<br>ZooKeeper并未采用Paxos，而是采用ZAB作为数据一致性的核心算法。</p>\n<h3 id=\"ZAB协议两种基本模式\"><a href=\"#ZAB协议两种基本模式\" class=\"headerlink\" title=\"ZAB协议两种基本模式\"></a>ZAB协议两种基本模式</h3><h4 id=\"崩溃恢复\"><a href=\"#崩溃恢复\" class=\"headerlink\" title=\"崩溃恢复\"></a>崩溃恢复</h4><p>  服务器启动、Leader服务器挂掉时进入该模式，选举产生新Leader服务器。<br>  当集群中有过半服务器（包含Leader）与Leader服务器完成状态同步（即数据同步）后，退出该模式。</p>\n<h5 id=\"基本特性\"><a href=\"#基本特性\" class=\"headerlink\" title=\"基本特性\"></a>基本特性</h5><ul>\n<li>ZAB协议需要确保已在Leader提交的事务最终被所有服务器提交。</li>\n<li>ZAB协议需要确保丢弃那些只在Leader服务器上被提出的事务。</li>\n</ul>\n<h5 id=\"Leader选举\"><a href=\"#Leader选举\" class=\"headerlink\" title=\"Leader选举\"></a>Leader选举</h5><p>算法思路：确保已被Leader提交的事务Proposal，同时丢弃已被掉过的事务Proposal。<br>即保证选举出的Leader服务器拥有集群中ZXID最大的事务Proposal。</p>\n<h5 id=\"数据同步\"><a href=\"#数据同步\" class=\"headerlink\" title=\"数据同步\"></a>数据同步</h5><p>Leader服务器通过确认事务日志中所有Proposal是否已被集群中过半的服务器提交，来判断是否完成数据同步。</p>\n<h4 id=\"消息广播\"><a href=\"#消息广播\" class=\"headerlink\" title=\"消息广播\"></a>消息广播</h4><h5 id=\"ZAB协议核心\"><a href=\"#ZAB协议核心\" class=\"headerlink\" title=\"ZAB协议核心\"></a>ZAB协议核心</h5><p>定义了可能改变ZooKeeper服务器数据状态的数据请求处理方式：<br><img src=\"/images/zookeeper/zab/2016_07_18_zab_message_broadcast.png\" alt=\"zab_message_broadcast\"></p>\n<ul>\n<li>Leader服务器收到事务请求后，生成事务Proposal，并为其分配事务ID（全局单调递增的ID，ZXID），放入队列中。</li>\n<li>Follower服务器接收到Proposal后，以事务日志形式写入到本地磁盘，写入成功后Respone Leader服务器“Ack”。</li>\n<li>当Leader服务器接收超过半数Follower服务器Ack响应，广播Commit消息发送给所有Follower服务器，Leader自身与收到Commit消息的Follower服务器会完成事务提交。</li>\n</ul>\n<p>基于TCP协议（FIFO）保证消息接收与发送的顺序性。</p>\n","excerpt":"<h1 id=\"基本概念\"><a href=\"#基本概念\" class=\"headerlink\" title=\"基本概念\"></a>基本概念</h1><h3 id=\"集群角色\"><a href=\"#集群角色\" class=\"headerlink\" title=\"集群角色\"></a>集群角色</h3><p>ZooKeeper没有沿用传统集群模式（主备模式，Master/Slave），而是采用了Leader、Follower、Observer三种角色。</p>\n<ul>\n<li>Leader 选举而来，为client提供读/写服务。</li>\n<li>Follower 为client提供读服务，可参与选举。</li>\n<li>Observer 为client提供读服务，不参与Leader选举，不参与写操作的“过半写成功”策略，通常用于提升集群读性能。","more":"</li>\n</ul>\n<hr>\n<h3 id=\"会话（Session）\"><a href=\"#会话（Session）\" class=\"headerlink\" title=\"会话（Session）\"></a>会话（Session）</h3><hr>\n<h3 id=\"数据节点（Znode）\"><a href=\"#数据节点（Znode）\" class=\"headerlink\" title=\"数据节点（Znode）\"></a>数据节点（Znode）</h3><p>指数据模型（Znode Tree）中的数据单元</p>\n<hr>\n<h3 id=\"版本\"><a href=\"#版本\" class=\"headerlink\" title=\"版本\"></a>版本</h3><hr>\n<h3 id=\"事件监听器（Watcher）\"><a href=\"#事件监听器（Watcher）\" class=\"headerlink\" title=\"事件监听器（Watcher）\"></a>事件监听器（Watcher）</h3><hr>\n<h3 id=\"ACL（Access-Control-Lists）\"><a href=\"#ACL（Access-Control-Lists）\" class=\"headerlink\" title=\"ACL（Access Control Lists）\"></a>ACL（Access Control Lists）</h3><p>ZooKeeper定义了5种权限：</p>\n<ul>\n<li>CREATE 创建子节点的权限</li>\n<li>READ 获取节点数据和节点列表的权限</li>\n<li>WRITE 更新节点数据的权限</li>\n<li>DELETE 删除子节点的权限</li>\n<li>ADMIN 设置节点ACL的权限</li>\n</ul>\n<hr>\n<h2 id=\"ZAB协议\"><a href=\"#ZAB协议\" class=\"headerlink\" title=\"ZAB协议\"></a>ZAB协议</h2><p>ZooKeeper原子消息广播协议（Zookeeper Atomic Broadcast）。<br>ZooKeeper并未采用Paxos，而是采用ZAB作为数据一致性的核心算法。</p>\n<h3 id=\"ZAB协议两种基本模式\"><a href=\"#ZAB协议两种基本模式\" class=\"headerlink\" title=\"ZAB协议两种基本模式\"></a>ZAB协议两种基本模式</h3><h4 id=\"崩溃恢复\"><a href=\"#崩溃恢复\" class=\"headerlink\" title=\"崩溃恢复\"></a>崩溃恢复</h4><p>  服务器启动、Leader服务器挂掉时进入该模式，选举产生新Leader服务器。<br>  当集群中有过半服务器（包含Leader）与Leader服务器完成状态同步（即数据同步）后，退出该模式。</p>\n<h5 id=\"基本特性\"><a href=\"#基本特性\" class=\"headerlink\" title=\"基本特性\"></a>基本特性</h5><ul>\n<li>ZAB协议需要确保已在Leader提交的事务最终被所有服务器提交。</li>\n<li>ZAB协议需要确保丢弃那些只在Leader服务器上被提出的事务。</li>\n</ul>\n<h5 id=\"Leader选举\"><a href=\"#Leader选举\" class=\"headerlink\" title=\"Leader选举\"></a>Leader选举</h5><p>算法思路：确保已被Leader提交的事务Proposal，同时丢弃已被掉过的事务Proposal。<br>即保证选举出的Leader服务器拥有集群中ZXID最大的事务Proposal。</p>\n<h5 id=\"数据同步\"><a href=\"#数据同步\" class=\"headerlink\" title=\"数据同步\"></a>数据同步</h5><p>Leader服务器通过确认事务日志中所有Proposal是否已被集群中过半的服务器提交，来判断是否完成数据同步。</p>\n<h4 id=\"消息广播\"><a href=\"#消息广播\" class=\"headerlink\" title=\"消息广播\"></a>消息广播</h4><h5 id=\"ZAB协议核心\"><a href=\"#ZAB协议核心\" class=\"headerlink\" title=\"ZAB协议核心\"></a>ZAB协议核心</h5><p>定义了可能改变ZooKeeper服务器数据状态的数据请求处理方式：<br><img src=\"/images/zookeeper/zab/2016_07_18_zab_message_broadcast.png\" alt=\"zab_message_broadcast\"></p>\n<ul>\n<li>Leader服务器收到事务请求后，生成事务Proposal，并为其分配事务ID（全局单调递增的ID，ZXID），放入队列中。</li>\n<li>Follower服务器接收到Proposal后，以事务日志形式写入到本地磁盘，写入成功后Respone Leader服务器“Ack”。</li>\n<li>当Leader服务器接收超过半数Follower服务器Ack响应，广播Commit消息发送给所有Follower服务器，Leader自身与收到Commit消息的Follower服务器会完成事务提交。</li>\n</ul>\n<p>基于TCP协议（FIFO）保证消息接收与发送的顺序性。</p>"},{"title":"Zookeeper Curator的使用","date":"2016-07-27T07:00:00.000Z","toc":{"on":true,"max_depth":3,"nowrap":false,"list_number":true},"toc_list_number":true,"_content":"\n# 前言\nCurator是ZooKeeper的开源客户端。\n官网：http://curator.apache.org/\nAPI文档：http://curator.apache.org/apidocs/index.html\n<!-- more -->\n\n在工程中需要引入curator依赖\n\n```xml\n\t<dependency>\n\t\t<groupId>org.apache.curator</groupId>\n\t\t<artifactId>curator-framework</artifactId>\n\t\t<version>${curator.version}</version>\n\t</dependency>\n```\n\n\n截止目前文章中使用的版本为3.2.0\n---\n\n## 创建Session\n\n###  使用CuratorFrameworkFactory创建Session\n\n可以通过newClient方法建立ZooKeeper会话，但这里推荐使用其自带的Builder模式，下面是newClient的官方API，Builder模式的case见下文。\n\n- #### newClient\n\n  ```\n  public static CuratorFramework newClient(String connectString,\n                                           RetryPolicy retryPolicy)\n  ```\n\n  Create a new client with default session timeout and default connection timeout\n\n  - Parameters:\n\n    `connectString` - list of servers to connect to\n\n    `retryPolicy` - retry policy to use\n\n  - Returns:\n\n    client\n\n\n- #### newClient\n\n  ```\n  public static CuratorFramework newClient(String connectString,\n                                           int sessionTimeoutMs,\n                                           int connectionTimeoutMs,\n                                           RetryPolicy retryPolicy)\n  ```\n\n  Create a new client\n\n  - Parameters:\n\n    `connectString` - list of servers to connect to\n\n    `sessionTimeoutMs` - session timeout\n\n    `connectionTimeoutMs` - connection timeout\n\n    `retryPolicy` - retry policy to use\n\n  - Returns:\n\n    client\n\n    ​\n\n\nRetryPolicy是Curator提供的创建会话的策略接口。\n\n```\n/**\n * Abstracts the policy to use when retrying connections\n */\npublic interface RetryPolicy\n{\n    /**\n     * Called when an operation has failed for some reason. This method should return\n     * true to make another attempt.\n     *\n     *\n     * @param retryCount the number of times retried so far (0 the first time)\n     * @param elapsedTimeMs the elapsed time in ms since the operation was attempted\n     * @param sleeper use this to sleep - DO NOT call Thread.sleep\n     * @return true/false\n     */\n    public boolean      allowRetry(int retryCount, long elapsedTimeMs, RetrySleeper sleeper);\n}\n```\n\n官方提供的RetryPolicy的继承关系如下，我们也可通过继承RetryPolicy来实现自己的策略类。\n\n![retrypolicy_extends](images/curator/retrypolicy_extends.png)\n\n这里，我们使用ExponentialBackoffRetry这个重试策略来建立ZooKeeperSession。\n\n### case\n\n```java\npackage me.wangran.zookeeper.demo.curator;\n\nimport org.apache.curator.RetryPolicy;\nimport org.apache.curator.framework.CuratorFramework;\nimport org.apache.curator.framework.CuratorFrameworkFactory;\nimport org.apache.curator.retry.ExponentialBackoffRetry;\n\n/**\n * Curator创建SessionDemo\n * @author Wang Ran\n */\npublic class CuratorCreateSessionDemo {\n\n\tpublic static void main(String[] args) {\n\t\tcreateSessionDemo1();\n\t}\n\t\n\t/**\n\t * 使用CuratorFrameworkFactory创建Session\n\t */\n\tpublic static void createSessionDemo1() {\n\t\tString connectString = \"192.168.128.75:2181\";\n\t\tint baseSleepTimeMs = 1000; // 初始sleep时间\n\t\tint maxRetries = 100; // 最大重试次数\n\t\tint maxSleepMs = 25000; // 最大sleep时间\n\t\t// ExponentialBackoffRetry : Retry policy that retries a set number of \n\t\t// times with increasing sleep time between retries\n\t\tRetryPolicy retryPolicy = new ExponentialBackoffRetry(baseSleepTimeMs, maxRetries, maxSleepMs);\n\t\tint sessionTimeoutMs = 10000;\n\t\tint connectionTimeoutMs = 10000;\n\t\tCuratorFramework cff = CuratorFrameworkFactory.builder()\n\t\t\t\t.connectString(connectString)\n\t\t\t\t.retryPolicy(retryPolicy)\n\t\t\t\t.sessionTimeoutMs(sessionTimeoutMs)\n\t\t\t\t.connectionTimeoutMs(connectionTimeoutMs)\n\t\t\t\t.build();\n\t\tcff.start();\n\t\ttry {\n\t\t\tThread.sleep(1000);\n\t\t} catch (InterruptedException e) {\n\t\t\te.printStackTrace();\n\t\t}\n\t\tSystem.out.println(\"ZooKeeper current state is \" + cff.getState());\n\t}\n}\n```\n\n当我运行该代码后，控制台报错如下：\n\n```\nException in thread \"main\" java.lang.NoSuchMethodError: org.apache.zookeeper.server.quorum.flexible.QuorumMaj.<init>(Ljava/util/Map;)V\n\tat org.apache.curator.framework.imps.EnsembleTracker.<init>(EnsembleTracker.java:57)\n\tat org.apache.curator.framework.imps.CuratorFrameworkImpl.<init>(CuratorFrameworkImpl.java:158)\n\tat org.apache.curator.framework.CuratorFrameworkFactory$Builder.build(CuratorFrameworkFactory.java:156)\n\tat me.wangran.zookeeper.demo.curator.CuratorCreateSessionDemo.createSessionDemo1(CuratorCreateSessionDemo.java:36)\n\tat me.wangran.zookeeper.demo.curator.CuratorCreateSessionDemo.main(CuratorCreateSessionDemo.java:15)\n```\n\n报错的原因如下：\n\n> Curator 2.x.x - compatible with both ZooKeeper 3.4.x and ZooKeeper 3.5.x\n> Curator 3.x.x - compatible only with ZooKeeper 3.5.x and includes support for new features such as dynamic reconfiguration, etc.\n\n在依赖中，我引入的curator与zookeeper版本不兼容导致\n\n>   <properties>\n>   \t<zookeeper.version>3.4.6</zookeeper.version>\n>   \t<curator.version>3.2.0</curator.version>\n>   </properties>\n\n将zookeeper版本改为3.5.2-alpha后ZooKeeper会话创建成功，控制台输出如下：\n\n```\nZooKeeper current state is STARTED\n```\n\n这里特别说明一下，这个zookeeper版本指的是maven依赖的客户端版本，并不是zookeeper服务本身的版本。","source":"_posts/zookeeper_curator.md","raw":"---\ntitle:  \"Zookeeper Curator的使用\"\ndate: 2016-07-27 00:00:00\ncategories: Zookeeper\ntags: Zookeeper Curator\ntoc:\n  on: true\n  max_depth: 3\n  nowrap: false\n  list_number: true\ntoc_list_number: true\n---\n\n# 前言\nCurator是ZooKeeper的开源客户端。\n官网：http://curator.apache.org/\nAPI文档：http://curator.apache.org/apidocs/index.html\n<!-- more -->\n\n在工程中需要引入curator依赖\n\n```xml\n\t<dependency>\n\t\t<groupId>org.apache.curator</groupId>\n\t\t<artifactId>curator-framework</artifactId>\n\t\t<version>${curator.version}</version>\n\t</dependency>\n```\n\n\n截止目前文章中使用的版本为3.2.0\n---\n\n## 创建Session\n\n###  使用CuratorFrameworkFactory创建Session\n\n可以通过newClient方法建立ZooKeeper会话，但这里推荐使用其自带的Builder模式，下面是newClient的官方API，Builder模式的case见下文。\n\n- #### newClient\n\n  ```\n  public static CuratorFramework newClient(String connectString,\n                                           RetryPolicy retryPolicy)\n  ```\n\n  Create a new client with default session timeout and default connection timeout\n\n  - Parameters:\n\n    `connectString` - list of servers to connect to\n\n    `retryPolicy` - retry policy to use\n\n  - Returns:\n\n    client\n\n\n- #### newClient\n\n  ```\n  public static CuratorFramework newClient(String connectString,\n                                           int sessionTimeoutMs,\n                                           int connectionTimeoutMs,\n                                           RetryPolicy retryPolicy)\n  ```\n\n  Create a new client\n\n  - Parameters:\n\n    `connectString` - list of servers to connect to\n\n    `sessionTimeoutMs` - session timeout\n\n    `connectionTimeoutMs` - connection timeout\n\n    `retryPolicy` - retry policy to use\n\n  - Returns:\n\n    client\n\n    ​\n\n\nRetryPolicy是Curator提供的创建会话的策略接口。\n\n```\n/**\n * Abstracts the policy to use when retrying connections\n */\npublic interface RetryPolicy\n{\n    /**\n     * Called when an operation has failed for some reason. This method should return\n     * true to make another attempt.\n     *\n     *\n     * @param retryCount the number of times retried so far (0 the first time)\n     * @param elapsedTimeMs the elapsed time in ms since the operation was attempted\n     * @param sleeper use this to sleep - DO NOT call Thread.sleep\n     * @return true/false\n     */\n    public boolean      allowRetry(int retryCount, long elapsedTimeMs, RetrySleeper sleeper);\n}\n```\n\n官方提供的RetryPolicy的继承关系如下，我们也可通过继承RetryPolicy来实现自己的策略类。\n\n![retrypolicy_extends](images/curator/retrypolicy_extends.png)\n\n这里，我们使用ExponentialBackoffRetry这个重试策略来建立ZooKeeperSession。\n\n### case\n\n```java\npackage me.wangran.zookeeper.demo.curator;\n\nimport org.apache.curator.RetryPolicy;\nimport org.apache.curator.framework.CuratorFramework;\nimport org.apache.curator.framework.CuratorFrameworkFactory;\nimport org.apache.curator.retry.ExponentialBackoffRetry;\n\n/**\n * Curator创建SessionDemo\n * @author Wang Ran\n */\npublic class CuratorCreateSessionDemo {\n\n\tpublic static void main(String[] args) {\n\t\tcreateSessionDemo1();\n\t}\n\t\n\t/**\n\t * 使用CuratorFrameworkFactory创建Session\n\t */\n\tpublic static void createSessionDemo1() {\n\t\tString connectString = \"192.168.128.75:2181\";\n\t\tint baseSleepTimeMs = 1000; // 初始sleep时间\n\t\tint maxRetries = 100; // 最大重试次数\n\t\tint maxSleepMs = 25000; // 最大sleep时间\n\t\t// ExponentialBackoffRetry : Retry policy that retries a set number of \n\t\t// times with increasing sleep time between retries\n\t\tRetryPolicy retryPolicy = new ExponentialBackoffRetry(baseSleepTimeMs, maxRetries, maxSleepMs);\n\t\tint sessionTimeoutMs = 10000;\n\t\tint connectionTimeoutMs = 10000;\n\t\tCuratorFramework cff = CuratorFrameworkFactory.builder()\n\t\t\t\t.connectString(connectString)\n\t\t\t\t.retryPolicy(retryPolicy)\n\t\t\t\t.sessionTimeoutMs(sessionTimeoutMs)\n\t\t\t\t.connectionTimeoutMs(connectionTimeoutMs)\n\t\t\t\t.build();\n\t\tcff.start();\n\t\ttry {\n\t\t\tThread.sleep(1000);\n\t\t} catch (InterruptedException e) {\n\t\t\te.printStackTrace();\n\t\t}\n\t\tSystem.out.println(\"ZooKeeper current state is \" + cff.getState());\n\t}\n}\n```\n\n当我运行该代码后，控制台报错如下：\n\n```\nException in thread \"main\" java.lang.NoSuchMethodError: org.apache.zookeeper.server.quorum.flexible.QuorumMaj.<init>(Ljava/util/Map;)V\n\tat org.apache.curator.framework.imps.EnsembleTracker.<init>(EnsembleTracker.java:57)\n\tat org.apache.curator.framework.imps.CuratorFrameworkImpl.<init>(CuratorFrameworkImpl.java:158)\n\tat org.apache.curator.framework.CuratorFrameworkFactory$Builder.build(CuratorFrameworkFactory.java:156)\n\tat me.wangran.zookeeper.demo.curator.CuratorCreateSessionDemo.createSessionDemo1(CuratorCreateSessionDemo.java:36)\n\tat me.wangran.zookeeper.demo.curator.CuratorCreateSessionDemo.main(CuratorCreateSessionDemo.java:15)\n```\n\n报错的原因如下：\n\n> Curator 2.x.x - compatible with both ZooKeeper 3.4.x and ZooKeeper 3.5.x\n> Curator 3.x.x - compatible only with ZooKeeper 3.5.x and includes support for new features such as dynamic reconfiguration, etc.\n\n在依赖中，我引入的curator与zookeeper版本不兼容导致\n\n>   <properties>\n>   \t<zookeeper.version>3.4.6</zookeeper.version>\n>   \t<curator.version>3.2.0</curator.version>\n>   </properties>\n\n将zookeeper版本改为3.5.2-alpha后ZooKeeper会话创建成功，控制台输出如下：\n\n```\nZooKeeper current state is STARTED\n```\n\n这里特别说明一下，这个zookeeper版本指的是maven依赖的客户端版本，并不是zookeeper服务本身的版本。","slug":"zookeeper_curator","published":1,"updated":"2016-07-29T12:07:59.187Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1hliwge000fo65lbljkxct4","content":"<h1 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h1><p>Curator是ZooKeeper的开源客户端。<br>官网：<a href=\"http://curator.apache.org/\" target=\"_blank\" rel=\"external\">http://curator.apache.org/</a><br>API文档：<a href=\"http://curator.apache.org/apidocs/index.html\" target=\"_blank\" rel=\"external\">http://curator.apache.org/apidocs/index.html</a><br><a id=\"more\"></a></p>\n<p>在工程中需要引入curator依赖</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.curator<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>curator-framework<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;curator.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"截止目前文章中使用的版本为3-2-0\"><a href=\"#截止目前文章中使用的版本为3-2-0\" class=\"headerlink\" title=\"截止目前文章中使用的版本为3.2.0\"></a>截止目前文章中使用的版本为3.2.0</h2><h2 id=\"创建Session\"><a href=\"#创建Session\" class=\"headerlink\" title=\"创建Session\"></a>创建Session</h2><h3 id=\"使用CuratorFrameworkFactory创建Session\"><a href=\"#使用CuratorFrameworkFactory创建Session\" class=\"headerlink\" title=\"使用CuratorFrameworkFactory创建Session\"></a>使用CuratorFrameworkFactory创建Session</h3><p>可以通过newClient方法建立ZooKeeper会话，但这里推荐使用其自带的Builder模式，下面是newClient的官方API，Builder模式的case见下文。</p>\n<ul>\n<li><h4 id=\"newClient\"><a href=\"#newClient\" class=\"headerlink\" title=\"newClient\"></a>newClient</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">public static CuratorFramework newClient(String connectString,</div><div class=\"line\">                                         RetryPolicy retryPolicy)</div></pre></td></tr></table></figure>\n<p>Create a new client with default session timeout and default connection timeout</p>\n<ul>\n<li><p>Parameters:</p>\n<p><code>connectString</code> - list of servers to connect to</p>\n<p><code>retryPolicy</code> - retry policy to use</p>\n</li>\n<li><p>Returns:</p>\n<p>client</p>\n</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li><h4 id=\"newClient-1\"><a href=\"#newClient-1\" class=\"headerlink\" title=\"newClient\"></a>newClient</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">public static CuratorFramework newClient(String connectString,</div><div class=\"line\">                                         int sessionTimeoutMs,</div><div class=\"line\">                                         int connectionTimeoutMs,</div><div class=\"line\">                                         RetryPolicy retryPolicy)</div></pre></td></tr></table></figure>\n<p>Create a new client</p>\n<ul>\n<li><p>Parameters:</p>\n<p><code>connectString</code> - list of servers to connect to</p>\n<p><code>sessionTimeoutMs</code> - session timeout</p>\n<p><code>connectionTimeoutMs</code> - connection timeout</p>\n<p><code>retryPolicy</code> - retry policy to use</p>\n</li>\n<li><p>Returns:</p>\n<p>client</p>\n<p>​</p>\n</li>\n</ul>\n</li>\n</ul>\n<p>RetryPolicy是Curator提供的创建会话的策略接口。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\">/**</div><div class=\"line\"> * Abstracts the policy to use when retrying connections</div><div class=\"line\"> */</div><div class=\"line\">public interface RetryPolicy</div><div class=\"line\">&#123;</div><div class=\"line\">    /**</div><div class=\"line\">     * Called when an operation has failed for some reason. This method should return</div><div class=\"line\">     * true to make another attempt.</div><div class=\"line\">     *</div><div class=\"line\">     *</div><div class=\"line\">     * @param retryCount the number of times retried so far (0 the first time)</div><div class=\"line\">     * @param elapsedTimeMs the elapsed time in ms since the operation was attempted</div><div class=\"line\">     * @param sleeper use this to sleep - DO NOT call Thread.sleep</div><div class=\"line\">     * @return true/false</div><div class=\"line\">     */</div><div class=\"line\">    public boolean      allowRetry(int retryCount, long elapsedTimeMs, RetrySleeper sleeper);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>官方提供的RetryPolicy的继承关系如下，我们也可通过继承RetryPolicy来实现自己的策略类。</p>\n<p><img src=\"images/curator/retrypolicy_extends.png\" alt=\"retrypolicy_extends\"></p>\n<p>这里，我们使用ExponentialBackoffRetry这个重试策略来建立ZooKeeperSession。</p>\n<h3 id=\"case\"><a href=\"#case\" class=\"headerlink\" title=\"case\"></a>case</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> me.wangran.zookeeper.demo.curator;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.curator.RetryPolicy;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.curator.framework.CuratorFramework;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.curator.framework.CuratorFrameworkFactory;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.curator.retry.ExponentialBackoffRetry;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * Curator创建SessionDemo</div><div class=\"line\"> * <span class=\"doctag\">@author</span> Wang Ran</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CuratorCreateSessionDemo</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\tcreateSessionDemo1();</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\">\t * 使用CuratorFrameworkFactory创建Session</div><div class=\"line\">\t */</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">createSessionDemo1</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\tString connectString = <span class=\"string\">\"192.168.128.75:2181\"</span>;</div><div class=\"line\">\t\t<span class=\"keyword\">int</span> baseSleepTimeMs = <span class=\"number\">1000</span>; <span class=\"comment\">// 初始sleep时间</span></div><div class=\"line\">\t\t<span class=\"keyword\">int</span> maxRetries = <span class=\"number\">100</span>; <span class=\"comment\">// 最大重试次数</span></div><div class=\"line\">\t\t<span class=\"keyword\">int</span> maxSleepMs = <span class=\"number\">25000</span>; <span class=\"comment\">// 最大sleep时间</span></div><div class=\"line\">\t\t<span class=\"comment\">// ExponentialBackoffRetry : Retry policy that retries a set number of </span></div><div class=\"line\">\t\t<span class=\"comment\">// times with increasing sleep time between retries</span></div><div class=\"line\">\t\tRetryPolicy retryPolicy = <span class=\"keyword\">new</span> ExponentialBackoffRetry(baseSleepTimeMs, maxRetries, maxSleepMs);</div><div class=\"line\">\t\t<span class=\"keyword\">int</span> sessionTimeoutMs = <span class=\"number\">10000</span>;</div><div class=\"line\">\t\t<span class=\"keyword\">int</span> connectionTimeoutMs = <span class=\"number\">10000</span>;</div><div class=\"line\">\t\tCuratorFramework cff = CuratorFrameworkFactory.builder()</div><div class=\"line\">\t\t\t\t.connectString(connectString)</div><div class=\"line\">\t\t\t\t.retryPolicy(retryPolicy)</div><div class=\"line\">\t\t\t\t.sessionTimeoutMs(sessionTimeoutMs)</div><div class=\"line\">\t\t\t\t.connectionTimeoutMs(connectionTimeoutMs)</div><div class=\"line\">\t\t\t\t.build();</div><div class=\"line\">\t\tcff.start();</div><div class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\tThread.sleep(<span class=\"number\">1000</span>);</div><div class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</div><div class=\"line\">\t\t\te.printStackTrace();</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"ZooKeeper current state is \"</span> + cff.getState());</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>当我运行该代码后，控制台报错如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">Exception in thread &quot;main&quot; java.lang.NoSuchMethodError: org.apache.zookeeper.server.quorum.flexible.QuorumMaj.&lt;init&gt;(Ljava/util/Map;)V</div><div class=\"line\">\tat org.apache.curator.framework.imps.EnsembleTracker.&lt;init&gt;(EnsembleTracker.java:57)</div><div class=\"line\">\tat org.apache.curator.framework.imps.CuratorFrameworkImpl.&lt;init&gt;(CuratorFrameworkImpl.java:158)</div><div class=\"line\">\tat org.apache.curator.framework.CuratorFrameworkFactory$Builder.build(CuratorFrameworkFactory.java:156)</div><div class=\"line\">\tat me.wangran.zookeeper.demo.curator.CuratorCreateSessionDemo.createSessionDemo1(CuratorCreateSessionDemo.java:36)</div><div class=\"line\">\tat me.wangran.zookeeper.demo.curator.CuratorCreateSessionDemo.main(CuratorCreateSessionDemo.java:15)</div></pre></td></tr></table></figure>\n<p>报错的原因如下：</p>\n<blockquote>\n<p>Curator 2.x.x - compatible with both ZooKeeper 3.4.x and ZooKeeper 3.5.x<br>Curator 3.x.x - compatible only with ZooKeeper 3.5.x and includes support for new features such as dynamic reconfiguration, etc.</p>\n</blockquote>\n<p>在依赖中，我引入的curator与zookeeper版本不兼容导致</p>\n<blockquote>\n  <properties><br>      <zookeeper.version>3.4.6</zookeeper.version><br>      <curator.version>3.2.0</curator.version><br>  </properties>\n\n</blockquote>\n<p>将zookeeper版本改为3.5.2-alpha后ZooKeeper会话创建成功，控制台输出如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">ZooKeeper current state is STARTED</div></pre></td></tr></table></figure>\n<p>这里特别说明一下，这个zookeeper版本指的是maven依赖的客户端版本，并不是zookeeper服务本身的版本。</p>\n","excerpt":"<h1 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h1><p>Curator是ZooKeeper的开源客户端。<br>官网：<a href=\"http://curator.apache.org/\">http://curator.apache.org/</a><br>API文档：<a href=\"http://curator.apache.org/apidocs/index.html\">http://curator.apache.org/apidocs/index.html</a><br>","more":"</p>\n<p>在工程中需要引入curator依赖</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.curator<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>curator-framework<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;curator.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"截止目前文章中使用的版本为3-2-0\"><a href=\"#截止目前文章中使用的版本为3-2-0\" class=\"headerlink\" title=\"截止目前文章中使用的版本为3.2.0\"></a>截止目前文章中使用的版本为3.2.0</h2><h2 id=\"创建Session\"><a href=\"#创建Session\" class=\"headerlink\" title=\"创建Session\"></a>创建Session</h2><h3 id=\"使用CuratorFrameworkFactory创建Session\"><a href=\"#使用CuratorFrameworkFactory创建Session\" class=\"headerlink\" title=\"使用CuratorFrameworkFactory创建Session\"></a>使用CuratorFrameworkFactory创建Session</h3><p>可以通过newClient方法建立ZooKeeper会话，但这里推荐使用其自带的Builder模式，下面是newClient的官方API，Builder模式的case见下文。</p>\n<ul>\n<li><h4 id=\"newClient\"><a href=\"#newClient\" class=\"headerlink\" title=\"newClient\"></a>newClient</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">public static CuratorFramework newClient(String connectString,</div><div class=\"line\">                                         RetryPolicy retryPolicy)</div></pre></td></tr></table></figure>\n<p>Create a new client with default session timeout and default connection timeout</p>\n<ul>\n<li><p>Parameters:</p>\n<p><code>connectString</code> - list of servers to connect to</p>\n<p><code>retryPolicy</code> - retry policy to use</p>\n</li>\n<li><p>Returns:</p>\n<p>client</p>\n</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li><h4 id=\"newClient-1\"><a href=\"#newClient-1\" class=\"headerlink\" title=\"newClient\"></a>newClient</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">public static CuratorFramework newClient(String connectString,</div><div class=\"line\">                                         int sessionTimeoutMs,</div><div class=\"line\">                                         int connectionTimeoutMs,</div><div class=\"line\">                                         RetryPolicy retryPolicy)</div></pre></td></tr></table></figure>\n<p>Create a new client</p>\n<ul>\n<li><p>Parameters:</p>\n<p><code>connectString</code> - list of servers to connect to</p>\n<p><code>sessionTimeoutMs</code> - session timeout</p>\n<p><code>connectionTimeoutMs</code> - connection timeout</p>\n<p><code>retryPolicy</code> - retry policy to use</p>\n</li>\n<li><p>Returns:</p>\n<p>client</p>\n<p>​</p>\n</li>\n</ul>\n</li>\n</ul>\n<p>RetryPolicy是Curator提供的创建会话的策略接口。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\">/**</div><div class=\"line\"> * Abstracts the policy to use when retrying connections</div><div class=\"line\"> */</div><div class=\"line\">public interface RetryPolicy</div><div class=\"line\">&#123;</div><div class=\"line\">    /**</div><div class=\"line\">     * Called when an operation has failed for some reason. This method should return</div><div class=\"line\">     * true to make another attempt.</div><div class=\"line\">     *</div><div class=\"line\">     *</div><div class=\"line\">     * @param retryCount the number of times retried so far (0 the first time)</div><div class=\"line\">     * @param elapsedTimeMs the elapsed time in ms since the operation was attempted</div><div class=\"line\">     * @param sleeper use this to sleep - DO NOT call Thread.sleep</div><div class=\"line\">     * @return true/false</div><div class=\"line\">     */</div><div class=\"line\">    public boolean      allowRetry(int retryCount, long elapsedTimeMs, RetrySleeper sleeper);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>官方提供的RetryPolicy的继承关系如下，我们也可通过继承RetryPolicy来实现自己的策略类。</p>\n<p><img src=\"images/curator/retrypolicy_extends.png\" alt=\"retrypolicy_extends\"></p>\n<p>这里，我们使用ExponentialBackoffRetry这个重试策略来建立ZooKeeperSession。</p>\n<h3 id=\"case\"><a href=\"#case\" class=\"headerlink\" title=\"case\"></a>case</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> me.wangran.zookeeper.demo.curator;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.curator.RetryPolicy;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.curator.framework.CuratorFramework;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.curator.framework.CuratorFrameworkFactory;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.curator.retry.ExponentialBackoffRetry;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</div><div class=\"line\"> * Curator创建SessionDemo</div><div class=\"line\"> * <span class=\"doctag\">@author</span> Wang Ran</div><div class=\"line\"> */</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CuratorCreateSessionDemo</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\tcreateSessionDemo1();</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">/**</div><div class=\"line\">\t * 使用CuratorFrameworkFactory创建Session</div><div class=\"line\">\t */</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">createSessionDemo1</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\tString connectString = <span class=\"string\">\"192.168.128.75:2181\"</span>;</div><div class=\"line\">\t\t<span class=\"keyword\">int</span> baseSleepTimeMs = <span class=\"number\">1000</span>; <span class=\"comment\">// 初始sleep时间</span></div><div class=\"line\">\t\t<span class=\"keyword\">int</span> maxRetries = <span class=\"number\">100</span>; <span class=\"comment\">// 最大重试次数</span></div><div class=\"line\">\t\t<span class=\"keyword\">int</span> maxSleepMs = <span class=\"number\">25000</span>; <span class=\"comment\">// 最大sleep时间</span></div><div class=\"line\">\t\t<span class=\"comment\">// ExponentialBackoffRetry : Retry policy that retries a set number of </span></div><div class=\"line\">\t\t<span class=\"comment\">// times with increasing sleep time between retries</span></div><div class=\"line\">\t\tRetryPolicy retryPolicy = <span class=\"keyword\">new</span> ExponentialBackoffRetry(baseSleepTimeMs, maxRetries, maxSleepMs);</div><div class=\"line\">\t\t<span class=\"keyword\">int</span> sessionTimeoutMs = <span class=\"number\">10000</span>;</div><div class=\"line\">\t\t<span class=\"keyword\">int</span> connectionTimeoutMs = <span class=\"number\">10000</span>;</div><div class=\"line\">\t\tCuratorFramework cff = CuratorFrameworkFactory.builder()</div><div class=\"line\">\t\t\t\t.connectString(connectString)</div><div class=\"line\">\t\t\t\t.retryPolicy(retryPolicy)</div><div class=\"line\">\t\t\t\t.sessionTimeoutMs(sessionTimeoutMs)</div><div class=\"line\">\t\t\t\t.connectionTimeoutMs(connectionTimeoutMs)</div><div class=\"line\">\t\t\t\t.build();</div><div class=\"line\">\t\tcff.start();</div><div class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\tThread.sleep(<span class=\"number\">1000</span>);</div><div class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</div><div class=\"line\">\t\t\te.printStackTrace();</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"ZooKeeper current state is \"</span> + cff.getState());</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>当我运行该代码后，控制台报错如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">Exception in thread &quot;main&quot; java.lang.NoSuchMethodError: org.apache.zookeeper.server.quorum.flexible.QuorumMaj.&lt;init&gt;(Ljava/util/Map;)V</div><div class=\"line\">\tat org.apache.curator.framework.imps.EnsembleTracker.&lt;init&gt;(EnsembleTracker.java:57)</div><div class=\"line\">\tat org.apache.curator.framework.imps.CuratorFrameworkImpl.&lt;init&gt;(CuratorFrameworkImpl.java:158)</div><div class=\"line\">\tat org.apache.curator.framework.CuratorFrameworkFactory$Builder.build(CuratorFrameworkFactory.java:156)</div><div class=\"line\">\tat me.wangran.zookeeper.demo.curator.CuratorCreateSessionDemo.createSessionDemo1(CuratorCreateSessionDemo.java:36)</div><div class=\"line\">\tat me.wangran.zookeeper.demo.curator.CuratorCreateSessionDemo.main(CuratorCreateSessionDemo.java:15)</div></pre></td></tr></table></figure>\n<p>报错的原因如下：</p>\n<blockquote>\n<p>Curator 2.x.x - compatible with both ZooKeeper 3.4.x and ZooKeeper 3.5.x<br>Curator 3.x.x - compatible only with ZooKeeper 3.5.x and includes support for new features such as dynamic reconfiguration, etc.</p>\n</blockquote>\n<p>在依赖中，我引入的curator与zookeeper版本不兼容导致</p>\n<blockquote>\n  <properties><br>      <zookeeper.version>3.4.6</zookeeper.version><br>      <curator.version>3.2.0</curator.version><br>  </properties>\n\n</blockquote>\n<p>将zookeeper版本改为3.5.2-alpha后ZooKeeper会话创建成功，控制台输出如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">ZooKeeper current state is STARTED</div></pre></td></tr></table></figure>\n<p>这里特别说明一下，这个zookeeper版本指的是maven依赖的客户端版本，并不是zookeeper服务本身的版本。</p>"},{"title":"Zookeeper的安装部署与客户端使用","date":"2016-07-23T07:00:00.000Z","toc":{"on":true,"max_depth":3,"nowrap":false,"list_number":true},"toc_list_number":true,"_content":"\nzookeeper官方网站: http://zookeeper.apache.org/\n\n## Zookeeper的安装与部署\nZookeeper通过Java编写，因此运行前需要配置好JRE\n\n### 下载\nzookeeper下载地址为http://mirrors.cnnic.cn/apache/zookeeper/\n<!-- more -->\n\n### 安装\nZookeeper官方下载的文件为.tar.gz格式，我们只需解压即可完成安装\n\n```linux\ntar -xzvf zookeeper-3.4.6.tar.gz\n```\n\n### 配置\n\n#### 创建zoo.cfg文件\n我们进入到解压后的Zookeeper目录下，找到/conf/zoo_sample.cfg文件，重命名为zoo.cfg\n\n```\n# The number of milliseconds of each tick\n# 基本事件单元，以毫秒为单位。它用来指示心跳，最小的 session 过期时间为两倍的 tickTime.\ntickTime=2000\n# The number of ticks that the initial \n# synchronization phase can take\ninitLimit=10\n# The number of ticks that can pass between \n# sending a request and getting an acknowledgement\nsyncLimit=5\n# the directory where the snapshot is stored.\n# do not use /tmp for storage, /tmp here is just \n# example sakes.\n# 存储内存中数据库快照的位置，如果不设置参数，更新事务日志将被存储到默认位置\ndataDir=/home/yumao/zookeeper/data\ndataLogDir=/home/yumao/zookeeper/log\n# the port at which the clients will connect\n# 监听客户端连接的端口\nclientPort=2181\n# the maximum number of client connections.\n# increase this if you need to handle more clients\n#maxClientCnxns=60\n#\n# Be sure to read the maintenance section of the \n# administrator guide before turning on autopurge.\n#\n# http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance\n#\n# The number of snapshots to retain in dataDir\n#autopurge.snapRetainCount=3\n# 格式为server.id=host:port:port, 其中id为在dataDir目录下创建的myid文件中的数字, 每个机器的数字必须保证唯一, id的范围是1~255\n# 以下配置为单机配置\nserver.1=127.0.0.1:2888:3888\n\n# Set to \"0\" to disable auto purge feature\n#autopurge.purgeInterval=1\n```\n\n#### 创建myid文件\n由于在zoo.cfg配置中指定了dataDir位置，进入dataDir=/home/yumao/zookeeper/data目录下，创建文件myid，内容为1\n\n#### 启动服务\n\n```\nyumao@ubuntu:/opt/zookeeper-3.4.6/bin$ sudo ./zkServer.sh start\nJMX enabled by default\nUsing config: /opt/zookeeper-3.4.6/bin/../conf/zoo.cfg\nStarting zookeeper ... STARTED\n\n```\n\n#### 停止服务\n```\nyumao@ubuntu:/opt/zookeeper-3.4.6/bin$ sudo ./zkServer.sh stop\nJMX enabled by default\nUsing config: /opt/zookeeper-3.4.6/bin/../conf/zoo.cfg\nStopping zookeeper ... STOPPED\nyumao@ubuntu:/opt/zookeeper-3.4.6/bin$ \n```\n\n#### 设置环境变量\n\n在/etc/profile文件中添加\n\n```\n#Set ZooKeeper Enviroment\nexport ZOOKEEPER_HOME=/opt/zookeeper-3.4.6\nexport PATH=$PATH:$ZOOKEEPER_HOME/bin:$ZOOKEEPER_HOME/conf\n```\n\n---\n\n\n\n## Zookeeper客户端的使用\n\n### 客户端启动\n\n```\nsh zkCli.sh \n```\n\n注：在执行该脚本的时候，系统报了个错\n\n> zkCli.sh: 81: /opt/zookeeper-3.4.6/bin/zkEnv.sh: Syntax error: \"(\" unexpected (expecting \"fi\")\n\n一般出现该问题是因为没有配置Zookeeper的环境变量，但还有一个问题是ubuntu本身的配置问题导致，执行以下命令后解决。\n\n```\nyumao@ubuntu:/bin$ ls -l /bin/sh\nlrwxrwxrwx 1 root root 4 May 17 10:34 /bin/sh -> dash\nyumao@ubuntu:/bin$ sudo ln -sf bash /bin/sh\nyumao@ubuntu:/bin$ ls -l /bin/sh\nlrwxrwxrwx 1 root root 4 Jul 26 03:23 /bin/sh -> bash\n```\n\n若客户端脚本成功启动，则系统控制台输出如下\n\n```\nyumao@ubuntu:/opt/zookeeper-3.4.6/bin$ sudo sh ./zkServer.sh start\nJMX enabled by default\nUsing config: /opt/zookeeper-3.4.6/bin/../conf/zoo.cfg\nStarting zookeeper ... STARTED\nyumao@ubuntu:/opt/zookeeper-3.4.6/bin$ sudo sh zkCli.sh \nConnecting to localhost:2181\n2016-07-26 03:29:22,781 [myid:] - INFO  [main:Environment@100] - Client environment:zookeeper.version=3.4.6-1569965, built on 02/20/2014 09:09 GMT\n2016-07-26 03:29:22,789 [myid:] - INFO  [main:Environment@100] - Client environment:host.name=ubuntu\n2016-07-26 03:29:22,790 [myid:] - INFO  [main:Environment@100] - Client environment:java.version=1.7.0_51\n2016-07-26 03:29:22,791 [myid:] - INFO  [main:Environment@100] - Client environment:java.vendor=Oracle Corporation\n2016-07-26 03:29:22,791 [myid:] - INFO  [main:Environment@100] - Client environment:java.home=/usr/jdk1.7.0_51/jre\n2016-07-26 03:29:22,791 [myid:] - INFO  [main:Environment@100] - Client environment:java.class.path=/opt/zookeeper-3.4.6/bin/../build/classes:/opt/zookeeper-3.4.6/bin/../build/lib/*.jar:/opt/zookeeper-3.4.6/bin/../lib/slf4j-log4j12-1.6.1.jar:/opt/zookeeper-3.4.6/bin/../lib/slf4j-api-1.6.1.jar:/opt/zookeeper-3.4.6/bin/../lib/netty-3.7.0.Final.jar:/opt/zookeeper-3.4.6/bin/../lib/log4j-1.2.16.jar:/opt/zookeeper-3.4.6/bin/../lib/jline-0.9.94.jar:/opt/zookeeper-3.4.6/bin/../zookeeper-3.4.6.jar:/opt/zookeeper-3.4.6/bin/../src/java/lib/*.jar:/opt/zookeeper-3.4.6/bin/../conf:$CLASSPATH:$JAVA_HOME/lib:$JAVA_HOME/jre/lib\n2016-07-26 03:29:22,791 [myid:] - INFO  [main:Environment@100] - Client environment:java.library.path=/usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib\n2016-07-26 03:29:22,792 [myid:] - INFO  [main:Environment@100] - Client environment:java.io.tmpdir=/tmp\n2016-07-26 03:29:22,792 [myid:] - INFO  [main:Environment@100] - Client environment:java.compiler=<NA>\n2016-07-26 03:29:22,792 [myid:] - INFO  [main:Environment@100] - Client environment:os.name=Linux\n2016-07-26 03:29:22,792 [myid:] - INFO  [main:Environment@100] - Client environment:os.arch=amd64\n2016-07-26 03:29:22,793 [myid:] - INFO  [main:Environment@100] - Client environment:os.version=4.4.0-31-generic\n2016-07-26 03:29:22,793 [myid:] - INFO  [main:Environment@100] - Client environment:user.name=root\n2016-07-26 03:29:22,793 [myid:] - INFO  [main:Environment@100] - Client environment:user.home=/root\n2016-07-26 03:29:22,793 [myid:] - INFO  [main:Environment@100] - Client environment:user.dir=/opt/zookeeper-3.4.6/bin\n2016-07-26 03:29:22,794 [myid:] - INFO  [main:ZooKeeper@438] - Initiating client connection, connectString=localhost:2181 sessionTimeout=30000 watcher=org.apache.zookeeper.ZooKeeperMain$MyWatcher@4b4cab63\nWelcome to ZooKeeper!\nJLine support is enabled\n2016-07-26 03:29:22,865 [myid:] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@975] - Opening socket connection to server localhost/127.0.0.1:2181. Will not attempt to authenticate using SASL (unknown error)\n2016-07-26 03:29:22,887 [myid:] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@852] - Socket connection established to localhost/127.0.0.1:2181, initiating session\n[zk: localhost:2181(CONNECTING) 0] 2016-07-26 03:29:22,936 [myid:] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1235] - Session establishment complete on server localhost/127.0.0.1:2181, sessionid = 0x15626c0466b0000, negotiated timeout = 30000\n\nWATCHER::\n\nWatchedEvent state:SyncConnected type:None path:null\n\n\n```\n\n若想以指定Zookeeper地址启动，则命令应输入\n\n> sh zkCli.sh -server ip:port\n\n---\n\n\n\n### 通过客户端创建一个Zookeeper节点\n\n> create [-s]  [-e] path data acl\n\n其中 -s或-e分别指节点的特性，-s代表顺序节点，-e则代表临时节点。若不添加-e或-s参数，默认创建持久节点。\n\nacl表示用来进行权限控制。\n\n```\nWatchedEvent state:SyncConnected type:None path:null\ncreate /test_root test_data\nCreated /test_root\n[zk: localhost:2181(CONNECTED) 1] \n```\n\n\n\n### 读取Zookeeper节点\n\n#### ls命令\n\n列出指定节点下的所有子节点。只能看到指定节点下的第一级的所有子节点。\n\n> ls path [watch]\n\n\n\ncase：在根节点下创建了/test_root持久节点后，使用ls命令查看根节点。然后再/test_root节点下创建了新的持久子节点1，再次使用ls命令查看根节点，结果无变化。\n\n```\nWatchedEvent state:SyncConnected type:None path:null\ncreate /test_root test_data\nCreated /test_root\n[zk: localhost:2181(CONNECTED) 1] ls /\n[test_root, dubbo, zookeeper]\n[zk: localhost:2181(CONNECTED) 2] create /test_root/1 test_data_1\nCreated /test_root/1\n[zk: localhost:2181(CONNECTED) 3] ls /\n[test_root, dubbo, zookeeper]\n[zk: localhost:2181(CONNECTED) 4] ls /test_root\n[1]\n[zk: localhost:2181(CONNECTED) 5]\n```\n\n\n\n#### get命令\n\n获取指定节点数据内容和属性信息\n\n> get path [watch]\n\ncase：使用get命令查看根节点test_root\n\n```\n[zk: localhost:2181(CONNECTED) 5] get /test_root\ntest_data\ncZxid = 0xbf\nctime = Tue Jul 26 03:35:51 PDT 2016\nmZxid = 0xbf\nmtime = Tue Jul 26 03:35:51 PDT 2016\npZxid = 0xc0\ncversion = 1\ndataVersion = 0\naclVersion = 0\nephemeralOwner = 0x0\ndataLength = 9\nnumChildren = 1\n[zk: localhost:2181(CONNECTED) 6] \n```\n\n### 更新Zookeeper节点\n#### set命令\n> set path data [version]\n\ncase: 将/test_root节点的值更新为luffy，注意更新后节点version的变化\n\n```\n[zk: localhost:2181(CONNECTED) 3] get /test_root\ntest_data\ncZxid = 0xbf\nctime = Tue Jul 26 03:35:51 PDT 2016\nmZxid = 0xbf\nmtime = Tue Jul 26 03:35:51 PDT 2016\npZxid = 0xc0\ncversion = 1\ndataVersion = 0\naclVersion = 0\nephemeralOwner = 0x0\ndataLength = 9\nnumChildren = 1\n[zk: localhost:2181(CONNECTED) 4] set /test_root luffy\ncZxid = 0xbf\nctime = Tue Jul 26 03:35:51 PDT 2016\nmZxid = 0xc3\nmtime = Tue Jul 26 19:24:32 PDT 2016\npZxid = 0xc0\ncversion = 1\ndataVersion = 1\naclVersion = 0\nephemeralOwner = 0x0\ndataLength = 5\nnumChildren = 1\n[zk: localhost:2181(CONNECTED) 5] \n```\n\n\n### 删除Zookeeper节点\n#### delete 命令\n> delete path [version]\n> 注意，只能删除叶子节点。\n\ncase: 将/test_root下的1节点删除。\n\n```\n[zk: localhost:2181(CONNECTED) 5] ls /test_root\n[1]\n[zk: localhost:2181(CONNECTED) 6] delete /test_root/1\n[zk: localhost:2181(CONNECTED) 7] ls /test_root      \n[]\n[zk: localhost:2181(CONNECTED) 8] \n```\n\n","source":"_posts/zookeeper_deploy_and_client_using.md","raw":"---\ntitle:  \"Zookeeper的安装部署与客户端使用\"\ndate: 2016-07-23 00:00:00\ncategories: Zookeeper\ntags: Zookeeper zkCli.sh zkServer.sh\ntoc:\n  on: true\n  max_depth: 3\n  nowrap: false\n  list_number: true\ntoc_list_number: true\n---\n\nzookeeper官方网站: http://zookeeper.apache.org/\n\n## Zookeeper的安装与部署\nZookeeper通过Java编写，因此运行前需要配置好JRE\n\n### 下载\nzookeeper下载地址为http://mirrors.cnnic.cn/apache/zookeeper/\n<!-- more -->\n\n### 安装\nZookeeper官方下载的文件为.tar.gz格式，我们只需解压即可完成安装\n\n```linux\ntar -xzvf zookeeper-3.4.6.tar.gz\n```\n\n### 配置\n\n#### 创建zoo.cfg文件\n我们进入到解压后的Zookeeper目录下，找到/conf/zoo_sample.cfg文件，重命名为zoo.cfg\n\n```\n# The number of milliseconds of each tick\n# 基本事件单元，以毫秒为单位。它用来指示心跳，最小的 session 过期时间为两倍的 tickTime.\ntickTime=2000\n# The number of ticks that the initial \n# synchronization phase can take\ninitLimit=10\n# The number of ticks that can pass between \n# sending a request and getting an acknowledgement\nsyncLimit=5\n# the directory where the snapshot is stored.\n# do not use /tmp for storage, /tmp here is just \n# example sakes.\n# 存储内存中数据库快照的位置，如果不设置参数，更新事务日志将被存储到默认位置\ndataDir=/home/yumao/zookeeper/data\ndataLogDir=/home/yumao/zookeeper/log\n# the port at which the clients will connect\n# 监听客户端连接的端口\nclientPort=2181\n# the maximum number of client connections.\n# increase this if you need to handle more clients\n#maxClientCnxns=60\n#\n# Be sure to read the maintenance section of the \n# administrator guide before turning on autopurge.\n#\n# http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance\n#\n# The number of snapshots to retain in dataDir\n#autopurge.snapRetainCount=3\n# 格式为server.id=host:port:port, 其中id为在dataDir目录下创建的myid文件中的数字, 每个机器的数字必须保证唯一, id的范围是1~255\n# 以下配置为单机配置\nserver.1=127.0.0.1:2888:3888\n\n# Set to \"0\" to disable auto purge feature\n#autopurge.purgeInterval=1\n```\n\n#### 创建myid文件\n由于在zoo.cfg配置中指定了dataDir位置，进入dataDir=/home/yumao/zookeeper/data目录下，创建文件myid，内容为1\n\n#### 启动服务\n\n```\nyumao@ubuntu:/opt/zookeeper-3.4.6/bin$ sudo ./zkServer.sh start\nJMX enabled by default\nUsing config: /opt/zookeeper-3.4.6/bin/../conf/zoo.cfg\nStarting zookeeper ... STARTED\n\n```\n\n#### 停止服务\n```\nyumao@ubuntu:/opt/zookeeper-3.4.6/bin$ sudo ./zkServer.sh stop\nJMX enabled by default\nUsing config: /opt/zookeeper-3.4.6/bin/../conf/zoo.cfg\nStopping zookeeper ... STOPPED\nyumao@ubuntu:/opt/zookeeper-3.4.6/bin$ \n```\n\n#### 设置环境变量\n\n在/etc/profile文件中添加\n\n```\n#Set ZooKeeper Enviroment\nexport ZOOKEEPER_HOME=/opt/zookeeper-3.4.6\nexport PATH=$PATH:$ZOOKEEPER_HOME/bin:$ZOOKEEPER_HOME/conf\n```\n\n---\n\n\n\n## Zookeeper客户端的使用\n\n### 客户端启动\n\n```\nsh zkCli.sh \n```\n\n注：在执行该脚本的时候，系统报了个错\n\n> zkCli.sh: 81: /opt/zookeeper-3.4.6/bin/zkEnv.sh: Syntax error: \"(\" unexpected (expecting \"fi\")\n\n一般出现该问题是因为没有配置Zookeeper的环境变量，但还有一个问题是ubuntu本身的配置问题导致，执行以下命令后解决。\n\n```\nyumao@ubuntu:/bin$ ls -l /bin/sh\nlrwxrwxrwx 1 root root 4 May 17 10:34 /bin/sh -> dash\nyumao@ubuntu:/bin$ sudo ln -sf bash /bin/sh\nyumao@ubuntu:/bin$ ls -l /bin/sh\nlrwxrwxrwx 1 root root 4 Jul 26 03:23 /bin/sh -> bash\n```\n\n若客户端脚本成功启动，则系统控制台输出如下\n\n```\nyumao@ubuntu:/opt/zookeeper-3.4.6/bin$ sudo sh ./zkServer.sh start\nJMX enabled by default\nUsing config: /opt/zookeeper-3.4.6/bin/../conf/zoo.cfg\nStarting zookeeper ... STARTED\nyumao@ubuntu:/opt/zookeeper-3.4.6/bin$ sudo sh zkCli.sh \nConnecting to localhost:2181\n2016-07-26 03:29:22,781 [myid:] - INFO  [main:Environment@100] - Client environment:zookeeper.version=3.4.6-1569965, built on 02/20/2014 09:09 GMT\n2016-07-26 03:29:22,789 [myid:] - INFO  [main:Environment@100] - Client environment:host.name=ubuntu\n2016-07-26 03:29:22,790 [myid:] - INFO  [main:Environment@100] - Client environment:java.version=1.7.0_51\n2016-07-26 03:29:22,791 [myid:] - INFO  [main:Environment@100] - Client environment:java.vendor=Oracle Corporation\n2016-07-26 03:29:22,791 [myid:] - INFO  [main:Environment@100] - Client environment:java.home=/usr/jdk1.7.0_51/jre\n2016-07-26 03:29:22,791 [myid:] - INFO  [main:Environment@100] - Client environment:java.class.path=/opt/zookeeper-3.4.6/bin/../build/classes:/opt/zookeeper-3.4.6/bin/../build/lib/*.jar:/opt/zookeeper-3.4.6/bin/../lib/slf4j-log4j12-1.6.1.jar:/opt/zookeeper-3.4.6/bin/../lib/slf4j-api-1.6.1.jar:/opt/zookeeper-3.4.6/bin/../lib/netty-3.7.0.Final.jar:/opt/zookeeper-3.4.6/bin/../lib/log4j-1.2.16.jar:/opt/zookeeper-3.4.6/bin/../lib/jline-0.9.94.jar:/opt/zookeeper-3.4.6/bin/../zookeeper-3.4.6.jar:/opt/zookeeper-3.4.6/bin/../src/java/lib/*.jar:/opt/zookeeper-3.4.6/bin/../conf:$CLASSPATH:$JAVA_HOME/lib:$JAVA_HOME/jre/lib\n2016-07-26 03:29:22,791 [myid:] - INFO  [main:Environment@100] - Client environment:java.library.path=/usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib\n2016-07-26 03:29:22,792 [myid:] - INFO  [main:Environment@100] - Client environment:java.io.tmpdir=/tmp\n2016-07-26 03:29:22,792 [myid:] - INFO  [main:Environment@100] - Client environment:java.compiler=<NA>\n2016-07-26 03:29:22,792 [myid:] - INFO  [main:Environment@100] - Client environment:os.name=Linux\n2016-07-26 03:29:22,792 [myid:] - INFO  [main:Environment@100] - Client environment:os.arch=amd64\n2016-07-26 03:29:22,793 [myid:] - INFO  [main:Environment@100] - Client environment:os.version=4.4.0-31-generic\n2016-07-26 03:29:22,793 [myid:] - INFO  [main:Environment@100] - Client environment:user.name=root\n2016-07-26 03:29:22,793 [myid:] - INFO  [main:Environment@100] - Client environment:user.home=/root\n2016-07-26 03:29:22,793 [myid:] - INFO  [main:Environment@100] - Client environment:user.dir=/opt/zookeeper-3.4.6/bin\n2016-07-26 03:29:22,794 [myid:] - INFO  [main:ZooKeeper@438] - Initiating client connection, connectString=localhost:2181 sessionTimeout=30000 watcher=org.apache.zookeeper.ZooKeeperMain$MyWatcher@4b4cab63\nWelcome to ZooKeeper!\nJLine support is enabled\n2016-07-26 03:29:22,865 [myid:] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@975] - Opening socket connection to server localhost/127.0.0.1:2181. Will not attempt to authenticate using SASL (unknown error)\n2016-07-26 03:29:22,887 [myid:] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@852] - Socket connection established to localhost/127.0.0.1:2181, initiating session\n[zk: localhost:2181(CONNECTING) 0] 2016-07-26 03:29:22,936 [myid:] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1235] - Session establishment complete on server localhost/127.0.0.1:2181, sessionid = 0x15626c0466b0000, negotiated timeout = 30000\n\nWATCHER::\n\nWatchedEvent state:SyncConnected type:None path:null\n\n\n```\n\n若想以指定Zookeeper地址启动，则命令应输入\n\n> sh zkCli.sh -server ip:port\n\n---\n\n\n\n### 通过客户端创建一个Zookeeper节点\n\n> create [-s]  [-e] path data acl\n\n其中 -s或-e分别指节点的特性，-s代表顺序节点，-e则代表临时节点。若不添加-e或-s参数，默认创建持久节点。\n\nacl表示用来进行权限控制。\n\n```\nWatchedEvent state:SyncConnected type:None path:null\ncreate /test_root test_data\nCreated /test_root\n[zk: localhost:2181(CONNECTED) 1] \n```\n\n\n\n### 读取Zookeeper节点\n\n#### ls命令\n\n列出指定节点下的所有子节点。只能看到指定节点下的第一级的所有子节点。\n\n> ls path [watch]\n\n\n\ncase：在根节点下创建了/test_root持久节点后，使用ls命令查看根节点。然后再/test_root节点下创建了新的持久子节点1，再次使用ls命令查看根节点，结果无变化。\n\n```\nWatchedEvent state:SyncConnected type:None path:null\ncreate /test_root test_data\nCreated /test_root\n[zk: localhost:2181(CONNECTED) 1] ls /\n[test_root, dubbo, zookeeper]\n[zk: localhost:2181(CONNECTED) 2] create /test_root/1 test_data_1\nCreated /test_root/1\n[zk: localhost:2181(CONNECTED) 3] ls /\n[test_root, dubbo, zookeeper]\n[zk: localhost:2181(CONNECTED) 4] ls /test_root\n[1]\n[zk: localhost:2181(CONNECTED) 5]\n```\n\n\n\n#### get命令\n\n获取指定节点数据内容和属性信息\n\n> get path [watch]\n\ncase：使用get命令查看根节点test_root\n\n```\n[zk: localhost:2181(CONNECTED) 5] get /test_root\ntest_data\ncZxid = 0xbf\nctime = Tue Jul 26 03:35:51 PDT 2016\nmZxid = 0xbf\nmtime = Tue Jul 26 03:35:51 PDT 2016\npZxid = 0xc0\ncversion = 1\ndataVersion = 0\naclVersion = 0\nephemeralOwner = 0x0\ndataLength = 9\nnumChildren = 1\n[zk: localhost:2181(CONNECTED) 6] \n```\n\n### 更新Zookeeper节点\n#### set命令\n> set path data [version]\n\ncase: 将/test_root节点的值更新为luffy，注意更新后节点version的变化\n\n```\n[zk: localhost:2181(CONNECTED) 3] get /test_root\ntest_data\ncZxid = 0xbf\nctime = Tue Jul 26 03:35:51 PDT 2016\nmZxid = 0xbf\nmtime = Tue Jul 26 03:35:51 PDT 2016\npZxid = 0xc0\ncversion = 1\ndataVersion = 0\naclVersion = 0\nephemeralOwner = 0x0\ndataLength = 9\nnumChildren = 1\n[zk: localhost:2181(CONNECTED) 4] set /test_root luffy\ncZxid = 0xbf\nctime = Tue Jul 26 03:35:51 PDT 2016\nmZxid = 0xc3\nmtime = Tue Jul 26 19:24:32 PDT 2016\npZxid = 0xc0\ncversion = 1\ndataVersion = 1\naclVersion = 0\nephemeralOwner = 0x0\ndataLength = 5\nnumChildren = 1\n[zk: localhost:2181(CONNECTED) 5] \n```\n\n\n### 删除Zookeeper节点\n#### delete 命令\n> delete path [version]\n> 注意，只能删除叶子节点。\n\ncase: 将/test_root下的1节点删除。\n\n```\n[zk: localhost:2181(CONNECTED) 5] ls /test_root\n[1]\n[zk: localhost:2181(CONNECTED) 6] delete /test_root/1\n[zk: localhost:2181(CONNECTED) 7] ls /test_root      \n[]\n[zk: localhost:2181(CONNECTED) 8] \n```\n\n","slug":"zookeeper_deploy_and_client_using","published":1,"updated":"2016-07-27T02:42:43.396Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1hliwgh000jo65lsyryba7f","content":"<p>zookeeper官方网站: <a href=\"http://zookeeper.apache.org/\" target=\"_blank\" rel=\"external\">http://zookeeper.apache.org/</a></p>\n<h2 id=\"Zookeeper的安装与部署\"><a href=\"#Zookeeper的安装与部署\" class=\"headerlink\" title=\"Zookeeper的安装与部署\"></a>Zookeeper的安装与部署</h2><p>Zookeeper通过Java编写，因此运行前需要配置好JRE</p>\n<h3 id=\"下载\"><a href=\"#下载\" class=\"headerlink\" title=\"下载\"></a>下载</h3><p>zookeeper下载地址为<a href=\"http://mirrors.cnnic.cn/apache/zookeeper/\" target=\"_blank\" rel=\"external\">http://mirrors.cnnic.cn/apache/zookeeper/</a><br><a id=\"more\"></a></p>\n<h3 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h3><p>Zookeeper官方下载的文件为.tar.gz格式，我们只需解压即可完成安装</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">tar -xzvf zookeeper-3.4.6.tar.gz</div></pre></td></tr></table></figure>\n<h3 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h3><h4 id=\"创建zoo-cfg文件\"><a href=\"#创建zoo-cfg文件\" class=\"headerlink\" title=\"创建zoo.cfg文件\"></a>创建zoo.cfg文件</h4><p>我们进入到解压后的Zookeeper目录下，找到/conf/zoo_sample.cfg文件，重命名为zoo.cfg</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div></pre></td><td class=\"code\"><pre><div class=\"line\"># The number of milliseconds of each tick</div><div class=\"line\"># 基本事件单元，以毫秒为单位。它用来指示心跳，最小的 session 过期时间为两倍的 tickTime.</div><div class=\"line\">tickTime=2000</div><div class=\"line\"># The number of ticks that the initial </div><div class=\"line\"># synchronization phase can take</div><div class=\"line\">initLimit=10</div><div class=\"line\"># The number of ticks that can pass between </div><div class=\"line\"># sending a request and getting an acknowledgement</div><div class=\"line\">syncLimit=5</div><div class=\"line\"># the directory where the snapshot is stored.</div><div class=\"line\"># do not use /tmp for storage, /tmp here is just </div><div class=\"line\"># example sakes.</div><div class=\"line\"># 存储内存中数据库快照的位置，如果不设置参数，更新事务日志将被存储到默认位置</div><div class=\"line\">dataDir=/home/yumao/zookeeper/data</div><div class=\"line\">dataLogDir=/home/yumao/zookeeper/log</div><div class=\"line\"># the port at which the clients will connect</div><div class=\"line\"># 监听客户端连接的端口</div><div class=\"line\">clientPort=2181</div><div class=\"line\"># the maximum number of client connections.</div><div class=\"line\"># increase this if you need to handle more clients</div><div class=\"line\">#maxClientCnxns=60</div><div class=\"line\">#</div><div class=\"line\"># Be sure to read the maintenance section of the </div><div class=\"line\"># administrator guide before turning on autopurge.</div><div class=\"line\">#</div><div class=\"line\"># http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance</div><div class=\"line\">#</div><div class=\"line\"># The number of snapshots to retain in dataDir</div><div class=\"line\">#autopurge.snapRetainCount=3</div><div class=\"line\"># 格式为server.id=host:port:port, 其中id为在dataDir目录下创建的myid文件中的数字, 每个机器的数字必须保证唯一, id的范围是1~255</div><div class=\"line\"># 以下配置为单机配置</div><div class=\"line\">server.1=127.0.0.1:2888:3888</div><div class=\"line\"></div><div class=\"line\"># Set to &quot;0&quot; to disable auto purge feature</div><div class=\"line\">#autopurge.purgeInterval=1</div></pre></td></tr></table></figure>\n<h4 id=\"创建myid文件\"><a href=\"#创建myid文件\" class=\"headerlink\" title=\"创建myid文件\"></a>创建myid文件</h4><p>由于在zoo.cfg配置中指定了dataDir位置，进入dataDir=/home/yumao/zookeeper/data目录下，创建文件myid，内容为1</p>\n<h4 id=\"启动服务\"><a href=\"#启动服务\" class=\"headerlink\" title=\"启动服务\"></a>启动服务</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">yumao@ubuntu:/opt/zookeeper-3.4.6/bin$ sudo ./zkServer.sh start</div><div class=\"line\">JMX enabled by default</div><div class=\"line\">Using config: /opt/zookeeper-3.4.6/bin/../conf/zoo.cfg</div><div class=\"line\">Starting zookeeper ... STARTED</div></pre></td></tr></table></figure>\n<h4 id=\"停止服务\"><a href=\"#停止服务\" class=\"headerlink\" title=\"停止服务\"></a>停止服务</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">yumao@ubuntu:/opt/zookeeper-3.4.6/bin$ sudo ./zkServer.sh stop</div><div class=\"line\">JMX enabled by default</div><div class=\"line\">Using config: /opt/zookeeper-3.4.6/bin/../conf/zoo.cfg</div><div class=\"line\">Stopping zookeeper ... STOPPED</div><div class=\"line\">yumao@ubuntu:/opt/zookeeper-3.4.6/bin$</div></pre></td></tr></table></figure>\n<h4 id=\"设置环境变量\"><a href=\"#设置环境变量\" class=\"headerlink\" title=\"设置环境变量\"></a>设置环境变量</h4><p>在/etc/profile文件中添加</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">#Set ZooKeeper Enviroment</div><div class=\"line\">export ZOOKEEPER_HOME=/opt/zookeeper-3.4.6</div><div class=\"line\">export PATH=$PATH:$ZOOKEEPER_HOME/bin:$ZOOKEEPER_HOME/conf</div></pre></td></tr></table></figure>\n<hr>\n<h2 id=\"Zookeeper客户端的使用\"><a href=\"#Zookeeper客户端的使用\" class=\"headerlink\" title=\"Zookeeper客户端的使用\"></a>Zookeeper客户端的使用</h2><h3 id=\"客户端启动\"><a href=\"#客户端启动\" class=\"headerlink\" title=\"客户端启动\"></a>客户端启动</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">sh zkCli.sh</div></pre></td></tr></table></figure>\n<p>注：在执行该脚本的时候，系统报了个错</p>\n<blockquote>\n<p>zkCli.sh: 81: /opt/zookeeper-3.4.6/bin/zkEnv.sh: Syntax error: “(“ unexpected (expecting “fi”)</p>\n</blockquote>\n<p>一般出现该问题是因为没有配置Zookeeper的环境变量，但还有一个问题是ubuntu本身的配置问题导致，执行以下命令后解决。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">yumao@ubuntu:/bin$ ls -l /bin/sh</div><div class=\"line\">lrwxrwxrwx 1 root root 4 May 17 10:34 /bin/sh -&gt; dash</div><div class=\"line\">yumao@ubuntu:/bin$ sudo ln -sf bash /bin/sh</div><div class=\"line\">yumao@ubuntu:/bin$ ls -l /bin/sh</div><div class=\"line\">lrwxrwxrwx 1 root root 4 Jul 26 03:23 /bin/sh -&gt; bash</div></pre></td></tr></table></figure>\n<p>若客户端脚本成功启动，则系统控制台输出如下</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div></pre></td><td class=\"code\"><pre><div class=\"line\">yumao@ubuntu:/opt/zookeeper-3.4.6/bin$ sudo sh ./zkServer.sh start</div><div class=\"line\">JMX enabled by default</div><div class=\"line\">Using config: /opt/zookeeper-3.4.6/bin/../conf/zoo.cfg</div><div class=\"line\">Starting zookeeper ... STARTED</div><div class=\"line\">yumao@ubuntu:/opt/zookeeper-3.4.6/bin$ sudo sh zkCli.sh </div><div class=\"line\">Connecting to localhost:2181</div><div class=\"line\">2016-07-26 03:29:22,781 [myid:] - INFO  [main:Environment@100] - Client environment:zookeeper.version=3.4.6-1569965, built on 02/20/2014 09:09 GMT</div><div class=\"line\">2016-07-26 03:29:22,789 [myid:] - INFO  [main:Environment@100] - Client environment:host.name=ubuntu</div><div class=\"line\">2016-07-26 03:29:22,790 [myid:] - INFO  [main:Environment@100] - Client environment:java.version=1.7.0_51</div><div class=\"line\">2016-07-26 03:29:22,791 [myid:] - INFO  [main:Environment@100] - Client environment:java.vendor=Oracle Corporation</div><div class=\"line\">2016-07-26 03:29:22,791 [myid:] - INFO  [main:Environment@100] - Client environment:java.home=/usr/jdk1.7.0_51/jre</div><div class=\"line\">2016-07-26 03:29:22,791 [myid:] - INFO  [main:Environment@100] - Client environment:java.class.path=/opt/zookeeper-3.4.6/bin/../build/classes:/opt/zookeeper-3.4.6/bin/../build/lib/*.jar:/opt/zookeeper-3.4.6/bin/../lib/slf4j-log4j12-1.6.1.jar:/opt/zookeeper-3.4.6/bin/../lib/slf4j-api-1.6.1.jar:/opt/zookeeper-3.4.6/bin/../lib/netty-3.7.0.Final.jar:/opt/zookeeper-3.4.6/bin/../lib/log4j-1.2.16.jar:/opt/zookeeper-3.4.6/bin/../lib/jline-0.9.94.jar:/opt/zookeeper-3.4.6/bin/../zookeeper-3.4.6.jar:/opt/zookeeper-3.4.6/bin/../src/java/lib/*.jar:/opt/zookeeper-3.4.6/bin/../conf:$CLASSPATH:$JAVA_HOME/lib:$JAVA_HOME/jre/lib</div><div class=\"line\">2016-07-26 03:29:22,791 [myid:] - INFO  [main:Environment@100] - Client environment:java.library.path=/usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib</div><div class=\"line\">2016-07-26 03:29:22,792 [myid:] - INFO  [main:Environment@100] - Client environment:java.io.tmpdir=/tmp</div><div class=\"line\">2016-07-26 03:29:22,792 [myid:] - INFO  [main:Environment@100] - Client environment:java.compiler=&lt;NA&gt;</div><div class=\"line\">2016-07-26 03:29:22,792 [myid:] - INFO  [main:Environment@100] - Client environment:os.name=Linux</div><div class=\"line\">2016-07-26 03:29:22,792 [myid:] - INFO  [main:Environment@100] - Client environment:os.arch=amd64</div><div class=\"line\">2016-07-26 03:29:22,793 [myid:] - INFO  [main:Environment@100] - Client environment:os.version=4.4.0-31-generic</div><div class=\"line\">2016-07-26 03:29:22,793 [myid:] - INFO  [main:Environment@100] - Client environment:user.name=root</div><div class=\"line\">2016-07-26 03:29:22,793 [myid:] - INFO  [main:Environment@100] - Client environment:user.home=/root</div><div class=\"line\">2016-07-26 03:29:22,793 [myid:] - INFO  [main:Environment@100] - Client environment:user.dir=/opt/zookeeper-3.4.6/bin</div><div class=\"line\">2016-07-26 03:29:22,794 [myid:] - INFO  [main:ZooKeeper@438] - Initiating client connection, connectString=localhost:2181 sessionTimeout=30000 watcher=org.apache.zookeeper.ZooKeeperMain$MyWatcher@4b4cab63</div><div class=\"line\">Welcome to ZooKeeper!</div><div class=\"line\">JLine support is enabled</div><div class=\"line\">2016-07-26 03:29:22,865 [myid:] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@975] - Opening socket connection to server localhost/127.0.0.1:2181. Will not attempt to authenticate using SASL (unknown error)</div><div class=\"line\">2016-07-26 03:29:22,887 [myid:] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@852] - Socket connection established to localhost/127.0.0.1:2181, initiating session</div><div class=\"line\">[zk: localhost:2181(CONNECTING) 0] 2016-07-26 03:29:22,936 [myid:] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1235] - Session establishment complete on server localhost/127.0.0.1:2181, sessionid = 0x15626c0466b0000, negotiated timeout = 30000</div><div class=\"line\"></div><div class=\"line\">WATCHER::</div><div class=\"line\"></div><div class=\"line\">WatchedEvent state:SyncConnected type:None path:null</div></pre></td></tr></table></figure>\n<p>若想以指定Zookeeper地址启动，则命令应输入</p>\n<blockquote>\n<p>sh zkCli.sh -server ip:port</p>\n</blockquote>\n<hr>\n<h3 id=\"通过客户端创建一个Zookeeper节点\"><a href=\"#通过客户端创建一个Zookeeper节点\" class=\"headerlink\" title=\"通过客户端创建一个Zookeeper节点\"></a>通过客户端创建一个Zookeeper节点</h3><blockquote>\n<p>create [-s]  [-e] path data acl</p>\n</blockquote>\n<p>其中 -s或-e分别指节点的特性，-s代表顺序节点，-e则代表临时节点。若不添加-e或-s参数，默认创建持久节点。</p>\n<p>acl表示用来进行权限控制。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">WatchedEvent state:SyncConnected type:None path:null</div><div class=\"line\">create /test_root test_data</div><div class=\"line\">Created /test_root</div><div class=\"line\">[zk: localhost:2181(CONNECTED) 1]</div></pre></td></tr></table></figure>\n<h3 id=\"读取Zookeeper节点\"><a href=\"#读取Zookeeper节点\" class=\"headerlink\" title=\"读取Zookeeper节点\"></a>读取Zookeeper节点</h3><h4 id=\"ls命令\"><a href=\"#ls命令\" class=\"headerlink\" title=\"ls命令\"></a>ls命令</h4><p>列出指定节点下的所有子节点。只能看到指定节点下的第一级的所有子节点。</p>\n<blockquote>\n<p>ls path [watch]</p>\n</blockquote>\n<p>case：在根节点下创建了/test_root持久节点后，使用ls命令查看根节点。然后再/test_root节点下创建了新的持久子节点1，再次使用ls命令查看根节点，结果无变化。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">WatchedEvent state:SyncConnected type:None path:null</div><div class=\"line\">create /test_root test_data</div><div class=\"line\">Created /test_root</div><div class=\"line\">[zk: localhost:2181(CONNECTED) 1] ls /</div><div class=\"line\">[test_root, dubbo, zookeeper]</div><div class=\"line\">[zk: localhost:2181(CONNECTED) 2] create /test_root/1 test_data_1</div><div class=\"line\">Created /test_root/1</div><div class=\"line\">[zk: localhost:2181(CONNECTED) 3] ls /</div><div class=\"line\">[test_root, dubbo, zookeeper]</div><div class=\"line\">[zk: localhost:2181(CONNECTED) 4] ls /test_root</div><div class=\"line\">[1]</div><div class=\"line\">[zk: localhost:2181(CONNECTED) 5]</div></pre></td></tr></table></figure>\n<h4 id=\"get命令\"><a href=\"#get命令\" class=\"headerlink\" title=\"get命令\"></a>get命令</h4><p>获取指定节点数据内容和属性信息</p>\n<blockquote>\n<p>get path [watch]</p>\n</blockquote>\n<p>case：使用get命令查看根节点test_root</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\">[zk: localhost:2181(CONNECTED) 5] get /test_root</div><div class=\"line\">test_data</div><div class=\"line\">cZxid = 0xbf</div><div class=\"line\">ctime = Tue Jul 26 03:35:51 PDT 2016</div><div class=\"line\">mZxid = 0xbf</div><div class=\"line\">mtime = Tue Jul 26 03:35:51 PDT 2016</div><div class=\"line\">pZxid = 0xc0</div><div class=\"line\">cversion = 1</div><div class=\"line\">dataVersion = 0</div><div class=\"line\">aclVersion = 0</div><div class=\"line\">ephemeralOwner = 0x0</div><div class=\"line\">dataLength = 9</div><div class=\"line\">numChildren = 1</div><div class=\"line\">[zk: localhost:2181(CONNECTED) 6]</div></pre></td></tr></table></figure>\n<h3 id=\"更新Zookeeper节点\"><a href=\"#更新Zookeeper节点\" class=\"headerlink\" title=\"更新Zookeeper节点\"></a>更新Zookeeper节点</h3><h4 id=\"set命令\"><a href=\"#set命令\" class=\"headerlink\" title=\"set命令\"></a>set命令</h4><blockquote>\n<p>set path data [version]</p>\n</blockquote>\n<p>case: 将/test_root节点的值更新为luffy，注意更新后节点version的变化</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div></pre></td><td class=\"code\"><pre><div class=\"line\">[zk: localhost:2181(CONNECTED) 3] get /test_root</div><div class=\"line\">test_data</div><div class=\"line\">cZxid = 0xbf</div><div class=\"line\">ctime = Tue Jul 26 03:35:51 PDT 2016</div><div class=\"line\">mZxid = 0xbf</div><div class=\"line\">mtime = Tue Jul 26 03:35:51 PDT 2016</div><div class=\"line\">pZxid = 0xc0</div><div class=\"line\">cversion = 1</div><div class=\"line\">dataVersion = 0</div><div class=\"line\">aclVersion = 0</div><div class=\"line\">ephemeralOwner = 0x0</div><div class=\"line\">dataLength = 9</div><div class=\"line\">numChildren = 1</div><div class=\"line\">[zk: localhost:2181(CONNECTED) 4] set /test_root luffy</div><div class=\"line\">cZxid = 0xbf</div><div class=\"line\">ctime = Tue Jul 26 03:35:51 PDT 2016</div><div class=\"line\">mZxid = 0xc3</div><div class=\"line\">mtime = Tue Jul 26 19:24:32 PDT 2016</div><div class=\"line\">pZxid = 0xc0</div><div class=\"line\">cversion = 1</div><div class=\"line\">dataVersion = 1</div><div class=\"line\">aclVersion = 0</div><div class=\"line\">ephemeralOwner = 0x0</div><div class=\"line\">dataLength = 5</div><div class=\"line\">numChildren = 1</div><div class=\"line\">[zk: localhost:2181(CONNECTED) 5]</div></pre></td></tr></table></figure>\n<h3 id=\"删除Zookeeper节点\"><a href=\"#删除Zookeeper节点\" class=\"headerlink\" title=\"删除Zookeeper节点\"></a>删除Zookeeper节点</h3><h4 id=\"delete-命令\"><a href=\"#delete-命令\" class=\"headerlink\" title=\"delete 命令\"></a>delete 命令</h4><blockquote>\n<p>delete path [version]<br>注意，只能删除叶子节点。</p>\n</blockquote>\n<p>case: 将/test_root下的1节点删除。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">[zk: localhost:2181(CONNECTED) 5] ls /test_root</div><div class=\"line\">[1]</div><div class=\"line\">[zk: localhost:2181(CONNECTED) 6] delete /test_root/1</div><div class=\"line\">[zk: localhost:2181(CONNECTED) 7] ls /test_root      </div><div class=\"line\">[]</div><div class=\"line\">[zk: localhost:2181(CONNECTED) 8]</div></pre></td></tr></table></figure>\n","excerpt":"<p>zookeeper官方网站: <a href=\"http://zookeeper.apache.org/\">http://zookeeper.apache.org/</a></p>\n<h2 id=\"Zookeeper的安装与部署\"><a href=\"#Zookeeper的安装与部署\" class=\"headerlink\" title=\"Zookeeper的安装与部署\"></a>Zookeeper的安装与部署</h2><p>Zookeeper通过Java编写，因此运行前需要配置好JRE</p>\n<h3 id=\"下载\"><a href=\"#下载\" class=\"headerlink\" title=\"下载\"></a>下载</h3><p>zookeeper下载地址为<a href=\"http://mirrors.cnnic.cn/apache/zookeeper/\">http://mirrors.cnnic.cn/apache/zookeeper/</a><br>","more":"</p>\n<h3 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h3><p>Zookeeper官方下载的文件为.tar.gz格式，我们只需解压即可完成安装</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">tar -xzvf zookeeper-3.4.6.tar.gz</div></pre></td></tr></table></figure>\n<h3 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h3><h4 id=\"创建zoo-cfg文件\"><a href=\"#创建zoo-cfg文件\" class=\"headerlink\" title=\"创建zoo.cfg文件\"></a>创建zoo.cfg文件</h4><p>我们进入到解压后的Zookeeper目录下，找到/conf/zoo_sample.cfg文件，重命名为zoo.cfg</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div></pre></td><td class=\"code\"><pre><div class=\"line\"># The number of milliseconds of each tick</div><div class=\"line\"># 基本事件单元，以毫秒为单位。它用来指示心跳，最小的 session 过期时间为两倍的 tickTime.</div><div class=\"line\">tickTime=2000</div><div class=\"line\"># The number of ticks that the initial </div><div class=\"line\"># synchronization phase can take</div><div class=\"line\">initLimit=10</div><div class=\"line\"># The number of ticks that can pass between </div><div class=\"line\"># sending a request and getting an acknowledgement</div><div class=\"line\">syncLimit=5</div><div class=\"line\"># the directory where the snapshot is stored.</div><div class=\"line\"># do not use /tmp for storage, /tmp here is just </div><div class=\"line\"># example sakes.</div><div class=\"line\"># 存储内存中数据库快照的位置，如果不设置参数，更新事务日志将被存储到默认位置</div><div class=\"line\">dataDir=/home/yumao/zookeeper/data</div><div class=\"line\">dataLogDir=/home/yumao/zookeeper/log</div><div class=\"line\"># the port at which the clients will connect</div><div class=\"line\"># 监听客户端连接的端口</div><div class=\"line\">clientPort=2181</div><div class=\"line\"># the maximum number of client connections.</div><div class=\"line\"># increase this if you need to handle more clients</div><div class=\"line\">#maxClientCnxns=60</div><div class=\"line\">#</div><div class=\"line\"># Be sure to read the maintenance section of the </div><div class=\"line\"># administrator guide before turning on autopurge.</div><div class=\"line\">#</div><div class=\"line\"># http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance</div><div class=\"line\">#</div><div class=\"line\"># The number of snapshots to retain in dataDir</div><div class=\"line\">#autopurge.snapRetainCount=3</div><div class=\"line\"># 格式为server.id=host:port:port, 其中id为在dataDir目录下创建的myid文件中的数字, 每个机器的数字必须保证唯一, id的范围是1~255</div><div class=\"line\"># 以下配置为单机配置</div><div class=\"line\">server.1=127.0.0.1:2888:3888</div><div class=\"line\"></div><div class=\"line\"># Set to &quot;0&quot; to disable auto purge feature</div><div class=\"line\">#autopurge.purgeInterval=1</div></pre></td></tr></table></figure>\n<h4 id=\"创建myid文件\"><a href=\"#创建myid文件\" class=\"headerlink\" title=\"创建myid文件\"></a>创建myid文件</h4><p>由于在zoo.cfg配置中指定了dataDir位置，进入dataDir=/home/yumao/zookeeper/data目录下，创建文件myid，内容为1</p>\n<h4 id=\"启动服务\"><a href=\"#启动服务\" class=\"headerlink\" title=\"启动服务\"></a>启动服务</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">yumao@ubuntu:/opt/zookeeper-3.4.6/bin$ sudo ./zkServer.sh start</div><div class=\"line\">JMX enabled by default</div><div class=\"line\">Using config: /opt/zookeeper-3.4.6/bin/../conf/zoo.cfg</div><div class=\"line\">Starting zookeeper ... STARTED</div></pre></td></tr></table></figure>\n<h4 id=\"停止服务\"><a href=\"#停止服务\" class=\"headerlink\" title=\"停止服务\"></a>停止服务</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">yumao@ubuntu:/opt/zookeeper-3.4.6/bin$ sudo ./zkServer.sh stop</div><div class=\"line\">JMX enabled by default</div><div class=\"line\">Using config: /opt/zookeeper-3.4.6/bin/../conf/zoo.cfg</div><div class=\"line\">Stopping zookeeper ... STOPPED</div><div class=\"line\">yumao@ubuntu:/opt/zookeeper-3.4.6/bin$</div></pre></td></tr></table></figure>\n<h4 id=\"设置环境变量\"><a href=\"#设置环境变量\" class=\"headerlink\" title=\"设置环境变量\"></a>设置环境变量</h4><p>在/etc/profile文件中添加</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">#Set ZooKeeper Enviroment</div><div class=\"line\">export ZOOKEEPER_HOME=/opt/zookeeper-3.4.6</div><div class=\"line\">export PATH=$PATH:$ZOOKEEPER_HOME/bin:$ZOOKEEPER_HOME/conf</div></pre></td></tr></table></figure>\n<hr>\n<h2 id=\"Zookeeper客户端的使用\"><a href=\"#Zookeeper客户端的使用\" class=\"headerlink\" title=\"Zookeeper客户端的使用\"></a>Zookeeper客户端的使用</h2><h3 id=\"客户端启动\"><a href=\"#客户端启动\" class=\"headerlink\" title=\"客户端启动\"></a>客户端启动</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">sh zkCli.sh</div></pre></td></tr></table></figure>\n<p>注：在执行该脚本的时候，系统报了个错</p>\n<blockquote>\n<p>zkCli.sh: 81: /opt/zookeeper-3.4.6/bin/zkEnv.sh: Syntax error: “(“ unexpected (expecting “fi”)</p>\n</blockquote>\n<p>一般出现该问题是因为没有配置Zookeeper的环境变量，但还有一个问题是ubuntu本身的配置问题导致，执行以下命令后解决。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">yumao@ubuntu:/bin$ ls -l /bin/sh</div><div class=\"line\">lrwxrwxrwx 1 root root 4 May 17 10:34 /bin/sh -&gt; dash</div><div class=\"line\">yumao@ubuntu:/bin$ sudo ln -sf bash /bin/sh</div><div class=\"line\">yumao@ubuntu:/bin$ ls -l /bin/sh</div><div class=\"line\">lrwxrwxrwx 1 root root 4 Jul 26 03:23 /bin/sh -&gt; bash</div></pre></td></tr></table></figure>\n<p>若客户端脚本成功启动，则系统控制台输出如下</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div></pre></td><td class=\"code\"><pre><div class=\"line\">yumao@ubuntu:/opt/zookeeper-3.4.6/bin$ sudo sh ./zkServer.sh start</div><div class=\"line\">JMX enabled by default</div><div class=\"line\">Using config: /opt/zookeeper-3.4.6/bin/../conf/zoo.cfg</div><div class=\"line\">Starting zookeeper ... STARTED</div><div class=\"line\">yumao@ubuntu:/opt/zookeeper-3.4.6/bin$ sudo sh zkCli.sh </div><div class=\"line\">Connecting to localhost:2181</div><div class=\"line\">2016-07-26 03:29:22,781 [myid:] - INFO  [main:Environment@100] - Client environment:zookeeper.version=3.4.6-1569965, built on 02/20/2014 09:09 GMT</div><div class=\"line\">2016-07-26 03:29:22,789 [myid:] - INFO  [main:Environment@100] - Client environment:host.name=ubuntu</div><div class=\"line\">2016-07-26 03:29:22,790 [myid:] - INFO  [main:Environment@100] - Client environment:java.version=1.7.0_51</div><div class=\"line\">2016-07-26 03:29:22,791 [myid:] - INFO  [main:Environment@100] - Client environment:java.vendor=Oracle Corporation</div><div class=\"line\">2016-07-26 03:29:22,791 [myid:] - INFO  [main:Environment@100] - Client environment:java.home=/usr/jdk1.7.0_51/jre</div><div class=\"line\">2016-07-26 03:29:22,791 [myid:] - INFO  [main:Environment@100] - Client environment:java.class.path=/opt/zookeeper-3.4.6/bin/../build/classes:/opt/zookeeper-3.4.6/bin/../build/lib/*.jar:/opt/zookeeper-3.4.6/bin/../lib/slf4j-log4j12-1.6.1.jar:/opt/zookeeper-3.4.6/bin/../lib/slf4j-api-1.6.1.jar:/opt/zookeeper-3.4.6/bin/../lib/netty-3.7.0.Final.jar:/opt/zookeeper-3.4.6/bin/../lib/log4j-1.2.16.jar:/opt/zookeeper-3.4.6/bin/../lib/jline-0.9.94.jar:/opt/zookeeper-3.4.6/bin/../zookeeper-3.4.6.jar:/opt/zookeeper-3.4.6/bin/../src/java/lib/*.jar:/opt/zookeeper-3.4.6/bin/../conf:$CLASSPATH:$JAVA_HOME/lib:$JAVA_HOME/jre/lib</div><div class=\"line\">2016-07-26 03:29:22,791 [myid:] - INFO  [main:Environment@100] - Client environment:java.library.path=/usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib</div><div class=\"line\">2016-07-26 03:29:22,792 [myid:] - INFO  [main:Environment@100] - Client environment:java.io.tmpdir=/tmp</div><div class=\"line\">2016-07-26 03:29:22,792 [myid:] - INFO  [main:Environment@100] - Client environment:java.compiler=&lt;NA&gt;</div><div class=\"line\">2016-07-26 03:29:22,792 [myid:] - INFO  [main:Environment@100] - Client environment:os.name=Linux</div><div class=\"line\">2016-07-26 03:29:22,792 [myid:] - INFO  [main:Environment@100] - Client environment:os.arch=amd64</div><div class=\"line\">2016-07-26 03:29:22,793 [myid:] - INFO  [main:Environment@100] - Client environment:os.version=4.4.0-31-generic</div><div class=\"line\">2016-07-26 03:29:22,793 [myid:] - INFO  [main:Environment@100] - Client environment:user.name=root</div><div class=\"line\">2016-07-26 03:29:22,793 [myid:] - INFO  [main:Environment@100] - Client environment:user.home=/root</div><div class=\"line\">2016-07-26 03:29:22,793 [myid:] - INFO  [main:Environment@100] - Client environment:user.dir=/opt/zookeeper-3.4.6/bin</div><div class=\"line\">2016-07-26 03:29:22,794 [myid:] - INFO  [main:ZooKeeper@438] - Initiating client connection, connectString=localhost:2181 sessionTimeout=30000 watcher=org.apache.zookeeper.ZooKeeperMain$MyWatcher@4b4cab63</div><div class=\"line\">Welcome to ZooKeeper!</div><div class=\"line\">JLine support is enabled</div><div class=\"line\">2016-07-26 03:29:22,865 [myid:] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@975] - Opening socket connection to server localhost/127.0.0.1:2181. Will not attempt to authenticate using SASL (unknown error)</div><div class=\"line\">2016-07-26 03:29:22,887 [myid:] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@852] - Socket connection established to localhost/127.0.0.1:2181, initiating session</div><div class=\"line\">[zk: localhost:2181(CONNECTING) 0] 2016-07-26 03:29:22,936 [myid:] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1235] - Session establishment complete on server localhost/127.0.0.1:2181, sessionid = 0x15626c0466b0000, negotiated timeout = 30000</div><div class=\"line\"></div><div class=\"line\">WATCHER::</div><div class=\"line\"></div><div class=\"line\">WatchedEvent state:SyncConnected type:None path:null</div></pre></td></tr></table></figure>\n<p>若想以指定Zookeeper地址启动，则命令应输入</p>\n<blockquote>\n<p>sh zkCli.sh -server ip:port</p>\n</blockquote>\n<hr>\n<h3 id=\"通过客户端创建一个Zookeeper节点\"><a href=\"#通过客户端创建一个Zookeeper节点\" class=\"headerlink\" title=\"通过客户端创建一个Zookeeper节点\"></a>通过客户端创建一个Zookeeper节点</h3><blockquote>\n<p>create [-s]  [-e] path data acl</p>\n</blockquote>\n<p>其中 -s或-e分别指节点的特性，-s代表顺序节点，-e则代表临时节点。若不添加-e或-s参数，默认创建持久节点。</p>\n<p>acl表示用来进行权限控制。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">WatchedEvent state:SyncConnected type:None path:null</div><div class=\"line\">create /test_root test_data</div><div class=\"line\">Created /test_root</div><div class=\"line\">[zk: localhost:2181(CONNECTED) 1]</div></pre></td></tr></table></figure>\n<h3 id=\"读取Zookeeper节点\"><a href=\"#读取Zookeeper节点\" class=\"headerlink\" title=\"读取Zookeeper节点\"></a>读取Zookeeper节点</h3><h4 id=\"ls命令\"><a href=\"#ls命令\" class=\"headerlink\" title=\"ls命令\"></a>ls命令</h4><p>列出指定节点下的所有子节点。只能看到指定节点下的第一级的所有子节点。</p>\n<blockquote>\n<p>ls path [watch]</p>\n</blockquote>\n<p>case：在根节点下创建了/test_root持久节点后，使用ls命令查看根节点。然后再/test_root节点下创建了新的持久子节点1，再次使用ls命令查看根节点，结果无变化。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">WatchedEvent state:SyncConnected type:None path:null</div><div class=\"line\">create /test_root test_data</div><div class=\"line\">Created /test_root</div><div class=\"line\">[zk: localhost:2181(CONNECTED) 1] ls /</div><div class=\"line\">[test_root, dubbo, zookeeper]</div><div class=\"line\">[zk: localhost:2181(CONNECTED) 2] create /test_root/1 test_data_1</div><div class=\"line\">Created /test_root/1</div><div class=\"line\">[zk: localhost:2181(CONNECTED) 3] ls /</div><div class=\"line\">[test_root, dubbo, zookeeper]</div><div class=\"line\">[zk: localhost:2181(CONNECTED) 4] ls /test_root</div><div class=\"line\">[1]</div><div class=\"line\">[zk: localhost:2181(CONNECTED) 5]</div></pre></td></tr></table></figure>\n<h4 id=\"get命令\"><a href=\"#get命令\" class=\"headerlink\" title=\"get命令\"></a>get命令</h4><p>获取指定节点数据内容和属性信息</p>\n<blockquote>\n<p>get path [watch]</p>\n</blockquote>\n<p>case：使用get命令查看根节点test_root</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\">[zk: localhost:2181(CONNECTED) 5] get /test_root</div><div class=\"line\">test_data</div><div class=\"line\">cZxid = 0xbf</div><div class=\"line\">ctime = Tue Jul 26 03:35:51 PDT 2016</div><div class=\"line\">mZxid = 0xbf</div><div class=\"line\">mtime = Tue Jul 26 03:35:51 PDT 2016</div><div class=\"line\">pZxid = 0xc0</div><div class=\"line\">cversion = 1</div><div class=\"line\">dataVersion = 0</div><div class=\"line\">aclVersion = 0</div><div class=\"line\">ephemeralOwner = 0x0</div><div class=\"line\">dataLength = 9</div><div class=\"line\">numChildren = 1</div><div class=\"line\">[zk: localhost:2181(CONNECTED) 6]</div></pre></td></tr></table></figure>\n<h3 id=\"更新Zookeeper节点\"><a href=\"#更新Zookeeper节点\" class=\"headerlink\" title=\"更新Zookeeper节点\"></a>更新Zookeeper节点</h3><h4 id=\"set命令\"><a href=\"#set命令\" class=\"headerlink\" title=\"set命令\"></a>set命令</h4><blockquote>\n<p>set path data [version]</p>\n</blockquote>\n<p>case: 将/test_root节点的值更新为luffy，注意更新后节点version的变化</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div></pre></td><td class=\"code\"><pre><div class=\"line\">[zk: localhost:2181(CONNECTED) 3] get /test_root</div><div class=\"line\">test_data</div><div class=\"line\">cZxid = 0xbf</div><div class=\"line\">ctime = Tue Jul 26 03:35:51 PDT 2016</div><div class=\"line\">mZxid = 0xbf</div><div class=\"line\">mtime = Tue Jul 26 03:35:51 PDT 2016</div><div class=\"line\">pZxid = 0xc0</div><div class=\"line\">cversion = 1</div><div class=\"line\">dataVersion = 0</div><div class=\"line\">aclVersion = 0</div><div class=\"line\">ephemeralOwner = 0x0</div><div class=\"line\">dataLength = 9</div><div class=\"line\">numChildren = 1</div><div class=\"line\">[zk: localhost:2181(CONNECTED) 4] set /test_root luffy</div><div class=\"line\">cZxid = 0xbf</div><div class=\"line\">ctime = Tue Jul 26 03:35:51 PDT 2016</div><div class=\"line\">mZxid = 0xc3</div><div class=\"line\">mtime = Tue Jul 26 19:24:32 PDT 2016</div><div class=\"line\">pZxid = 0xc0</div><div class=\"line\">cversion = 1</div><div class=\"line\">dataVersion = 1</div><div class=\"line\">aclVersion = 0</div><div class=\"line\">ephemeralOwner = 0x0</div><div class=\"line\">dataLength = 5</div><div class=\"line\">numChildren = 1</div><div class=\"line\">[zk: localhost:2181(CONNECTED) 5]</div></pre></td></tr></table></figure>\n<h3 id=\"删除Zookeeper节点\"><a href=\"#删除Zookeeper节点\" class=\"headerlink\" title=\"删除Zookeeper节点\"></a>删除Zookeeper节点</h3><h4 id=\"delete-命令\"><a href=\"#delete-命令\" class=\"headerlink\" title=\"delete 命令\"></a>delete 命令</h4><blockquote>\n<p>delete path [version]<br>注意，只能删除叶子节点。</p>\n</blockquote>\n<p>case: 将/test_root下的1节点删除。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">[zk: localhost:2181(CONNECTED) 5] ls /test_root</div><div class=\"line\">[1]</div><div class=\"line\">[zk: localhost:2181(CONNECTED) 6] delete /test_root/1</div><div class=\"line\">[zk: localhost:2181(CONNECTED) 7] ls /test_root      </div><div class=\"line\">[]</div><div class=\"line\">[zk: localhost:2181(CONNECTED) 8]</div></pre></td></tr></table></figure>"},{"title":"Zookeeper Java API的使用","date":"2016-07-26T07:00:00.000Z","toc":{"on":true,"max_depth":3,"nowrap":false,"list_number":true},"toc_list_number":true,"_content":"\n## 前言\n\nZookeeper官方API文档 http://zookeeper.apache.org/doc/r3.4.6/api/index.html\n\n<!-- more -->\n\n## 通过API建立ZooKeeper Session\n\nZooKeeper构造方法官方文档摘录如下\n\n> | Constructor and Description              |\n> | ---------------------------------------- |\n> | `ZooKeeper(String connectString,         int sessionTimeout,         Watcher watcher)`To create a ZooKeeper client object, the application needs to pass a connection string containing a comma separated list of host:port pairs, each corresponding to a ZooKeeper server. |\n> | `ZooKeeper(String connectString,         int sessionTimeout,         Watcher watcher,         boolean canBeReadOnly)`To create a ZooKeeper client object, the application needs to pass a connection string containing a comma separated list of host:port pairs, each corresponding to a ZooKeeper server. |\n> | `ZooKeeper(String connectString,         int sessionTimeout,         Watcher watcher,         long sessionId,         byte[] sessionPasswd)`To create a ZooKeeper client object, the application needs to pass a connection string containing a comma separated list of host:port pairs, each corresponding to a ZooKeeper server. |\n> | `ZooKeeper(String connectString,         int sessionTimeout,         Watcher watcher,         long sessionId,         byte[] sessionPasswd,         boolean canBeReadOnly)`To create a ZooKeeper client object, the application needs to pass a connection string containing a comma separated list of host:port pairs, each corresponding to a ZooKeeper server. |\n\n\n\nDemo github地址：\n\n```java\npackage me.wangran.zookeeper.demo.api;\n\nimport java.util.concurrent.CountDownLatch;\n\nimport org.apache.zookeeper.WatchedEvent;\nimport org.apache.zookeeper.Watcher;\nimport org.apache.zookeeper.Watcher.Event.KeeperState;\nimport org.apache.zookeeper.ZooKeeper;\n\n/**\n * Zookeeper 创建Session\n * @author Wang Ran\n */\npublic class ZooKeeperSessionDemo implements Watcher {\n\tprivate static CountDownLatch countDownLatch = new CountDownLatch(1);\n\t\n\tpublic static void main(String[] args) throws Exception {\n\t\tdemo3();\n\t}\n\t\n\t/**\n\t * 创建最基本的会话\n\t */\n\tpublic static void demo1() throws Exception {\n\t\tString zookeeperAddress = \"192.168.128.75:2181\"; // Zookeeper地址，多个Zookeeper地址可以英文逗号分隔，地址可指定节点\n\t\tint sessionTimeout = 10000; // session超时时间，单位毫秒\n\t\tWatcher watcher = new ZooKeeperSessionDemo(); // 事件通知处理器， 创建会话时可为null\n\t\tZooKeeper zookeeper = new ZooKeeper(zookeeperAddress, sessionTimeout, watcher);\n\t\tSystem.out.println(\"zookeeper connecting, state is \" + zookeeper.getState());\n\t\tcountDownLatch.await();\n\t\tSystem.out.println(\"zookeeper connected, state is \" + zookeeper.getState());\n\t}\n\t\n\t/**\n\t * 创建指定read only模式的会话\n\t */\n\tpublic static void demo2() throws Exception {\n\t\tString zookeeperAddress = \"192.168.128.75:2181/test_root\"; // Zookeeper地址，多个Zookeeper地址可以英文逗号分隔，地址可指定节点\n\t\tint sessionTimeout = 10000; // session超时时间，单位毫秒\n\t\tWatcher watcher = new ZooKeeperSessionDemo(); // 事件通知处理器， 创建会话时可为null\n\t\tboolean canBeReadOnly = true; // 是否支持read only模式，默认为false，若一个机器和Zookeeper Cluster过半机器失去网络连接，则不处理所有读写请求。若未true，则该情况可提供读请求。\n\t\tZooKeeper zookeeper = new ZooKeeper(zookeeperAddress, sessionTimeout, watcher, canBeReadOnly);\n\t\tSystem.out.println(\"zookeeper connecting, state is \" + zookeeper.getState());\n\t\tcountDownLatch.await();\n\t\tSystem.out.println(\"zookeeper connected, state is \" + zookeeper.getState());\n\t}\n\t\n\t/**\n\t * 恢复会话\n\t */\n\tpublic static void demo3()  throws Exception {\n\t\tString zookeeperAddress = \"192.168.128.75:2181/test_root\"; // Zookeeper地址，多个Zookeeper地址可以英文逗号分隔，地址可指定节点\n\t\tint sessionTimeout = 10000; // session超时时间，单位毫秒\n\t\tWatcher watcher = new ZooKeeperSessionDemo(); // 事件通知处理器， 创建会话时可为null\n\t\tZooKeeper zookeeper = new ZooKeeper(zookeeperAddress, sessionTimeout, watcher);\n\t\tSystem.out.println(\"zookeeper connecting, state is \" + zookeeper.getState());\n\t\tcountDownLatch.await();\n\t\tSystem.out.println(\"zookeeper connected, state is \" + zookeeper.getState());\n\t\tlong sessionId = zookeeper.getSessionId(); // 用于恢复会话\n\t\tbyte[] sessionPwd = zookeeper.getSessionPasswd(); // 用于恢复会话\n\t\tcountDownLatch = new CountDownLatch(1);\n\t\tzookeeper = new ZooKeeper(zookeeperAddress, sessionTimeout, watcher, sessionId, sessionPwd);\n\t\tSystem.out.println(\"zookeeper reconnecting, state is \" + zookeeper.getState());\n\t\tcountDownLatch.await();\n\t\tSystem.out.println(\"zookeeper reconnected, state is \" + zookeeper.getState());\n\t}\n\t\n\t@Override\n\tpublic void process(WatchedEvent watchedEvent) {\n\t\tSystem.out.println(\"ZooKeeperWatcherDemo process, watchedEvent is \" + watchedEvent);\n\t\tif(KeeperState.SyncConnected == watchedEvent.getState()) {\n\t\t\tcountDownLatch.countDown();\n\t\t}\n\t}\n}\n```\n\n---\n\n\n\n## 通过API创建节点\n\n### 说明\n\n创建节点API地址：http://zookeeper.apache.org/doc/r3.4.6/api/index.html\n\n这里，我们主要用到两个方法，分别是\n\n| 返回值      | 方法                                       |\n| -------- | ---------------------------------------- |\n| `String` | `create(String path,      byte[] data,      List acl,      CreateMode createMode)`Create a node with the given path. |\n| `void`   | `create(String path,      byte[] data,      List acl,      CreateMode createMode,      AsyncCallback.StringCallback cb,      Object ctx)`The asynchronous version of create. |\n\n\n\n* path 指定创建的节点路径\n* data 节点的内容\n* acl 创建节点策略\n\n```Java\n        /**\n         * This Id represents anyone.\n         */\n        public final Id ANYONE_ID_UNSAFE = new Id(\"world\", \"anyone\");\n\n        /**\n         * This Id is only usable to set ACLs. It will get substituted with the\n         * Id's the client authenticated with.\n         */\n        public final Id AUTH_IDS = new Id(\"auth\", \"\");\n\n        /**\n         * This is a completely open ACL .\n         */\n        public final ArrayList<ACL> OPEN_ACL_UNSAFE = new ArrayList<ACL>(\n                Collections.singletonList(new ACL(Perms.ALL, ANYONE_ID_UNSAFE)));\n\n        /**\n         * This ACL gives the creators authentication id's all permissions.\n         */\n        public final ArrayList<ACL> CREATOR_ALL_ACL = new ArrayList<ACL>(\n                Collections.singletonList(new ACL(Perms.ALL, AUTH_IDS)));\n\n        /**\n         * This ACL gives the world the ability to read.\n         */\n        public final ArrayList<ACL> READ_ACL_UNSAFE = new ArrayList<ACL>(\n                Collections\n                        .singletonList(new ACL(Perms.READ, ANYONE_ID_UNSAFE)));\n```\n\n* cb 异步回调函数，当节点创建后ZooKeeper客户端自动调用本方法。需要实现StringCallback接口，重写processResult方法\n* ctx 回调方法执行时使用的对象，通常放置上线文Context信息\n\n\n* CreateMode节点类型枚举如下\n\n```Java\n    /**\n     * The znode will not be automatically deleted upon client's disconnect\n     * 持久节点\n     */\n    PERSISTENT (0, false, false, false),\n    /**\n    * The znode will not be automatically deleted upon client's disconnect,\n    * and its name will be appended with a monotonically increasing number.\n    * 持久顺序节点\n    */\n    PERSISTENT_SEQUENTIAL (2, false, true, false),\n    /**\n     * The znode will be deleted upon the client's disconnect.\n     * 临时节点\n     */\n    EPHEMERAL (1, true, false, false),\n    /**\n     * The znode will be deleted upon the client's disconnect, and its name\n     * will be appended with a monotonically increasing number.\n     * 临时顺序节点\n     */\n    EPHEMERAL_SEQUENTIAL (3, true, true, false),\n    /**\n     * The znode will be a container node. Container\n     * nodes are special purpose nodes useful for recipes such as leader, lock,\n     * etc. When the last child of a container is deleted, the container becomes\n     * a candidate to be deleted by the server at some point in the future.\n     * Given this property, you should be prepared to get\n     * {@link org.apache.zookeeper.KeeperException.NoNodeException}\n     * when creating children inside of this container node.\n     */\n    CONTAINER (4, false, false, true);\n```\n\n### Case\n\n* case 1 根节点下创建持久节点/node_pokemon\n\n```Java\npackage me.wangran.zookeeper.demo.api;\n\nimport java.util.concurrent.CountDownLatch;\n\nimport org.apache.zookeeper.CreateMode;\nimport org.apache.zookeeper.WatchedEvent;\nimport org.apache.zookeeper.Watcher;\nimport org.apache.zookeeper.ZooKeeper;\nimport org.apache.zookeeper.Watcher.Event.KeeperState;\nimport org.apache.zookeeper.ZooDefs.Ids;\n\n/**\n * ZooKeeper创建节点Demo\n * @author Wang Ran\n */\npublic class ZooKeeperCreateNodeDemo  implements Watcher {\n\tprivate static CountDownLatch countDownLatch = new CountDownLatch(1);\n\t\n\tpublic static void main(String[] args) throws Exception {\n\t\tnew ZooKeeperCreateNodeDemo().demo1();\n\t}\n\t\n\t/**\n\t * 创建最基本的会话\n\t */\n\tpublic void demo1() throws Exception {\n\t\tString zookeeperAddress = \"192.168.128.75:2181\"; // Zookeeper地址，多个Zookeeper地址可以英文逗号分隔，地址可指定节点\n\t\tint sessionTimeout = 10000; // session超时时间，单位毫秒\n\t\tWatcher watcher = new ZooKeeperCreateNodeDemo(); // 事件通知处理器， 创建会话时可为null\n\t\tZooKeeper zookeeper = new ZooKeeper(zookeeperAddress, sessionTimeout, watcher);\n\t\tSystem.out.println(\"zookeeper connecting, state is \" + zookeeper.getState());\n\t\tcountDownLatch.await();\n\t\tSystem.out.println(\"zookeeper connected, state is \" + zookeeper.getState());\n\t\t\n\t\tString newNodePath = \"/node_pokemon\";\n\t\tbyte[] newNodeData = \"go\".getBytes();\n\t\tCreateMode newNodeMode = CreateMode.PERSISTENT;\n\t\tzookeeper.create(newNodePath, newNodeData, Ids.OPEN_ACL_UNSAFE, newNodeMode);\n\t\tSystem.out.println(\"zookeeper node created\");\n\t}\n\t\n\t@Override\n\tpublic void process(WatchedEvent watchedEvent) {\n\t\tSystem.out.println(\"ZooKeeperWatcherDemo process, watchedEvent is \" + watchedEvent);\n\t\tif(KeeperState.SyncConnected == watchedEvent.getState()) {\n\t\t\tcountDownLatch.countDown();\n\t\t}\n\t}\n\t\n}\n```\n\n控制台输出：\n\n> zookeeper connecting, state is CONNECTING\n> ZooKeeperWatcherDemo process, watchedEvent is WatchedEvent state:SyncConnected type:None path:null\n> zookeeper connected, state is CONNECTED\n> zookeeper node created\n\n\n\n* case2 创建节点后异步触发回调函数\n\n```Java\npackage me.wangran.zookeeper.demo.api;\n\nimport java.util.concurrent.CountDownLatch;\n\nimport org.apache.zookeeper.AsyncCallback;\nimport org.apache.zookeeper.AsyncCallback.StringCallback;\nimport org.apache.zookeeper.CreateMode;\nimport org.apache.zookeeper.WatchedEvent;\nimport org.apache.zookeeper.Watcher;\nimport org.apache.zookeeper.ZooKeeper;\nimport org.apache.zookeeper.Watcher.Event.KeeperState;\nimport org.apache.zookeeper.ZooDefs.Ids;\n\n/**\n * ZooKeeper创建节点Demo\n * @author Wang Ran\n */\npublic class ZooKeeperCreateNodeDemo  implements Watcher {\n\tprivate static CountDownLatch countDownLatch = new CountDownLatch(1);\n\t\n\tpublic static void main(String[] args) throws Exception {\n\t\tnew ZooKeeperCreateNodeDemo().demo2();\n\t}\n\t\n\t/**\n\t * 创建持久节点\n\t */\n\tpublic void demo1() throws Exception {\n\t\tString zookeeperAddress = \"192.168.128.75:2181\"; // Zookeeper地址，多个Zookeeper地址可以英文逗号分隔，地址可指定节点\n\t\tint sessionTimeout = 10000; // session超时时间，单位毫秒\n\t\tWatcher watcher = new ZooKeeperCreateNodeDemo(); // 事件通知处理器， 创建会话时可为null\n\t\tZooKeeper zookeeper = new ZooKeeper(zookeeperAddress, sessionTimeout, watcher);\n\t\tSystem.out.println(\"zookeeper connecting, state is \" + zookeeper.getState());\n\t\tcountDownLatch.await();\n\t\tSystem.out.println(\"zookeeper connected, state is \" + zookeeper.getState());\n\t\t\n\t\tString newNodePath = \"/node_pokemon\";\n\t\tbyte[] newNodeData = \"go\".getBytes();\n\t\tCreateMode newNodeMode = CreateMode.PERSISTENT;\n\t\tzookeeper.create(newNodePath, newNodeData, Ids.OPEN_ACL_UNSAFE, newNodeMode);\n\t\tSystem.out.println(\"zookeeper node created\");\n\t}\n\t\n\t/**\n\t * 创建节点后异步回调业务函数\n\t */\n\tpublic void demo2() throws Exception {\n\t\tString zookeeperAddress = \"192.168.128.75:2181/node_pokemon\"; // Zookeeper地址，多个Zookeeper地址可以英文逗号分隔，地址可指定节点\n\t\tint sessionTimeout = 10000; // session超时时间，单位毫秒\n\t\tWatcher watcher = new ZooKeeperCreateNodeDemo(); // 事件通知处理器， 创建会话时可为null\n\t\tZooKeeper zookeeper = new ZooKeeper(zookeeperAddress, sessionTimeout, watcher);\n\t\tSystem.out.println(\"zookeeper connecting, state is \" + zookeeper.getState());\n\t\tcountDownLatch.await();\n\t\tSystem.out.println(\"zookeeper connected, state is \" + zookeeper.getState());\n\t\t\n\t\tString newNodePath = \"/node_kinosaki\";\n\t\tbyte[] newNodeData = \"osen\".getBytes();\n\t\tCreateMode newNodeMode = CreateMode.PERSISTENT_SEQUENTIAL;\n\t\tObject ctx = \"ContextDemo\";\n\t\tzookeeper.create(newNodePath, newNodeData, Ids.OPEN_ACL_UNSAFE, newNodeMode, new StringCallbackDemo(), ctx);\n\t\tSystem.out.println(\"zookeeper node created\");\n\t\tThread.sleep(10);\n\t}\n\t\n\t/**\n\t * 异步回调函数\n\t * @author Wang Ran\n\t */\n\tclass StringCallbackDemo implements AsyncCallback.StringCallback {\n\t\t@Override\n\t\tpublic void processResult(int rc, String path, Object ctx, String name) {\n\t\t\tSystem.out.println(\"StringCallbackDemo.processResult executed!, resultCode is \" + rc\n\t\t\t\t\t+ \", path is\" + path // 调用接口时传入的Path\n\t\t\t\t\t+ \", context is \" + ctx.toString() // 调用接口时传入的Context\n\t\t\t\t\t+ \", node name is \" + name); // 实际在服务器中创建的节点名称\n\t\t}\n\t}\n\t\n\t@Override\n\tpublic void process(WatchedEvent watchedEvent) {\n\t\tSystem.out.println(\"ZooKeeperWatcherDemo process, watchedEvent is \" + watchedEvent);\n\t\tif(KeeperState.SyncConnected == watchedEvent.getState()) {\n\t\t\tcountDownLatch.countDown();\n\t\t}\n\t}\n}\n```\n\n控制台输出：\n\n> zookeeper connecting, state is CONNECTING\n> ZooKeeperWatcherDemo process, watchedEvent is WatchedEvent state:SyncConnected type:None path:null\n> zookeeper connected, state is CONNECTED\n> zookeeper node created\n> StringCallbackDemo.processResult executed!, resultCode is 0, path is/node_kinosaki, context is ContextDemo, node name is /node_kinosaki0000000005\n\n---\n\n\n## 通过API读取节点\n\n### API说明：\n\n* ### getChildren查询指定节点的所有子节点\n\n* ### getData查询指定节点的数据内容\n\n| 返回值    | 方法                                       |\n| ------ | ---------------------------------------- |\n| `List` | `  getChildren  (String path, boolean watch)`Return the list of the children of the node of the given path. |\n| `void` | `  getChildren  (String path, boolean watch, AsyncCallback.Children2Callback cb, Object ctx)`The asynchronous version of getChildren. |\n| `void` | `  getChildren  (String path, boolean watch, AsyncCallback.ChildrenCallback cb, Object ctx)`The asynchronous version of getChildren. |\n| `List` | `  getChildren  (String path, boolean watch, Stat stat)`For the given znode path return the stat and children list. |\n| `List` | `  getChildren  (String path, Watcher watcher)`Return the list of the children of the node of the given path. |\n| `void` | `  getChildren  (String path, Watcher watcher, AsyncCallback.Children2Callback cb, Object ctx)`The asynchronous version of getChildren. |\n| `void` | `  getChildren  (String path, Watcher watcher, AsyncCallback.ChildrenCallback cb, Object ctx)`The asynchronous version of getChildren. |\n| `List` | `  getChildren  (String path, Watcher watcher, Stat stat)`For the given znode path return the stat and children list. |\n\n\n| 返回值      | 方法                                       |\n| -------- | ---------------------------------------- |\n| `void`   | `getData(String path,       boolean watch,       AsyncCallback.DataCallback cb,       Object ctx)`The asynchronous version of getData. |\n| `byte[]` | `getData(String path,       boolean watch,       Stat stat)`Return the data and the stat of the node of the given path. |\n| `void`   | `getData(String path,       Watcher watcher,       AsyncCallback.DataCallback cb,       Object ctx)`The asynchronous version of getData. |\n| `byte[]` | `getData(String path,       Watcher watcher,       Stat stat)`Return the data and the stat of the node of the given path. |\n\n* ### 参数说明\n\n| 参数      | 说明                                       |\n| ------- | ---------------------------------------- |\n| path    | 想要查询的节点路径。                               |\n| watch   | false为不需要注册watcher，true为使用默认watcher。     |\n| watcher | 可为null。指定watcher用于订阅子节点列表变化通知。当子节点被添加或删除时会向客户端发送通知（通知内容不包含节点列表，客户端需重新查询以获得节点列表信息）。 |\n| cb      | 异步回调函数                                   |\n| ctx     | 上下文对象                                    |\n| stat    | 指定数据节点的状态信息，包含cZxid（节点创建的事务id）、mZxid（节点最后一次更新的事务id）、dataLength（节点数据内容长度），传入变量的值会在方法执行过程中被服务器响应的值替换。 |\n\n\n\n## 通过API更新节点\n\n### API说明\n\n| 返回值    | 方法                                       |\n| ------ | ---------------------------------------- |\n| `Stat` | `  setData  (String path,       byte[] data,       int version)`Set the data for the node of the given path if such a node exists and the given version matches the version of the node (if the given version is -1, it matches any node's versions).说明：该方法为同步更新方法 |\n| `void` | `  setData  (String path,       byte[] data,       int version,       AsyncCallback.StatCallback cb,       Object ctx)`The asynchronous version of setData.说明：该方法为异步更新方法 |\n\n### 参数说明\n\n| 参数      | 说明         |\n| ------- | ---------- |\n| path    | 想要更新的节点路径。 |\n| data[ ] | 更新的内容      |\n| version | 指定更新的数据版本  |\n| cb      | 异步回调函数     |\n| ctx     | 上下文对象      |\n\n\n\n\n## 通过API删除节点\n\n### API说明\n\n| 返回值    | 方法                                       |\n| ------ | ---------------------------------------- |\n| `void` | `  delete  (String path,      int version)`Delete the node with the given path. |\n| `void` | `  delete  (String path,      int version,      AsyncCallback.VoidCallback cb,      Object ctx)`The asynchronous version of delete. |\n\n---\n\n\n\n## 通过API判断节点是否存在\n\n### API说明\n\n| 返回值    | 方法                                       |\n| ------ | ---------------------------------------- |\n| `Stat` | `  exists  (String path,      boolean watch)`Return the stat of the node of the given path. |\n| `void` | `  exists  (String path,      boolean watch,      AsyncCallback.StatCallback cb,      Object ctx)`The asynchronous version of exists. |\n| `Stat` | `  exists  (String path,      Watcher watcher)`Return the stat of the node of the given path. |\n| `void` | `  exists  (String path,      Watcher watcher,      AsyncCallback.StatCallback cb,      Object ctx)`The asynchronous version of exists. |\n\n---\n\n\n\n## 权限控制\n\n### API说明\n\n| 返回值    | 方法                                       |\n| ------ | ---------------------------------------- |\n| `List` | `  getACL  (String path,      Stat stat)`Return the ACL and stat of the node of the given path. |\n| `void` | `  getACL  (String path,      Stat stat,      AsyncCallback.ACLCallback cb,      Object ctx)`The asynchronous version of getACL. |\n| `Stat` | `  setACL  (String path,      List acl,      int version)`Set the ACL for the node of the given path if such a node exists and the given version matches the version of the node. |\n| `void` | `  setACL  (String path,      List acl,      int version,      AsyncCallback.StatCallback cb,      Object ctx)`The asynchronous version of setACL. |\n","source":"_posts/zookeeper_java_api.md","raw":"---\ntitle:  \"Zookeeper Java API的使用\"\ndate: 2016-07-26 00:00:00\ncategories: Zookeeper\ntags: Zookeeper\ntoc:\n  on: true\n  max_depth: 3\n  nowrap: false\n  list_number: true\ntoc_list_number: true\n---\n\n## 前言\n\nZookeeper官方API文档 http://zookeeper.apache.org/doc/r3.4.6/api/index.html\n\n<!-- more -->\n\n## 通过API建立ZooKeeper Session\n\nZooKeeper构造方法官方文档摘录如下\n\n> | Constructor and Description              |\n> | ---------------------------------------- |\n> | `ZooKeeper(String connectString,         int sessionTimeout,         Watcher watcher)`To create a ZooKeeper client object, the application needs to pass a connection string containing a comma separated list of host:port pairs, each corresponding to a ZooKeeper server. |\n> | `ZooKeeper(String connectString,         int sessionTimeout,         Watcher watcher,         boolean canBeReadOnly)`To create a ZooKeeper client object, the application needs to pass a connection string containing a comma separated list of host:port pairs, each corresponding to a ZooKeeper server. |\n> | `ZooKeeper(String connectString,         int sessionTimeout,         Watcher watcher,         long sessionId,         byte[] sessionPasswd)`To create a ZooKeeper client object, the application needs to pass a connection string containing a comma separated list of host:port pairs, each corresponding to a ZooKeeper server. |\n> | `ZooKeeper(String connectString,         int sessionTimeout,         Watcher watcher,         long sessionId,         byte[] sessionPasswd,         boolean canBeReadOnly)`To create a ZooKeeper client object, the application needs to pass a connection string containing a comma separated list of host:port pairs, each corresponding to a ZooKeeper server. |\n\n\n\nDemo github地址：\n\n```java\npackage me.wangran.zookeeper.demo.api;\n\nimport java.util.concurrent.CountDownLatch;\n\nimport org.apache.zookeeper.WatchedEvent;\nimport org.apache.zookeeper.Watcher;\nimport org.apache.zookeeper.Watcher.Event.KeeperState;\nimport org.apache.zookeeper.ZooKeeper;\n\n/**\n * Zookeeper 创建Session\n * @author Wang Ran\n */\npublic class ZooKeeperSessionDemo implements Watcher {\n\tprivate static CountDownLatch countDownLatch = new CountDownLatch(1);\n\t\n\tpublic static void main(String[] args) throws Exception {\n\t\tdemo3();\n\t}\n\t\n\t/**\n\t * 创建最基本的会话\n\t */\n\tpublic static void demo1() throws Exception {\n\t\tString zookeeperAddress = \"192.168.128.75:2181\"; // Zookeeper地址，多个Zookeeper地址可以英文逗号分隔，地址可指定节点\n\t\tint sessionTimeout = 10000; // session超时时间，单位毫秒\n\t\tWatcher watcher = new ZooKeeperSessionDemo(); // 事件通知处理器， 创建会话时可为null\n\t\tZooKeeper zookeeper = new ZooKeeper(zookeeperAddress, sessionTimeout, watcher);\n\t\tSystem.out.println(\"zookeeper connecting, state is \" + zookeeper.getState());\n\t\tcountDownLatch.await();\n\t\tSystem.out.println(\"zookeeper connected, state is \" + zookeeper.getState());\n\t}\n\t\n\t/**\n\t * 创建指定read only模式的会话\n\t */\n\tpublic static void demo2() throws Exception {\n\t\tString zookeeperAddress = \"192.168.128.75:2181/test_root\"; // Zookeeper地址，多个Zookeeper地址可以英文逗号分隔，地址可指定节点\n\t\tint sessionTimeout = 10000; // session超时时间，单位毫秒\n\t\tWatcher watcher = new ZooKeeperSessionDemo(); // 事件通知处理器， 创建会话时可为null\n\t\tboolean canBeReadOnly = true; // 是否支持read only模式，默认为false，若一个机器和Zookeeper Cluster过半机器失去网络连接，则不处理所有读写请求。若未true，则该情况可提供读请求。\n\t\tZooKeeper zookeeper = new ZooKeeper(zookeeperAddress, sessionTimeout, watcher, canBeReadOnly);\n\t\tSystem.out.println(\"zookeeper connecting, state is \" + zookeeper.getState());\n\t\tcountDownLatch.await();\n\t\tSystem.out.println(\"zookeeper connected, state is \" + zookeeper.getState());\n\t}\n\t\n\t/**\n\t * 恢复会话\n\t */\n\tpublic static void demo3()  throws Exception {\n\t\tString zookeeperAddress = \"192.168.128.75:2181/test_root\"; // Zookeeper地址，多个Zookeeper地址可以英文逗号分隔，地址可指定节点\n\t\tint sessionTimeout = 10000; // session超时时间，单位毫秒\n\t\tWatcher watcher = new ZooKeeperSessionDemo(); // 事件通知处理器， 创建会话时可为null\n\t\tZooKeeper zookeeper = new ZooKeeper(zookeeperAddress, sessionTimeout, watcher);\n\t\tSystem.out.println(\"zookeeper connecting, state is \" + zookeeper.getState());\n\t\tcountDownLatch.await();\n\t\tSystem.out.println(\"zookeeper connected, state is \" + zookeeper.getState());\n\t\tlong sessionId = zookeeper.getSessionId(); // 用于恢复会话\n\t\tbyte[] sessionPwd = zookeeper.getSessionPasswd(); // 用于恢复会话\n\t\tcountDownLatch = new CountDownLatch(1);\n\t\tzookeeper = new ZooKeeper(zookeeperAddress, sessionTimeout, watcher, sessionId, sessionPwd);\n\t\tSystem.out.println(\"zookeeper reconnecting, state is \" + zookeeper.getState());\n\t\tcountDownLatch.await();\n\t\tSystem.out.println(\"zookeeper reconnected, state is \" + zookeeper.getState());\n\t}\n\t\n\t@Override\n\tpublic void process(WatchedEvent watchedEvent) {\n\t\tSystem.out.println(\"ZooKeeperWatcherDemo process, watchedEvent is \" + watchedEvent);\n\t\tif(KeeperState.SyncConnected == watchedEvent.getState()) {\n\t\t\tcountDownLatch.countDown();\n\t\t}\n\t}\n}\n```\n\n---\n\n\n\n## 通过API创建节点\n\n### 说明\n\n创建节点API地址：http://zookeeper.apache.org/doc/r3.4.6/api/index.html\n\n这里，我们主要用到两个方法，分别是\n\n| 返回值      | 方法                                       |\n| -------- | ---------------------------------------- |\n| `String` | `create(String path,      byte[] data,      List acl,      CreateMode createMode)`Create a node with the given path. |\n| `void`   | `create(String path,      byte[] data,      List acl,      CreateMode createMode,      AsyncCallback.StringCallback cb,      Object ctx)`The asynchronous version of create. |\n\n\n\n* path 指定创建的节点路径\n* data 节点的内容\n* acl 创建节点策略\n\n```Java\n        /**\n         * This Id represents anyone.\n         */\n        public final Id ANYONE_ID_UNSAFE = new Id(\"world\", \"anyone\");\n\n        /**\n         * This Id is only usable to set ACLs. It will get substituted with the\n         * Id's the client authenticated with.\n         */\n        public final Id AUTH_IDS = new Id(\"auth\", \"\");\n\n        /**\n         * This is a completely open ACL .\n         */\n        public final ArrayList<ACL> OPEN_ACL_UNSAFE = new ArrayList<ACL>(\n                Collections.singletonList(new ACL(Perms.ALL, ANYONE_ID_UNSAFE)));\n\n        /**\n         * This ACL gives the creators authentication id's all permissions.\n         */\n        public final ArrayList<ACL> CREATOR_ALL_ACL = new ArrayList<ACL>(\n                Collections.singletonList(new ACL(Perms.ALL, AUTH_IDS)));\n\n        /**\n         * This ACL gives the world the ability to read.\n         */\n        public final ArrayList<ACL> READ_ACL_UNSAFE = new ArrayList<ACL>(\n                Collections\n                        .singletonList(new ACL(Perms.READ, ANYONE_ID_UNSAFE)));\n```\n\n* cb 异步回调函数，当节点创建后ZooKeeper客户端自动调用本方法。需要实现StringCallback接口，重写processResult方法\n* ctx 回调方法执行时使用的对象，通常放置上线文Context信息\n\n\n* CreateMode节点类型枚举如下\n\n```Java\n    /**\n     * The znode will not be automatically deleted upon client's disconnect\n     * 持久节点\n     */\n    PERSISTENT (0, false, false, false),\n    /**\n    * The znode will not be automatically deleted upon client's disconnect,\n    * and its name will be appended with a monotonically increasing number.\n    * 持久顺序节点\n    */\n    PERSISTENT_SEQUENTIAL (2, false, true, false),\n    /**\n     * The znode will be deleted upon the client's disconnect.\n     * 临时节点\n     */\n    EPHEMERAL (1, true, false, false),\n    /**\n     * The znode will be deleted upon the client's disconnect, and its name\n     * will be appended with a monotonically increasing number.\n     * 临时顺序节点\n     */\n    EPHEMERAL_SEQUENTIAL (3, true, true, false),\n    /**\n     * The znode will be a container node. Container\n     * nodes are special purpose nodes useful for recipes such as leader, lock,\n     * etc. When the last child of a container is deleted, the container becomes\n     * a candidate to be deleted by the server at some point in the future.\n     * Given this property, you should be prepared to get\n     * {@link org.apache.zookeeper.KeeperException.NoNodeException}\n     * when creating children inside of this container node.\n     */\n    CONTAINER (4, false, false, true);\n```\n\n### Case\n\n* case 1 根节点下创建持久节点/node_pokemon\n\n```Java\npackage me.wangran.zookeeper.demo.api;\n\nimport java.util.concurrent.CountDownLatch;\n\nimport org.apache.zookeeper.CreateMode;\nimport org.apache.zookeeper.WatchedEvent;\nimport org.apache.zookeeper.Watcher;\nimport org.apache.zookeeper.ZooKeeper;\nimport org.apache.zookeeper.Watcher.Event.KeeperState;\nimport org.apache.zookeeper.ZooDefs.Ids;\n\n/**\n * ZooKeeper创建节点Demo\n * @author Wang Ran\n */\npublic class ZooKeeperCreateNodeDemo  implements Watcher {\n\tprivate static CountDownLatch countDownLatch = new CountDownLatch(1);\n\t\n\tpublic static void main(String[] args) throws Exception {\n\t\tnew ZooKeeperCreateNodeDemo().demo1();\n\t}\n\t\n\t/**\n\t * 创建最基本的会话\n\t */\n\tpublic void demo1() throws Exception {\n\t\tString zookeeperAddress = \"192.168.128.75:2181\"; // Zookeeper地址，多个Zookeeper地址可以英文逗号分隔，地址可指定节点\n\t\tint sessionTimeout = 10000; // session超时时间，单位毫秒\n\t\tWatcher watcher = new ZooKeeperCreateNodeDemo(); // 事件通知处理器， 创建会话时可为null\n\t\tZooKeeper zookeeper = new ZooKeeper(zookeeperAddress, sessionTimeout, watcher);\n\t\tSystem.out.println(\"zookeeper connecting, state is \" + zookeeper.getState());\n\t\tcountDownLatch.await();\n\t\tSystem.out.println(\"zookeeper connected, state is \" + zookeeper.getState());\n\t\t\n\t\tString newNodePath = \"/node_pokemon\";\n\t\tbyte[] newNodeData = \"go\".getBytes();\n\t\tCreateMode newNodeMode = CreateMode.PERSISTENT;\n\t\tzookeeper.create(newNodePath, newNodeData, Ids.OPEN_ACL_UNSAFE, newNodeMode);\n\t\tSystem.out.println(\"zookeeper node created\");\n\t}\n\t\n\t@Override\n\tpublic void process(WatchedEvent watchedEvent) {\n\t\tSystem.out.println(\"ZooKeeperWatcherDemo process, watchedEvent is \" + watchedEvent);\n\t\tif(KeeperState.SyncConnected == watchedEvent.getState()) {\n\t\t\tcountDownLatch.countDown();\n\t\t}\n\t}\n\t\n}\n```\n\n控制台输出：\n\n> zookeeper connecting, state is CONNECTING\n> ZooKeeperWatcherDemo process, watchedEvent is WatchedEvent state:SyncConnected type:None path:null\n> zookeeper connected, state is CONNECTED\n> zookeeper node created\n\n\n\n* case2 创建节点后异步触发回调函数\n\n```Java\npackage me.wangran.zookeeper.demo.api;\n\nimport java.util.concurrent.CountDownLatch;\n\nimport org.apache.zookeeper.AsyncCallback;\nimport org.apache.zookeeper.AsyncCallback.StringCallback;\nimport org.apache.zookeeper.CreateMode;\nimport org.apache.zookeeper.WatchedEvent;\nimport org.apache.zookeeper.Watcher;\nimport org.apache.zookeeper.ZooKeeper;\nimport org.apache.zookeeper.Watcher.Event.KeeperState;\nimport org.apache.zookeeper.ZooDefs.Ids;\n\n/**\n * ZooKeeper创建节点Demo\n * @author Wang Ran\n */\npublic class ZooKeeperCreateNodeDemo  implements Watcher {\n\tprivate static CountDownLatch countDownLatch = new CountDownLatch(1);\n\t\n\tpublic static void main(String[] args) throws Exception {\n\t\tnew ZooKeeperCreateNodeDemo().demo2();\n\t}\n\t\n\t/**\n\t * 创建持久节点\n\t */\n\tpublic void demo1() throws Exception {\n\t\tString zookeeperAddress = \"192.168.128.75:2181\"; // Zookeeper地址，多个Zookeeper地址可以英文逗号分隔，地址可指定节点\n\t\tint sessionTimeout = 10000; // session超时时间，单位毫秒\n\t\tWatcher watcher = new ZooKeeperCreateNodeDemo(); // 事件通知处理器， 创建会话时可为null\n\t\tZooKeeper zookeeper = new ZooKeeper(zookeeperAddress, sessionTimeout, watcher);\n\t\tSystem.out.println(\"zookeeper connecting, state is \" + zookeeper.getState());\n\t\tcountDownLatch.await();\n\t\tSystem.out.println(\"zookeeper connected, state is \" + zookeeper.getState());\n\t\t\n\t\tString newNodePath = \"/node_pokemon\";\n\t\tbyte[] newNodeData = \"go\".getBytes();\n\t\tCreateMode newNodeMode = CreateMode.PERSISTENT;\n\t\tzookeeper.create(newNodePath, newNodeData, Ids.OPEN_ACL_UNSAFE, newNodeMode);\n\t\tSystem.out.println(\"zookeeper node created\");\n\t}\n\t\n\t/**\n\t * 创建节点后异步回调业务函数\n\t */\n\tpublic void demo2() throws Exception {\n\t\tString zookeeperAddress = \"192.168.128.75:2181/node_pokemon\"; // Zookeeper地址，多个Zookeeper地址可以英文逗号分隔，地址可指定节点\n\t\tint sessionTimeout = 10000; // session超时时间，单位毫秒\n\t\tWatcher watcher = new ZooKeeperCreateNodeDemo(); // 事件通知处理器， 创建会话时可为null\n\t\tZooKeeper zookeeper = new ZooKeeper(zookeeperAddress, sessionTimeout, watcher);\n\t\tSystem.out.println(\"zookeeper connecting, state is \" + zookeeper.getState());\n\t\tcountDownLatch.await();\n\t\tSystem.out.println(\"zookeeper connected, state is \" + zookeeper.getState());\n\t\t\n\t\tString newNodePath = \"/node_kinosaki\";\n\t\tbyte[] newNodeData = \"osen\".getBytes();\n\t\tCreateMode newNodeMode = CreateMode.PERSISTENT_SEQUENTIAL;\n\t\tObject ctx = \"ContextDemo\";\n\t\tzookeeper.create(newNodePath, newNodeData, Ids.OPEN_ACL_UNSAFE, newNodeMode, new StringCallbackDemo(), ctx);\n\t\tSystem.out.println(\"zookeeper node created\");\n\t\tThread.sleep(10);\n\t}\n\t\n\t/**\n\t * 异步回调函数\n\t * @author Wang Ran\n\t */\n\tclass StringCallbackDemo implements AsyncCallback.StringCallback {\n\t\t@Override\n\t\tpublic void processResult(int rc, String path, Object ctx, String name) {\n\t\t\tSystem.out.println(\"StringCallbackDemo.processResult executed!, resultCode is \" + rc\n\t\t\t\t\t+ \", path is\" + path // 调用接口时传入的Path\n\t\t\t\t\t+ \", context is \" + ctx.toString() // 调用接口时传入的Context\n\t\t\t\t\t+ \", node name is \" + name); // 实际在服务器中创建的节点名称\n\t\t}\n\t}\n\t\n\t@Override\n\tpublic void process(WatchedEvent watchedEvent) {\n\t\tSystem.out.println(\"ZooKeeperWatcherDemo process, watchedEvent is \" + watchedEvent);\n\t\tif(KeeperState.SyncConnected == watchedEvent.getState()) {\n\t\t\tcountDownLatch.countDown();\n\t\t}\n\t}\n}\n```\n\n控制台输出：\n\n> zookeeper connecting, state is CONNECTING\n> ZooKeeperWatcherDemo process, watchedEvent is WatchedEvent state:SyncConnected type:None path:null\n> zookeeper connected, state is CONNECTED\n> zookeeper node created\n> StringCallbackDemo.processResult executed!, resultCode is 0, path is/node_kinosaki, context is ContextDemo, node name is /node_kinosaki0000000005\n\n---\n\n\n## 通过API读取节点\n\n### API说明：\n\n* ### getChildren查询指定节点的所有子节点\n\n* ### getData查询指定节点的数据内容\n\n| 返回值    | 方法                                       |\n| ------ | ---------------------------------------- |\n| `List` | `  getChildren  (String path, boolean watch)`Return the list of the children of the node of the given path. |\n| `void` | `  getChildren  (String path, boolean watch, AsyncCallback.Children2Callback cb, Object ctx)`The asynchronous version of getChildren. |\n| `void` | `  getChildren  (String path, boolean watch, AsyncCallback.ChildrenCallback cb, Object ctx)`The asynchronous version of getChildren. |\n| `List` | `  getChildren  (String path, boolean watch, Stat stat)`For the given znode path return the stat and children list. |\n| `List` | `  getChildren  (String path, Watcher watcher)`Return the list of the children of the node of the given path. |\n| `void` | `  getChildren  (String path, Watcher watcher, AsyncCallback.Children2Callback cb, Object ctx)`The asynchronous version of getChildren. |\n| `void` | `  getChildren  (String path, Watcher watcher, AsyncCallback.ChildrenCallback cb, Object ctx)`The asynchronous version of getChildren. |\n| `List` | `  getChildren  (String path, Watcher watcher, Stat stat)`For the given znode path return the stat and children list. |\n\n\n| 返回值      | 方法                                       |\n| -------- | ---------------------------------------- |\n| `void`   | `getData(String path,       boolean watch,       AsyncCallback.DataCallback cb,       Object ctx)`The asynchronous version of getData. |\n| `byte[]` | `getData(String path,       boolean watch,       Stat stat)`Return the data and the stat of the node of the given path. |\n| `void`   | `getData(String path,       Watcher watcher,       AsyncCallback.DataCallback cb,       Object ctx)`The asynchronous version of getData. |\n| `byte[]` | `getData(String path,       Watcher watcher,       Stat stat)`Return the data and the stat of the node of the given path. |\n\n* ### 参数说明\n\n| 参数      | 说明                                       |\n| ------- | ---------------------------------------- |\n| path    | 想要查询的节点路径。                               |\n| watch   | false为不需要注册watcher，true为使用默认watcher。     |\n| watcher | 可为null。指定watcher用于订阅子节点列表变化通知。当子节点被添加或删除时会向客户端发送通知（通知内容不包含节点列表，客户端需重新查询以获得节点列表信息）。 |\n| cb      | 异步回调函数                                   |\n| ctx     | 上下文对象                                    |\n| stat    | 指定数据节点的状态信息，包含cZxid（节点创建的事务id）、mZxid（节点最后一次更新的事务id）、dataLength（节点数据内容长度），传入变量的值会在方法执行过程中被服务器响应的值替换。 |\n\n\n\n## 通过API更新节点\n\n### API说明\n\n| 返回值    | 方法                                       |\n| ------ | ---------------------------------------- |\n| `Stat` | `  setData  (String path,       byte[] data,       int version)`Set the data for the node of the given path if such a node exists and the given version matches the version of the node (if the given version is -1, it matches any node's versions).说明：该方法为同步更新方法 |\n| `void` | `  setData  (String path,       byte[] data,       int version,       AsyncCallback.StatCallback cb,       Object ctx)`The asynchronous version of setData.说明：该方法为异步更新方法 |\n\n### 参数说明\n\n| 参数      | 说明         |\n| ------- | ---------- |\n| path    | 想要更新的节点路径。 |\n| data[ ] | 更新的内容      |\n| version | 指定更新的数据版本  |\n| cb      | 异步回调函数     |\n| ctx     | 上下文对象      |\n\n\n\n\n## 通过API删除节点\n\n### API说明\n\n| 返回值    | 方法                                       |\n| ------ | ---------------------------------------- |\n| `void` | `  delete  (String path,      int version)`Delete the node with the given path. |\n| `void` | `  delete  (String path,      int version,      AsyncCallback.VoidCallback cb,      Object ctx)`The asynchronous version of delete. |\n\n---\n\n\n\n## 通过API判断节点是否存在\n\n### API说明\n\n| 返回值    | 方法                                       |\n| ------ | ---------------------------------------- |\n| `Stat` | `  exists  (String path,      boolean watch)`Return the stat of the node of the given path. |\n| `void` | `  exists  (String path,      boolean watch,      AsyncCallback.StatCallback cb,      Object ctx)`The asynchronous version of exists. |\n| `Stat` | `  exists  (String path,      Watcher watcher)`Return the stat of the node of the given path. |\n| `void` | `  exists  (String path,      Watcher watcher,      AsyncCallback.StatCallback cb,      Object ctx)`The asynchronous version of exists. |\n\n---\n\n\n\n## 权限控制\n\n### API说明\n\n| 返回值    | 方法                                       |\n| ------ | ---------------------------------------- |\n| `List` | `  getACL  (String path,      Stat stat)`Return the ACL and stat of the node of the given path. |\n| `void` | `  getACL  (String path,      Stat stat,      AsyncCallback.ACLCallback cb,      Object ctx)`The asynchronous version of getACL. |\n| `Stat` | `  setACL  (String path,      List acl,      int version)`Set the ACL for the node of the given path if such a node exists and the given version matches the version of the node. |\n| `void` | `  setACL  (String path,      List acl,      int version,      AsyncCallback.StatCallback cb,      Object ctx)`The asynchronous version of setACL. |\n","slug":"zookeeper_java_api","published":1,"updated":"2016-07-27T08:28:53.527Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj1hliwgj000ko65ldmgq8jl3","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>Zookeeper官方API文档 <a href=\"http://zookeeper.apache.org/doc/r3.4.6/api/index.html\" target=\"_blank\" rel=\"external\">http://zookeeper.apache.org/doc/r3.4.6/api/index.html</a></p>\n<a id=\"more\"></a>\n<h2 id=\"通过API建立ZooKeeper-Session\"><a href=\"#通过API建立ZooKeeper-Session\" class=\"headerlink\" title=\"通过API建立ZooKeeper Session\"></a>通过API建立ZooKeeper Session</h2><p>ZooKeeper构造方法官方文档摘录如下</p>\n<blockquote>\n<table>\n<thead>\n<tr>\n<th>Constructor and Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>ZooKeeper(String connectString,         int sessionTimeout,         Watcher watcher)</code>To create a ZooKeeper client object, the application needs to pass a connection string containing a comma separated list of host:port pairs, each corresponding to a ZooKeeper server.</td>\n</tr>\n<tr>\n<td><code>ZooKeeper(String connectString,         int sessionTimeout,         Watcher watcher,         boolean canBeReadOnly)</code>To create a ZooKeeper client object, the application needs to pass a connection string containing a comma separated list of host:port pairs, each corresponding to a ZooKeeper server.</td>\n</tr>\n<tr>\n<td><code>ZooKeeper(String connectString,         int sessionTimeout,         Watcher watcher,         long sessionId,         byte[] sessionPasswd)</code>To create a ZooKeeper client object, the application needs to pass a connection string containing a comma separated list of host:port pairs, each corresponding to a ZooKeeper server.</td>\n</tr>\n<tr>\n<td><code>ZooKeeper(String connectString,         int sessionTimeout,         Watcher watcher,         long sessionId,         byte[] sessionPasswd,         boolean canBeReadOnly)</code>To create a ZooKeeper client object, the application needs to pass a connection string containing a comma separated list of host:port pairs, each corresponding to a ZooKeeper server.</td>\n</tr>\n</tbody>\n</table>\n</blockquote>\n<p>Demo github地址：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> me.wangran.zookeeper.demo.api;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.CountDownLatch;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.WatchedEvent;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.Watcher;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.Watcher.Event.KeeperState;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.ZooKeeper;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * Zookeeper 创建Session</div><div class=\"line\"> * <span class=\"doctag\">@author</span> Wang Ran</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ZooKeeperSessionDemo</span> <span class=\"keyword\">implements</span> <span class=\"title\">Watcher</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> CountDownLatch countDownLatch = <span class=\"keyword\">new</span> CountDownLatch(<span class=\"number\">1</span>);</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tdemo3();</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\">\t * 创建最基本的会话</div><div class=\"line\">\t */</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">demo1</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tString zookeeperAddress = <span class=\"string\">\"192.168.128.75:2181\"</span>; <span class=\"comment\">// Zookeeper地址，多个Zookeeper地址可以英文逗号分隔，地址可指定节点</span></div><div class=\"line\">\t\t<span class=\"keyword\">int</span> sessionTimeout = <span class=\"number\">10000</span>; <span class=\"comment\">// session超时时间，单位毫秒</span></div><div class=\"line\">\t\tWatcher watcher = <span class=\"keyword\">new</span> ZooKeeperSessionDemo(); <span class=\"comment\">// 事件通知处理器， 创建会话时可为null</span></div><div class=\"line\">\t\tZooKeeper zookeeper = <span class=\"keyword\">new</span> ZooKeeper(zookeeperAddress, sessionTimeout, watcher);</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"zookeeper connecting, state is \"</span> + zookeeper.getState());</div><div class=\"line\">\t\tcountDownLatch.await();</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"zookeeper connected, state is \"</span> + zookeeper.getState());</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\">\t * 创建指定read only模式的会话</div><div class=\"line\">\t */</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">demo2</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tString zookeeperAddress = <span class=\"string\">\"192.168.128.75:2181/test_root\"</span>; <span class=\"comment\">// Zookeeper地址，多个Zookeeper地址可以英文逗号分隔，地址可指定节点</span></div><div class=\"line\">\t\t<span class=\"keyword\">int</span> sessionTimeout = <span class=\"number\">10000</span>; <span class=\"comment\">// session超时时间，单位毫秒</span></div><div class=\"line\">\t\tWatcher watcher = <span class=\"keyword\">new</span> ZooKeeperSessionDemo(); <span class=\"comment\">// 事件通知处理器， 创建会话时可为null</span></div><div class=\"line\">\t\t<span class=\"keyword\">boolean</span> canBeReadOnly = <span class=\"keyword\">true</span>; <span class=\"comment\">// 是否支持read only模式，默认为false，若一个机器和Zookeeper Cluster过半机器失去网络连接，则不处理所有读写请求。若未true，则该情况可提供读请求。</span></div><div class=\"line\">\t\tZooKeeper zookeeper = <span class=\"keyword\">new</span> ZooKeeper(zookeeperAddress, sessionTimeout, watcher, canBeReadOnly);</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"zookeeper connecting, state is \"</span> + zookeeper.getState());</div><div class=\"line\">\t\tcountDownLatch.await();</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"zookeeper connected, state is \"</span> + zookeeper.getState());</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\">\t * 恢复会话</div><div class=\"line\">\t */</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">demo3</span><span class=\"params\">()</span>  <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tString zookeeperAddress = <span class=\"string\">\"192.168.128.75:2181/test_root\"</span>; <span class=\"comment\">// Zookeeper地址，多个Zookeeper地址可以英文逗号分隔，地址可指定节点</span></div><div class=\"line\">\t\t<span class=\"keyword\">int</span> sessionTimeout = <span class=\"number\">10000</span>; <span class=\"comment\">// session超时时间，单位毫秒</span></div><div class=\"line\">\t\tWatcher watcher = <span class=\"keyword\">new</span> ZooKeeperSessionDemo(); <span class=\"comment\">// 事件通知处理器， 创建会话时可为null</span></div><div class=\"line\">\t\tZooKeeper zookeeper = <span class=\"keyword\">new</span> ZooKeeper(zookeeperAddress, sessionTimeout, watcher);</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"zookeeper connecting, state is \"</span> + zookeeper.getState());</div><div class=\"line\">\t\tcountDownLatch.await();</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"zookeeper connected, state is \"</span> + zookeeper.getState());</div><div class=\"line\">\t\t<span class=\"keyword\">long</span> sessionId = zookeeper.getSessionId(); <span class=\"comment\">// 用于恢复会话</span></div><div class=\"line\">\t\t<span class=\"keyword\">byte</span>[] sessionPwd = zookeeper.getSessionPasswd(); <span class=\"comment\">// 用于恢复会话</span></div><div class=\"line\">\t\tcountDownLatch = <span class=\"keyword\">new</span> CountDownLatch(<span class=\"number\">1</span>);</div><div class=\"line\">\t\tzookeeper = <span class=\"keyword\">new</span> ZooKeeper(zookeeperAddress, sessionTimeout, watcher, sessionId, sessionPwd);</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"zookeeper reconnecting, state is \"</span> + zookeeper.getState());</div><div class=\"line\">\t\tcountDownLatch.await();</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"zookeeper reconnected, state is \"</span> + zookeeper.getState());</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">process</span><span class=\"params\">(WatchedEvent watchedEvent)</span> </span>&#123;</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"ZooKeeperWatcherDemo process, watchedEvent is \"</span> + watchedEvent);</div><div class=\"line\">\t\t<span class=\"keyword\">if</span>(KeeperState.SyncConnected == watchedEvent.getState()) &#123;</div><div class=\"line\">\t\t\tcountDownLatch.countDown();</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<hr>\n<h2 id=\"通过API创建节点\"><a href=\"#通过API创建节点\" class=\"headerlink\" title=\"通过API创建节点\"></a>通过API创建节点</h2><h3 id=\"说明\"><a href=\"#说明\" class=\"headerlink\" title=\"说明\"></a>说明</h3><p>创建节点API地址：<a href=\"http://zookeeper.apache.org/doc/r3.4.6/api/index.html\" target=\"_blank\" rel=\"external\">http://zookeeper.apache.org/doc/r3.4.6/api/index.html</a></p>\n<p>这里，我们主要用到两个方法，分别是</p>\n<table>\n<thead>\n<tr>\n<th>返回值</th>\n<th>方法</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>String</code></td>\n<td><code>create(String path,      byte[] data,      List acl,      CreateMode createMode)</code>Create a node with the given path.</td>\n</tr>\n<tr>\n<td><code>void</code></td>\n<td><code>create(String path,      byte[] data,      List acl,      CreateMode createMode,      AsyncCallback.StringCallback cb,      Object ctx)</code>The asynchronous version of create.</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>path 指定创建的节点路径</li>\n<li>data 节点的内容</li>\n<li>acl 创建节点策略</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * This Id represents anyone.</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> Id ANYONE_ID_UNSAFE = <span class=\"keyword\">new</span> Id(<span class=\"string\">\"world\"</span>, <span class=\"string\">\"anyone\"</span>);</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * This Id is only usable to set ACLs. It will get substituted with the</div><div class=\"line\"> * Id's the client authenticated with.</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> Id AUTH_IDS = <span class=\"keyword\">new</span> Id(<span class=\"string\">\"auth\"</span>, <span class=\"string\">\"\"</span>);</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * This is a completely open ACL .</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> ArrayList&lt;ACL&gt; OPEN_ACL_UNSAFE = <span class=\"keyword\">new</span> ArrayList&lt;ACL&gt;(</div><div class=\"line\">        Collections.singletonList(<span class=\"keyword\">new</span> ACL(Perms.ALL, ANYONE_ID_UNSAFE)));</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * This ACL gives the creators authentication id's all permissions.</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> ArrayList&lt;ACL&gt; CREATOR_ALL_ACL = <span class=\"keyword\">new</span> ArrayList&lt;ACL&gt;(</div><div class=\"line\">        Collections.singletonList(<span class=\"keyword\">new</span> ACL(Perms.ALL, AUTH_IDS)));</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * This ACL gives the world the ability to read.</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> ArrayList&lt;ACL&gt; READ_ACL_UNSAFE = <span class=\"keyword\">new</span> ArrayList&lt;ACL&gt;(</div><div class=\"line\">        Collections</div><div class=\"line\">                .singletonList(<span class=\"keyword\">new</span> ACL(Perms.READ, ANYONE_ID_UNSAFE)));</div></pre></td></tr></table></figure>\n<ul>\n<li>cb 异步回调函数，当节点创建后ZooKeeper客户端自动调用本方法。需要实现StringCallback接口，重写processResult方法</li>\n<li>ctx 回调方法执行时使用的对象，通常放置上线文Context信息</li>\n</ul>\n<ul>\n<li>CreateMode节点类型枚举如下</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * The znode will not be automatically deleted upon client's disconnect</div><div class=\"line\"> * 持久节点</div><div class=\"line\"> */</div><div class=\"line\">PERSISTENT (<span class=\"number\">0</span>, <span class=\"keyword\">false</span>, <span class=\"keyword\">false</span>, <span class=\"keyword\">false</span>),</div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\">* The znode will not be automatically deleted upon client's disconnect,</div><div class=\"line\">* and its name will be appended with a monotonically increasing number.</div><div class=\"line\">* 持久顺序节点</div><div class=\"line\">*/</div><div class=\"line\">PERSISTENT_SEQUENTIAL (<span class=\"number\">2</span>, <span class=\"keyword\">false</span>, <span class=\"keyword\">true</span>, <span class=\"keyword\">false</span>),</div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * The znode will be deleted upon the client's disconnect.</div><div class=\"line\"> * 临时节点</div><div class=\"line\"> */</div><div class=\"line\">EPHEMERAL (<span class=\"number\">1</span>, <span class=\"keyword\">true</span>, <span class=\"keyword\">false</span>, <span class=\"keyword\">false</span>),</div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * The znode will be deleted upon the client's disconnect, and its name</div><div class=\"line\"> * will be appended with a monotonically increasing number.</div><div class=\"line\"> * 临时顺序节点</div><div class=\"line\"> */</div><div class=\"line\">EPHEMERAL_SEQUENTIAL (<span class=\"number\">3</span>, <span class=\"keyword\">true</span>, <span class=\"keyword\">true</span>, <span class=\"keyword\">false</span>),</div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * The znode will be a container node. Container</div><div class=\"line\"> * nodes are special purpose nodes useful for recipes such as leader, lock,</div><div class=\"line\"> * etc. When the last child of a container is deleted, the container becomes</div><div class=\"line\"> * a candidate to be deleted by the server at some point in the future.</div><div class=\"line\"> * Given this property, you should be prepared to get</div><div class=\"line\"> * &#123;<span class=\"doctag\">@link</span> org.apache.zookeeper.KeeperException.NoNodeException&#125;</div><div class=\"line\"> * when creating children inside of this container node.</div><div class=\"line\"> */</div><div class=\"line\">CONTAINER (<span class=\"number\">4</span>, <span class=\"keyword\">false</span>, <span class=\"keyword\">false</span>, <span class=\"keyword\">true</span>);</div></pre></td></tr></table></figure>\n<h3 id=\"Case\"><a href=\"#Case\" class=\"headerlink\" title=\"Case\"></a>Case</h3><ul>\n<li>case 1 根节点下创建持久节点/node_pokemon</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> me.wangran.zookeeper.demo.api;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.CountDownLatch;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.CreateMode;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.WatchedEvent;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.Watcher;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.ZooKeeper;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.Watcher.Event.KeeperState;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.ZooDefs.Ids;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * ZooKeeper创建节点Demo</div><div class=\"line\"> * <span class=\"doctag\">@author</span> Wang Ran</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ZooKeeperCreateNodeDemo</span>  <span class=\"keyword\">implements</span> <span class=\"title\">Watcher</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> CountDownLatch countDownLatch = <span class=\"keyword\">new</span> CountDownLatch(<span class=\"number\">1</span>);</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> ZooKeeperCreateNodeDemo().demo1();</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\">\t * 创建最基本的会话</div><div class=\"line\">\t */</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">demo1</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tString zookeeperAddress = <span class=\"string\">\"192.168.128.75:2181\"</span>; <span class=\"comment\">// Zookeeper地址，多个Zookeeper地址可以英文逗号分隔，地址可指定节点</span></div><div class=\"line\">\t\t<span class=\"keyword\">int</span> sessionTimeout = <span class=\"number\">10000</span>; <span class=\"comment\">// session超时时间，单位毫秒</span></div><div class=\"line\">\t\tWatcher watcher = <span class=\"keyword\">new</span> ZooKeeperCreateNodeDemo(); <span class=\"comment\">// 事件通知处理器， 创建会话时可为null</span></div><div class=\"line\">\t\tZooKeeper zookeeper = <span class=\"keyword\">new</span> ZooKeeper(zookeeperAddress, sessionTimeout, watcher);</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"zookeeper connecting, state is \"</span> + zookeeper.getState());</div><div class=\"line\">\t\tcountDownLatch.await();</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"zookeeper connected, state is \"</span> + zookeeper.getState());</div><div class=\"line\">\t\t</div><div class=\"line\">\t\tString newNodePath = <span class=\"string\">\"/node_pokemon\"</span>;</div><div class=\"line\">\t\t<span class=\"keyword\">byte</span>[] newNodeData = <span class=\"string\">\"go\"</span>.getBytes();</div><div class=\"line\">\t\tCreateMode newNodeMode = CreateMode.PERSISTENT;</div><div class=\"line\">\t\tzookeeper.create(newNodePath, newNodeData, Ids.OPEN_ACL_UNSAFE, newNodeMode);</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"zookeeper node created\"</span>);</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">process</span><span class=\"params\">(WatchedEvent watchedEvent)</span> </span>&#123;</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"ZooKeeperWatcherDemo process, watchedEvent is \"</span> + watchedEvent);</div><div class=\"line\">\t\t<span class=\"keyword\">if</span>(KeeperState.SyncConnected == watchedEvent.getState()) &#123;</div><div class=\"line\">\t\t\tcountDownLatch.countDown();</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>控制台输出：</p>\n<blockquote>\n<p>zookeeper connecting, state is CONNECTING<br>ZooKeeperWatcherDemo process, watchedEvent is WatchedEvent state:SyncConnected type:None path:null<br>zookeeper connected, state is CONNECTED<br>zookeeper node created</p>\n</blockquote>\n<ul>\n<li>case2 创建节点后异步触发回调函数</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> me.wangran.zookeeper.demo.api;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.CountDownLatch;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.AsyncCallback;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.AsyncCallback.StringCallback;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.CreateMode;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.WatchedEvent;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.Watcher;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.ZooKeeper;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.Watcher.Event.KeeperState;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.ZooDefs.Ids;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * ZooKeeper创建节点Demo</div><div class=\"line\"> * <span class=\"doctag\">@author</span> Wang Ran</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ZooKeeperCreateNodeDemo</span>  <span class=\"keyword\">implements</span> <span class=\"title\">Watcher</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> CountDownLatch countDownLatch = <span class=\"keyword\">new</span> CountDownLatch(<span class=\"number\">1</span>);</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> ZooKeeperCreateNodeDemo().demo2();</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\">\t * 创建持久节点</div><div class=\"line\">\t */</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">demo1</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tString zookeeperAddress = <span class=\"string\">\"192.168.128.75:2181\"</span>; <span class=\"comment\">// Zookeeper地址，多个Zookeeper地址可以英文逗号分隔，地址可指定节点</span></div><div class=\"line\">\t\t<span class=\"keyword\">int</span> sessionTimeout = <span class=\"number\">10000</span>; <span class=\"comment\">// session超时时间，单位毫秒</span></div><div class=\"line\">\t\tWatcher watcher = <span class=\"keyword\">new</span> ZooKeeperCreateNodeDemo(); <span class=\"comment\">// 事件通知处理器， 创建会话时可为null</span></div><div class=\"line\">\t\tZooKeeper zookeeper = <span class=\"keyword\">new</span> ZooKeeper(zookeeperAddress, sessionTimeout, watcher);</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"zookeeper connecting, state is \"</span> + zookeeper.getState());</div><div class=\"line\">\t\tcountDownLatch.await();</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"zookeeper connected, state is \"</span> + zookeeper.getState());</div><div class=\"line\">\t\t</div><div class=\"line\">\t\tString newNodePath = <span class=\"string\">\"/node_pokemon\"</span>;</div><div class=\"line\">\t\t<span class=\"keyword\">byte</span>[] newNodeData = <span class=\"string\">\"go\"</span>.getBytes();</div><div class=\"line\">\t\tCreateMode newNodeMode = CreateMode.PERSISTENT;</div><div class=\"line\">\t\tzookeeper.create(newNodePath, newNodeData, Ids.OPEN_ACL_UNSAFE, newNodeMode);</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"zookeeper node created\"</span>);</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\">\t * 创建节点后异步回调业务函数</div><div class=\"line\">\t */</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">demo2</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tString zookeeperAddress = <span class=\"string\">\"192.168.128.75:2181/node_pokemon\"</span>; <span class=\"comment\">// Zookeeper地址，多个Zookeeper地址可以英文逗号分隔，地址可指定节点</span></div><div class=\"line\">\t\t<span class=\"keyword\">int</span> sessionTimeout = <span class=\"number\">10000</span>; <span class=\"comment\">// session超时时间，单位毫秒</span></div><div class=\"line\">\t\tWatcher watcher = <span class=\"keyword\">new</span> ZooKeeperCreateNodeDemo(); <span class=\"comment\">// 事件通知处理器， 创建会话时可为null</span></div><div class=\"line\">\t\tZooKeeper zookeeper = <span class=\"keyword\">new</span> ZooKeeper(zookeeperAddress, sessionTimeout, watcher);</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"zookeeper connecting, state is \"</span> + zookeeper.getState());</div><div class=\"line\">\t\tcountDownLatch.await();</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"zookeeper connected, state is \"</span> + zookeeper.getState());</div><div class=\"line\">\t\t</div><div class=\"line\">\t\tString newNodePath = <span class=\"string\">\"/node_kinosaki\"</span>;</div><div class=\"line\">\t\t<span class=\"keyword\">byte</span>[] newNodeData = <span class=\"string\">\"osen\"</span>.getBytes();</div><div class=\"line\">\t\tCreateMode newNodeMode = CreateMode.PERSISTENT_SEQUENTIAL;</div><div class=\"line\">\t\tObject ctx = <span class=\"string\">\"ContextDemo\"</span>;</div><div class=\"line\">\t\tzookeeper.create(newNodePath, newNodeData, Ids.OPEN_ACL_UNSAFE, newNodeMode, <span class=\"keyword\">new</span> StringCallbackDemo(), ctx);</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"zookeeper node created\"</span>);</div><div class=\"line\">\t\tThread.sleep(<span class=\"number\">10</span>);</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\">\t * 异步回调函数</div><div class=\"line\">\t * <span class=\"doctag\">@author</span> Wang Ran</div><div class=\"line\">\t */</div><div class=\"line\">\t<span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">StringCallbackDemo</span> <span class=\"keyword\">implements</span> <span class=\"title\">AsyncCallback</span>.<span class=\"title\">StringCallback</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">processResult</span><span class=\"params\">(<span class=\"keyword\">int</span> rc, String path, Object ctx, String name)</span> </span>&#123;</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"StringCallbackDemo.processResult executed!, resultCode is \"</span> + rc</div><div class=\"line\">\t\t\t\t\t+ <span class=\"string\">\", path is\"</span> + path <span class=\"comment\">// 调用接口时传入的Path</span></div><div class=\"line\">\t\t\t\t\t+ <span class=\"string\">\", context is \"</span> + ctx.toString() <span class=\"comment\">// 调用接口时传入的Context</span></div><div class=\"line\">\t\t\t\t\t+ <span class=\"string\">\", node name is \"</span> + name); <span class=\"comment\">// 实际在服务器中创建的节点名称</span></div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">process</span><span class=\"params\">(WatchedEvent watchedEvent)</span> </span>&#123;</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"ZooKeeperWatcherDemo process, watchedEvent is \"</span> + watchedEvent);</div><div class=\"line\">\t\t<span class=\"keyword\">if</span>(KeeperState.SyncConnected == watchedEvent.getState()) &#123;</div><div class=\"line\">\t\t\tcountDownLatch.countDown();</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>控制台输出：</p>\n<blockquote>\n<p>zookeeper connecting, state is CONNECTING<br>ZooKeeperWatcherDemo process, watchedEvent is WatchedEvent state:SyncConnected type:None path:null<br>zookeeper connected, state is CONNECTED<br>zookeeper node created<br>StringCallbackDemo.processResult executed!, resultCode is 0, path is/node_kinosaki, context is ContextDemo, node name is /node_kinosaki0000000005</p>\n</blockquote>\n<hr>\n<h2 id=\"通过API读取节点\"><a href=\"#通过API读取节点\" class=\"headerlink\" title=\"通过API读取节点\"></a>通过API读取节点</h2><h3 id=\"API说明：\"><a href=\"#API说明：\" class=\"headerlink\" title=\"API说明：\"></a>API说明：</h3><ul>\n<li><h3 id=\"getChildren查询指定节点的所有子节点\"><a href=\"#getChildren查询指定节点的所有子节点\" class=\"headerlink\" title=\"getChildren查询指定节点的所有子节点\"></a>getChildren查询指定节点的所有子节点</h3></li>\n<li><h3 id=\"getData查询指定节点的数据内容\"><a href=\"#getData查询指定节点的数据内容\" class=\"headerlink\" title=\"getData查询指定节点的数据内容\"></a>getData查询指定节点的数据内容</h3></li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>返回值</th>\n<th>方法</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>List</code></td>\n<td><code>getChildren  (String path, boolean watch)</code>Return the list of the children of the node of the given path.</td>\n</tr>\n<tr>\n<td><code>void</code></td>\n<td><code>getChildren  (String path, boolean watch, AsyncCallback.Children2Callback cb, Object ctx)</code>The asynchronous version of getChildren.</td>\n</tr>\n<tr>\n<td><code>void</code></td>\n<td><code>getChildren  (String path, boolean watch, AsyncCallback.ChildrenCallback cb, Object ctx)</code>The asynchronous version of getChildren.</td>\n</tr>\n<tr>\n<td><code>List</code></td>\n<td><code>getChildren  (String path, boolean watch, Stat stat)</code>For the given znode path return the stat and children list.</td>\n</tr>\n<tr>\n<td><code>List</code></td>\n<td><code>getChildren  (String path, Watcher watcher)</code>Return the list of the children of the node of the given path.</td>\n</tr>\n<tr>\n<td><code>void</code></td>\n<td><code>getChildren  (String path, Watcher watcher, AsyncCallback.Children2Callback cb, Object ctx)</code>The asynchronous version of getChildren.</td>\n</tr>\n<tr>\n<td><code>void</code></td>\n<td><code>getChildren  (String path, Watcher watcher, AsyncCallback.ChildrenCallback cb, Object ctx)</code>The asynchronous version of getChildren.</td>\n</tr>\n<tr>\n<td><code>List</code></td>\n<td><code>getChildren  (String path, Watcher watcher, Stat stat)</code>For the given znode path return the stat and children list.</td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th>返回值</th>\n<th>方法</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>void</code></td>\n<td><code>getData(String path,       boolean watch,       AsyncCallback.DataCallback cb,       Object ctx)</code>The asynchronous version of getData.</td>\n</tr>\n<tr>\n<td><code>byte[]</code></td>\n<td><code>getData(String path,       boolean watch,       Stat stat)</code>Return the data and the stat of the node of the given path.</td>\n</tr>\n<tr>\n<td><code>void</code></td>\n<td><code>getData(String path,       Watcher watcher,       AsyncCallback.DataCallback cb,       Object ctx)</code>The asynchronous version of getData.</td>\n</tr>\n<tr>\n<td><code>byte[]</code></td>\n<td><code>getData(String path,       Watcher watcher,       Stat stat)</code>Return the data and the stat of the node of the given path.</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li><h3 id=\"参数说明\"><a href=\"#参数说明\" class=\"headerlink\" title=\"参数说明\"></a>参数说明</h3></li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>path</td>\n<td>想要查询的节点路径。</td>\n</tr>\n<tr>\n<td>watch</td>\n<td>false为不需要注册watcher，true为使用默认watcher。</td>\n</tr>\n<tr>\n<td>watcher</td>\n<td>可为null。指定watcher用于订阅子节点列表变化通知。当子节点被添加或删除时会向客户端发送通知（通知内容不包含节点列表，客户端需重新查询以获得节点列表信息）。</td>\n</tr>\n<tr>\n<td>cb</td>\n<td>异步回调函数</td>\n</tr>\n<tr>\n<td>ctx</td>\n<td>上下文对象</td>\n</tr>\n<tr>\n<td>stat</td>\n<td>指定数据节点的状态信息，包含cZxid（节点创建的事务id）、mZxid（节点最后一次更新的事务id）、dataLength（节点数据内容长度），传入变量的值会在方法执行过程中被服务器响应的值替换。</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"通过API更新节点\"><a href=\"#通过API更新节点\" class=\"headerlink\" title=\"通过API更新节点\"></a>通过API更新节点</h2><h3 id=\"API说明\"><a href=\"#API说明\" class=\"headerlink\" title=\"API说明\"></a>API说明</h3><table>\n<thead>\n<tr>\n<th>返回值</th>\n<th>方法</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>Stat</code></td>\n<td><code>setData  (String path,       byte[] data,       int version)</code>Set the data for the node of the given path if such a node exists and the given version matches the version of the node (if the given version is -1, it matches any node’s versions).说明：该方法为同步更新方法</td>\n</tr>\n<tr>\n<td><code>void</code></td>\n<td><code>setData  (String path,       byte[] data,       int version,       AsyncCallback.StatCallback cb,       Object ctx)</code>The asynchronous version of setData.说明：该方法为异步更新方法</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"参数说明-1\"><a href=\"#参数说明-1\" class=\"headerlink\" title=\"参数说明\"></a>参数说明</h3><table>\n<thead>\n<tr>\n<th>参数</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>path</td>\n<td>想要更新的节点路径。</td>\n</tr>\n<tr>\n<td>data[ ]</td>\n<td>更新的内容</td>\n</tr>\n<tr>\n<td>version</td>\n<td>指定更新的数据版本</td>\n</tr>\n<tr>\n<td>cb</td>\n<td>异步回调函数</td>\n</tr>\n<tr>\n<td>ctx</td>\n<td>上下文对象</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"通过API删除节点\"><a href=\"#通过API删除节点\" class=\"headerlink\" title=\"通过API删除节点\"></a>通过API删除节点</h2><h3 id=\"API说明-1\"><a href=\"#API说明-1\" class=\"headerlink\" title=\"API说明\"></a>API说明</h3><table>\n<thead>\n<tr>\n<th>返回值</th>\n<th>方法</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>void</code></td>\n<td><code>delete  (String path,      int version)</code>Delete the node with the given path.</td>\n</tr>\n<tr>\n<td><code>void</code></td>\n<td><code>delete  (String path,      int version,      AsyncCallback.VoidCallback cb,      Object ctx)</code>The asynchronous version of delete.</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2 id=\"通过API判断节点是否存在\"><a href=\"#通过API判断节点是否存在\" class=\"headerlink\" title=\"通过API判断节点是否存在\"></a>通过API判断节点是否存在</h2><h3 id=\"API说明-2\"><a href=\"#API说明-2\" class=\"headerlink\" title=\"API说明\"></a>API说明</h3><table>\n<thead>\n<tr>\n<th>返回值</th>\n<th>方法</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>Stat</code></td>\n<td><code>exists  (String path,      boolean watch)</code>Return the stat of the node of the given path.</td>\n</tr>\n<tr>\n<td><code>void</code></td>\n<td><code>exists  (String path,      boolean watch,      AsyncCallback.StatCallback cb,      Object ctx)</code>The asynchronous version of exists.</td>\n</tr>\n<tr>\n<td><code>Stat</code></td>\n<td><code>exists  (String path,      Watcher watcher)</code>Return the stat of the node of the given path.</td>\n</tr>\n<tr>\n<td><code>void</code></td>\n<td><code>exists  (String path,      Watcher watcher,      AsyncCallback.StatCallback cb,      Object ctx)</code>The asynchronous version of exists.</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2 id=\"权限控制\"><a href=\"#权限控制\" class=\"headerlink\" title=\"权限控制\"></a>权限控制</h2><h3 id=\"API说明-3\"><a href=\"#API说明-3\" class=\"headerlink\" title=\"API说明\"></a>API说明</h3><table>\n<thead>\n<tr>\n<th>返回值</th>\n<th>方法</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>List</code></td>\n<td><code>getACL  (String path,      Stat stat)</code>Return the ACL and stat of the node of the given path.</td>\n</tr>\n<tr>\n<td><code>void</code></td>\n<td><code>getACL  (String path,      Stat stat,      AsyncCallback.ACLCallback cb,      Object ctx)</code>The asynchronous version of getACL.</td>\n</tr>\n<tr>\n<td><code>Stat</code></td>\n<td><code>setACL  (String path,      List acl,      int version)</code>Set the ACL for the node of the given path if such a node exists and the given version matches the version of the node.</td>\n</tr>\n<tr>\n<td><code>void</code></td>\n<td><code>setACL  (String path,      List acl,      int version,      AsyncCallback.StatCallback cb,      Object ctx)</code>The asynchronous version of setACL.</td>\n</tr>\n</tbody>\n</table>\n","excerpt":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>Zookeeper官方API文档 <a href=\"http://zookeeper.apache.org/doc/r3.4.6/api/index.html\">http://zookeeper.apache.org/doc/r3.4.6/api/index.html</a></p>","more":"<h2 id=\"通过API建立ZooKeeper-Session\"><a href=\"#通过API建立ZooKeeper-Session\" class=\"headerlink\" title=\"通过API建立ZooKeeper Session\"></a>通过API建立ZooKeeper Session</h2><p>ZooKeeper构造方法官方文档摘录如下</p>\n<blockquote>\n<table>\n<thead>\n<tr>\n<th>Constructor and Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>ZooKeeper(String connectString,         int sessionTimeout,         Watcher watcher)</code>To create a ZooKeeper client object, the application needs to pass a connection string containing a comma separated list of host:port pairs, each corresponding to a ZooKeeper server.</td>\n</tr>\n<tr>\n<td><code>ZooKeeper(String connectString,         int sessionTimeout,         Watcher watcher,         boolean canBeReadOnly)</code>To create a ZooKeeper client object, the application needs to pass a connection string containing a comma separated list of host:port pairs, each corresponding to a ZooKeeper server.</td>\n</tr>\n<tr>\n<td><code>ZooKeeper(String connectString,         int sessionTimeout,         Watcher watcher,         long sessionId,         byte[] sessionPasswd)</code>To create a ZooKeeper client object, the application needs to pass a connection string containing a comma separated list of host:port pairs, each corresponding to a ZooKeeper server.</td>\n</tr>\n<tr>\n<td><code>ZooKeeper(String connectString,         int sessionTimeout,         Watcher watcher,         long sessionId,         byte[] sessionPasswd,         boolean canBeReadOnly)</code>To create a ZooKeeper client object, the application needs to pass a connection string containing a comma separated list of host:port pairs, each corresponding to a ZooKeeper server.</td>\n</tr>\n</tbody>\n</table>\n</blockquote>\n<p>Demo github地址：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> me.wangran.zookeeper.demo.api;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.CountDownLatch;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.WatchedEvent;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.Watcher;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.Watcher.Event.KeeperState;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.ZooKeeper;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</div><div class=\"line\"> * Zookeeper 创建Session</div><div class=\"line\"> * <span class=\"doctag\">@author</span> Wang Ran</div><div class=\"line\"> */</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ZooKeeperSessionDemo</span> <span class=\"keyword\">implements</span> <span class=\"title\">Watcher</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> CountDownLatch countDownLatch = <span class=\"keyword\">new</span> CountDownLatch(<span class=\"number\">1</span>);</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tdemo3();</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">/**</div><div class=\"line\">\t * 创建最基本的会话</div><div class=\"line\">\t */</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">demo1</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tString zookeeperAddress = <span class=\"string\">\"192.168.128.75:2181\"</span>; <span class=\"comment\">// Zookeeper地址，多个Zookeeper地址可以英文逗号分隔，地址可指定节点</span></div><div class=\"line\">\t\t<span class=\"keyword\">int</span> sessionTimeout = <span class=\"number\">10000</span>; <span class=\"comment\">// session超时时间，单位毫秒</span></div><div class=\"line\">\t\tWatcher watcher = <span class=\"keyword\">new</span> ZooKeeperSessionDemo(); <span class=\"comment\">// 事件通知处理器， 创建会话时可为null</span></div><div class=\"line\">\t\tZooKeeper zookeeper = <span class=\"keyword\">new</span> ZooKeeper(zookeeperAddress, sessionTimeout, watcher);</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"zookeeper connecting, state is \"</span> + zookeeper.getState());</div><div class=\"line\">\t\tcountDownLatch.await();</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"zookeeper connected, state is \"</span> + zookeeper.getState());</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">/**</div><div class=\"line\">\t * 创建指定read only模式的会话</div><div class=\"line\">\t */</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">demo2</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tString zookeeperAddress = <span class=\"string\">\"192.168.128.75:2181/test_root\"</span>; <span class=\"comment\">// Zookeeper地址，多个Zookeeper地址可以英文逗号分隔，地址可指定节点</span></div><div class=\"line\">\t\t<span class=\"keyword\">int</span> sessionTimeout = <span class=\"number\">10000</span>; <span class=\"comment\">// session超时时间，单位毫秒</span></div><div class=\"line\">\t\tWatcher watcher = <span class=\"keyword\">new</span> ZooKeeperSessionDemo(); <span class=\"comment\">// 事件通知处理器， 创建会话时可为null</span></div><div class=\"line\">\t\t<span class=\"keyword\">boolean</span> canBeReadOnly = <span class=\"keyword\">true</span>; <span class=\"comment\">// 是否支持read only模式，默认为false，若一个机器和Zookeeper Cluster过半机器失去网络连接，则不处理所有读写请求。若未true，则该情况可提供读请求。</span></div><div class=\"line\">\t\tZooKeeper zookeeper = <span class=\"keyword\">new</span> ZooKeeper(zookeeperAddress, sessionTimeout, watcher, canBeReadOnly);</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"zookeeper connecting, state is \"</span> + zookeeper.getState());</div><div class=\"line\">\t\tcountDownLatch.await();</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"zookeeper connected, state is \"</span> + zookeeper.getState());</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">/**</div><div class=\"line\">\t * 恢复会话</div><div class=\"line\">\t */</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">demo3</span><span class=\"params\">()</span>  <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tString zookeeperAddress = <span class=\"string\">\"192.168.128.75:2181/test_root\"</span>; <span class=\"comment\">// Zookeeper地址，多个Zookeeper地址可以英文逗号分隔，地址可指定节点</span></div><div class=\"line\">\t\t<span class=\"keyword\">int</span> sessionTimeout = <span class=\"number\">10000</span>; <span class=\"comment\">// session超时时间，单位毫秒</span></div><div class=\"line\">\t\tWatcher watcher = <span class=\"keyword\">new</span> ZooKeeperSessionDemo(); <span class=\"comment\">// 事件通知处理器， 创建会话时可为null</span></div><div class=\"line\">\t\tZooKeeper zookeeper = <span class=\"keyword\">new</span> ZooKeeper(zookeeperAddress, sessionTimeout, watcher);</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"zookeeper connecting, state is \"</span> + zookeeper.getState());</div><div class=\"line\">\t\tcountDownLatch.await();</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"zookeeper connected, state is \"</span> + zookeeper.getState());</div><div class=\"line\">\t\t<span class=\"keyword\">long</span> sessionId = zookeeper.getSessionId(); <span class=\"comment\">// 用于恢复会话</span></div><div class=\"line\">\t\t<span class=\"keyword\">byte</span>[] sessionPwd = zookeeper.getSessionPasswd(); <span class=\"comment\">// 用于恢复会话</span></div><div class=\"line\">\t\tcountDownLatch = <span class=\"keyword\">new</span> CountDownLatch(<span class=\"number\">1</span>);</div><div class=\"line\">\t\tzookeeper = <span class=\"keyword\">new</span> ZooKeeper(zookeeperAddress, sessionTimeout, watcher, sessionId, sessionPwd);</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"zookeeper reconnecting, state is \"</span> + zookeeper.getState());</div><div class=\"line\">\t\tcountDownLatch.await();</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"zookeeper reconnected, state is \"</span> + zookeeper.getState());</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">process</span><span class=\"params\">(WatchedEvent watchedEvent)</span> </span>&#123;</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"ZooKeeperWatcherDemo process, watchedEvent is \"</span> + watchedEvent);</div><div class=\"line\">\t\t<span class=\"keyword\">if</span>(KeeperState.SyncConnected == watchedEvent.getState()) &#123;</div><div class=\"line\">\t\t\tcountDownLatch.countDown();</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<hr>\n<h2 id=\"通过API创建节点\"><a href=\"#通过API创建节点\" class=\"headerlink\" title=\"通过API创建节点\"></a>通过API创建节点</h2><h3 id=\"说明\"><a href=\"#说明\" class=\"headerlink\" title=\"说明\"></a>说明</h3><p>创建节点API地址：<a href=\"http://zookeeper.apache.org/doc/r3.4.6/api/index.html\">http://zookeeper.apache.org/doc/r3.4.6/api/index.html</a></p>\n<p>这里，我们主要用到两个方法，分别是</p>\n<table>\n<thead>\n<tr>\n<th>返回值</th>\n<th>方法</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>String</code></td>\n<td><code>create(String path,      byte[] data,      List acl,      CreateMode createMode)</code>Create a node with the given path.</td>\n</tr>\n<tr>\n<td><code>void</code></td>\n<td><code>create(String path,      byte[] data,      List acl,      CreateMode createMode,      AsyncCallback.StringCallback cb,      Object ctx)</code>The asynchronous version of create.</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>path 指定创建的节点路径</li>\n<li>data 节点的内容</li>\n<li>acl 创建节点策略</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</div><div class=\"line\"> * This Id represents anyone.</div><div class=\"line\"> */</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> Id ANYONE_ID_UNSAFE = <span class=\"keyword\">new</span> Id(<span class=\"string\">\"world\"</span>, <span class=\"string\">\"anyone\"</span>);</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</div><div class=\"line\"> * This Id is only usable to set ACLs. It will get substituted with the</div><div class=\"line\"> * Id's the client authenticated with.</div><div class=\"line\"> */</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> Id AUTH_IDS = <span class=\"keyword\">new</span> Id(<span class=\"string\">\"auth\"</span>, <span class=\"string\">\"\"</span>);</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</div><div class=\"line\"> * This is a completely open ACL .</div><div class=\"line\"> */</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> ArrayList&lt;ACL&gt; OPEN_ACL_UNSAFE = <span class=\"keyword\">new</span> ArrayList&lt;ACL&gt;(</div><div class=\"line\">        Collections.singletonList(<span class=\"keyword\">new</span> ACL(Perms.ALL, ANYONE_ID_UNSAFE)));</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</div><div class=\"line\"> * This ACL gives the creators authentication id's all permissions.</div><div class=\"line\"> */</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> ArrayList&lt;ACL&gt; CREATOR_ALL_ACL = <span class=\"keyword\">new</span> ArrayList&lt;ACL&gt;(</div><div class=\"line\">        Collections.singletonList(<span class=\"keyword\">new</span> ACL(Perms.ALL, AUTH_IDS)));</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</div><div class=\"line\"> * This ACL gives the world the ability to read.</div><div class=\"line\"> */</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> ArrayList&lt;ACL&gt; READ_ACL_UNSAFE = <span class=\"keyword\">new</span> ArrayList&lt;ACL&gt;(</div><div class=\"line\">        Collections</div><div class=\"line\">                .singletonList(<span class=\"keyword\">new</span> ACL(Perms.READ, ANYONE_ID_UNSAFE)));</div></pre></td></tr></table></figure>\n<ul>\n<li>cb 异步回调函数，当节点创建后ZooKeeper客户端自动调用本方法。需要实现StringCallback接口，重写processResult方法</li>\n<li>ctx 回调方法执行时使用的对象，通常放置上线文Context信息</li>\n</ul>\n<ul>\n<li>CreateMode节点类型枚举如下</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</div><div class=\"line\"> * The znode will not be automatically deleted upon client's disconnect</div><div class=\"line\"> * 持久节点</div><div class=\"line\"> */</span></div><div class=\"line\">PERSISTENT (<span class=\"number\">0</span>, <span class=\"keyword\">false</span>, <span class=\"keyword\">false</span>, <span class=\"keyword\">false</span>),</div><div class=\"line\"><span class=\"comment\">/**</div><div class=\"line\">* The znode will not be automatically deleted upon client's disconnect,</div><div class=\"line\">* and its name will be appended with a monotonically increasing number.</div><div class=\"line\">* 持久顺序节点</div><div class=\"line\">*/</span></div><div class=\"line\">PERSISTENT_SEQUENTIAL (<span class=\"number\">2</span>, <span class=\"keyword\">false</span>, <span class=\"keyword\">true</span>, <span class=\"keyword\">false</span>),</div><div class=\"line\"><span class=\"comment\">/**</div><div class=\"line\"> * The znode will be deleted upon the client's disconnect.</div><div class=\"line\"> * 临时节点</div><div class=\"line\"> */</span></div><div class=\"line\">EPHEMERAL (<span class=\"number\">1</span>, <span class=\"keyword\">true</span>, <span class=\"keyword\">false</span>, <span class=\"keyword\">false</span>),</div><div class=\"line\"><span class=\"comment\">/**</div><div class=\"line\"> * The znode will be deleted upon the client's disconnect, and its name</div><div class=\"line\"> * will be appended with a monotonically increasing number.</div><div class=\"line\"> * 临时顺序节点</div><div class=\"line\"> */</span></div><div class=\"line\">EPHEMERAL_SEQUENTIAL (<span class=\"number\">3</span>, <span class=\"keyword\">true</span>, <span class=\"keyword\">true</span>, <span class=\"keyword\">false</span>),</div><div class=\"line\"><span class=\"comment\">/**</div><div class=\"line\"> * The znode will be a container node. Container</div><div class=\"line\"> * nodes are special purpose nodes useful for recipes such as leader, lock,</div><div class=\"line\"> * etc. When the last child of a container is deleted, the container becomes</div><div class=\"line\"> * a candidate to be deleted by the server at some point in the future.</div><div class=\"line\"> * Given this property, you should be prepared to get</div><div class=\"line\"> * &#123;<span class=\"doctag\">@link</span> org.apache.zookeeper.KeeperException.NoNodeException&#125;</div><div class=\"line\"> * when creating children inside of this container node.</div><div class=\"line\"> */</span></div><div class=\"line\">CONTAINER (<span class=\"number\">4</span>, <span class=\"keyword\">false</span>, <span class=\"keyword\">false</span>, <span class=\"keyword\">true</span>);</div></pre></td></tr></table></figure>\n<h3 id=\"Case\"><a href=\"#Case\" class=\"headerlink\" title=\"Case\"></a>Case</h3><ul>\n<li>case 1 根节点下创建持久节点/node_pokemon</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> me.wangran.zookeeper.demo.api;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.CountDownLatch;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.CreateMode;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.WatchedEvent;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.Watcher;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.ZooKeeper;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.Watcher.Event.KeeperState;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.ZooDefs.Ids;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</div><div class=\"line\"> * ZooKeeper创建节点Demo</div><div class=\"line\"> * <span class=\"doctag\">@author</span> Wang Ran</div><div class=\"line\"> */</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ZooKeeperCreateNodeDemo</span>  <span class=\"keyword\">implements</span> <span class=\"title\">Watcher</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> CountDownLatch countDownLatch = <span class=\"keyword\">new</span> CountDownLatch(<span class=\"number\">1</span>);</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> ZooKeeperCreateNodeDemo().demo1();</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">/**</div><div class=\"line\">\t * 创建最基本的会话</div><div class=\"line\">\t */</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">demo1</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tString zookeeperAddress = <span class=\"string\">\"192.168.128.75:2181\"</span>; <span class=\"comment\">// Zookeeper地址，多个Zookeeper地址可以英文逗号分隔，地址可指定节点</span></div><div class=\"line\">\t\t<span class=\"keyword\">int</span> sessionTimeout = <span class=\"number\">10000</span>; <span class=\"comment\">// session超时时间，单位毫秒</span></div><div class=\"line\">\t\tWatcher watcher = <span class=\"keyword\">new</span> ZooKeeperCreateNodeDemo(); <span class=\"comment\">// 事件通知处理器， 创建会话时可为null</span></div><div class=\"line\">\t\tZooKeeper zookeeper = <span class=\"keyword\">new</span> ZooKeeper(zookeeperAddress, sessionTimeout, watcher);</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"zookeeper connecting, state is \"</span> + zookeeper.getState());</div><div class=\"line\">\t\tcountDownLatch.await();</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"zookeeper connected, state is \"</span> + zookeeper.getState());</div><div class=\"line\">\t\t</div><div class=\"line\">\t\tString newNodePath = <span class=\"string\">\"/node_pokemon\"</span>;</div><div class=\"line\">\t\t<span class=\"keyword\">byte</span>[] newNodeData = <span class=\"string\">\"go\"</span>.getBytes();</div><div class=\"line\">\t\tCreateMode newNodeMode = CreateMode.PERSISTENT;</div><div class=\"line\">\t\tzookeeper.create(newNodePath, newNodeData, Ids.OPEN_ACL_UNSAFE, newNodeMode);</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"zookeeper node created\"</span>);</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">process</span><span class=\"params\">(WatchedEvent watchedEvent)</span> </span>&#123;</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"ZooKeeperWatcherDemo process, watchedEvent is \"</span> + watchedEvent);</div><div class=\"line\">\t\t<span class=\"keyword\">if</span>(KeeperState.SyncConnected == watchedEvent.getState()) &#123;</div><div class=\"line\">\t\t\tcountDownLatch.countDown();</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>控制台输出：</p>\n<blockquote>\n<p>zookeeper connecting, state is CONNECTING<br>ZooKeeperWatcherDemo process, watchedEvent is WatchedEvent state:SyncConnected type:None path:null<br>zookeeper connected, state is CONNECTED<br>zookeeper node created</p>\n</blockquote>\n<ul>\n<li>case2 创建节点后异步触发回调函数</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> me.wangran.zookeeper.demo.api;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.CountDownLatch;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.AsyncCallback;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.AsyncCallback.StringCallback;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.CreateMode;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.WatchedEvent;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.Watcher;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.ZooKeeper;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.Watcher.Event.KeeperState;</div><div class=\"line\"><span class=\"keyword\">import</span> org.apache.zookeeper.ZooDefs.Ids;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</div><div class=\"line\"> * ZooKeeper创建节点Demo</div><div class=\"line\"> * <span class=\"doctag\">@author</span> Wang Ran</div><div class=\"line\"> */</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ZooKeeperCreateNodeDemo</span>  <span class=\"keyword\">implements</span> <span class=\"title\">Watcher</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> CountDownLatch countDownLatch = <span class=\"keyword\">new</span> CountDownLatch(<span class=\"number\">1</span>);</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> ZooKeeperCreateNodeDemo().demo2();</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">/**</div><div class=\"line\">\t * 创建持久节点</div><div class=\"line\">\t */</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">demo1</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tString zookeeperAddress = <span class=\"string\">\"192.168.128.75:2181\"</span>; <span class=\"comment\">// Zookeeper地址，多个Zookeeper地址可以英文逗号分隔，地址可指定节点</span></div><div class=\"line\">\t\t<span class=\"keyword\">int</span> sessionTimeout = <span class=\"number\">10000</span>; <span class=\"comment\">// session超时时间，单位毫秒</span></div><div class=\"line\">\t\tWatcher watcher = <span class=\"keyword\">new</span> ZooKeeperCreateNodeDemo(); <span class=\"comment\">// 事件通知处理器， 创建会话时可为null</span></div><div class=\"line\">\t\tZooKeeper zookeeper = <span class=\"keyword\">new</span> ZooKeeper(zookeeperAddress, sessionTimeout, watcher);</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"zookeeper connecting, state is \"</span> + zookeeper.getState());</div><div class=\"line\">\t\tcountDownLatch.await();</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"zookeeper connected, state is \"</span> + zookeeper.getState());</div><div class=\"line\">\t\t</div><div class=\"line\">\t\tString newNodePath = <span class=\"string\">\"/node_pokemon\"</span>;</div><div class=\"line\">\t\t<span class=\"keyword\">byte</span>[] newNodeData = <span class=\"string\">\"go\"</span>.getBytes();</div><div class=\"line\">\t\tCreateMode newNodeMode = CreateMode.PERSISTENT;</div><div class=\"line\">\t\tzookeeper.create(newNodePath, newNodeData, Ids.OPEN_ACL_UNSAFE, newNodeMode);</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"zookeeper node created\"</span>);</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">/**</div><div class=\"line\">\t * 创建节点后异步回调业务函数</div><div class=\"line\">\t */</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">demo2</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\tString zookeeperAddress = <span class=\"string\">\"192.168.128.75:2181/node_pokemon\"</span>; <span class=\"comment\">// Zookeeper地址，多个Zookeeper地址可以英文逗号分隔，地址可指定节点</span></div><div class=\"line\">\t\t<span class=\"keyword\">int</span> sessionTimeout = <span class=\"number\">10000</span>; <span class=\"comment\">// session超时时间，单位毫秒</span></div><div class=\"line\">\t\tWatcher watcher = <span class=\"keyword\">new</span> ZooKeeperCreateNodeDemo(); <span class=\"comment\">// 事件通知处理器， 创建会话时可为null</span></div><div class=\"line\">\t\tZooKeeper zookeeper = <span class=\"keyword\">new</span> ZooKeeper(zookeeperAddress, sessionTimeout, watcher);</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"zookeeper connecting, state is \"</span> + zookeeper.getState());</div><div class=\"line\">\t\tcountDownLatch.await();</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"zookeeper connected, state is \"</span> + zookeeper.getState());</div><div class=\"line\">\t\t</div><div class=\"line\">\t\tString newNodePath = <span class=\"string\">\"/node_kinosaki\"</span>;</div><div class=\"line\">\t\t<span class=\"keyword\">byte</span>[] newNodeData = <span class=\"string\">\"osen\"</span>.getBytes();</div><div class=\"line\">\t\tCreateMode newNodeMode = CreateMode.PERSISTENT_SEQUENTIAL;</div><div class=\"line\">\t\tObject ctx = <span class=\"string\">\"ContextDemo\"</span>;</div><div class=\"line\">\t\tzookeeper.create(newNodePath, newNodeData, Ids.OPEN_ACL_UNSAFE, newNodeMode, <span class=\"keyword\">new</span> StringCallbackDemo(), ctx);</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"zookeeper node created\"</span>);</div><div class=\"line\">\t\tThread.sleep(<span class=\"number\">10</span>);</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">/**</div><div class=\"line\">\t * 异步回调函数</div><div class=\"line\">\t * <span class=\"doctag\">@author</span> Wang Ran</div><div class=\"line\">\t */</span></div><div class=\"line\">\t<span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">StringCallbackDemo</span> <span class=\"keyword\">implements</span> <span class=\"title\">AsyncCallback</span>.<span class=\"title\">StringCallback</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">processResult</span><span class=\"params\">(<span class=\"keyword\">int</span> rc, String path, Object ctx, String name)</span> </span>&#123;</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"StringCallbackDemo.processResult executed!, resultCode is \"</span> + rc</div><div class=\"line\">\t\t\t\t\t+ <span class=\"string\">\", path is\"</span> + path <span class=\"comment\">// 调用接口时传入的Path</span></div><div class=\"line\">\t\t\t\t\t+ <span class=\"string\">\", context is \"</span> + ctx.toString() <span class=\"comment\">// 调用接口时传入的Context</span></div><div class=\"line\">\t\t\t\t\t+ <span class=\"string\">\", node name is \"</span> + name); <span class=\"comment\">// 实际在服务器中创建的节点名称</span></div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">process</span><span class=\"params\">(WatchedEvent watchedEvent)</span> </span>&#123;</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"ZooKeeperWatcherDemo process, watchedEvent is \"</span> + watchedEvent);</div><div class=\"line\">\t\t<span class=\"keyword\">if</span>(KeeperState.SyncConnected == watchedEvent.getState()) &#123;</div><div class=\"line\">\t\t\tcountDownLatch.countDown();</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>控制台输出：</p>\n<blockquote>\n<p>zookeeper connecting, state is CONNECTING<br>ZooKeeperWatcherDemo process, watchedEvent is WatchedEvent state:SyncConnected type:None path:null<br>zookeeper connected, state is CONNECTED<br>zookeeper node created<br>StringCallbackDemo.processResult executed!, resultCode is 0, path is/node_kinosaki, context is ContextDemo, node name is /node_kinosaki0000000005</p>\n</blockquote>\n<hr>\n<h2 id=\"通过API读取节点\"><a href=\"#通过API读取节点\" class=\"headerlink\" title=\"通过API读取节点\"></a>通过API读取节点</h2><h3 id=\"API说明：\"><a href=\"#API说明：\" class=\"headerlink\" title=\"API说明：\"></a>API说明：</h3><ul>\n<li><h3 id=\"getChildren查询指定节点的所有子节点\"><a href=\"#getChildren查询指定节点的所有子节点\" class=\"headerlink\" title=\"getChildren查询指定节点的所有子节点\"></a>getChildren查询指定节点的所有子节点</h3></li>\n<li><h3 id=\"getData查询指定节点的数据内容\"><a href=\"#getData查询指定节点的数据内容\" class=\"headerlink\" title=\"getData查询指定节点的数据内容\"></a>getData查询指定节点的数据内容</h3></li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>返回值</th>\n<th>方法</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>List</code></td>\n<td><code>getChildren  (String path, boolean watch)</code>Return the list of the children of the node of the given path.</td>\n</tr>\n<tr>\n<td><code>void</code></td>\n<td><code>getChildren  (String path, boolean watch, AsyncCallback.Children2Callback cb, Object ctx)</code>The asynchronous version of getChildren.</td>\n</tr>\n<tr>\n<td><code>void</code></td>\n<td><code>getChildren  (String path, boolean watch, AsyncCallback.ChildrenCallback cb, Object ctx)</code>The asynchronous version of getChildren.</td>\n</tr>\n<tr>\n<td><code>List</code></td>\n<td><code>getChildren  (String path, boolean watch, Stat stat)</code>For the given znode path return the stat and children list.</td>\n</tr>\n<tr>\n<td><code>List</code></td>\n<td><code>getChildren  (String path, Watcher watcher)</code>Return the list of the children of the node of the given path.</td>\n</tr>\n<tr>\n<td><code>void</code></td>\n<td><code>getChildren  (String path, Watcher watcher, AsyncCallback.Children2Callback cb, Object ctx)</code>The asynchronous version of getChildren.</td>\n</tr>\n<tr>\n<td><code>void</code></td>\n<td><code>getChildren  (String path, Watcher watcher, AsyncCallback.ChildrenCallback cb, Object ctx)</code>The asynchronous version of getChildren.</td>\n</tr>\n<tr>\n<td><code>List</code></td>\n<td><code>getChildren  (String path, Watcher watcher, Stat stat)</code>For the given znode path return the stat and children list.</td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th>返回值</th>\n<th>方法</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>void</code></td>\n<td><code>getData(String path,       boolean watch,       AsyncCallback.DataCallback cb,       Object ctx)</code>The asynchronous version of getData.</td>\n</tr>\n<tr>\n<td><code>byte[]</code></td>\n<td><code>getData(String path,       boolean watch,       Stat stat)</code>Return the data and the stat of the node of the given path.</td>\n</tr>\n<tr>\n<td><code>void</code></td>\n<td><code>getData(String path,       Watcher watcher,       AsyncCallback.DataCallback cb,       Object ctx)</code>The asynchronous version of getData.</td>\n</tr>\n<tr>\n<td><code>byte[]</code></td>\n<td><code>getData(String path,       Watcher watcher,       Stat stat)</code>Return the data and the stat of the node of the given path.</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li><h3 id=\"参数说明\"><a href=\"#参数说明\" class=\"headerlink\" title=\"参数说明\"></a>参数说明</h3></li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>path</td>\n<td>想要查询的节点路径。</td>\n</tr>\n<tr>\n<td>watch</td>\n<td>false为不需要注册watcher，true为使用默认watcher。</td>\n</tr>\n<tr>\n<td>watcher</td>\n<td>可为null。指定watcher用于订阅子节点列表变化通知。当子节点被添加或删除时会向客户端发送通知（通知内容不包含节点列表，客户端需重新查询以获得节点列表信息）。</td>\n</tr>\n<tr>\n<td>cb</td>\n<td>异步回调函数</td>\n</tr>\n<tr>\n<td>ctx</td>\n<td>上下文对象</td>\n</tr>\n<tr>\n<td>stat</td>\n<td>指定数据节点的状态信息，包含cZxid（节点创建的事务id）、mZxid（节点最后一次更新的事务id）、dataLength（节点数据内容长度），传入变量的值会在方法执行过程中被服务器响应的值替换。</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"通过API更新节点\"><a href=\"#通过API更新节点\" class=\"headerlink\" title=\"通过API更新节点\"></a>通过API更新节点</h2><h3 id=\"API说明\"><a href=\"#API说明\" class=\"headerlink\" title=\"API说明\"></a>API说明</h3><table>\n<thead>\n<tr>\n<th>返回值</th>\n<th>方法</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>Stat</code></td>\n<td><code>setData  (String path,       byte[] data,       int version)</code>Set the data for the node of the given path if such a node exists and the given version matches the version of the node (if the given version is -1, it matches any node’s versions).说明：该方法为同步更新方法</td>\n</tr>\n<tr>\n<td><code>void</code></td>\n<td><code>setData  (String path,       byte[] data,       int version,       AsyncCallback.StatCallback cb,       Object ctx)</code>The asynchronous version of setData.说明：该方法为异步更新方法</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"参数说明-1\"><a href=\"#参数说明-1\" class=\"headerlink\" title=\"参数说明\"></a>参数说明</h3><table>\n<thead>\n<tr>\n<th>参数</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>path</td>\n<td>想要更新的节点路径。</td>\n</tr>\n<tr>\n<td>data[ ]</td>\n<td>更新的内容</td>\n</tr>\n<tr>\n<td>version</td>\n<td>指定更新的数据版本</td>\n</tr>\n<tr>\n<td>cb</td>\n<td>异步回调函数</td>\n</tr>\n<tr>\n<td>ctx</td>\n<td>上下文对象</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"通过API删除节点\"><a href=\"#通过API删除节点\" class=\"headerlink\" title=\"通过API删除节点\"></a>通过API删除节点</h2><h3 id=\"API说明-1\"><a href=\"#API说明-1\" class=\"headerlink\" title=\"API说明\"></a>API说明</h3><table>\n<thead>\n<tr>\n<th>返回值</th>\n<th>方法</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>void</code></td>\n<td><code>delete  (String path,      int version)</code>Delete the node with the given path.</td>\n</tr>\n<tr>\n<td><code>void</code></td>\n<td><code>delete  (String path,      int version,      AsyncCallback.VoidCallback cb,      Object ctx)</code>The asynchronous version of delete.</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2 id=\"通过API判断节点是否存在\"><a href=\"#通过API判断节点是否存在\" class=\"headerlink\" title=\"通过API判断节点是否存在\"></a>通过API判断节点是否存在</h2><h3 id=\"API说明-2\"><a href=\"#API说明-2\" class=\"headerlink\" title=\"API说明\"></a>API说明</h3><table>\n<thead>\n<tr>\n<th>返回值</th>\n<th>方法</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>Stat</code></td>\n<td><code>exists  (String path,      boolean watch)</code>Return the stat of the node of the given path.</td>\n</tr>\n<tr>\n<td><code>void</code></td>\n<td><code>exists  (String path,      boolean watch,      AsyncCallback.StatCallback cb,      Object ctx)</code>The asynchronous version of exists.</td>\n</tr>\n<tr>\n<td><code>Stat</code></td>\n<td><code>exists  (String path,      Watcher watcher)</code>Return the stat of the node of the given path.</td>\n</tr>\n<tr>\n<td><code>void</code></td>\n<td><code>exists  (String path,      Watcher watcher,      AsyncCallback.StatCallback cb,      Object ctx)</code>The asynchronous version of exists.</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2 id=\"权限控制\"><a href=\"#权限控制\" class=\"headerlink\" title=\"权限控制\"></a>权限控制</h2><h3 id=\"API说明-3\"><a href=\"#API说明-3\" class=\"headerlink\" title=\"API说明\"></a>API说明</h3><table>\n<thead>\n<tr>\n<th>返回值</th>\n<th>方法</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>List</code></td>\n<td><code>getACL  (String path,      Stat stat)</code>Return the ACL and stat of the node of the given path.</td>\n</tr>\n<tr>\n<td><code>void</code></td>\n<td><code>getACL  (String path,      Stat stat,      AsyncCallback.ACLCallback cb,      Object ctx)</code>The asynchronous version of getACL.</td>\n</tr>\n<tr>\n<td><code>Stat</code></td>\n<td><code>setACL  (String path,      List acl,      int version)</code>Set the ACL for the node of the given path if such a node exists and the given version matches the version of the node.</td>\n</tr>\n<tr>\n<td><code>void</code></td>\n<td><code>setACL  (String path,      List acl,      int version,      AsyncCallback.StatCallback cb,      Object ctx)</code>The asynchronous version of setACL.</td>\n</tr>\n</tbody>\n</table>"}],"PostAsset":[],"PostCategory":[{"post_id":"cj1hliweo0001o65l47lgwh86","category_id":"cj1hliwfo0005o65lo9b5joag","_id":"cj1hliwgd000eo65legqegr3c"},{"post_id":"cj1hliwfa0003o65l7xivcf7r","category_id":"cj1hliwg3000bo65lv3xtgwnu","_id":"cj1hliwgl000lo65lzdmvwq85"},{"post_id":"cj1hliwfr0007o65lqinnde4t","category_id":"cj1hliwgg000ho65l7t5hcwbo","_id":"cj1hliwgm000po65l0fn1fced"},{"post_id":"cj1hliwft0008o65lj2srlrrn","category_id":"cj1hliwgl000no65l5e48nzo2","_id":"cj1hliwgo000to65le134r0x4"},{"post_id":"cj1hliwg1000ao65l8ke7ddin","category_id":"cj1hliwgm000ro65lnt0hvpyy","_id":"cj1hliwgp000xo65l05p9f7gp"},{"post_id":"cj1hliwg7000do65l21xrema0","category_id":"cj1hliwgm000ro65lnt0hvpyy","_id":"cj1hliwgr0011o65lwjlyd9ze"},{"post_id":"cj1hliwge000fo65lbljkxct4","category_id":"cj1hliwgm000ro65lnt0hvpyy","_id":"cj1hliwgv0015o65lhgrreg2o"},{"post_id":"cj1hliwgh000jo65lsyryba7f","category_id":"cj1hliwgm000ro65lnt0hvpyy","_id":"cj1hliwgz0019o65ljmecgpp0"},{"post_id":"cj1hliwgj000ko65ldmgq8jl3","category_id":"cj1hliwgm000ro65lnt0hvpyy","_id":"cj1hliwgz001bo65ldh1jv571"}],"PostTag":[{"post_id":"cj1hliweo0001o65l47lgwh86","tag_id":"cj1hliwfe0004o65lj6vhjo25","_id":"cj1hliwg6000co65lr9182ydk"},{"post_id":"cj1hliwfa0003o65l7xivcf7r","tag_id":"cj1hliwg00009o65ltephrw42","_id":"cj1hliwgh000io65li9otmotm"},{"post_id":"cj1hliwfr0007o65lqinnde4t","tag_id":"cj1hliwgg000go65lohr04itu","_id":"cj1hliwgm000oo65l6icrb2kz"},{"post_id":"cj1hliwft0008o65lj2srlrrn","tag_id":"cj1hliwgl000mo65logurgraf","_id":"cj1hliwgn000so65laxjo1t0l"},{"post_id":"cj1hliwg1000ao65l8ke7ddin","tag_id":"cj1hliwgm000qo65ltfminmbb","_id":"cj1hliwgp000wo65latccoqg5"},{"post_id":"cj1hliwg7000do65l21xrema0","tag_id":"cj1hliwgo000uo65l9g9kuo0p","_id":"cj1hliwgr0010o65l9ax4g55c"},{"post_id":"cj1hliwge000fo65lbljkxct4","tag_id":"cj1hliwgq000zo65l6sjsb1le","_id":"cj1hliwgu0014o65lt69obnvt"},{"post_id":"cj1hliwgh000jo65lsyryba7f","tag_id":"cj1hliwgu0013o65lo201ovjm","_id":"cj1hliwgz0018o65ln4b264ka"},{"post_id":"cj1hliwgj000ko65ldmgq8jl3","tag_id":"cj1hliwgy0017o65ljdzabp21","_id":"cj1hliwgz001ao65lttk5cja0"}],"Tag":[{"name":"Jekyll Github 搭建静态博客 blog","_id":"cj1hliwfe0004o65lj6vhjo25"},{"name":"数据库 事务 transaction acid lock","_id":"cj1hliwg00009o65ltephrw42"},{"name":"Jekyll Hexo blog Github","_id":"cj1hliwgg000go65lohr04itu"},{"name":"TCP Connection TCP连接","_id":"cj1hliwgl000mo65logurgraf"},{"name":"Zookeeper Paxos","_id":"cj1hliwgm000qo65ltfminmbb"},{"name":"Zookeeper ZAB","_id":"cj1hliwgo000uo65l9g9kuo0p"},{"name":"Zookeeper Curator","_id":"cj1hliwgq000zo65l6sjsb1le"},{"name":"Zookeeper zkCli.sh zkServer.sh","_id":"cj1hliwgu0013o65lo201ovjm"},{"name":"Zookeeper","_id":"cj1hliwgy0017o65ljdzabp21"}]}}